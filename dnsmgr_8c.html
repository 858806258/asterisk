<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (24 May 2007)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Thu May 24 22:27:27 2007</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Fmain_2F.html">main</a></div>
<h1>dnsmgr.c File Reference</h1>Background DNS update manager. <a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="asterisk_8h-source.html">asterisk.h</a>&quot;</code><br>
<code>#include &lt;sys/types.h&gt;</code><br>
<code>#include &lt;netinet/in.h&gt;</code><br>
<code>#include &lt;sys/socket.h&gt;</code><br>
<code>#include &lt;arpa/inet.h&gt;</code><br>
<code>#include &lt;resolv.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;unistd.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;regex.h&gt;</code><br>
<code>#include &lt;signal.h&gt;</code><br>
<code>#include &quot;<a class="el" href="dnsmgr_8h-source.html">asterisk/dnsmgr.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="linkedlists_8h-source.html">asterisk/linkedlists.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="utils_8h-source.html">asterisk/utils.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="config_8h-source.html">asterisk/config.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="logger_8h-source.html">asterisk/logger.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="sched_8h-source.html">asterisk/sched.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="options_8h-source.html">asterisk/options.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="cli_8h-source.html">asterisk/cli.h</a>&quot;</code><br>

<p>
<a href="dnsmgr_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__dnsmgr__entry.html">ast_dnsmgr_entry</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrefresh__info.html">refresh_info</a></td></tr>

<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#c571ab529e4a2af50c241b70ecf8920f">REFRESH_DEFAULT</a>&nbsp;&nbsp;&nbsp;300</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#68483fb36fcaaf84520c46f5ae70b51e">ast_dnsmgr_changed</a> (struct <a class="el" href="structast__dnsmgr__entry.html">ast_dnsmgr_entry</a> *entry)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check is see if a dnsmgr entry has changed.  <a href="#68483fb36fcaaf84520c46f5ae70b51e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__dnsmgr__entry.html">ast_dnsmgr_entry</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#aa9a042fcf60b295befa58ca2bc41bed">ast_dnsmgr_get</a> (const char *<a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>, struct in_addr *<a class="el" href="cdr__pgsql_8c.html#b4a88417b3d0170d754c647c30b7216a">result</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#c0f14e87e1c5fc7196034f2334847c6a">ast_dnsmgr_lookup</a> (const char *<a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>, struct in_addr *<a class="el" href="cdr__pgsql_8c.html#b4a88417b3d0170d754c647c30b7216a">result</a>, struct <a class="el" href="structast__dnsmgr__entry.html">ast_dnsmgr_entry</a> **dnsmgr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#00be59b11bb76ae57b4dbf8ec333e43d">ast_dnsmgr_refresh</a> (struct <a class="el" href="structast__dnsmgr__entry.html">ast_dnsmgr_entry</a> *entry)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Force a refresh of a dnsmgr entry.  <a href="#00be59b11bb76ae57b4dbf8ec333e43d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#cc6d75965018ba72c2ba0dc0520e2b4a">ast_dnsmgr_release</a> (struct <a class="el" href="structast__dnsmgr__entry.html">ast_dnsmgr_entry</a> *entry)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#711ff2ae3768fbb40b9f30a47245d5bf">AST_LIST_HEAD_STATIC</a> (entry_list, <a class="el" href="structast__dnsmgr__entry.html">ast_dnsmgr_entry</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#fc0575ff202eaa0b1876a44e2a8a1b8e">AST_MUTEX_DEFINE_STATIC</a> (refresh_lock)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#2edcd99e57832c03d01818ddbb8bf871">dnsmgr_init</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#e0a4bd789aa60ccc390a765ba087a35d">dnsmgr_refresh</a> (struct <a class="el" href="structast__dnsmgr__entry.html">ast_dnsmgr_entry</a> *entry, int verbose)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#6be31af1df8dbb8613465dc090879c17">dnsmgr_reload</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#6a5d6dd87d710376bdb793d4b5e73010">dnsmgr_start_refresh</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#4a9229bca1d088ef30786e98f0552aee">do_refresh</a> (void *data)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#e453955eb2c7dcedbe266cf9fb799b4e">do_reload</a> (int loading)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#2a1cc498a2fc9cfdc7039b5024e7b43f">handle_cli_refresh</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#01bd6ce56a1509c7d5191e05fd6a82b9">handle_cli_reload</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#4c46037349e54f093f80d14e4ec98d6e">handle_cli_status</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#5a8a80b52a581ce1e3db8682838a26ed">refresh_list</a> (void *data)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#a06014657db07d0cef05b926d96d4608">cli_refresh</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#328abb9fa714448b3c5bb9af5a72ea1f">cli_reload</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#a43065b204561baf7f5ea3fafc435672">cli_status</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#a10311459433adf322f2590a4987c423">enabled</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structrefresh__info.html">refresh_info</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#3b4b43479126508d86864420d71aada1">master_refresh_info</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#c46a842d7b4f90f8c10b1895bfbed01c">refresh_interval</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#5c82937eb07c8712bd8e0280c5cd46b6">refresh_sched</a> = -1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static pthread_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#a5b097f22debf9177beffb13ad3a8a3d">refresh_thread</a> = AST_PTHREADT_NULL</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dnsmgr_8c.html#47721f99ae60cbec027428e52ad7ca39">sched</a></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Background DNS update manager. 
<p>
<dl compact><dt><b>Author:</b></dt><dd>Kevin P. Fleming &lt;<a href="mailto:kpfleming@digium.com">kpfleming@digium.com</a>&gt; </dd></dl>

<p>
Definition in file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.<hr><h2>Define Documentation</h2>
<a class="anchor" name="c571ab529e4a2af50c241b70ecf8920f"></a><!-- doxytag: member="dnsmgr.c::REFRESH_DEFAULT" ref="c571ab529e4a2af50c241b70ecf8920f" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define REFRESH_DEFAULT&nbsp;&nbsp;&nbsp;300          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00072">72</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.
<p>
Referenced by <a class="el" href="dnsmgr_8c-source.html#l00352">do_reload()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="68483fb36fcaaf84520c46f5ae70b51e"></a><!-- doxytag: member="dnsmgr.c::ast_dnsmgr_changed" ref="68483fb36fcaaf84520c46f5ae70b51e" args="(struct ast_dnsmgr_entry *entry)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_dnsmgr_changed           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__dnsmgr__entry.html">ast_dnsmgr_entry</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>entry</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Check is see if a dnsmgr entry has changed. 
<p>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>non-zero</em>&nbsp;</td><td>if the dnsmgr entry has changed since the last call to this function </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>zero</em>&nbsp;</td><td>if the dnsmgr entry has not changed since the last call to this function </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00197">197</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.
<p>
References <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="dnsmgr_8c-source.html#l00061">ast_dnsmgr_entry::changed</a>, and <a class="el" href="dnsmgr_8c-source.html#l00062">ast_dnsmgr_entry::lock</a>.
<p>
Referenced by <a class="el" href="chan__iax2_8c-source.html#l08012">iax2_do_register()</a>.<div class="fragment"><pre class="fragment"><a name="l00198"></a>00198 {
<a name="l00199"></a>00199    <span class="keywordtype">int</span> changed;
<a name="l00200"></a>00200 
<a name="l00201"></a>00201    <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;entry-&gt;<a class="code" href="structast__dnsmgr__entry.html#dce7c4174ce9323904a934a486c41288">lock</a>);
<a name="l00202"></a>00202 
<a name="l00203"></a>00203    changed = entry-&gt;<a class="code" href="structast__dnsmgr__entry.html#8977dfac2f8e04cb96e66882235f5aba">changed</a>;
<a name="l00204"></a>00204    entry-&gt;<a class="code" href="structast__dnsmgr__entry.html#8977dfac2f8e04cb96e66882235f5aba">changed</a> = 0;
<a name="l00205"></a>00205 
<a name="l00206"></a>00206    <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;entry-&gt;<a class="code" href="structast__dnsmgr__entry.html#dce7c4174ce9323904a934a486c41288">lock</a>);
<a name="l00207"></a>00207    
<a name="l00208"></a>00208    <span class="keywordflow">return</span> changed;
<a name="l00209"></a>00209 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="aa9a042fcf60b295befa58ca2bc41bed"></a><!-- doxytag: member="dnsmgr.c::ast_dnsmgr_get" ref="aa9a042fcf60b295befa58ca2bc41bed" args="(const char *name, struct in_addr *result)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__dnsmgr__entry.html">ast_dnsmgr_entry</a>* ast_dnsmgr_get           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct in_addr *&nbsp;</td>
          <td class="mdname" nowrap> <em>result</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00089">89</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.
<p>
References <a class="el" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>, <a class="el" href="linkedlists_8h-source.html#l00650">AST_LIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, <a class="el" href="lock_8h-source.html#l00508">ast_mutex_init()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, and <a class="el" href="dnsmgr_8c-source.html#l00057">ast_dnsmgr_entry::result</a>.
<p>
Referenced by <a class="el" href="dnsmgr_8c-source.html#l00122">ast_dnsmgr_lookup()</a>.<div class="fragment"><pre class="fragment"><a name="l00090"></a>00090 {
<a name="l00091"></a>00091    <span class="keyword">struct </span><a class="code" href="structast__dnsmgr__entry.html">ast_dnsmgr_entry</a> *entry;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093    <span class="keywordflow">if</span> (!<a class="code" href="cdr__pgsql_8c.html#b4a88417b3d0170d754c647c30b7216a">result</a> || <a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>) || !(entry = <a class="code" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*entry) + strlen(<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>))))
<a name="l00094"></a>00094       <span class="keywordflow">return</span> NULL;
<a name="l00095"></a>00095 
<a name="l00096"></a>00096    entry-&gt;result = <a class="code" href="cdr__pgsql_8c.html#b4a88417b3d0170d754c647c30b7216a">result</a>;
<a name="l00097"></a>00097    <a class="code" href="lock_8h.html#33e99ac90b0ca47211841b5cab79ffc4">ast_mutex_init</a>(&amp;entry-&gt;lock);
<a name="l00098"></a>00098    strcpy(entry-&gt;name, <a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>);
<a name="l00099"></a>00099 
<a name="l00100"></a>00100    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;entry_list);
<a name="l00101"></a>00101    <a class="code" href="linkedlists_8h.html#5df56040a8838bdc841ef8eb179b7609">AST_LIST_INSERT_HEAD</a>(&amp;entry_list, entry, list);
<a name="l00102"></a>00102    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;entry_list);
<a name="l00103"></a>00103 
<a name="l00104"></a>00104    <span class="keywordflow">return</span> entry;
<a name="l00105"></a>00105 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="c0f14e87e1c5fc7196034f2334847c6a"></a><!-- doxytag: member="dnsmgr.c::ast_dnsmgr_lookup" ref="c0f14e87e1c5fc7196034f2334847c6a" args="(const char *name, struct in_addr *result, struct ast_dnsmgr_entry **dnsmgr)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_dnsmgr_lookup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct in_addr *&nbsp;</td>
          <td class="mdname" nowrap> <em>result</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct <a class="el" href="structast__dnsmgr__entry.html">ast_dnsmgr_entry</a> **&nbsp;</td>
          <td class="mdname" nowrap> <em>dnsmgr</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00122">122</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.
<p>
References <a class="el" href="dnsmgr_8c-source.html#l00089">ast_dnsmgr_get()</a>, <a class="el" href="utils_8c-source.html#l00182">ast_gethostbyname()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="logger_8c-source.html#l00989">ast_verbose()</a>, <a class="el" href="cdr_8c-source.html#l00091">enabled</a>, <a class="el" href="chan__skinny_8c-source.html#l00760">hp</a>, <a class="el" href="asterisk_8c-source.html#l00163">option_verbose</a>, <a class="el" href="logger_8h-source.html#l00044">VERBOSE_PREFIX_2</a>, and <a class="el" href="logger_8h-source.html#l00046">VERBOSE_PREFIX_4</a>.
<p>
Referenced by <a class="el" href="chan__iax2_8c-source.html#l08607">build_peer()</a>, and <a class="el" href="chan__iax2_8c-source.html#l05581">iax2_append_register()</a>.<div class="fragment"><pre class="fragment"><a name="l00123"></a>00123 {
<a name="l00124"></a>00124    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>) || !<a class="code" href="cdr__pgsql_8c.html#b4a88417b3d0170d754c647c30b7216a">result</a> || !dnsmgr)
<a name="l00125"></a>00125       <span class="keywordflow">return</span> -1;
<a name="l00126"></a>00126 
<a name="l00127"></a>00127    <span class="keywordflow">if</span> (*dnsmgr &amp;&amp; !strcasecmp((*dnsmgr)-&gt;name, name))
<a name="l00128"></a>00128       <span class="keywordflow">return</span> 0;
<a name="l00129"></a>00129 
<a name="l00130"></a>00130    <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ge36cdd7167e060bff70d00fbd82809eb">option_verbose</a> &gt; 3)
<a name="l00131"></a>00131       <a class="code" href="logger_8c.html#6a1ef0a194bcc79fccfb662192954477">ast_verbose</a>(<a class="code" href="logger_8h.html#8f25f582e7a737b25f607fb6ad653807">VERBOSE_PREFIX_4</a> <span class="stringliteral">"doing dnsmgr_lookup for '%s'\n"</span>, name);
<a name="l00132"></a>00132 
<a name="l00133"></a>00133    <span class="comment">/* if it's actually an IP address and not a name,</span>
<a name="l00134"></a>00134 <span class="comment">      there's no need for a managed lookup */</span>
<a name="l00135"></a>00135    <span class="keywordflow">if</span> (inet_aton(name, <a class="code" href="cdr__pgsql_8c.html#b4a88417b3d0170d754c647c30b7216a">result</a>))
<a name="l00136"></a>00136       <span class="keywordflow">return</span> 0;
<a name="l00137"></a>00137 
<a name="l00138"></a>00138    <span class="comment">/* if the manager is disabled, do a direct lookup and return the result,</span>
<a name="l00139"></a>00139 <span class="comment">      otherwise register a managed lookup for the name */</span>
<a name="l00140"></a>00140    <span class="keywordflow">if</span> (!<a class="code" href="cdr_8c.html#a10311459433adf322f2590a4987c423">enabled</a>) {
<a name="l00141"></a>00141       <span class="keyword">struct </span><a class="code" href="structast__hostent.html">ast_hostent</a> ahp;
<a name="l00142"></a>00142       <span class="keyword">struct </span>hostent *<a class="code" href="chan__skinny_8c.html#d2ccda10db94c2b5d51beed10484c025">hp</a>;
<a name="l00143"></a>00143 
<a name="l00144"></a>00144       <span class="keywordflow">if</span> ((hp = <a class="code" href="utils_8c.html#00f9ad2be8cda9c885557d03568816ec">ast_gethostbyname</a>(name, &amp;ahp)))
<a name="l00145"></a>00145          memcpy(<a class="code" href="cdr__pgsql_8c.html#b4a88417b3d0170d754c647c30b7216a">result</a>, hp-&gt;h_addr, <span class="keyword">sizeof</span>(result));
<a name="l00146"></a>00146       <span class="keywordflow">return</span> 0;
<a name="l00147"></a>00147    } <span class="keywordflow">else</span> {
<a name="l00148"></a>00148       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ge36cdd7167e060bff70d00fbd82809eb">option_verbose</a> &gt; 2)
<a name="l00149"></a>00149          <a class="code" href="logger_8c.html#6a1ef0a194bcc79fccfb662192954477">ast_verbose</a>(<a class="code" href="logger_8h.html#6e3640436a97291b451a8d264b5ab15d">VERBOSE_PREFIX_2</a> <span class="stringliteral">"adding dns manager for '%s'\n"</span>, name);
<a name="l00150"></a>00150       *dnsmgr = <a class="code" href="dnsmgr_8c.html#aa9a042fcf60b295befa58ca2bc41bed">ast_dnsmgr_get</a>(name, <a class="code" href="cdr__pgsql_8c.html#b4a88417b3d0170d754c647c30b7216a">result</a>);
<a name="l00151"></a>00151       <span class="keywordflow">return</span> !*dnsmgr;
<a name="l00152"></a>00152    }
<a name="l00153"></a>00153 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="00be59b11bb76ae57b4dbf8ec333e43d"></a><!-- doxytag: member="dnsmgr.c::ast_dnsmgr_refresh" ref="00be59b11bb76ae57b4dbf8ec333e43d" args="(struct ast_dnsmgr_entry *entry)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_dnsmgr_refresh           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__dnsmgr__entry.html">ast_dnsmgr_entry</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>entry</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Force a refresh of a dnsmgr entry. 
<p>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>non-zero</em>&nbsp;</td><td>if the result is different than the previous result </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>zero</em>&nbsp;</td><td>if the result is the same as the previous result </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00189">189</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.
<p>
References <a class="el" href="dnsmgr_8c-source.html#l00158">dnsmgr_refresh()</a>.
<p>
Referenced by <a class="el" href="chan__iax2_8c-source.html#l08012">iax2_do_register()</a>.<div class="fragment"><pre class="fragment"><a name="l00190"></a>00190 {
<a name="l00191"></a>00191    <span class="keywordflow">return</span> <a class="code" href="dnsmgr_8c.html#e0a4bd789aa60ccc390a765ba087a35d">dnsmgr_refresh</a>(entry, 0);
<a name="l00192"></a>00192 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="cc6d75965018ba72c2ba0dc0520e2b4a"></a><!-- doxytag: member="dnsmgr.c::ast_dnsmgr_release" ref="cc6d75965018ba72c2ba0dc0520e2b4a" args="(struct ast_dnsmgr_entry *entry)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_dnsmgr_release           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__dnsmgr__entry.html">ast_dnsmgr_entry</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>entry</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00107">107</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.
<p>
References <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00731">AST_LIST_REMOVE</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, <a class="el" href="lock_8h-source.html#l00525">ast_mutex_destroy()</a>, <a class="el" href="logger_8c-source.html#l00989">ast_verbose()</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="dnsmgr_8c-source.html#l00062">ast_dnsmgr_entry::lock</a>, <a class="el" href="asterisk_8c-source.html#l00163">option_verbose</a>, and <a class="el" href="logger_8h-source.html#l00046">VERBOSE_PREFIX_4</a>.
<p>
Referenced by <a class="el" href="chan__iax2_8c-source.html#l09068">delete_users()</a>, <a class="el" href="chan__iax2_8c-source.html#l09131">destroy_peer()</a>, and <a class="el" href="chan__sip_8c-source.html#l02679">sip_destroy_peer()</a>.<div class="fragment"><pre class="fragment"><a name="l00108"></a>00108 {
<a name="l00109"></a>00109    <span class="keywordflow">if</span> (!entry)
<a name="l00110"></a>00110       <span class="keywordflow">return</span>;
<a name="l00111"></a>00111 
<a name="l00112"></a>00112    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;entry_list);
<a name="l00113"></a>00113    <a class="code" href="linkedlists_8h.html#d4a4c53d3b264b4e1c5e3fdd84cd8b5a">AST_LIST_REMOVE</a>(&amp;entry_list, entry, list);
<a name="l00114"></a>00114    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;entry_list);
<a name="l00115"></a>00115    <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ge36cdd7167e060bff70d00fbd82809eb">option_verbose</a> &gt; 3)
<a name="l00116"></a>00116       <a class="code" href="logger_8c.html#6a1ef0a194bcc79fccfb662192954477">ast_verbose</a>(<a class="code" href="logger_8h.html#8f25f582e7a737b25f607fb6ad653807">VERBOSE_PREFIX_4</a> <span class="stringliteral">"removing dns manager for '%s'\n"</span>, entry-&gt;name);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118    <a class="code" href="lock_8h.html#1b27af7774f46859ffe2b1340ee7c082">ast_mutex_destroy</a>(&amp;entry-&gt;<a class="code" href="structast__dnsmgr__entry.html#dce7c4174ce9323904a934a486c41288">lock</a>);
<a name="l00119"></a>00119    <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(entry);
<a name="l00120"></a>00120 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="711ff2ae3768fbb40b9f30a47245d5bf"></a><!-- doxytag: member="dnsmgr.c::AST_LIST_HEAD_STATIC" ref="711ff2ae3768fbb40b9f30a47245d5bf" args="(entry_list, ast_dnsmgr_entry)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static AST_LIST_HEAD_STATIC           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">entry_list&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="structast__dnsmgr__entry.html">ast_dnsmgr_entry</a>&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="fc0575ff202eaa0b1876a44e2a8a1b8e"></a><!-- doxytag: member="dnsmgr.c::AST_MUTEX_DEFINE_STATIC" ref="fc0575ff202eaa0b1876a44e2a8a1b8e" args="(refresh_lock)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">AST_MUTEX_DEFINE_STATIC           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">refresh_lock&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="2edcd99e57832c03d01818ddbb8bf871"></a><!-- doxytag: member="dnsmgr.c::dnsmgr_init" ref="2edcd99e57832c03d01818ddbb8bf871" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int dnsmgr_init           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Provided by <a class="el" href="dnsmgr_8c.html">dnsmgr.c</a> 
<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00336">336</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.
<p>
References <a class="el" href="cli_8c-source.html#l01344">ast_cli_register()</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="cdr_8c-source.html#l01229">do_reload()</a>, <a class="el" href="logger_8h-source.html#l00118">LOG_ERROR</a>, and <a class="el" href="sched_8c-source.html#l00075">sched_context_create()</a>.
<p>
Referenced by <a class="el" href="asterisk_8c-source.html#l02570">main()</a>.<div class="fragment"><pre class="fragment"><a name="l00337"></a>00337 {
<a name="l00338"></a>00338    <span class="keywordflow">if</span> (!(<a class="code" href="structsched.html">sched</a> = <a class="code" href="sched_8c.html#4326fa64fd840788d03093b9931bb1fb">sched_context_create</a>())) {
<a name="l00339"></a>00339       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#4490aa3d29644e716440fada68f54032">LOG_ERROR</a>, <span class="stringliteral">"Unable to create schedule context.\n"</span>);
<a name="l00340"></a>00340       <span class="keywordflow">return</span> -1;
<a name="l00341"></a>00341    }
<a name="l00342"></a>00342    <a class="code" href="cli_8c.html#63b8a59f72a7d4f5f3cdef8190057349">ast_cli_register</a>(&amp;<a class="code" href="dnsmgr_8c.html#328abb9fa714448b3c5bb9af5a72ea1f">cli_reload</a>);
<a name="l00343"></a>00343    <a class="code" href="cli_8c.html#63b8a59f72a7d4f5f3cdef8190057349">ast_cli_register</a>(&amp;<a class="code" href="cdr_8c.html#a43065b204561baf7f5ea3fafc435672">cli_status</a>);
<a name="l00344"></a>00344    <span class="keywordflow">return</span> <a class="code" href="cdr_8c.html#398d4ec50a0d5be51afce0244d30f16d">do_reload</a>(1);
<a name="l00345"></a>00345 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="e0a4bd789aa60ccc390a765ba087a35d"></a><!-- doxytag: member="dnsmgr.c::dnsmgr_refresh" ref="e0a4bd789aa60ccc390a765ba087a35d" args="(struct ast_dnsmgr_entry *entry, int verbose)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int dnsmgr_refresh           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__dnsmgr__entry.html">ast_dnsmgr_entry</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>entry</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>verbose</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00158">158</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.
<p>
References <a class="el" href="utils_8c-source.html#l00182">ast_gethostbyname()</a>, <a class="el" href="utils_8c-source.html#l00493">ast_inet_ntoa()</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="logger_8c-source.html#l00989">ast_verbose()</a>, <a class="el" href="dnsmgr_8c-source.html#l00061">ast_dnsmgr_entry::changed</a>, <a class="el" href="chan__skinny_8c-source.html#l00760">hp</a>, <a class="el" href="dnsmgr_8c-source.html#l00059">ast_dnsmgr_entry::last</a>, <a class="el" href="dnsmgr_8c-source.html#l00062">ast_dnsmgr_entry::lock</a>, <a class="el" href="logger_8h-source.html#l00106">LOG_NOTICE</a>, <a class="el" href="asterisk_8c-source.html#l00163">option_verbose</a>, <a class="el" href="dnsmgr_8c-source.html#l00057">ast_dnsmgr_entry::result</a>, and <a class="el" href="logger_8h-source.html#l00044">VERBOSE_PREFIX_2</a>.
<p>
Referenced by <a class="el" href="dnsmgr_8c-source.html#l00189">ast_dnsmgr_refresh()</a>, and <a class="el" href="dnsmgr_8c-source.html#l00222">refresh_list()</a>.<div class="fragment"><pre class="fragment"><a name="l00159"></a>00159 {
<a name="l00160"></a>00160    <span class="keyword">struct </span><a class="code" href="structast__hostent.html">ast_hostent</a> ahp;
<a name="l00161"></a>00161    <span class="keyword">struct </span>hostent *<a class="code" href="chan__skinny_8c.html#d2ccda10db94c2b5d51beed10484c025">hp</a>;
<a name="l00162"></a>00162    <span class="keywordtype">char</span> iabuf[INET_ADDRSTRLEN];
<a name="l00163"></a>00163    <span class="keywordtype">char</span> iabuf2[INET_ADDRSTRLEN];
<a name="l00164"></a>00164    <span class="keyword">struct </span>in_addr tmp;
<a name="l00165"></a>00165    <span class="keywordtype">int</span> changed = 0;
<a name="l00166"></a>00166         
<a name="l00167"></a>00167    <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;entry-&gt;<a class="code" href="structast__dnsmgr__entry.html#dce7c4174ce9323904a934a486c41288">lock</a>);
<a name="l00168"></a>00168    <span class="keywordflow">if</span> (verbose &amp;&amp; (<a class="code" href="group__main__options.html#ge36cdd7167e060bff70d00fbd82809eb">option_verbose</a> &gt; 2))
<a name="l00169"></a>00169       <a class="code" href="logger_8c.html#6a1ef0a194bcc79fccfb662192954477">ast_verbose</a>(<a class="code" href="logger_8h.html#6e3640436a97291b451a8d264b5ab15d">VERBOSE_PREFIX_2</a> <span class="stringliteral">"refreshing '%s'\n"</span>, entry-&gt;name);
<a name="l00170"></a>00170 
<a name="l00171"></a>00171    <span class="keywordflow">if</span> ((hp = <a class="code" href="utils_8c.html#00f9ad2be8cda9c885557d03568816ec">ast_gethostbyname</a>(entry-&gt;name, &amp;ahp))) {
<a name="l00172"></a>00172       <span class="comment">/* check to see if it has changed, do callback if requested (where de callback is defined ????) */</span>
<a name="l00173"></a>00173       memcpy(&amp;tmp, hp-&gt;h_addr, <span class="keyword">sizeof</span>(tmp));
<a name="l00174"></a>00174       <span class="keywordflow">if</span> (tmp.s_addr != entry-&gt;<a class="code" href="structast__dnsmgr__entry.html#98bd1c45684cf587ac2347a92dd7bb51">last</a>.s_addr) {
<a name="l00175"></a>00175          ast_copy_string(iabuf, <a class="code" href="utils_8c.html#d5490a9b672272bd2f20ee1e5b72c11e">ast_inet_ntoa</a>(entry-&gt;<a class="code" href="structast__dnsmgr__entry.html#98bd1c45684cf587ac2347a92dd7bb51">last</a>), <span class="keyword">sizeof</span>(iabuf));
<a name="l00176"></a>00176          ast_copy_string(iabuf2, <a class="code" href="utils_8c.html#d5490a9b672272bd2f20ee1e5b72c11e">ast_inet_ntoa</a>(tmp), <span class="keyword">sizeof</span>(iabuf2));
<a name="l00177"></a>00177          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#bbf95aad74d847cd4bcb129604f798cd">LOG_NOTICE</a>, <span class="stringliteral">"host '%s' changed from %s to %s\n"</span>, 
<a name="l00178"></a>00178             entry-&gt;name, iabuf, iabuf2);
<a name="l00179"></a>00179          memcpy(entry-&gt;<a class="code" href="structast__dnsmgr__entry.html#b4a88417b3d0170d754c647c30b7216a">result</a>, hp-&gt;h_addr, <span class="keyword">sizeof</span>(entry-&gt;<a class="code" href="structast__dnsmgr__entry.html#b4a88417b3d0170d754c647c30b7216a">result</a>));
<a name="l00180"></a>00180          memcpy(&amp;entry-&gt;<a class="code" href="structast__dnsmgr__entry.html#98bd1c45684cf587ac2347a92dd7bb51">last</a>, hp-&gt;h_addr, <span class="keyword">sizeof</span>(entry-&gt;<a class="code" href="structast__dnsmgr__entry.html#98bd1c45684cf587ac2347a92dd7bb51">last</a>));
<a name="l00181"></a>00181          changed = entry-&gt;<a class="code" href="structast__dnsmgr__entry.html#8977dfac2f8e04cb96e66882235f5aba">changed</a> = 1;
<a name="l00182"></a>00182       } 
<a name="l00183"></a>00183       
<a name="l00184"></a>00184    }
<a name="l00185"></a>00185    <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;entry-&gt;<a class="code" href="structast__dnsmgr__entry.html#dce7c4174ce9323904a934a486c41288">lock</a>);
<a name="l00186"></a>00186    <span class="keywordflow">return</span> changed;
<a name="l00187"></a>00187 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="6be31af1df8dbb8613465dc090879c17"></a><!-- doxytag: member="dnsmgr.c::dnsmgr_reload" ref="6be31af1df8dbb8613465dc090879c17" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int dnsmgr_reload           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Provided by <a class="el" href="dnsmgr_8c.html">dnsmgr.c</a> 
<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00347">347</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.
<p>
References <a class="el" href="cdr_8c-source.html#l01229">do_reload()</a>.<div class="fragment"><pre class="fragment"><a name="l00348"></a>00348 {
<a name="l00349"></a>00349    <span class="keywordflow">return</span> <a class="code" href="cdr_8c.html#398d4ec50a0d5be51afce0244d30f16d">do_reload</a>(0);
<a name="l00350"></a>00350 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="6a5d6dd87d710376bdb793d4b5e73010"></a><!-- doxytag: member="dnsmgr.c::dnsmgr_start_refresh" ref="6a5d6dd87d710376bdb793d4b5e73010" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void dnsmgr_start_refresh           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Provided by <a class="el" href="dnsmgr_8c.html">dnsmgr.c</a> 
<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00251">251</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.
<p>
References <a class="el" href="sched_8c-source.html#l00215">ast_sched_add_variable()</a>, <a class="el" href="sched_8c-source.html#l00259">ast_sched_del()</a>, <a class="el" href="dnsmgr_8c-source.html#l00222">refresh_list()</a>, and <a class="el" href="dnsmgr_8c-source.html#l00052">refresh_sched</a>.
<p>
Referenced by <a class="el" href="asterisk_8c-source.html#l02570">main()</a>.<div class="fragment"><pre class="fragment"><a name="l00252"></a>00252 {
<a name="l00253"></a>00253    <span class="keywordflow">if</span> (<a class="code" href="dnsmgr_8c.html#5c82937eb07c8712bd8e0280c5cd46b6">refresh_sched</a> &gt; -1) {
<a name="l00254"></a>00254       <a class="code" href="sched_8c.html#4a0b784f64b9caf71932a3344c9c7c49">ast_sched_del</a>(<a class="code" href="structsched.html">sched</a>, <a class="code" href="dnsmgr_8c.html#5c82937eb07c8712bd8e0280c5cd46b6">refresh_sched</a>);
<a name="l00255"></a>00255       <a class="code" href="dnsmgr_8c.html#5c82937eb07c8712bd8e0280c5cd46b6">refresh_sched</a> = <a class="code" href="sched_8c.html#5e691064a5722460631d25cabf3b7756">ast_sched_add_variable</a>(<a class="code" href="structsched.html">sched</a>, 100, <a class="code" href="dnsmgr_8c.html#5a8a80b52a581ce1e3db8682838a26ed">refresh_list</a>, &amp;<a class="code" href="dnsmgr_8c.html#3b4b43479126508d86864420d71aada1">master_refresh_info</a>, 1);
<a name="l00256"></a>00256    }
<a name="l00257"></a>00257 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="4a9229bca1d088ef30786e98f0552aee"></a><!-- doxytag: member="dnsmgr.c::do_refresh" ref="4a9229bca1d088ef30786e98f0552aee" args="(void *data)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void* do_refresh           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>data</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00211">211</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.
<p>
References <a class="el" href="sched_8c-source.html#l00329">ast_sched_runq()</a>, and <a class="el" href="sched_8c-source.html#l00148">ast_sched_wait()</a>.
<p>
Referenced by <a class="el" href="dnsmgr_8c-source.html#l00352">do_reload()</a>.<div class="fragment"><pre class="fragment"><a name="l00212"></a>00212 {
<a name="l00213"></a>00213    <span class="keywordflow">for</span> (;;) {
<a name="l00214"></a>00214       pthread_testcancel();
<a name="l00215"></a>00215       usleep((<a class="code" href="sched_8c.html#be772a122828e81602f21038162f6dff">ast_sched_wait</a>(<a class="code" href="structsched.html">sched</a>)*1000));
<a name="l00216"></a>00216       pthread_testcancel();
<a name="l00217"></a>00217       <a class="code" href="sched_8c.html#2ea97d35de659fe307e6d5c6c4e11ffc">ast_sched_runq</a>(<a class="code" href="structsched.html">sched</a>);
<a name="l00218"></a>00218    }
<a name="l00219"></a>00219    <span class="keywordflow">return</span> NULL;
<a name="l00220"></a>00220 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="e453955eb2c7dcedbe266cf9fb799b4e"></a><!-- doxytag: member="dnsmgr.c::do_reload" ref="e453955eb2c7dcedbe266cf9fb799b4e" args="(int loading)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int do_reload           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>loading</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00352">352</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.
<p>
References <a class="el" href="cli_8c-source.html#l01344">ast_cli_register()</a>, <a class="el" href="cli_8c-source.html#l01338">ast_cli_unregister()</a>, <a class="el" href="config_8c-source.html#l00555">ast_config_destroy()</a>, <a class="el" href="config_8c-source.html#l01278">ast_config_load()</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="utils_8h-source.html#l00307">ast_pthread_create_background</a>, <a class="el" href="lock_8h-source.html#l00074">AST_PTHREADT_NULL</a>, <a class="el" href="sched_8c-source.html#l00215">ast_sched_add_variable()</a>, <a class="el" href="sched_8c-source.html#l00259">ast_sched_del()</a>, <a class="el" href="utils_8c-source.html#l00724">ast_true()</a>, <a class="el" href="config_8c-source.html#l00244">ast_variable_retrieve()</a>, <a class="el" href="chan__agent_8c-source.html#l00077">config</a>, <a class="el" href="dnsmgr_8c-source.html#l00211">do_refresh()</a>, <a class="el" href="cdr_8c-source.html#l00091">enabled</a>, <a class="el" href="logger_8h-source.html#l00118">LOG_ERROR</a>, <a class="el" href="logger_8h-source.html#l00106">LOG_NOTICE</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="dnsmgr_8c-source.html#l00072">REFRESH_DEFAULT</a>, <a class="el" href="dnsmgr_8c-source.html#l00075">refresh_interval</a>, <a class="el" href="dnsmgr_8c-source.html#l00222">refresh_list()</a>, <a class="el" href="dnsmgr_8c-source.html#l00052">refresh_sched</a>, and <a class="el" href="dnsmgr_8c-source.html#l00053">refresh_thread</a>.<div class="fragment"><pre class="fragment"><a name="l00353"></a>00353 {
<a name="l00354"></a>00354    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *<a class="code" href="chan__agent_8c.html#71d63bae4fa3507f57ae4e35f6de4c63">config</a>;
<a name="l00355"></a>00355    <span class="keyword">const</span> <span class="keywordtype">char</span> *interval_value;
<a name="l00356"></a>00356    <span class="keyword">const</span> <span class="keywordtype">char</span> *enabled_value;
<a name="l00357"></a>00357    <span class="keywordtype">int</span> interval;
<a name="l00358"></a>00358    <span class="keywordtype">int</span> was_enabled;
<a name="l00359"></a>00359    <span class="keywordtype">int</span> res = -1;
<a name="l00360"></a>00360 
<a name="l00361"></a>00361    <span class="comment">/* ensure that no refresh cycles run while the reload is in progress */</span>
<a name="l00362"></a>00362    <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;refresh_lock);
<a name="l00363"></a>00363 
<a name="l00364"></a>00364    <span class="comment">/* reset defaults in preparation for reading config file */</span>
<a name="l00365"></a>00365    <a class="code" href="dnsmgr_8c.html#c46a842d7b4f90f8c10b1895bfbed01c">refresh_interval</a> = <a class="code" href="dnsmgr_8c.html#c571ab529e4a2af50c241b70ecf8920f">REFRESH_DEFAULT</a>;
<a name="l00366"></a>00366    was_enabled = <a class="code" href="cdr_8c.html#a10311459433adf322f2590a4987c423">enabled</a>;
<a name="l00367"></a>00367    <a class="code" href="cdr_8c.html#a10311459433adf322f2590a4987c423">enabled</a> = 0;
<a name="l00368"></a>00368 
<a name="l00369"></a>00369    <span class="keywordflow">if</span> (<a class="code" href="dnsmgr_8c.html#5c82937eb07c8712bd8e0280c5cd46b6">refresh_sched</a> &gt; -1)
<a name="l00370"></a>00370       <a class="code" href="sched_8c.html#4a0b784f64b9caf71932a3344c9c7c49">ast_sched_del</a>(<a class="code" href="structsched.html">sched</a>, <a class="code" href="dnsmgr_8c.html#5c82937eb07c8712bd8e0280c5cd46b6">refresh_sched</a>);
<a name="l00371"></a>00371 
<a name="l00372"></a>00372    <span class="keywordflow">if</span> ((config = <a class="code" href="config_8c.html#0ea8bde5422fa0db50302e0f710e18c1">ast_config_load</a>(<span class="stringliteral">"dnsmgr.conf"</span>))) {
<a name="l00373"></a>00373       <span class="keywordflow">if</span> ((enabled_value = <a class="code" href="config_8c.html#db24588ed54fb0d9d8f078b9d64bd0e1">ast_variable_retrieve</a>(config, <span class="stringliteral">"general"</span>, <span class="stringliteral">"enable"</span>))) {
<a name="l00374"></a>00374          <a class="code" href="cdr_8c.html#a10311459433adf322f2590a4987c423">enabled</a> = <a class="code" href="utils_8c.html#63bb02e4d6f18c1dbeca92dc63310685">ast_true</a>(enabled_value);
<a name="l00375"></a>00375       }
<a name="l00376"></a>00376       <span class="keywordflow">if</span> ((interval_value = <a class="code" href="config_8c.html#db24588ed54fb0d9d8f078b9d64bd0e1">ast_variable_retrieve</a>(config, <span class="stringliteral">"general"</span>, <span class="stringliteral">"refreshinterval"</span>))) {
<a name="l00377"></a>00377          <span class="keywordflow">if</span> (sscanf(interval_value, <span class="stringliteral">"%d"</span>, &amp;interval) &lt; 1)
<a name="l00378"></a>00378             <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Unable to convert '%s' to a numeric value.\n"</span>, interval_value);
<a name="l00379"></a>00379          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (interval &lt; 0)
<a name="l00380"></a>00380             <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Invalid refresh interval '%d' specified, using default\n"</span>, interval);
<a name="l00381"></a>00381          <span class="keywordflow">else</span>
<a name="l00382"></a>00382             <a class="code" href="dnsmgr_8c.html#c46a842d7b4f90f8c10b1895bfbed01c">refresh_interval</a> = interval;
<a name="l00383"></a>00383       }
<a name="l00384"></a>00384       <a class="code" href="config_8c.html#ad84c9d29ca53758c2a113d057e221a0">ast_config_destroy</a>(config);
<a name="l00385"></a>00385    }
<a name="l00386"></a>00386 
<a name="l00387"></a>00387    <span class="keywordflow">if</span> (<a class="code" href="cdr_8c.html#a10311459433adf322f2590a4987c423">enabled</a> &amp;&amp; <a class="code" href="dnsmgr_8c.html#c46a842d7b4f90f8c10b1895bfbed01c">refresh_interval</a>)
<a name="l00388"></a>00388       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#bbf95aad74d847cd4bcb129604f798cd">LOG_NOTICE</a>, <span class="stringliteral">"Managed DNS entries will be refreshed every %d seconds.\n"</span>, <a class="code" href="dnsmgr_8c.html#c46a842d7b4f90f8c10b1895bfbed01c">refresh_interval</a>);
<a name="l00389"></a>00389 
<a name="l00390"></a>00390    <span class="comment">/* if this reload enabled the manager, create the background thread</span>
<a name="l00391"></a>00391 <span class="comment">      if it does not exist */</span>
<a name="l00392"></a>00392    <span class="keywordflow">if</span> (<a class="code" href="cdr_8c.html#a10311459433adf322f2590a4987c423">enabled</a>) {
<a name="l00393"></a>00393       <span class="keywordflow">if</span> (!was_enabled &amp;&amp; (<a class="code" href="dnsmgr_8c.html#a5b097f22debf9177beffb13ad3a8a3d">refresh_thread</a> == <a class="code" href="lock_8h.html#84e4b34008de83ea9d1fa44057758022">AST_PTHREADT_NULL</a>)) {
<a name="l00394"></a>00394          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#351b78c7aeb62b2b57eb447287cdd9d4">ast_pthread_create_background</a>(&amp;<a class="code" href="dnsmgr_8c.html#a5b097f22debf9177beffb13ad3a8a3d">refresh_thread</a>, NULL, <a class="code" href="dnsmgr_8c.html#4a9229bca1d088ef30786e98f0552aee">do_refresh</a>, NULL) &lt; 0) {
<a name="l00395"></a>00395             <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#4490aa3d29644e716440fada68f54032">LOG_ERROR</a>, <span class="stringliteral">"Unable to start refresh thread.\n"</span>);
<a name="l00396"></a>00396          }
<a name="l00397"></a>00397          <a class="code" href="cli_8c.html#63b8a59f72a7d4f5f3cdef8190057349">ast_cli_register</a>(&amp;<a class="code" href="dnsmgr_8c.html#a06014657db07d0cef05b926d96d4608">cli_refresh</a>);
<a name="l00398"></a>00398       }
<a name="l00399"></a>00399       <span class="comment">/* make a background refresh happen right away */</span>
<a name="l00400"></a>00400       <a class="code" href="dnsmgr_8c.html#5c82937eb07c8712bd8e0280c5cd46b6">refresh_sched</a> = <a class="code" href="sched_8c.html#5e691064a5722460631d25cabf3b7756">ast_sched_add_variable</a>(<a class="code" href="structsched.html">sched</a>, 100, <a class="code" href="dnsmgr_8c.html#5a8a80b52a581ce1e3db8682838a26ed">refresh_list</a>, &amp;<a class="code" href="dnsmgr_8c.html#3b4b43479126508d86864420d71aada1">master_refresh_info</a>, 1);
<a name="l00401"></a>00401       res = 0;
<a name="l00402"></a>00402    }
<a name="l00403"></a>00403    <span class="comment">/* if this reload disabled the manager and there is a background thread,</span>
<a name="l00404"></a>00404 <span class="comment">      kill it */</span>
<a name="l00405"></a>00405    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="cdr_8c.html#a10311459433adf322f2590a4987c423">enabled</a> &amp;&amp; was_enabled &amp;&amp; (<a class="code" href="dnsmgr_8c.html#a5b097f22debf9177beffb13ad3a8a3d">refresh_thread</a> != <a class="code" href="lock_8h.html#84e4b34008de83ea9d1fa44057758022">AST_PTHREADT_NULL</a>)) {
<a name="l00406"></a>00406       <span class="comment">/* wake up the thread so it will exit */</span>
<a name="l00407"></a>00407       pthread_cancel(<a class="code" href="dnsmgr_8c.html#a5b097f22debf9177beffb13ad3a8a3d">refresh_thread</a>);
<a name="l00408"></a>00408       pthread_kill(<a class="code" href="dnsmgr_8c.html#a5b097f22debf9177beffb13ad3a8a3d">refresh_thread</a>, SIGURG);
<a name="l00409"></a>00409       pthread_join(<a class="code" href="dnsmgr_8c.html#a5b097f22debf9177beffb13ad3a8a3d">refresh_thread</a>, NULL);
<a name="l00410"></a>00410       <a class="code" href="dnsmgr_8c.html#a5b097f22debf9177beffb13ad3a8a3d">refresh_thread</a> = <a class="code" href="lock_8h.html#84e4b34008de83ea9d1fa44057758022">AST_PTHREADT_NULL</a>;
<a name="l00411"></a>00411       <a class="code" href="cli_8c.html#b895af7894fd3ae1f535f8e84811b2ea">ast_cli_unregister</a>(&amp;<a class="code" href="dnsmgr_8c.html#a06014657db07d0cef05b926d96d4608">cli_refresh</a>);
<a name="l00412"></a>00412       res = 0;
<a name="l00413"></a>00413    }
<a name="l00414"></a>00414    <span class="keywordflow">else</span>
<a name="l00415"></a>00415       res = 0;
<a name="l00416"></a>00416 
<a name="l00417"></a>00417    <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;refresh_lock);
<a name="l00418"></a>00418 
<a name="l00419"></a>00419    <span class="keywordflow">return</span> res;
<a name="l00420"></a>00420 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="2a1cc498a2fc9cfdc7039b5024e7b43f"></a><!-- doxytag: member="dnsmgr.c::handle_cli_refresh" ref="2a1cc498a2fc9cfdc7039b5024e7b43f" args="(int fd, int argc, char *argv[])" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int handle_cli_refresh           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em>[]</td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00270">270</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.
<p>
References <a class="el" href="dnsmgr_8c-source.html#l00078">refresh_info::entries</a>, <a class="el" href="dnsmgr_8c-source.html#l00081">refresh_info::filter</a>, <a class="el" href="dnsmgr_8c-source.html#l00222">refresh_list()</a>, <a class="el" href="dnsmgr_8c-source.html#l00080">refresh_info::regex_present</a>, and <a class="el" href="cli_8h-source.html#l00038">RESULT_SHOWUSAGE</a>.<div class="fragment"><pre class="fragment"><a name="l00271"></a>00271 {
<a name="l00272"></a>00272    <span class="keyword">struct </span><a class="code" href="structrefresh__info.html">refresh_info</a> info = {
<a name="l00273"></a>00273       .<a class="code" href="structrefresh__info.html#5fce916b625108149ee3ea5f48d9b0d1">entries</a> = &amp;entry_list,
<a name="l00274"></a>00274       .verbose = 1,
<a name="l00275"></a>00275    };
<a name="l00276"></a>00276 
<a name="l00277"></a>00277    <span class="keywordflow">if</span> (argc &gt; 3)
<a name="l00278"></a>00278       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d7f3bcd35c16172e6fc0964a175fcadb">RESULT_SHOWUSAGE</a>;
<a name="l00279"></a>00279 
<a name="l00280"></a>00280    <span class="keywordflow">if</span> (argc == 3) {
<a name="l00281"></a>00281       <span class="keywordflow">if</span> (regcomp(&amp;info.<a class="code" href="structrefresh__info.html#b2c97ae425dd751b0e48a3acae79cf4a">filter</a>, argv[2], REG_EXTENDED | REG_NOSUB))
<a name="l00282"></a>00282          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d7f3bcd35c16172e6fc0964a175fcadb">RESULT_SHOWUSAGE</a>;
<a name="l00283"></a>00283       <span class="keywordflow">else</span>
<a name="l00284"></a>00284          info.<a class="code" href="structrefresh__info.html#850cf5dd1a4fbf9413cf6bd8dfa568e1">regex_present</a> = 1;
<a name="l00285"></a>00285    }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287    <a class="code" href="dnsmgr_8c.html#5a8a80b52a581ce1e3db8682838a26ed">refresh_list</a>(&amp;info);
<a name="l00288"></a>00288 
<a name="l00289"></a>00289    <span class="keywordflow">if</span> (info.<a class="code" href="structrefresh__info.html#850cf5dd1a4fbf9413cf6bd8dfa568e1">regex_present</a>)
<a name="l00290"></a>00290       regfree(&amp;info.<a class="code" href="structrefresh__info.html#b2c97ae425dd751b0e48a3acae79cf4a">filter</a>);
<a name="l00291"></a>00291 
<a name="l00292"></a>00292    <span class="keywordflow">return</span> 0;
<a name="l00293"></a>00293 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="01bd6ce56a1509c7d5191e05fd6a82b9"></a><!-- doxytag: member="dnsmgr.c::handle_cli_reload" ref="01bd6ce56a1509c7d5191e05fd6a82b9" args="(int fd, int argc, char *argv[])" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int handle_cli_reload           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em>[]</td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00261">261</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.
<p>
References <a class="el" href="cdr_8c-source.html#l01229">do_reload()</a>, and <a class="el" href="cli_8h-source.html#l00038">RESULT_SHOWUSAGE</a>.<div class="fragment"><pre class="fragment"><a name="l00262"></a>00262 {
<a name="l00263"></a>00263    <span class="keywordflow">if</span> (argc &gt; 2)
<a name="l00264"></a>00264       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d7f3bcd35c16172e6fc0964a175fcadb">RESULT_SHOWUSAGE</a>;
<a name="l00265"></a>00265 
<a name="l00266"></a>00266    <a class="code" href="cdr_8c.html#398d4ec50a0d5be51afce0244d30f16d">do_reload</a>(0);
<a name="l00267"></a>00267    <span class="keywordflow">return</span> 0;
<a name="l00268"></a>00268 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="4c46037349e54f093f80d14e4ec98d6e"></a><!-- doxytag: member="dnsmgr.c::handle_cli_status" ref="4c46037349e54f093f80d14e4ec98d6e" args="(int fd, int argc, char *argv[])" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int handle_cli_status           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em>[]</td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00295">295</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.
<p>
References <a class="el" href="cli_8c-source.html#l00057">ast_cli()</a>, <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00453">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, <a class="el" href="cdr_8c-source.html#l00091">enabled</a>, <a class="el" href="dnsmgr_8c-source.html#l00075">refresh_interval</a>, and <a class="el" href="cli_8h-source.html#l00038">RESULT_SHOWUSAGE</a>.<div class="fragment"><pre class="fragment"><a name="l00296"></a>00296 {
<a name="l00297"></a>00297    <span class="keywordtype">int</span> count = 0;
<a name="l00298"></a>00298    <span class="keyword">struct </span><a class="code" href="structast__dnsmgr__entry.html">ast_dnsmgr_entry</a> *entry;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300    <span class="keywordflow">if</span> (argc &gt; 2)
<a name="l00301"></a>00301       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d7f3bcd35c16172e6fc0964a175fcadb">RESULT_SHOWUSAGE</a>;
<a name="l00302"></a>00302 
<a name="l00303"></a>00303    <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"DNS Manager: %s\n"</span>, <a class="code" href="cdr_8c.html#a10311459433adf322f2590a4987c423">enabled</a> ? <span class="stringliteral">"enabled"</span> : <span class="stringliteral">"disabled"</span>);
<a name="l00304"></a>00304    <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"Refresh Interval: %d seconds\n"</span>, <a class="code" href="dnsmgr_8c.html#c46a842d7b4f90f8c10b1895bfbed01c">refresh_interval</a>);
<a name="l00305"></a>00305    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;entry_list);
<a name="l00306"></a>00306    <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;entry_list, entry, list)
<a name="l00307"></a>00307       count++;
<a name="l00308"></a>00308    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;entry_list);
<a name="l00309"></a>00309    <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, "Number of entries: %d\n", count);
<a name="l00310"></a>00310 
<a name="l00311"></a>00311    return 0;
<a name="l00312"></a>00312 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="5a8a80b52a581ce1e3db8682838a26ed"></a><!-- doxytag: member="dnsmgr.c::refresh_list" ref="5a8a80b52a581ce1e3db8682838a26ed" args="(void *data)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int refresh_list           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>data</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00222">222</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.
<p>
References <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00453">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="lock_8h-source.html#l00535">ast_mutex_trylock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="logger_8c-source.html#l00989">ast_verbose()</a>, <a class="el" href="dnsmgr_8c-source.html#l00158">dnsmgr_refresh()</a>, <a class="el" href="dnsmgr_8c-source.html#l00078">refresh_info::entries</a>, <a class="el" href="dnsmgr_8c-source.html#l00081">refresh_info::filter</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="asterisk_8c-source.html#l00163">option_verbose</a>, <a class="el" href="dnsmgr_8c-source.html#l00075">refresh_interval</a>, <a class="el" href="dnsmgr_8c-source.html#l00080">refresh_info::regex_present</a>, <a class="el" href="dnsmgr_8c-source.html#l00079">refresh_info::verbose</a>, and <a class="el" href="logger_8h-source.html#l00044">VERBOSE_PREFIX_2</a>.
<p>
Referenced by <a class="el" href="dnsmgr_8c-source.html#l00251">dnsmgr_start_refresh()</a>, <a class="el" href="dnsmgr_8c-source.html#l00352">do_reload()</a>, and <a class="el" href="dnsmgr_8c-source.html#l00270">handle_cli_refresh()</a>.<div class="fragment"><pre class="fragment"><a name="l00223"></a>00223 {
<a name="l00224"></a>00224    <span class="keyword">struct </span><a class="code" href="structrefresh__info.html">refresh_info</a> *info = data;
<a name="l00225"></a>00225    <span class="keyword">struct </span><a class="code" href="structast__dnsmgr__entry.html">ast_dnsmgr_entry</a> *entry;
<a name="l00226"></a>00226 
<a name="l00227"></a>00227    <span class="comment">/* if a refresh or reload is already in progress, exit now */</span>
<a name="l00228"></a>00228    <span class="keywordflow">if</span> (<a class="code" href="lock_8h.html#95eeb25d5a8ccfa3adff8168c75d70e0">ast_mutex_trylock</a>(&amp;refresh_lock)) {
<a name="l00229"></a>00229       <span class="keywordflow">if</span> (info-&gt;<a class="code" href="structrefresh__info.html#2c7aea4237e25b4f8ee3b0bf77d6fed0">verbose</a>)
<a name="l00230"></a>00230          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"DNS Manager refresh already in progress.\n"</span>);
<a name="l00231"></a>00231       <span class="keywordflow">return</span> -1;
<a name="l00232"></a>00232    }
<a name="l00233"></a>00233 
<a name="l00234"></a>00234    <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ge36cdd7167e060bff70d00fbd82809eb">option_verbose</a> &gt; 2)
<a name="l00235"></a>00235       <a class="code" href="logger_8c.html#6a1ef0a194bcc79fccfb662192954477">ast_verbose</a>(<a class="code" href="logger_8h.html#6e3640436a97291b451a8d264b5ab15d">VERBOSE_PREFIX_2</a> <span class="stringliteral">"Refreshing DNS lookups.\n"</span>);
<a name="l00236"></a>00236    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(info-&gt;<a class="code" href="structrefresh__info.html#5fce916b625108149ee3ea5f48d9b0d1">entries</a>);
<a name="l00237"></a>00237    <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(info-&gt;<a class="code" href="structrefresh__info.html#5fce916b625108149ee3ea5f48d9b0d1">entries</a>, entry, list) {
<a name="l00238"></a>00238       <span class="keywordflow">if</span> (info-&gt;<a class="code" href="structrefresh__info.html#850cf5dd1a4fbf9413cf6bd8dfa568e1">regex_present</a> &amp;&amp; regexec(&amp;info-&gt;<a class="code" href="structrefresh__info.html#b2c97ae425dd751b0e48a3acae79cf4a">filter</a>, entry-&gt;name, 0, NULL, 0))
<a name="l00239"></a>00239           <span class="keywordflow">continue</span>;
<a name="l00240"></a>00240 
<a name="l00241"></a>00241       <a class="code" href="dnsmgr_8c.html#e0a4bd789aa60ccc390a765ba087a35d">dnsmgr_refresh</a>(entry, info-&gt;<a class="code" href="structrefresh__info.html#2c7aea4237e25b4f8ee3b0bf77d6fed0">verbose</a>);
<a name="l00242"></a>00242    }
<a name="l00243"></a>00243    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(info-&gt;<a class="code" href="structrefresh__info.html#5fce916b625108149ee3ea5f48d9b0d1">entries</a>);
<a name="l00244"></a>00244 
<a name="l00245"></a>00245    <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;refresh_lock);
<a name="l00246"></a>00246 
<a name="l00247"></a>00247    <span class="comment">/* automatically reschedule based on the interval */</span>
<a name="l00248"></a>00248    <span class="keywordflow">return</span> <a class="code" href="dnsmgr_8c.html#c46a842d7b4f90f8c10b1895bfbed01c">refresh_interval</a> * 1000;
<a name="l00249"></a>00249 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a06014657db07d0cef05b926d96d4608"></a><!-- doxytag: member="dnsmgr.c::cli_refresh" ref="a06014657db07d0cef05b926d96d4608" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> <a class="el" href="dnsmgr_8c.html#a06014657db07d0cef05b926d96d4608">cli_refresh</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00321">321</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="328abb9fa714448b3c5bb9af5a72ea1f"></a><!-- doxytag: member="dnsmgr.c::cli_reload" ref="328abb9fa714448b3c5bb9af5a72ea1f" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> <a class="el" href="dnsmgr_8c.html#328abb9fa714448b3c5bb9af5a72ea1f">cli_reload</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00314">314</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a43065b204561baf7f5ea3fafc435672"></a><!-- doxytag: member="dnsmgr.c::cli_status" ref="a43065b204561baf7f5ea3fafc435672" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> cli_status<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00329">329</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10311459433adf322f2590a4987c423"></a><!-- doxytag: member="dnsmgr.c::enabled" ref="a10311459433adf322f2590a4987c423" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="dnsmgr_8c.html#a10311459433adf322f2590a4987c423">enabled</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00074">74</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="3b4b43479126508d86864420d71aada1"></a><!-- doxytag: member="dnsmgr.c::master_refresh_info" ref="3b4b43479126508d86864420d71aada1" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structrefresh__info.html">refresh_info</a> <a class="el" href="dnsmgr_8c.html#3b4b43479126508d86864420d71aada1">master_refresh_info</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
   .entries = &amp;entry_list,
   .verbose = 0,
}
</pre></div>
<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00084">84</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="c46a842d7b4f90f8c10b1895bfbed01c"></a><!-- doxytag: member="dnsmgr.c::refresh_interval" ref="c46a842d7b4f90f8c10b1895bfbed01c" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="dnsmgr_8c.html#c46a842d7b4f90f8c10b1895bfbed01c">refresh_interval</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00075">75</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.
<p>
Referenced by <a class="el" href="dnsmgr_8c-source.html#l00352">do_reload()</a>, <a class="el" href="dnsmgr_8c-source.html#l00295">handle_cli_status()</a>, and <a class="el" href="dnsmgr_8c-source.html#l00222">refresh_list()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="5c82937eb07c8712bd8e0280c5cd46b6"></a><!-- doxytag: member="dnsmgr.c::refresh_sched" ref="5c82937eb07c8712bd8e0280c5cd46b6" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="dnsmgr_8c.html#5c82937eb07c8712bd8e0280c5cd46b6">refresh_sched</a> = -1<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00052">52</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.
<p>
Referenced by <a class="el" href="dnsmgr_8c-source.html#l00251">dnsmgr_start_refresh()</a>, and <a class="el" href="dnsmgr_8c-source.html#l00352">do_reload()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5b097f22debf9177beffb13ad3a8a3d"></a><!-- doxytag: member="dnsmgr.c::refresh_thread" ref="a5b097f22debf9177beffb13ad3a8a3d" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">pthread_t <a class="el" href="dnsmgr_8c.html#a5b097f22debf9177beffb13ad3a8a3d">refresh_thread</a> = AST_PTHREADT_NULL<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00053">53</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.
<p>
Referenced by <a class="el" href="dnsmgr_8c-source.html#l00352">do_reload()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="47721f99ae60cbec027428e52ad7ca39"></a><!-- doxytag: member="dnsmgr.c::sched" ref="47721f99ae60cbec027428e52ad7ca39" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structsched__context.html">sched_context</a>* <a class="el" href="structsched.html">sched</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dnsmgr_8c-source.html#l00051">51</a> of file <a class="el" href="dnsmgr_8c-source.html">dnsmgr.c</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu May 24 22:27:27 2007 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.5 </small></address>
</body>
</html>
