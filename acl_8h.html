<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (24 May 2007)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Thu May 24 22:26:53 2007</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Finclude_2F.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Finclude_2Fasterisk_2F.html">asterisk</a></div>
<h1>acl.h File Reference</h1>Access Control of various sorts. <a href="#_details">More...</a>
<p>
<code>#include &lt;netinet/in.h&gt;</code><br>
<code>#include &quot;<a class="el" href="io_8h-source.html">asterisk/io.h</a>&quot;</code><br>

<p>
<a href="acl_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#a3e37f476d37aadec8f911e06abcbf64">AST_SENSE_ALLOW</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#9afa4e45f84dbcb16f4a6aa8c6affff4">AST_SENSE_DENY</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__ha.html">ast_ha</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#bd7ec664091783cbeef4274f5c30d7b4">ast_append_ha</a> (char *sense, char *stuff, struct <a class="el" href="structast__ha.html">ast_ha</a> *path, int *error)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Append ACL entry to host access list.  <a href="#bd7ec664091783cbeef4274f5c30d7b4"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#ad4795f3b2afa9e898bbd529d0735a32">ast_apply_ha</a> (struct <a class="el" href="structast__ha.html">ast_ha</a> *ha, struct sockaddr_in *sin)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check IP address with host access list.  <a href="#ad4795f3b2afa9e898bbd529d0735a32"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__ha.html">ast_ha</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#113ad1cde505eb1e837a0424138a9e45">ast_duplicate_ha_list</a> (struct <a class="el" href="structast__ha.html">ast_ha</a> *original)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Copy host access list.  <a href="#113ad1cde505eb1e837a0424138a9e45"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#6ca7f9d214a3e5baec5042d7fdddd86d">ast_find_ourip</a> (struct in_addr *ourip, struct sockaddr_in <a class="el" href="chan__skinny_8c.html#ad73ad6b1a88f192c5aeffc5a58b9dd5">bindaddr</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#395c900def2430bc4d7270a1b537c870">ast_free_ha</a> (struct <a class="el" href="structast__ha.html">ast_ha</a> *ha)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free host access list.  <a href="#395c900def2430bc4d7270a1b537c870"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#f7dd90d30179dcc316588be3a38fbce4">ast_get_ip</a> (struct sockaddr_in *sin, const char *value)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#282eabfbf8517193c826e6fe3468e340">ast_get_ip_or_srv</a> (struct sockaddr_in *sin, const char *value, const char *<a class="el" href="adsistub_8c.html#aaabf0d39951f3e6c3e8a7911df524c2">service</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#1513a4995380f79d880c6429e15aecad">ast_ouraddrfor</a> (struct in_addr *them, struct in_addr *us)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#6297666af9a77f81c450a5412e808476">ast_str2cos</a> (const char *value, unsigned int *<a class="el" href="chan__mgcp_8c.html#4d00d79b6733c9cc066584a02ed03410">cos</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#9f6c8cff137f7cf7f3c5119f872297fb">ast_str2tos</a> (const char *value, unsigned int *<a class="el" href="pbx__dundi_8c.html#227f82daef18fd97b0ed9538ce418761">tos</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#a8e87ba02a559449eb25a968de4e7d8e">ast_tos2str</a> (unsigned int <a class="el" href="pbx__dundi_8c.html#227f82daef18fd97b0ed9538ce418761">tos</a>)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Access Control of various sorts. 
<p>

<p>
Definition in file <a class="el" href="acl_8h-source.html">acl.h</a>.<hr><h2>Define Documentation</h2>
<a class="anchor" name="a3e37f476d37aadec8f911e06abcbf64"></a><!-- doxytag: member="acl.h::AST_SENSE_ALLOW" ref="a3e37f476d37aadec8f911e06abcbf64" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define AST_SENSE_ALLOW&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="acl_8h-source.html#l00035">35</a> of file <a class="el" href="acl_8h-source.html">acl.h</a>.
<p>
Referenced by <a class="el" href="acl_8c-source.html#l00140">ast_append_ha()</a>, and <a class="el" href="acl_8c-source.html#l00205">ast_apply_ha()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="9afa4e45f84dbcb16f4a6aa8c6affff4"></a><!-- doxytag: member="acl.h::AST_SENSE_DENY" ref="9afa4e45f84dbcb16f4a6aa8c6affff4" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define AST_SENSE_DENY&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="acl_8h-source.html#l00034">34</a> of file <a class="el" href="acl_8h-source.html">acl.h</a>.
<p>
Referenced by <a class="el" href="acl_8c-source.html#l00140">ast_append_ha()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="bd7ec664091783cbeef4274f5c30d7b4"></a><!-- doxytag: member="acl.h::ast_append_ha" ref="bd7ec664091783cbeef4274f5c30d7b4" args="(char *sense, char *stuff, struct ast_ha *path, int *error)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__ha.html">ast_ha</a>* ast_append_ha           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>sense</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>stuff</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct <a class="el" href="structast__ha.html">ast_ha</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>path</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>error</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Append ACL entry to host access list. 
<p>

<p>
Definition at line <a class="el" href="acl_8c-source.html#l00140">140</a> of file <a class="el" href="acl_8c-source.html">acl.c</a>.
<p>
References <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="utils_8h-source.html#l00359">ast_malloc</a>, <a class="el" href="acl_8h-source.html#l00035">AST_SENSE_ALLOW</a>, <a class="el" href="acl_8h-source.html#l00034">AST_SENSE_DENY</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="logger_8h-source.html#l00094">LOG_DEBUG</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="acl_8c-source.html#l00075">ast_ha::netaddr</a>, <a class="el" href="acl_8c-source.html#l00078">ast_ha::next</a>, and <a class="el" href="asterisk_8c-source.html#l00164">option_debug</a>.
<p>
Referenced by <a class="el" href="res__astum_8c-source.html#l01424">aum_build_group()</a>, <a class="el" href="res__astum_8c-source.html#l01229">aum_build_user()</a>, <a class="el" href="manager_8c-source.html#l00903">authenticate()</a>, <a class="el" href="chan__skinny_8c-source.html#l02102">build_device()</a>, <a class="el" href="chan__mgcp_8c-source.html#l03593">build_gateway()</a>, <a class="el" href="chan__h323_8c-source.html#l01488">build_peer()</a>, <a class="el" href="chan__h323_8c-source.html#l01370">build_user()</a>, and <a class="el" href="chan__sip_8c-source.html#l17179">reload_config()</a>.<div class="fragment"><pre class="fragment"><a name="l00141"></a>00141 {
<a name="l00142"></a>00142    <span class="keyword">struct </span><a class="code" href="structast__ha.html">ast_ha</a> *ha;
<a name="l00143"></a>00143    <span class="keywordtype">char</span> *nm = <span class="stringliteral">"255.255.255.255"</span>;
<a name="l00144"></a>00144    <span class="keywordtype">char</span> tmp[256];
<a name="l00145"></a>00145    <span class="keyword">struct </span><a class="code" href="structast__ha.html">ast_ha</a> *prev = NULL;
<a name="l00146"></a>00146    <span class="keyword">struct </span><a class="code" href="structast__ha.html">ast_ha</a> *ret;
<a name="l00147"></a>00147    <span class="keywordtype">int</span> x, z;
<a name="l00148"></a>00148    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y;
<a name="l00149"></a>00149 
<a name="l00150"></a>00150    ret = path;
<a name="l00151"></a>00151    <span class="keywordflow">while</span> (path) {
<a name="l00152"></a>00152       prev = path;
<a name="l00153"></a>00153       path = path-&gt;<a class="code" href="structast__ha.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>;
<a name="l00154"></a>00154    }
<a name="l00155"></a>00155    <span class="keywordflow">if</span> ((ha = <a class="code" href="utils_8h.html#efc2f2f953e736b509e4a2cee96151db">ast_malloc</a>(<span class="keyword">sizeof</span>(*ha)))) {
<a name="l00156"></a>00156       ast_copy_string(tmp, stuff, <span class="keyword">sizeof</span>(tmp));
<a name="l00157"></a>00157       nm = strchr(tmp, <span class="charliteral">'/'</span>);
<a name="l00158"></a>00158       <span class="keywordflow">if</span> (!nm) {
<a name="l00159"></a>00159          nm = <span class="stringliteral">"255.255.255.255"</span>;
<a name="l00160"></a>00160       } <span class="keywordflow">else</span> {
<a name="l00161"></a>00161          *nm = <span class="charliteral">'\0'</span>;
<a name="l00162"></a>00162          nm++;
<a name="l00163"></a>00163       }
<a name="l00164"></a>00164       <span class="keywordflow">if</span> (!strchr(nm, <span class="charliteral">'.'</span>)) {
<a name="l00165"></a>00165          <span class="keywordflow">if</span> ((sscanf(nm, <span class="stringliteral">"%d"</span>, &amp;x) == 1) &amp;&amp; (x &gt;= 0) &amp;&amp; (x &lt;= 32)) {
<a name="l00166"></a>00166             y = 0;
<a name="l00167"></a>00167             <span class="keywordflow">for</span> (z = 0; z &lt; x; z++) {
<a name="l00168"></a>00168                y &gt;&gt;= 1;
<a name="l00169"></a>00169                y |= 0x80000000;
<a name="l00170"></a>00170             }
<a name="l00171"></a>00171             ha-&gt;netmask.s_addr = htonl(y);
<a name="l00172"></a>00172          }
<a name="l00173"></a>00173       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!inet_aton(nm, &amp;ha-&gt;netmask)) {
<a name="l00174"></a>00174          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"%s is not a valid netmask\n"</span>, nm);
<a name="l00175"></a>00175          <span class="keywordflow">if</span> (<a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>)
<a name="l00176"></a>00176             *<a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a> = 1;
<a name="l00177"></a>00177          <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(ha);
<a name="l00178"></a>00178          <span class="keywordflow">return</span> ret;
<a name="l00179"></a>00179       }
<a name="l00180"></a>00180       <span class="keywordflow">if</span> (!inet_aton(tmp, &amp;ha-&gt;netaddr)) {
<a name="l00181"></a>00181          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"%s is not a valid IP\n"</span>, tmp);
<a name="l00182"></a>00182          <span class="keywordflow">if</span> (<a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>)
<a name="l00183"></a>00183             *<a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a> = 1;
<a name="l00184"></a>00184          <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(ha);
<a name="l00185"></a>00185          <span class="keywordflow">return</span> ret;
<a name="l00186"></a>00186       }
<a name="l00187"></a>00187       ha-&gt;<a class="code" href="structast__ha.html#6ed1630535e149ee97279a775dccb954">netaddr</a>.s_addr &amp;= ha-&gt;netmask.s_addr;
<a name="l00188"></a>00188       <span class="keywordflow">if</span> (!strncasecmp(<a class="code" href="structast__ha.html#f5743daa1b0c190dc25ac146a657932e">sense</a>, <span class="stringliteral">"p"</span>, 1)) {
<a name="l00189"></a>00189          ha-&gt;sense = <a class="code" href="acl_8h.html#a3e37f476d37aadec8f911e06abcbf64">AST_SENSE_ALLOW</a>;
<a name="l00190"></a>00190       } <span class="keywordflow">else</span> {
<a name="l00191"></a>00191          ha-&gt;sense = <a class="code" href="acl_8h.html#9afa4e45f84dbcb16f4a6aa8c6affff4">AST_SENSE_DENY</a>;
<a name="l00192"></a>00192       }
<a name="l00193"></a>00193       ha-&gt;next = NULL;
<a name="l00194"></a>00194       <span class="keywordflow">if</span> (prev) {
<a name="l00195"></a>00195          prev-&gt;<a class="code" href="structast__ha.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a> = ha;
<a name="l00196"></a>00196       } <span class="keywordflow">else</span> {
<a name="l00197"></a>00197          ret = ha;
<a name="l00198"></a>00198       }
<a name="l00199"></a>00199    }
<a name="l00200"></a>00200    <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a>)
<a name="l00201"></a>00201       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"%s/%s appended to acl for peer\n"</span>, stuff, nm);
<a name="l00202"></a>00202    <span class="keywordflow">return</span> ret;
<a name="l00203"></a>00203 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="ad4795f3b2afa9e898bbd529d0735a32"></a><!-- doxytag: member="acl.h::ast_apply_ha" ref="ad4795f3b2afa9e898bbd529d0735a32" args="(struct ast_ha *ha, struct sockaddr_in *sin)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_apply_ha           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__ha.html">ast_ha</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ha</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct sockaddr_in *&nbsp;</td>
          <td class="mdname" nowrap> <em>sin</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Check IP address with host access list. 
<p>

<p>
Definition at line <a class="el" href="acl_8c-source.html#l00205">205</a> of file <a class="el" href="acl_8c-source.html">acl.c</a>.
<p>
References <a class="el" href="utils_8c-source.html#l00493">ast_inet_ntoa()</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="acl_8h-source.html#l00035">AST_SENSE_ALLOW</a>, <a class="el" href="logger_8h-source.html#l00094">LOG_DEBUG</a>, <a class="el" href="acl_8c-source.html#l00075">ast_ha::netaddr</a>, <a class="el" href="acl_8c-source.html#l00076">ast_ha::netmask</a>, <a class="el" href="acl_8c-source.html#l00078">ast_ha::next</a>, <a class="el" href="asterisk_8c-source.html#l00164">option_debug</a>, and <a class="el" href="acl_8c-source.html#l00077">ast_ha::sense</a>.
<p>
Referenced by <a class="el" href="chan__sip_8c-source.html#l01959">ast_sip_ouraddrfor()</a>, <a class="el" href="manager_8c-source.html#l00903">authenticate()</a>, <a class="el" href="chan__sip_8c-source.html#l09745">check_user_ok()</a>, <a class="el" href="chan__iax2_8c-source.html#l05119">register_verify()</a>, and <a class="el" href="chan__skinny_8c-source.html#l01355">skinny_register()</a>.<div class="fragment"><pre class="fragment"><a name="l00206"></a>00206 {
<a name="l00207"></a>00207    <span class="comment">/* Start optimistic */</span>
<a name="l00208"></a>00208    <span class="keywordtype">int</span> res = <a class="code" href="acl_8h.html#a3e37f476d37aadec8f911e06abcbf64">AST_SENSE_ALLOW</a>;
<a name="l00209"></a>00209    <span class="keywordflow">while</span> (ha) {
<a name="l00210"></a>00210       <span class="keywordtype">char</span> iabuf[INET_ADDRSTRLEN];
<a name="l00211"></a>00211       <span class="keywordtype">char</span> iabuf2[INET_ADDRSTRLEN];
<a name="l00212"></a>00212       <span class="comment">/* DEBUG */</span>
<a name="l00213"></a>00213       ast_copy_string(iabuf, <a class="code" href="utils_8c.html#d5490a9b672272bd2f20ee1e5b72c11e">ast_inet_ntoa</a>(sin-&gt;sin_addr), <span class="keyword">sizeof</span>(iabuf));
<a name="l00214"></a>00214       ast_copy_string(iabuf2, <a class="code" href="utils_8c.html#d5490a9b672272bd2f20ee1e5b72c11e">ast_inet_ntoa</a>(ha-&gt;<a class="code" href="structast__ha.html#6ed1630535e149ee97279a775dccb954">netaddr</a>), <span class="keyword">sizeof</span>(iabuf2));
<a name="l00215"></a>00215       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a>)
<a name="l00216"></a>00216          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"##### Testing %s with %s\n"</span>, iabuf, iabuf2);
<a name="l00217"></a>00217       <span class="comment">/* For each rule, if this address and the netmask = the net address</span>
<a name="l00218"></a>00218 <span class="comment">         apply the current rule */</span>
<a name="l00219"></a>00219       <span class="keywordflow">if</span> ((sin-&gt;sin_addr.s_addr &amp; ha-&gt;<a class="code" href="structast__ha.html#3f5c8adfe42894248788ef03028cca0b">netmask</a>.s_addr) == ha-&gt;<a class="code" href="structast__ha.html#6ed1630535e149ee97279a775dccb954">netaddr</a>.s_addr)
<a name="l00220"></a>00220          res = ha-&gt;<a class="code" href="structast__ha.html#f5743daa1b0c190dc25ac146a657932e">sense</a>;
<a name="l00221"></a>00221       ha = ha-&gt;<a class="code" href="structast__ha.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>;
<a name="l00222"></a>00222    }
<a name="l00223"></a>00223    <span class="keywordflow">return</span> res;
<a name="l00224"></a>00224 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="113ad1cde505eb1e837a0424138a9e45"></a><!-- doxytag: member="acl.h::ast_duplicate_ha_list" ref="113ad1cde505eb1e837a0424138a9e45" args="(struct ast_ha *original)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__ha.html">ast_ha</a>* ast_duplicate_ha_list           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__ha.html">ast_ha</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>original</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Copy host access list. 
<p>

<p>
Definition at line <a class="el" href="acl_8c-source.html#l00120">120</a> of file <a class="el" href="acl_8c-source.html">acl.c</a>.
<p>
References <a class="el" href="acl_8c-source.html#l00106">ast_duplicate_ha()</a>, and <a class="el" href="acl_8c-source.html#l00078">ast_ha::next</a>.<div class="fragment"><pre class="fragment"><a name="l00121"></a>00121 {
<a name="l00122"></a>00122    <span class="keyword">struct </span><a class="code" href="structast__ha.html">ast_ha</a> *start = original;
<a name="l00123"></a>00123    <span class="keyword">struct </span><a class="code" href="structast__ha.html">ast_ha</a> *ret = NULL;
<a name="l00124"></a>00124    <span class="keyword">struct </span><a class="code" href="structast__ha.html">ast_ha</a> *link, *prev = NULL;
<a name="l00125"></a>00125 
<a name="l00126"></a>00126    <span class="keywordflow">while</span> (start) {
<a name="l00127"></a>00127       link = <a class="code" href="acl_8c.html#a5e51a255e80214196ce58b3557c4b95">ast_duplicate_ha</a>(start);  <span class="comment">/* Create copy of this object */</span>
<a name="l00128"></a>00128       <span class="keywordflow">if</span> (prev)
<a name="l00129"></a>00129          prev-&gt;<a class="code" href="structast__ha.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a> = link;      <span class="comment">/* Link previous to this object */</span>
<a name="l00130"></a>00130 
<a name="l00131"></a>00131       <span class="keywordflow">if</span> (!ret)
<a name="l00132"></a>00132          ret = link;    <span class="comment">/* Save starting point */</span>
<a name="l00133"></a>00133 
<a name="l00134"></a>00134       start = start-&gt;<a class="code" href="structast__ha.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>;    <span class="comment">/* Go to next object */</span>
<a name="l00135"></a>00135       prev = link;         <span class="comment">/* Save pointer to this object */</span>
<a name="l00136"></a>00136    }
<a name="l00137"></a>00137    <span class="keywordflow">return</span> ret;             <span class="comment">/* Return start of list */</span>
<a name="l00138"></a>00138 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="6ca7f9d214a3e5baec5042d7fdddd86d"></a><!-- doxytag: member="acl.h::ast_find_ourip" ref="6ca7f9d214a3e5baec5042d7fdddd86d" args="(struct in_addr *ourip, struct sockaddr_in bindaddr)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_find_ourip           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct in_addr *&nbsp;</td>
          <td class="mdname" nowrap> <em>ourip</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct sockaddr_in&nbsp;</td>
          <td class="mdname" nowrap> <em>bindaddr</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="acl_8c-source.html#l00362">362</a> of file <a class="el" href="acl_8c-source.html">acl.c</a>.
<p>
References <a class="el" href="utils_8c-source.html#l00182">ast_gethostbyname()</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="acl_8c-source.html#l00332">ast_ouraddrfor()</a>, <a class="el" href="chan__skinny_8c-source.html#l00760">hp</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, and <a class="el" href="chan__mgcp_8c-source.html#l00224">ourhost</a>.
<p>
Referenced by <a class="el" href="chan__h323_8c-source.html#l00962">__oh323_rtp_create()</a>, <a class="el" href="chan__gtalk_8c-source.html#l00705">gtalk_create_candidates()</a>, <a class="el" href="chan__jingle_8c-source.html#l00577">jingle_create_candidates()</a>, <a class="el" href="chan__gtalk_8c-source.html#l01823">load_module()</a>, and <a class="el" href="chan__sip_8c-source.html#l17179">reload_config()</a>.<div class="fragment"><pre class="fragment"><a name="l00363"></a>00363 {
<a name="l00364"></a>00364    <span class="keywordtype">char</span> <a class="code" href="chan__mgcp_8c.html#d5de74b873f0ec6e8570708a4c5fb3a1">ourhost</a>[MAXHOSTNAMELEN] = <span class="stringliteral">""</span>;
<a name="l00365"></a>00365    <span class="keyword">struct </span><a class="code" href="structast__hostent.html">ast_hostent</a> ahp;
<a name="l00366"></a>00366    <span class="keyword">struct </span>hostent *<a class="code" href="chan__skinny_8c.html#d2ccda10db94c2b5d51beed10484c025">hp</a>;
<a name="l00367"></a>00367    <span class="keyword">struct </span>in_addr saddr;
<a name="l00368"></a>00368 
<a name="l00369"></a>00369    <span class="comment">/* just use the bind address if it is nonzero */</span>
<a name="l00370"></a>00370    <span class="keywordflow">if</span> (ntohl(<a class="code" href="chan__gtalk_8c.html#ad73ad6b1a88f192c5aeffc5a58b9dd5">bindaddr</a>.sin_addr.s_addr)) {
<a name="l00371"></a>00371       memcpy(ourip, &amp;<a class="code" href="chan__gtalk_8c.html#ad73ad6b1a88f192c5aeffc5a58b9dd5">bindaddr</a>.sin_addr, <span class="keyword">sizeof</span>(*ourip));
<a name="l00372"></a>00372       <span class="keywordflow">return</span> 0;
<a name="l00373"></a>00373    }
<a name="l00374"></a>00374    <span class="comment">/* try to use our hostname */</span>
<a name="l00375"></a>00375    <span class="keywordflow">if</span> (gethostname(ourhost, <span class="keyword">sizeof</span>(ourhost) - 1)) {
<a name="l00376"></a>00376       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Unable to get hostname\n"</span>);
<a name="l00377"></a>00377    } <span class="keywordflow">else</span> {
<a name="l00378"></a>00378       hp = <a class="code" href="utils_8c.html#00f9ad2be8cda9c885557d03568816ec">ast_gethostbyname</a>(ourhost, &amp;ahp);
<a name="l00379"></a>00379       <span class="keywordflow">if</span> (hp) {
<a name="l00380"></a>00380          memcpy(ourip, hp-&gt;h_addr, <span class="keyword">sizeof</span>(*ourip));
<a name="l00381"></a>00381          <span class="keywordflow">return</span> 0;
<a name="l00382"></a>00382       }
<a name="l00383"></a>00383    }
<a name="l00384"></a>00384    <span class="comment">/* A.ROOT-SERVERS.NET. */</span>
<a name="l00385"></a>00385    <span class="keywordflow">if</span> (inet_aton(<span class="stringliteral">"198.41.0.4"</span>, &amp;saddr) &amp;&amp; !<a class="code" href="acl_8c.html#1513a4995380f79d880c6429e15aecad">ast_ouraddrfor</a>(&amp;saddr, ourip))
<a name="l00386"></a>00386       <span class="keywordflow">return</span> 0;
<a name="l00387"></a>00387    <span class="keywordflow">return</span> -1;
<a name="l00388"></a>00388 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="395c900def2430bc4d7270a1b537c870"></a><!-- doxytag: member="acl.h::ast_free_ha" ref="395c900def2430bc4d7270a1b537c870" args="(struct ast_ha *ha)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_free_ha           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__ha.html">ast_ha</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ha</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Free host access list. 
<p>

<p>
Definition at line <a class="el" href="acl_8c-source.html#l00087">87</a> of file <a class="el" href="acl_8c-source.html">acl.c</a>.
<p>
References <a class="el" href="astmm_8h-source.html#l00069">free</a>, and <a class="el" href="acl_8c-source.html#l00078">ast_ha::next</a>.
<p>
Referenced by <a class="el" href="res__astum_8c-source.html#l01662">aum_destroy_user()</a>, <a class="el" href="manager_8c-source.html#l00903">authenticate()</a>, <a class="el" href="chan__h323_8c-source.html#l01488">build_peer()</a>, <a class="el" href="chan__h323_8c-source.html#l01370">build_user()</a>, <a class="el" href="chan__mgcp_8c-source.html#l04056">destroy_gateway()</a>, <a class="el" href="chan__iax2_8c-source.html#l09131">destroy_peer()</a>, <a class="el" href="chan__iax2_8c-source.html#l09103">destroy_user()</a>, <a class="el" href="chan__h323_8c-source.html#l00302">oh323_destroy_peer()</a>, <a class="el" href="chan__h323_8c-source.html#l00294">oh323_destroy_user()</a>, <a class="el" href="chan__sip_8c-source.html#l02679">sip_destroy_peer()</a>, <a class="el" href="chan__sip_8c-source.html#l02867">sip_destroy_user()</a>, and <a class="el" href="chan__sip_8c-source.html#l18502">unload_module()</a>.<div class="fragment"><pre class="fragment"><a name="l00088"></a>00088 {
<a name="l00089"></a>00089    <span class="keyword">struct </span><a class="code" href="structast__ha.html">ast_ha</a> *hal;
<a name="l00090"></a>00090    <span class="keywordflow">while</span> (ha) {
<a name="l00091"></a>00091       hal = ha;
<a name="l00092"></a>00092       ha = ha-&gt;<a class="code" href="structast__ha.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>;
<a name="l00093"></a>00093       <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(hal);
<a name="l00094"></a>00094    }
<a name="l00095"></a>00095 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="f7dd90d30179dcc316588be3a38fbce4"></a><!-- doxytag: member="acl.h::ast_get_ip" ref="f7dd90d30179dcc316588be3a38fbce4" args="(struct sockaddr_in *sin, const char *value)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_get_ip           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct sockaddr_in *&nbsp;</td>
          <td class="mdname" nowrap> <em>sin</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>value</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="acl_8c-source.html#l00327">327</a> of file <a class="el" href="acl_8c-source.html">acl.c</a>.
<p>
References <a class="el" href="acl_8c-source.html#l00226">ast_get_ip_or_srv()</a>.
<p>
Referenced by <a class="el" href="chan__skinny_8c-source.html#l02102">build_device()</a>, <a class="el" href="chan__mgcp_8c-source.html#l03593">build_gateway()</a>, <a class="el" href="chan__h323_8c-source.html#l01488">build_peer()</a>, <a class="el" href="chan__h323_8c-source.html#l01370">build_user()</a>, and <a class="el" href="chan__iax2_8c-source.html#l08532">peer_set_srcaddr()</a>.<div class="fragment"><pre class="fragment"><a name="l00328"></a>00328 {
<a name="l00329"></a>00329    <span class="keywordflow">return</span> <a class="code" href="acl_8c.html#282eabfbf8517193c826e6fe3468e340">ast_get_ip_or_srv</a>(sin, value, NULL);
<a name="l00330"></a>00330 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="282eabfbf8517193c826e6fe3468e340"></a><!-- doxytag: member="acl.h::ast_get_ip_or_srv" ref="282eabfbf8517193c826e6fe3468e340" args="(struct sockaddr_in *sin, const char *value, const char *service)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_get_ip_or_srv           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct sockaddr_in *&nbsp;</td>
          <td class="mdname" nowrap> <em>sin</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>value</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>service</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="acl_8c-source.html#l00226">226</a> of file <a class="el" href="acl_8c-source.html">acl.c</a>.
<p>
References <a class="el" href="srv_8c-source.html#l00119">ast_get_srv()</a>, <a class="el" href="utils_8c-source.html#l00182">ast_gethostbyname()</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="chan__skinny_8c-source.html#l00760">hp</a>, and <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>.
<p>
Referenced by <a class="el" href="acl_8c-source.html#l00327">ast_get_ip()</a>, <a class="el" href="chan__sip_8c-source.html#l16894">build_peer()</a>, <a class="el" href="chan__iax2_8c-source.html#l02722">create_addr()</a>, and <a class="el" href="chan__sip_8c-source.html#l01760">proxy_update()</a>.<div class="fragment"><pre class="fragment"><a name="l00227"></a>00227 {
<a name="l00228"></a>00228    <span class="keyword">struct </span>hostent *<a class="code" href="chan__skinny_8c.html#d2ccda10db94c2b5d51beed10484c025">hp</a>;
<a name="l00229"></a>00229    <span class="keyword">struct </span><a class="code" href="structast__hostent.html">ast_hostent</a> ahp;
<a name="l00230"></a>00230    <span class="keywordtype">char</span> <a class="code" href="structsrv.html">srv</a>[256];
<a name="l00231"></a>00231    <span class="keywordtype">char</span> host[256];
<a name="l00232"></a>00232    <span class="keywordtype">int</span> tportno = ntohs(sin-&gt;sin_port);
<a name="l00233"></a>00233    <span class="keywordflow">if</span> (<a class="code" href="adsistub_8c.html#aaabf0d39951f3e6c3e8a7911df524c2">service</a>) {
<a name="l00234"></a>00234       snprintf(srv, <span class="keyword">sizeof</span>(srv), <span class="stringliteral">"%s.%s"</span>, <a class="code" href="adsistub_8c.html#aaabf0d39951f3e6c3e8a7911df524c2">service</a>, value);
<a name="l00235"></a>00235       <span class="keywordflow">if</span> (<a class="code" href="srv_8c.html#23dd55e26cce3bee65e46687a385db85">ast_get_srv</a>(NULL, host, <span class="keyword">sizeof</span>(host), &amp;tportno, srv) &gt; 0) {
<a name="l00236"></a>00236          sin-&gt;sin_port = htons(tportno);
<a name="l00237"></a>00237          value = host;
<a name="l00238"></a>00238       }
<a name="l00239"></a>00239    }
<a name="l00240"></a>00240    hp = <a class="code" href="utils_8c.html#00f9ad2be8cda9c885557d03568816ec">ast_gethostbyname</a>(value, &amp;ahp);
<a name="l00241"></a>00241    <span class="keywordflow">if</span> (hp) {
<a name="l00242"></a>00242       memcpy(&amp;sin-&gt;sin_addr, hp-&gt;h_addr, <span class="keyword">sizeof</span>(sin-&gt;sin_addr));
<a name="l00243"></a>00243    } <span class="keywordflow">else</span> {
<a name="l00244"></a>00244       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Unable to lookup '%s'\n"</span>, value);
<a name="l00245"></a>00245       <span class="keywordflow">return</span> -1;
<a name="l00246"></a>00246    }
<a name="l00247"></a>00247    <span class="keywordflow">return</span> 0;
<a name="l00248"></a>00248 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="1513a4995380f79d880c6429e15aecad"></a><!-- doxytag: member="acl.h::ast_ouraddrfor" ref="1513a4995380f79d880c6429e15aecad" args="(struct in_addr *them, struct in_addr *us)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_ouraddrfor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct in_addr *&nbsp;</td>
          <td class="mdname" nowrap> <em>them</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct in_addr *&nbsp;</td>
          <td class="mdname" nowrap> <em>us</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="acl_8c-source.html#l00332">332</a> of file <a class="el" href="acl_8c-source.html">acl.c</a>.
<p>
References <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, and <a class="el" href="aesopt_8h-source.html#l00399">s</a>.
<p>
Referenced by <a class="el" href="acl_8c-source.html#l00362">ast_find_ourip()</a>, <a class="el" href="chan__sip_8c-source.html#l01959">ast_sip_ouraddrfor()</a>, <a class="el" href="chan__skinny_8c-source.html#l02102">build_device()</a>, and <a class="el" href="chan__mgcp_8c-source.html#l01617">find_subchannel_and_lock()</a>.<div class="fragment"><pre class="fragment"><a name="l00333"></a>00333 {
<a name="l00334"></a>00334    <span class="keywordtype">int</span> <a class="code" href="aesopt_8h.html#8d6242bc80162ac99dd4d368eabe77cc">s</a>;
<a name="l00335"></a>00335    <span class="keyword">struct </span>sockaddr_in sin;
<a name="l00336"></a>00336    socklen_t slen;
<a name="l00337"></a>00337 
<a name="l00338"></a>00338    s = socket(PF_INET, SOCK_DGRAM, 0);
<a name="l00339"></a>00339    <span class="keywordflow">if</span> (s &lt; 0) {
<a name="l00340"></a>00340       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Cannot create socket\n"</span>);
<a name="l00341"></a>00341       <span class="keywordflow">return</span> -1;
<a name="l00342"></a>00342    }
<a name="l00343"></a>00343    sin.sin_family = AF_INET;
<a name="l00344"></a>00344    sin.sin_port = 5060;
<a name="l00345"></a>00345    sin.sin_addr = *them;
<a name="l00346"></a>00346    <span class="keywordflow">if</span> (connect(s, (<span class="keyword">struct</span> sockaddr *)&amp;sin, <span class="keyword">sizeof</span>(sin))) {
<a name="l00347"></a>00347       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Cannot connect\n"</span>);
<a name="l00348"></a>00348       close(s);
<a name="l00349"></a>00349       <span class="keywordflow">return</span> -1;
<a name="l00350"></a>00350    }
<a name="l00351"></a>00351    slen = <span class="keyword">sizeof</span>(sin);
<a name="l00352"></a>00352    <span class="keywordflow">if</span> (getsockname(s, (<span class="keyword">struct</span> sockaddr *)&amp;sin, &amp;slen)) {
<a name="l00353"></a>00353       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Cannot get socket name\n"</span>);
<a name="l00354"></a>00354       close(s);
<a name="l00355"></a>00355       <span class="keywordflow">return</span> -1;
<a name="l00356"></a>00356    }
<a name="l00357"></a>00357    close(s);
<a name="l00358"></a>00358    *us = sin.sin_addr;
<a name="l00359"></a>00359    <span class="keywordflow">return</span> 0;
<a name="l00360"></a>00360 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="6297666af9a77f81c450a5412e808476"></a><!-- doxytag: member="acl.h::ast_str2cos" ref="6297666af9a77f81c450a5412e808476" args="(const char *value, unsigned int *cos)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_str2cos           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>value</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int *&nbsp;</td>
          <td class="mdname" nowrap> <em>cos</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="acl_8c-source.html#l00281">281</a> of file <a class="el" href="acl_8c-source.html">acl.c</a>.
<p>
Referenced by <a class="el" href="chan__h323_8c-source.html#l02809">reload_config()</a>, and <a class="el" href="chan__iax2_8c-source.html#l09191">set_config()</a>.<div class="fragment"><pre class="fragment"><a name="l00282"></a>00282 {
<a name="l00283"></a>00283    <span class="keywordtype">int</span> fval;
<a name="l00284"></a>00284    
<a name="l00285"></a>00285    <span class="keywordflow">if</span> (sscanf(value, <span class="stringliteral">"%d"</span>, &amp;fval) == 1) {
<a name="l00286"></a>00286       <span class="keywordflow">if</span> (fval &lt; 8) {
<a name="l00287"></a>00287              *<a class="code" href="chan__h323_8c.html#4d00d79b6733c9cc066584a02ed03410">cos</a> = fval;
<a name="l00288"></a>00288           <span class="keywordflow">return</span> 0;
<a name="l00289"></a>00289       }
<a name="l00290"></a>00290    }
<a name="l00291"></a>00291    
<a name="l00292"></a>00292    <span class="keywordflow">return</span> -1;
<a name="l00293"></a>00293 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="9f6c8cff137f7cf7f3c5119f872297fb"></a><!-- doxytag: member="acl.h::ast_str2tos" ref="9f6c8cff137f7cf7f3c5119f872297fb" args="(const char *value, unsigned int *tos)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_str2tos           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>value</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int *&nbsp;</td>
          <td class="mdname" nowrap> <em>tos</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="acl_8c-source.html#l00295">295</a> of file <a class="el" href="acl_8c-source.html">acl.c</a>.
<p>
References <a class="el" href="callerid_8c-source.html#l01043">name</a>.
<p>
Referenced by <a class="el" href="iax2-provision_8c-source.html#l00262">iax_template_parse()</a>, <a class="el" href="chan__h323_8c-source.html#l02809">reload_config()</a>, and <a class="el" href="chan__iax2_8c-source.html#l09191">set_config()</a>.<div class="fragment"><pre class="fragment"><a name="l00296"></a>00296 {
<a name="l00297"></a>00297    <span class="keywordtype">int</span> fval;
<a name="l00298"></a>00298    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300    <span class="keywordflow">if</span> (sscanf(value, <span class="stringliteral">"%i"</span>, &amp;fval) == 1) {
<a name="l00301"></a>00301       *<a class="code" href="chan__h323_8c.html#227f82daef18fd97b0ed9538ce418761">tos</a> = fval &amp; 0xFF;
<a name="l00302"></a>00302       <span class="keywordflow">return</span> 0;
<a name="l00303"></a>00303    }
<a name="l00304"></a>00304 
<a name="l00305"></a>00305    <span class="keywordflow">for</span> (x = 0; x &lt; <span class="keyword">sizeof</span>(<a class="code" href="acl_8c.html#8d4a725cd7a55199372a171f9da3887c">dscp_pool1</a>) / <span class="keyword">sizeof</span>(dscp_pool1[0]); x++) {
<a name="l00306"></a>00306       <span class="keywordflow">if</span> (!strcasecmp(value, dscp_pool1[x].<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>)) {
<a name="l00307"></a>00307          *<a class="code" href="chan__h323_8c.html#227f82daef18fd97b0ed9538ce418761">tos</a> = dscp_pool1[x].space &lt;&lt; 2;
<a name="l00308"></a>00308          <span class="keywordflow">return</span> 0;
<a name="l00309"></a>00309       }
<a name="l00310"></a>00310    }
<a name="l00311"></a>00311 
<a name="l00312"></a>00312    <span class="keywordflow">return</span> -1;
<a name="l00313"></a>00313 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a8e87ba02a559449eb25a968de4e7d8e"></a><!-- doxytag: member="acl.h::ast_tos2str" ref="a8e87ba02a559449eb25a968de4e7d8e" args="(unsigned int tos)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char* ast_tos2str           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>tos</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="acl_8c-source.html#l00315">315</a> of file <a class="el" href="acl_8c-source.html">acl.c</a>.
<p>
References <a class="el" href="strings_8h-source.html#l00191">space</a>.
<p>
Referenced by <a class="el" href="chan__sip_8c-source.html#l11134">sip_show_settings()</a>.<div class="fragment"><pre class="fragment"><a name="l00316"></a>00316 {
<a name="l00317"></a>00317    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x;
<a name="l00318"></a>00318 
<a name="l00319"></a>00319    <span class="keywordflow">for</span> (x = 0; x &lt; <span class="keyword">sizeof</span>(<a class="code" href="acl_8c.html#8d4a725cd7a55199372a171f9da3887c">dscp_pool1</a>) / <span class="keyword">sizeof</span>(dscp_pool1[0]); x++) {
<a name="l00320"></a>00320       <span class="keywordflow">if</span> (dscp_pool1[x].<a class="code" href="strings_8h.html#ff2364a0be3d20e46cc69efb36afe9a5">space</a> == (<a class="code" href="chan__h323_8c.html#227f82daef18fd97b0ed9538ce418761">tos</a> &gt;&gt; 2))
<a name="l00321"></a>00321          <span class="keywordflow">return</span> dscp_pool1[x].name;
<a name="l00322"></a>00322    }
<a name="l00323"></a>00323 
<a name="l00324"></a>00324    <span class="keywordflow">return</span> <span class="stringliteral">"unknown"</span>;
<a name="l00325"></a>00325 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu May 24 22:26:53 2007 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.5 </small></address>
</body>
</html>
