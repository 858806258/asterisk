<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (24 May 2007)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Thu May 24 22:27:57 2007</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<h1><a class="anchor" name="SIP_REFER">SIP transfer Support (REFER)</a></h1>Handle incoming REFER request<p>
REFER is used for call transfer in SIP. We get a REFER to place a new call with an INVITE somwhere and then keep the transferor up-to-date of the transfer. If the transfer fails, get back on line with the orginal call.<p>
<ul>
<li>REFER can be sent outside or inside of a dialog. Asterisk only accepts REFER inside of a dialog.</li></ul>
<p>
<ul>
<li>If we get a replaces header, it is an attended transfer</li></ul>
<p>
<dl compact><dt><b>Blind transfers</b></dt><dd>The transferor provides the transferee with the transfer targets contact. The signalling between transferer or transferee should not be cancelled, so the call is recoverable if the transfer target can not be reached by the transferee.</dd></dl>
In this case, Asterisk receives a TRANSFER from the transferor, thus is the transferee. We should try to set up a call to the contact provided and if that fails, re-connect the current session. If the new call is set up, we issue a hangup. In this scenario, we are following section 5.2 in the SIP CC Transfer draft. (Transfer without a GRUU)<p>
<dl compact><dt><b>Transfer with consultation hold</b></dt><dd>In this case, the transferor talks to the transfer target before the transfer takes place. This is implemented with SIP hold and transfer. Note: The invite From: string could indicate a transfer. (Section 6. Transfer with consultation hold) The transferor places the transferee on hold, starts a call with the transfer target to alert them to the impending transfer, terminates the connection with the target, then proceeds with the transfer (as in Blind transfer above)</dd></dl>
<dl compact><dt><b>Attended transfer</b></dt><dd>The transferor places the transferee on hold, calls the transfer target to alert them, places the target on hold, then proceeds with the transfer using a Replaces header field in the Refer-to header. This will force the transfee to send an Invite to the target, with a replaces header that instructs the target to hangup the call between the transferor and the target. In this case, the Refer/to: uses the AOR address. (The same URI that the transferee used to establish the session with the transfer target (To: ). The Require: replaces header should be in the INVITE to avoid the wrong UA in a forked SIP proxy scenario to answer and have no call to replace with.</dd></dl>
The referred-by header is *NOT* required, but if we get it, can be copied into the INVITE to the transfer target to inform the target about the transferor<p>
"Any REFER request has to be appropriately authenticated.".<p>
We can't destroy dialogs, since we want the call to continue. <hr size="1"><address style="align: right;"><small>Generated on Thu May 24 22:27:57 2007 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.5 </small></address>
</body>
</html>
