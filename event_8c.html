<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (24 May 2007)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Thu May 24 22:27:28 2007</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Fmain_2F.html">main</a></div>
<h1>event.c File Reference</h1>Internal generic event system. <a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="asterisk_8h-source.html">asterisk.h</a>&quot;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &quot;<a class="el" href="event_8h-source.html">asterisk/event.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="linkedlists_8h-source.html">asterisk/linkedlists.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="lock_8h-source.html">asterisk/lock.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="utils_8h-source.html">asterisk/utils.h</a>&quot;</code><br>

<p>
<a href="event_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__event.html">ast_event</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">An event.  <a href="structast__event.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__event__ie.html">ast_event_ie</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__event__ie__val.html">ast_event_ie_val</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__event__ref.html">ast_event_ref</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__event__sub.html">ast_event_sub</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Event subscription.  <a href="structast__event__sub.html#_details">More...</a><br></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#01b5e015ac0acb2f53df5744d6d5efbb">NUM_EVENT_THREADS</a>&nbsp;&nbsp;&nbsp;5</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#8934f81fd63e7bf2cd79b47a4519929d">ast_event_append_ie_raw</a> (struct <a class="el" href="structast__event.html">ast_event</a> **<a class="el" href="manager_8h.html#4119639092e62c55ea8be348e4d9260d">event</a>, enum <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b">ast_event_ie_type</a> ie_type, const void *data, size_t data_len)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Append an information element that has a raw payload.  <a href="#8934f81fd63e7bf2cd79b47a4519929d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#ce8164c48165ba6cb58965b5b60ac9c8">ast_event_append_ie_str</a> (struct <a class="el" href="structast__event.html">ast_event</a> **<a class="el" href="manager_8h.html#4119639092e62c55ea8be348e4d9260d">event</a>, enum <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b">ast_event_ie_type</a> ie_type, const char *str)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Append an information element that has a string payload.  <a href="#ce8164c48165ba6cb58965b5b60ac9c8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#50a3fbc77a7e217fe88c814a022948cc">ast_event_append_ie_uint</a> (struct <a class="el" href="structast__event.html">ast_event</a> **<a class="el" href="manager_8h.html#4119639092e62c55ea8be348e4d9260d">event</a>, enum <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b">ast_event_ie_type</a> ie_type, uint32_t data)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Append an information element that has an integer payload.  <a href="#50a3fbc77a7e217fe88c814a022948cc"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">enum <a class="el" href="event__defs_8h.html#424fad4518162205ad01c55fcbd21777">ast_event_subscriber_res</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#45a2646c9399f2c44643eb59567ce37e">ast_event_check_subscriber</a> (enum <a class="el" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5">ast_event_type</a> <a class="el" href="chan__nbs_8c.html#a73364531569a868150462e5a44f29c8">type</a>,...)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check if subscribers exist.  <a href="#45a2646c9399f2c44643eb59567ce37e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#4b37332f515288396b68b385758f1e17">ast_event_destroy</a> (struct <a class="el" href="structast__event.html">ast_event</a> *<a class="el" href="manager_8h.html#4119639092e62c55ea8be348e4d9260d">event</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#76c4666a7e4da29982e909c9d8843feb">ast_event_dispatcher</a> (void *unused)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structast__event.html">ast_event</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#a8426bfff9d6f34ef98e8394dedb4994">ast_event_dup</a> (const struct <a class="el" href="structast__event.html">ast_event</a> *<a class="el" href="manager_8h.html#4119639092e62c55ea8be348e4d9260d">event</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#8b0d7c8a7cddfc61bbd82963b4de7913">ast_event_dup_and_cache</a> (const struct <a class="el" href="structast__event.html">ast_event</a> *<a class="el" href="manager_8h.html#4119639092e62c55ea8be348e4d9260d">event</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Duplicate an event and add it to the cache.  <a href="#8b0d7c8a7cddfc61bbd82963b4de7913"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__event.html">ast_event</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#27f9d308adca1ae89d69156ac4b6192e">ast_event_get_cached</a> (enum <a class="el" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5">ast_event_type</a> <a class="el" href="chan__nbs_8c.html#a73364531569a868150462e5a44f29c8">type</a>,...)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Retrieve an event from the cache.  <a href="#27f9d308adca1ae89d69156ac4b6192e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">const void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#e468dffe85e40bc098d4f54a781845b1">ast_event_get_ie_raw</a> (const struct <a class="el" href="structast__event.html">ast_event</a> *<a class="el" href="manager_8h.html#4119639092e62c55ea8be348e4d9260d">event</a>, enum <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b">ast_event_ie_type</a> ie_type)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the value of an information element that has a raw payload.  <a href="#e468dffe85e40bc098d4f54a781845b1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#12352be9265cdaceb97d8b4e628d7aaf">ast_event_get_ie_str</a> (const struct <a class="el" href="structast__event.html">ast_event</a> *<a class="el" href="manager_8h.html#4119639092e62c55ea8be348e4d9260d">event</a>, enum <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b">ast_event_ie_type</a> ie_type)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the value of an information element that has a string payload.  <a href="#12352be9265cdaceb97d8b4e628d7aaf"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">uint32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#4d7c0eaf32d6754b1e2e556f8a9b7bbb">ast_event_get_ie_uint</a> (const struct <a class="el" href="structast__event.html">ast_event</a> *<a class="el" href="manager_8h.html#4119639092e62c55ea8be348e4d9260d">event</a>, enum <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b">ast_event_ie_type</a> ie_type)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the value of an information element that has an integer payload.  <a href="#4d7c0eaf32d6754b1e2e556f8a9b7bbb"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">enum <a class="el" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5">ast_event_type</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#733e4e73cfb4593d04a71fdef29494e6">ast_event_get_type</a> (const struct <a class="el" href="structast__event.html">ast_event</a> *<a class="el" href="manager_8h.html#4119639092e62c55ea8be348e4d9260d">event</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the type for an event.  <a href="#733e4e73cfb4593d04a71fdef29494e6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#8422fd37702f84a5ced85ca3a641915b">ast_event_init</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__event.html">ast_event</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#24d00d946b24949294e1f91a535bd8b8">ast_event_new</a> (enum <a class="el" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5">ast_event_type</a> <a class="el" href="chan__nbs_8c.html#a73364531569a868150462e5a44f29c8">type</a>,...)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#dcae48afacd545a6d29f8e89ef042cf5">ast_event_queue</a> (struct <a class="el" href="structast__event.html">ast_event</a> *<a class="el" href="manager_8h.html#4119639092e62c55ea8be348e4d9260d">event</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#2a5828dac3c92eb431574796e82dee89">ast_event_queue_and_cache</a> (struct <a class="el" href="structast__event.html">ast_event</a> *<a class="el" href="manager_8h.html#4119639092e62c55ea8be348e4d9260d">event</a>,...)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a new event.  <a href="#2a5828dac3c92eb431574796e82dee89"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#04e74e5322c1b16de9116d071e86423b">ast_event_ref_destroy</a> (struct <a class="el" href="structast__event__ref.html">ast_event_ref</a> *event_ref)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#7ba4be66d52b4fed9efa3a0a598b6466">ast_event_report_subs</a> (const struct <a class="el" href="structast__event__sub.html">ast_event_sub</a> *event_sub)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Report current subscriptions to a subscription subscriber.  <a href="#7ba4be66d52b4fed9efa3a0a598b6466"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#63ec1fe5d72d4f6094b11f741647ac85">ast_event_sub_destroy</a> (struct <a class="el" href="structast__event__sub.html">ast_event_sub</a> *sub)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__event__sub.html">ast_event_sub</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#8f5090576abeadfdfdc7f31900bb1f5b">ast_event_subscribe</a> (enum <a class="el" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5">ast_event_type</a> <a class="el" href="chan__nbs_8c.html#a73364531569a868150462e5a44f29c8">type</a>, <a class="el" href="event_8h.html#305f03516e6e75e083b6719a720b43e4">ast_event_cb_t</a> cb, void *userdata,...)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Subscribe to events.  <a href="#8f5090576abeadfdfdc7f31900bb1f5b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#a403abf8cb435f491d27e3f0585a7170">ast_event_unsubscribe</a> (struct <a class="el" href="structast__event__sub.html">ast_event_sub</a> *sub)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Un-subscribe from events.  <a href="#a403abf8cb435f491d27e3f0585a7170"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#eee218ca1332c96b3329869a3748d564">AST_RWLIST_HEAD</a> (ast_event_sub_list, <a class="el" href="structast__event__sub.html">ast_event_sub</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Event subscriptions The event subscribers are indexed by which event they are subscribed to.  <a href="#eee218ca1332c96b3329869a3748d564"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap>struct {</td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;int&nbsp;&nbsp;&nbsp;<a class="el" href="chan__zap_8c.html#6486b4e98228b83d4b13d54febe5f170">alarm</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;<a class="el" href="lock_8h.html#c514af1097ce92209d8aac256b1c5850">ast_cond_t</a>&nbsp;&nbsp;&nbsp;<a class="el" href="event_8c.html#26542fb18a8b14c9775aa475f23c909f">cond</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;const char *&nbsp;&nbsp;&nbsp;<a class="el" href="callerid_8c.html#67daf92c833c41c95db874e18fcb2786">description</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;unsigned int&nbsp;&nbsp;&nbsp;<a class="el" href="logger_8c.html#c2860ae0aa7ac89c509bf7db6bb3324a">event_log</a>:1</td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;const char *&nbsp;&nbsp;&nbsp;<a class="el" href="http_8c.html#abf77184f55403d75b9d51d79162a7ca">ext</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;<a class="el" href="lock_8h.html#55c65f4d641fac96608dabb20791a062">ast_mutex_t</a>&nbsp;&nbsp;&nbsp;<a class="el" href="event_8c.html#dce7c4174ce9323904a934a486c41288">lock</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;const char *&nbsp;&nbsp;&nbsp;<a class="el" href="http_8c.html#455dce211ad602923d28acab07568023">mtype</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;char *&nbsp;&nbsp;&nbsp;<a class="el" href="chan__zap_8c.html#b068931cc450442b63f5b3d276ea4297">name</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;const char *&nbsp;&nbsp;&nbsp;<a class="el" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;unsigned int&nbsp;&nbsp;&nbsp;<a class="el" href="asterisk_8c.html#3759b3f8edb8c22ba8bfd5773258363a">need_quit</a>:1</td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;unsigned int&nbsp;&nbsp;&nbsp;<a class="el" href="asterisk_8c.html#4c2ec178ea7f0e2958118f3dfffb30f3">need_reload</a>:1</td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;<a class="el" href="structrtpPayloadType.html">rtpPayloadType</a>&nbsp;&nbsp;&nbsp;<a class="el" href="rtp_8c.html#081a816b6f16771bb202331725419f93">payloadType</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;unsigned int&nbsp;&nbsp;&nbsp;<a class="el" href="logger_8c.html#b882e02796c8b48d987f6d45f8a7fc04">queue_log</a>:1</td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;char *&nbsp;&nbsp;&nbsp;<a class="el" href="rtp_8c.html#2e282b0d23d6ec55185caeb87b41c0e0">subtype</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;char *&nbsp;&nbsp;&nbsp;<a class="el" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;int&nbsp;&nbsp;&nbsp;<a class="el" href="callerid_8c.html#3a6d0284e743dc4a9b86f97d6dd1a3bf">val</a></td></tr>

<tr><td class="memItemLeft" nowrap valign="top">}&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#13beb04f99cfd9fd4b1d9d303e774eff">event_thread</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">data shared between event dispatching threads  <a href="#13beb04f99cfd9fd4b1d9d303e774eff"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__event__ie.html">ast_event_ie</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#f59dcd306ec32930f1e78a1d82280b48">packed</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">An event.  <a href="#f59dcd306ec32930f1e78a1d82280b48"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static uint32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="event_8c.html#7b3644b799dd7d86b42a289c7442a07a">sub_uniqueid</a></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Internal generic event system. 
<p>
<dl compact><dt><b>Author:</b></dt><dd>Russell Bryant &lt;<a href="mailto:russell@digium.com">russell@digium.com</a>&gt; </dd></dl>

<p>
Definition in file <a class="el" href="event_8c-source.html">event.c</a>.<hr><h2>Define Documentation</h2>
<a class="anchor" name="01b5e015ac0acb2f53df5744d6d5efbb"></a><!-- doxytag: member="event.c::NUM_EVENT_THREADS" ref="01b5e015ac0acb2f53df5744d6d5efbb" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define NUM_EVENT_THREADS&nbsp;&nbsp;&nbsp;5          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="event_8c-source.html#l00038">38</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
Referenced by <a class="el" href="event_8c-source.html#l00758">ast_event_init()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="8934f81fd63e7bf2cd79b47a4519929d"></a><!-- doxytag: member="event.c::ast_event_append_ie_raw" ref="8934f81fd63e7bf2cd79b47a4519929d" args="(struct ast_event **event, enum ast_event_ie_type ie_type, const void *data, size_t data_len)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_event_append_ie_raw           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__event.html">ast_event</a> **&nbsp;</td>
          <td class="mdname" nowrap> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>enum <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b">ast_event_ie_type</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ie_type</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const void *&nbsp;</td>
          <td class="mdname" nowrap> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>size_t&nbsp;</td>
          <td class="mdname" nowrap> <em>data_len</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Append an information element that has a raw payload. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>event</em>&nbsp;</td><td>the event that the IE will be appended to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ie_type</em>&nbsp;</td><td>the type of IE to append </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>A pointer to the raw data for the payload of the IE </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data_len</em>&nbsp;</td><td>The amount of data to copy into the payload</td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>failure</td></tr>
  </table>
</dl>
The pointer to the event will get updated with the new location for the event that now contains the appended information element. If the re-allocation of the memory for this event fails, it will be set to NULL. 
<p>
Definition at line <a class="el" href="event_8c-source.html#l00408">408</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
References <a class="el" href="utils_8h.html#009723420c269c3a1ecb1953558e608d">ast_realloc</a>, <a class="el" href="event_8c-source.html#l00044">ast_event_ie::ie_payload</a>, and <a class="el" href="event_8c-source.html#l00041">ast_event_ie::ie_payload_len</a>.
<p>
Referenced by <a class="el" href="event_8c-source.html#l00395">ast_event_append_ie_str()</a>, and <a class="el" href="event_8c-source.html#l00401">ast_event_append_ie_uint()</a>.<div class="fragment"><pre class="fragment"><a name="l00410"></a>00410 {
<a name="l00411"></a>00411    <span class="keyword">struct </span><a class="code" href="structast__event__ie.html">ast_event_ie</a> *ie;
<a name="l00412"></a>00412    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> extra_len;
<a name="l00413"></a>00413    uint16_t event_len;
<a name="l00414"></a>00414 
<a name="l00415"></a>00415    event_len = ntohs((*event)-&gt;event_len);
<a name="l00416"></a>00416    extra_len = <span class="keyword">sizeof</span>(*ie) + data_len;
<a name="l00417"></a>00417 
<a name="l00418"></a>00418    <span class="keywordflow">if</span> (!(*event = <a class="code" href="utils_8h.html#009723420c269c3a1ecb1953558e608d">ast_realloc</a>(*event, event_len + extra_len)))
<a name="l00419"></a>00419       <span class="keywordflow">return</span> -1;
<a name="l00420"></a>00420 
<a name="l00421"></a>00421    ie = ((<span class="keywordtype">void</span> *) *event) + event_len;
<a name="l00422"></a>00422    ie-&gt;ie_type = htons(ie_type);
<a name="l00423"></a>00423    ie-&gt;<a class="code" href="structast__event__ie.html#71d5b231ccd9aa92f8dcbc7e9a37750f">ie_payload_len</a> = htons(data_len);
<a name="l00424"></a>00424    memcpy(ie-&gt;<a class="code" href="structast__event__ie.html#3c2a9d800aede4080e6a2344f92cafd4">ie_payload</a>, data, data_len);
<a name="l00425"></a>00425 
<a name="l00426"></a>00426    (*event)-&gt;event_len = htons(event_len + extra_len);
<a name="l00427"></a>00427 
<a name="l00428"></a>00428    <span class="keywordflow">return</span> 0;
<a name="l00429"></a>00429 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="ce8164c48165ba6cb58965b5b60ac9c8"></a><!-- doxytag: member="event.c::ast_event_append_ie_str" ref="ce8164c48165ba6cb58965b5b60ac9c8" args="(struct ast_event **event, enum ast_event_ie_type ie_type, const char *str)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_event_append_ie_str           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__event.html">ast_event</a> **&nbsp;</td>
          <td class="mdname" nowrap> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>enum <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b">ast_event_ie_type</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ie_type</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>str</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Append an information element that has a string payload. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>event</em>&nbsp;</td><td>the event that the IE will be appended to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ie_type</em>&nbsp;</td><td>the type of IE to append </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>str</em>&nbsp;</td><td>The string for the payload of the IE</td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>failure</td></tr>
  </table>
</dl>
The pointer to the event will get updated with the new location for the event that now contains the appended information element. If the re-allocation of the memory for this event fails, it will be set to NULL. 
<p>
Definition at line <a class="el" href="event_8c-source.html#l00395">395</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
References <a class="el" href="event_8c-source.html#l00408">ast_event_append_ie_raw()</a>.
<p>
Referenced by <a class="el" href="event_8c-source.html#l00431">ast_event_new()</a>, <a class="el" href="event_8c-source.html#l00187">ast_event_report_subs()</a>, and <a class="el" href="event_8c-source.html#l00243">ast_event_subscribe()</a>.<div class="fragment"><pre class="fragment"><a name="l00397"></a>00397 {
<a name="l00398"></a>00398    <span class="keywordflow">return</span> <a class="code" href="event_8c.html#8934f81fd63e7bf2cd79b47a4519929d">ast_event_append_ie_raw</a>(event, ie_type, str, strlen(str) + 1);
<a name="l00399"></a>00399 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="50a3fbc77a7e217fe88c814a022948cc"></a><!-- doxytag: member="event.c::ast_event_append_ie_uint" ref="50a3fbc77a7e217fe88c814a022948cc" args="(struct ast_event **event, enum ast_event_ie_type ie_type, uint32_t data)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_event_append_ie_uint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__event.html">ast_event</a> **&nbsp;</td>
          <td class="mdname" nowrap> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>enum <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b">ast_event_ie_type</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ie_type</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>uint32_t&nbsp;</td>
          <td class="mdname" nowrap> <em>data</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Append an information element that has an integer payload. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>event</em>&nbsp;</td><td>the event that the IE will be appended to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ie_type</em>&nbsp;</td><td>the type of IE to append </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>The integer for the payload of the IE</td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>failure</td></tr>
  </table>
</dl>
The pointer to the event will get updated with the new location for the event that now contains the appended information element. If the re-allocation of the memory for this event fails, it will be set to NULL. 
<p>
Definition at line <a class="el" href="event_8c-source.html#l00401">401</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
References <a class="el" href="event_8c-source.html#l00408">ast_event_append_ie_raw()</a>.
<p>
Referenced by <a class="el" href="event_8c-source.html#l00431">ast_event_new()</a>, <a class="el" href="event_8c-source.html#l00187">ast_event_report_subs()</a>, and <a class="el" href="event_8c-source.html#l00243">ast_event_subscribe()</a>.<div class="fragment"><pre class="fragment"><a name="l00403"></a>00403 {
<a name="l00404"></a>00404    data = htonl(data);
<a name="l00405"></a>00405    <span class="keywordflow">return</span> <a class="code" href="event_8c.html#8934f81fd63e7bf2cd79b47a4519929d">ast_event_append_ie_raw</a>(event, ie_type, &amp;data, <span class="keyword">sizeof</span>(data));
<a name="l00406"></a>00406 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="45a2646c9399f2c44643eb59567ce37e"></a><!-- doxytag: member="event.c::ast_event_check_subscriber" ref="45a2646c9399f2c44643eb59567ce37e" args="(enum ast_event_type type,...)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">enum <a class="el" href="event__defs_8h.html#424fad4518162205ad01c55fcbd21777">ast_event_subscriber_res</a> ast_event_check_subscriber           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">enum <a class="el" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5">ast_event_type</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>event_type</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>&nbsp;</td>
          <td class="mdname" nowrap> <em>...</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Check if subscribers exist. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>event_type</em>&nbsp;</td><td>This is the type of event that the caller would like to check for subscribers to.</td></tr>
  </table>
</dl>
The rest of the arguments to this function specify additional parameters for checking for subscriptions to subsets of an event type. The arguments must in sets of: <div class="fragment"><pre class="fragment">    &lt;<span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b">ast_event_ie_type</a>&gt;, [<span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e">ast_event_ie_pltype</a>, [payload] ]
</pre></div> and must end with AST_EVENT_IE_END.<p>
If the ie_type specified is *not* AST_EVENT_IE_END, then it must be followed by a valid IE payload type. If the payload type specified is AST_EVENT_IE_PLTYPE_EXISTS, then the 3rd argument should not be provided. Otherwise, a payload must also be specified.<p>
<dl compact><dt><b>Returns:</b></dt><dd>This returns one of the values defined in the ast_event_subscriber_res enum which will indicate if subscribers exist that match the given criteria.</dd></dl>
Example usage:<p>
<div class="fragment"><pre class="fragment"> <span class="keywordflow">if</span> (<a class="code" href="event_8c.html#45a2646c9399f2c44643eb59567ce37e">ast_event_check_subscriber</a>(<a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f500f99a8ee32335ae54d70cea64e9170e">AST_EVENT_MWI</a>,
     <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b8a9b8ba99731edf9cf7aa617c306b186">AST_EVENT_IE_MAILBOX</a>, <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a>, <a class="code" href="chan__mgcp_8c.html#be2fc5fd64209e633c78549d39c04fb2">mailbox</a>,
     <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>) == <a class="code" href="event__defs_8h.html#424fad4518162205ad01c55fcbd21777c65f9b17adec5191e644719fb53f9965">AST_EVENT_SUB_NONE</a>) {
       <span class="keywordflow">return</span>;
 }
</pre></div><p>
This example will check if there are any subscribers to MWI events for the mailbox defined in the "mailbox" variable. 
<p>
Definition at line <a class="el" href="event_8c-source.html#l00117">117</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
References <a class="el" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5706fd8340e84dc5dfb0e3b35bb69dff9">AST_EVENT_ALL</a>, <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>, <a class="el" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0ed653825efb5c5a5abeea257a3d3081ee">AST_EVENT_IE_PLTYPE_EXISTS</a>, <a class="el" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a>, <a class="el" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>, <a class="el" href="event__defs_8h.html#424fad4518162205ad01c55fcbd21777d4e8ddb30f6c452a57f26eae72b1b0a6">AST_EVENT_SUB_EXISTS</a>, <a class="el" href="event__defs_8h.html#424fad4518162205ad01c55fcbd21777c65f9b17adec5191e644719fb53f9965">AST_EVENT_SUB_NONE</a>, <a class="el" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f56c0d85a4badc26620b04ecd2a4dfbd6b">AST_EVENT_TOTAL</a>, <a class="el" href="linkedlists_8h-source.html#l00413">AST_LIST_EMPTY</a>, <a class="el" href="linkedlists_8h-source.html#l00310">AST_LIST_HEAD_NOLOCK_STATIC</a>, <a class="el" href="linkedlists_8h-source.html#l00670">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h-source.html#l00453">AST_LIST_TRAVERSE</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="linkedlists_8h-source.html#l00060">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00456">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h-source.html#l00115">AST_RWLIST_UNLOCK</a>, <a class="el" href="utils_8h.html#b38bbfc0f090d7e013ad805ff172a7d2">ast_strdupa</a>, <a class="el" href="logger_8h-source.html#l00118">LOG_ERROR</a>, and <a class="el" href="event_8c-source.html#l00084">ast_event_ie_val::payload</a>.
<p>
Referenced by <a class="el" href="event_8c-source.html#l00673">ast_event_queue()</a>, <a class="el" href="event_8c-source.html#l00243">ast_event_subscribe()</a>, and <a class="el" href="event_8c-source.html#l00333">ast_event_unsubscribe()</a>.<div class="fragment"><pre class="fragment"><a name="l00118"></a>00118 {
<a name="l00119"></a>00119    va_list ap;
<a name="l00120"></a>00120    <span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b">ast_event_ie_type</a> ie_type;
<a name="l00121"></a>00121    <span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#424fad4518162205ad01c55fcbd21777">ast_event_subscriber_res</a> res = <a class="code" href="event__defs_8h.html#424fad4518162205ad01c55fcbd21777c65f9b17adec5191e644719fb53f9965">AST_EVENT_SUB_NONE</a>;
<a name="l00122"></a>00122    <span class="keyword">struct </span><a class="code" href="structast__event__ie__val.html">ast_event_ie_val</a> *ie_val, *sub_ie_val;
<a name="l00123"></a>00123    <span class="keyword">struct </span><a class="code" href="structast__event__sub.html">ast_event_sub</a> *sub;
<a name="l00124"></a>00124    <a class="code" href="linkedlists_8h.html#c2fac4140618038d0d4f6a81e315cda6">AST_LIST_HEAD_NOLOCK_STATIC</a>(ie_vals, <a class="code" href="structast__event__ie__val.html">ast_event_ie_val</a>);
<a name="l00125"></a>00125 
<a name="l00126"></a>00126    <span class="keywordflow">if</span> (<a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a> &gt;= <a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f56c0d85a4badc26620b04ecd2a4dfbd6b">AST_EVENT_TOTAL</a>) {
<a name="l00127"></a>00127       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#4490aa3d29644e716440fada68f54032">LOG_ERROR</a>, <span class="stringliteral">"%u is an invalid type!\n"</span>, <a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>);
<a name="l00128"></a>00128       <span class="keywordflow">return</span> res;
<a name="l00129"></a>00129    }
<a name="l00130"></a>00130 
<a name="l00131"></a>00131    va_start(ap, <a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>);
<a name="l00132"></a>00132    <span class="keywordflow">for</span> (ie_type = va_arg(ap, <span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5">ast_event_type</a>);
<a name="l00133"></a>00133       ie_type != <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>;
<a name="l00134"></a>00134       ie_type = va_arg(ap, <span class="keyword">enum</span> ast_event_type))
<a name="l00135"></a>00135    {
<a name="l00136"></a>00136       <span class="keyword">struct </span><a class="code" href="structast__event__ie__val.html">ast_event_ie_val</a> *ie_val = alloca(<span class="keyword">sizeof</span>(*ie_val));
<a name="l00137"></a>00137       memset(ie_val, 0, <span class="keyword">sizeof</span>(*ie_val));
<a name="l00138"></a>00138       ie_val-&gt;ie_type = ie_type;
<a name="l00139"></a>00139       ie_val-&gt;ie_pltype = va_arg(ap, <span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e">ast_event_ie_pltype</a>);
<a name="l00140"></a>00140       <span class="keywordflow">if</span> (ie_val-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>)
<a name="l00141"></a>00141          ie_val-&gt;<a class="code" href="structast__event__ie__val.html#321c3cf486ed509164edec1e1981fec8">payload</a>.uint = va_arg(ap, uint32_t);
<a name="l00142"></a>00142       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ie_val-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a>)
<a name="l00143"></a>00143          ie_val-&gt;<a class="code" href="structast__event__ie__val.html#321c3cf486ed509164edec1e1981fec8">payload</a>.str = <a class="code" href="utils_8h.html#b38bbfc0f090d7e013ad805ff172a7d2">ast_strdupa</a>(va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *));
<a name="l00144"></a>00144       <a class="code" href="linkedlists_8h.html#8de6ce8a3b9d59e7e7fddee6b62b32a7">AST_LIST_INSERT_TAIL</a>(&amp;ie_vals, ie_val, entry);
<a name="l00145"></a>00145    }
<a name="l00146"></a>00146    va_end(ap);
<a name="l00147"></a>00147 
<a name="l00148"></a>00148    <a class="code" href="linkedlists_8h.html#23c0c844e5abcb474854867b408e3be8">AST_RWLIST_RDLOCK</a>(&amp;ast_event_subs[<a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>]);
<a name="l00149"></a>00149    <a class="code" href="linkedlists_8h.html#36b8c64a6c62cb77baa726f81dcaa7f5">AST_RWLIST_TRAVERSE</a>(&amp;ast_event_subs[<a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>], sub, entry) {
<a name="l00150"></a>00150       <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;ie_vals, ie_val, entry) {
<a name="l00151"></a>00151          <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;sub-&gt;ie_vals, sub_ie_val, entry) {
<a name="l00152"></a>00152             <span class="keywordflow">if</span> (sub_ie_val-&gt;ie_type == ie_val-&gt;ie_type)
<a name="l00153"></a>00153                <span class="keywordflow">break</span>;
<a name="l00154"></a>00154          }
<a name="l00155"></a>00155          <span class="keywordflow">if</span> (!sub_ie_val) {
<a name="l00156"></a>00156             <span class="keywordflow">if</span> (ie_val-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0ed653825efb5c5a5abeea257a3d3081ee">AST_EVENT_IE_PLTYPE_EXISTS</a>)
<a name="l00157"></a>00157                <span class="keywordflow">break</span>;
<a name="l00158"></a>00158             <span class="keywordflow">continue</span>;
<a name="l00159"></a>00159          }
<a name="l00160"></a>00160          <span class="comment">/* The subscriber doesn't actually care what the value is */</span>
<a name="l00161"></a>00161          <span class="keywordflow">if</span> (sub_ie_val-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0ed653825efb5c5a5abeea257a3d3081ee">AST_EVENT_IE_PLTYPE_EXISTS</a>)
<a name="l00162"></a>00162             <span class="keywordflow">continue</span>;
<a name="l00163"></a>00163          <span class="keywordflow">if</span> (ie_val-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a> &amp;&amp;
<a name="l00164"></a>00164             ie_val-&gt;<a class="code" href="structast__event__ie__val.html#321c3cf486ed509164edec1e1981fec8">payload</a>.uint != sub_ie_val-&gt;<a class="code" href="structast__event__ie__val.html#321c3cf486ed509164edec1e1981fec8">payload</a>.uint)
<a name="l00165"></a>00165             <span class="keywordflow">break</span>;
<a name="l00166"></a>00166          <span class="keywordflow">if</span> (ie_val-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a> &amp;&amp;
<a name="l00167"></a>00167             strcmp(ie_val-&gt;<a class="code" href="structast__event__ie__val.html#321c3cf486ed509164edec1e1981fec8">payload</a>.str, sub_ie_val-&gt;<a class="code" href="structast__event__ie__val.html#321c3cf486ed509164edec1e1981fec8">payload</a>.str))
<a name="l00168"></a>00168             <span class="keywordflow">break</span>;
<a name="l00169"></a>00169       }
<a name="l00170"></a>00170       <span class="keywordflow">if</span> (!ie_val)
<a name="l00171"></a>00171          <span class="keywordflow">break</span>;
<a name="l00172"></a>00172    }
<a name="l00173"></a>00173    <a class="code" href="linkedlists_8h.html#470215c8af4ffcdb09701e5d092a9205">AST_RWLIST_UNLOCK</a>(&amp;ast_event_subs[type]);
<a name="l00174"></a>00174 
<a name="l00175"></a>00175    <span class="keywordflow">if</span> (sub) <span class="comment">/* All parameters were matched */</span>
<a name="l00176"></a>00176       <span class="keywordflow">return</span> <a class="code" href="event__defs_8h.html#424fad4518162205ad01c55fcbd21777d4e8ddb30f6c452a57f26eae72b1b0a6">AST_EVENT_SUB_EXISTS</a>;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178    <a class="code" href="linkedlists_8h.html#23c0c844e5abcb474854867b408e3be8">AST_RWLIST_RDLOCK</a>(&amp;ast_event_subs[<a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5706fd8340e84dc5dfb0e3b35bb69dff9">AST_EVENT_ALL</a>]);
<a name="l00179"></a>00179    <span class="keywordflow">if</span> (!<a class="code" href="linkedlists_8h.html#0a9573eff61452c49019359bfc0df565">AST_LIST_EMPTY</a>(&amp;ast_event_subs[<a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5706fd8340e84dc5dfb0e3b35bb69dff9">AST_EVENT_ALL</a>]))
<a name="l00180"></a>00180       res = <a class="code" href="event__defs_8h.html#424fad4518162205ad01c55fcbd21777d4e8ddb30f6c452a57f26eae72b1b0a6">AST_EVENT_SUB_EXISTS</a>;
<a name="l00181"></a>00181    <a class="code" href="linkedlists_8h.html#470215c8af4ffcdb09701e5d092a9205">AST_RWLIST_UNLOCK</a>(&amp;ast_event_subs[AST_EVENT_ALL]);
<a name="l00182"></a>00182 
<a name="l00183"></a>00183    <span class="keywordflow">return</span> res;
<a name="l00184"></a>00184 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="4b37332f515288396b68b385758f1e17"></a><!-- doxytag: member="event.c::ast_event_destroy" ref="4b37332f515288396b68b385758f1e17" args="(struct ast_event *event)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_event_destroy           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__event.html">ast_event</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>event</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="event_8c-source.html#l00482">482</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
References <a class="el" href="astmm_8h-source.html#l00069">free</a>.
<p>
Referenced by <a class="el" href="event_8c-source.html#l00673">ast_event_queue()</a>, <a class="el" href="event_8c-source.html#l00487">ast_event_ref_destroy()</a>, <a class="el" href="event_8c-source.html#l00187">ast_event_report_subs()</a>, <a class="el" href="res__eventtest_8c-source.html#l00121">event_get_cached()</a>, <a class="el" href="chan__mgcp_8c-source.html#l00466">has_voicemail()</a>, <a class="el" href="chan__sip_8c-source.html#l15903">sip_send_mwi_to_peer()</a>, and <a class="el" href="chan__iax2_8c-source.html#l05757">update_registry()</a>.<div class="fragment"><pre class="fragment"><a name="l00483"></a>00483 {
<a name="l00484"></a>00484    <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(event);
<a name="l00485"></a>00485 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="76c4666a7e4da29982e909c9d8843feb"></a><!-- doxytag: member="event.c::ast_event_dispatcher" ref="76c4666a7e4da29982e909c9d8843feb" args="(void *unused)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void* ast_event_dispatcher           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>unused</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="event_8c-source.html#l00707">707</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
References <a class="el" href="lock_8h-source.html#l00562">ast_cond_wait()</a>, <a class="el" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5706fd8340e84dc5dfb0e3b35bb69dff9">AST_EVENT_ALL</a>, <a class="el" href="event_8c-source.html#l00376">ast_event_get_ie_raw()</a>, <a class="el" href="event_8c-source.html#l00371">ast_event_get_ie_str()</a>, <a class="el" href="event_8c-source.html#l00362">ast_event_get_ie_uint()</a>, <a class="el" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0ed653825efb5c5a5abeea257a3d3081ee">AST_EVENT_IE_PLTYPE_EXISTS</a>, <a class="el" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a>, <a class="el" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>, <a class="el" href="event_8c-source.html#l00487">ast_event_ref_destroy()</a>, <a class="el" href="linkedlists_8h-source.html#l00710">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="linkedlists_8h-source.html#l00453">AST_LIST_TRAVERSE</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="linkedlists_8h-source.html#l00060">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00456">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h-source.html#l00115">AST_RWLIST_UNLOCK</a>, <a class="el" href="event_8c-source.html#l00090">ast_event_sub::cb</a>, <a class="el" href="event_8c-source.html#l00064">ast_event_ref::event</a>, <a class="el" href="event_8c.html#13beb04f99cfd9fd4b1d9d303e774eff">event_thread</a>, <a class="el" href="event_8c-source.html#l00084">ast_event_ie_val::payload</a>, and <a class="el" href="event_8c-source.html#l00091">ast_event_sub::userdata</a>.
<p>
Referenced by <a class="el" href="event_8c-source.html#l00758">ast_event_init()</a>.<div class="fragment"><pre class="fragment"><a name="l00708"></a>00708 {
<a name="l00709"></a>00709    <span class="keywordflow">for</span> (;;) {
<a name="l00710"></a>00710       <span class="keyword">struct </span><a class="code" href="structast__event__ref.html">ast_event_ref</a> *event_ref;
<a name="l00711"></a>00711       <span class="keyword">struct </span><a class="code" href="structast__event__sub.html">ast_event_sub</a> *sub;
<a name="l00712"></a>00712       uint16_t host_event_type;
<a name="l00713"></a>00713 
<a name="l00714"></a>00714       <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;<a class="code" href="event_8c.html#13beb04f99cfd9fd4b1d9d303e774eff">event_thread</a>.lock);
<a name="l00715"></a>00715       <span class="keywordflow">while</span> (!(event_ref = <a class="code" href="linkedlists_8h.html#beec347da29fe6b0d7fdb3e80b851f90">AST_LIST_REMOVE_HEAD</a>(&amp;<a class="code" href="event_8c.html#13beb04f99cfd9fd4b1d9d303e774eff">event_thread</a>.event_q, entry)))
<a name="l00716"></a>00716          <a class="code" href="lock_8h.html#6a8a1d6df381c8ad9b8e664ff01849f8">ast_cond_wait</a>(&amp;<a class="code" href="event_8c.html#13beb04f99cfd9fd4b1d9d303e774eff">event_thread</a>.cond, &amp;<a class="code" href="event_8c.html#13beb04f99cfd9fd4b1d9d303e774eff">event_thread</a>.lock);
<a name="l00717"></a>00717       <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;<a class="code" href="event_8c.html#13beb04f99cfd9fd4b1d9d303e774eff">event_thread</a>.lock);
<a name="l00718"></a>00718 
<a name="l00719"></a>00719       host_event_type = ntohs(event_ref-&gt;<a class="code" href="structast__event__ref.html#4119639092e62c55ea8be348e4d9260d">event</a>-&gt;type);
<a name="l00720"></a>00720 
<a name="l00721"></a>00721       <span class="comment">/* Subscribers to this specific event first */</span>
<a name="l00722"></a>00722       <a class="code" href="linkedlists_8h.html#23c0c844e5abcb474854867b408e3be8">AST_RWLIST_RDLOCK</a>(&amp;ast_event_subs[host_event_type]);
<a name="l00723"></a>00723       <a class="code" href="linkedlists_8h.html#36b8c64a6c62cb77baa726f81dcaa7f5">AST_RWLIST_TRAVERSE</a>(&amp;ast_event_subs[host_event_type], sub, entry) {
<a name="l00724"></a>00724          <span class="keyword">struct </span><a class="code" href="structast__event__ie__val.html">ast_event_ie_val</a> *ie_val;
<a name="l00725"></a>00725          <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;sub-&gt;ie_vals, ie_val, entry) {
<a name="l00726"></a>00726             <span class="keywordflow">if</span> (ie_val-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0ed653825efb5c5a5abeea257a3d3081ee">AST_EVENT_IE_PLTYPE_EXISTS</a> &amp;&amp;
<a name="l00727"></a>00727                <a class="code" href="event_8c.html#e468dffe85e40bc098d4f54a781845b1">ast_event_get_ie_raw</a>(event_ref-&gt;<a class="code" href="structast__event__ref.html#4119639092e62c55ea8be348e4d9260d">event</a>, ie_val-&gt;ie_type)) {
<a name="l00728"></a>00728                <span class="keywordflow">continue</span>;
<a name="l00729"></a>00729             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ie_val-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a> &amp;&amp;
<a name="l00730"></a>00730                <a class="code" href="event_8c.html#4d7c0eaf32d6754b1e2e556f8a9b7bbb">ast_event_get_ie_uint</a>(event_ref-&gt;<a class="code" href="structast__event__ref.html#4119639092e62c55ea8be348e4d9260d">event</a>, ie_val-&gt;ie_type) 
<a name="l00731"></a>00731                == ie_val-&gt;<a class="code" href="structast__event__ie__val.html#321c3cf486ed509164edec1e1981fec8">payload</a>.uint) {
<a name="l00732"></a>00732                <span class="keywordflow">continue</span>;
<a name="l00733"></a>00733             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ie_val-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a> &amp;&amp;
<a name="l00734"></a>00734                !strcmp(<a class="code" href="event_8c.html#12352be9265cdaceb97d8b4e628d7aaf">ast_event_get_ie_str</a>(event_ref-&gt;<a class="code" href="structast__event__ref.html#4119639092e62c55ea8be348e4d9260d">event</a>, ie_val-&gt;ie_type),
<a name="l00735"></a>00735                   ie_val-&gt;<a class="code" href="structast__event__ie__val.html#321c3cf486ed509164edec1e1981fec8">payload</a>.str)) {
<a name="l00736"></a>00736                <span class="keywordflow">continue</span>;
<a name="l00737"></a>00737             }
<a name="l00738"></a>00738             <span class="keywordflow">break</span>;
<a name="l00739"></a>00739          }
<a name="l00740"></a>00740          <span class="keywordflow">if</span> (ie_val)
<a name="l00741"></a>00741             <span class="keywordflow">continue</span>;
<a name="l00742"></a>00742          sub-&gt;<a class="code" href="structast__event__sub.html#d0d7fdb6977b26929fb68c6083c0b439">cb</a>(event_ref-&gt;<a class="code" href="structast__event__ref.html#4119639092e62c55ea8be348e4d9260d">event</a>, sub-&gt;<a class="code" href="structast__event__sub.html#08fd04da1b9c3e4c1c9ab1fe42494a35">userdata</a>);
<a name="l00743"></a>00743       }
<a name="l00744"></a>00744       <a class="code" href="linkedlists_8h.html#470215c8af4ffcdb09701e5d092a9205">AST_RWLIST_UNLOCK</a>(&amp;ast_event_subs[host_event_type]);
<a name="l00745"></a>00745 
<a name="l00746"></a>00746       <span class="comment">/* Now to subscribers to all event types */</span>
<a name="l00747"></a>00747       <a class="code" href="linkedlists_8h.html#23c0c844e5abcb474854867b408e3be8">AST_RWLIST_RDLOCK</a>(&amp;ast_event_subs[<a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5706fd8340e84dc5dfb0e3b35bb69dff9">AST_EVENT_ALL</a>]);
<a name="l00748"></a>00748       <a class="code" href="linkedlists_8h.html#36b8c64a6c62cb77baa726f81dcaa7f5">AST_RWLIST_TRAVERSE</a>(&amp;ast_event_subs[<a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5706fd8340e84dc5dfb0e3b35bb69dff9">AST_EVENT_ALL</a>], sub, entry)
<a name="l00749"></a>00749          sub-&gt;cb(event_ref-&gt;<a class="code" href="manager_8h.html#4119639092e62c55ea8be348e4d9260d">event</a>, sub-&gt;userdata);
<a name="l00750"></a>00750       <a class="code" href="linkedlists_8h.html#470215c8af4ffcdb09701e5d092a9205">AST_RWLIST_UNLOCK</a>(&amp;ast_event_subs[AST_EVENT_ALL]);
<a name="l00751"></a>00751 
<a name="l00752"></a>00752       <a class="code" href="event_8c.html#04e74e5322c1b16de9116d071e86423b">ast_event_ref_destroy</a>(event_ref);
<a name="l00753"></a>00753    }
<a name="l00754"></a>00754 
<a name="l00755"></a>00755    return NULL;
<a name="l00756"></a>00756 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a8426bfff9d6f34ef98e8394dedb4994"></a><!-- doxytag: member="event.c::ast_event_dup" ref="a8426bfff9d6f34ef98e8394dedb4994" args="(const struct ast_event *event)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static struct <a class="el" href="structast__event.html">ast_event</a>* ast_event_dup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const struct <a class="el" href="structast__event.html">ast_event</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>event</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="event_8c-source.html#l00493">493</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
References <a class="el" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>, and <a class="el" href="event_8c-source.html#l00056">ast_event::event_len</a>.
<p>
Referenced by <a class="el" href="event_8c-source.html#l00584">ast_event_dup_and_cache()</a>, and <a class="el" href="event_8c-source.html#l00508">ast_event_get_cached()</a>.<div class="fragment"><pre class="fragment"><a name="l00494"></a>00494 {
<a name="l00495"></a>00495    <span class="keyword">struct </span><a class="code" href="structast__event.html">ast_event</a> *dup_event;
<a name="l00496"></a>00496    uint16_t <a class="code" href="structast__event.html#5a6793a0da30dd0c8b301a673d69432d">event_len</a>;
<a name="l00497"></a>00497 
<a name="l00498"></a>00498    event_len = ntohs(event-&gt;<a class="code" href="structast__event.html#5a6793a0da30dd0c8b301a673d69432d">event_len</a>);
<a name="l00499"></a>00499 
<a name="l00500"></a>00500    <span class="keywordflow">if</span> (!(dup_event = <a class="code" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>(1, event_len)))
<a name="l00501"></a>00501       <span class="keywordflow">return</span> NULL;
<a name="l00502"></a>00502    
<a name="l00503"></a>00503    memcpy(dup_event, event, event_len);
<a name="l00504"></a>00504 
<a name="l00505"></a>00505    <span class="keywordflow">return</span> dup_event;
<a name="l00506"></a>00506 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="8b0d7c8a7cddfc61bbd82963b4de7913"></a><!-- doxytag: member="event.c::ast_event_dup_and_cache" ref="8b0d7c8a7cddfc61bbd82963b4de7913" args="(const struct ast_event *event)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int ast_event_dup_and_cache           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const struct <a class="el" href="structast__event.html">ast_event</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>event</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Duplicate an event and add it to the cache. 
<p>
<dl compact><dt><b>Note:</b></dt><dd>This assumes this index in to the cache is locked </dd></dl>

<p>
Definition at line <a class="el" href="event_8c-source.html#l00584">584</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
References <a class="el" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>, <a class="el" href="event_8c-source.html#l00493">ast_event_dup()</a>, and <a class="el" href="linkedlists_8h-source.html#l00670">AST_LIST_INSERT_TAIL</a>.
<p>
Referenced by <a class="el" href="event_8c-source.html#l00601">ast_event_queue_and_cache()</a>.<div class="fragment"><pre class="fragment"><a name="l00585"></a>00585 {
<a name="l00586"></a>00586    <span class="keyword">struct </span><a class="code" href="structast__event.html">ast_event</a> *dup_event;
<a name="l00587"></a>00587    <span class="keyword">struct </span><a class="code" href="structast__event__ref.html">ast_event_ref</a> *event_ref;
<a name="l00588"></a>00588 
<a name="l00589"></a>00589    <span class="keywordflow">if</span> (!(dup_event = <a class="code" href="event_8c.html#a8426bfff9d6f34ef98e8394dedb4994">ast_event_dup</a>(event)))
<a name="l00590"></a>00590       <span class="keywordflow">return</span> -1;
<a name="l00591"></a>00591    <span class="keywordflow">if</span> (!(event_ref = <a class="code" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*event_ref))))
<a name="l00592"></a>00592       <span class="keywordflow">return</span> -1;
<a name="l00593"></a>00593    
<a name="l00594"></a>00594    event_ref-&gt;event = dup_event;
<a name="l00595"></a>00595 
<a name="l00596"></a>00596    <a class="code" href="linkedlists_8h.html#8de6ce8a3b9d59e7e7fddee6b62b32a7">AST_LIST_INSERT_TAIL</a>(&amp;ast_event_cache[ntohs(event-&gt;type)], event_ref, entry);
<a name="l00597"></a>00597 
<a name="l00598"></a>00598    <span class="keywordflow">return</span> 0;
<a name="l00599"></a>00599 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="27f9d308adca1ae89d69156ac4b6192e"></a><!-- doxytag: member="event.c::ast_event_get_cached" ref="27f9d308adca1ae89d69156ac4b6192e" args="(enum ast_event_type type,...)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__event.html">ast_event</a>* ast_event_get_cached           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">enum&nbsp;</td>
          <td class="mdname" nowrap> <em>ast_event_type</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>&nbsp;</td>
          <td class="mdname" nowrap> <em>...</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Retrieve an event from the cache. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>event_type</em>&nbsp;</td><td>The type of event to retrieve from the cache</td></tr>
  </table>
</dl>
The rest of the arguments to this function specify information elements to match for retrieving events from the cache. They are specified in the form: <div class="fragment"><pre class="fragment">    &lt;<span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b">ast_event_ie_type</a>&gt;, [<span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e">ast_event_ie_pltype</a>, [payload] ]
</pre></div> and must end with AST_EVENT_IE_END.<p>
If the ie_type specified is *not* AST_EVENT_IE_END, then it must be followed by a valid IE payload type. If the payload type specified is AST_EVENT_IE_PLTYPE_EXISTS, then the 3rd argument should not be provided. Otherwise, a payload must also be specified.<p>
<dl compact><dt><b>Returns:</b></dt><dd>A reference to an event retrieved from the cache. If no event was found that matches the specified criteria, then NULL will be returned.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>If more than one event in the cache matches the specified criteria, only one will be returned, and it is undefined which one it will be.<p>
The caller of this function *must* call <a class="el" href="event_8c.html#4b37332f515288396b68b385758f1e17">ast_event_destroy()</a> on the returned event after it is done using it.</dd></dl>
Example Usage:<p>
<div class="fragment"><pre class="fragment"> event = <a class="code" href="event_8c.html#27f9d308adca1ae89d69156ac4b6192e">ast_event_get_cached</a>(<a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f500f99a8ee32335ae54d70cea64e9170e">AST_EVENT_MWI</a>,
     <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b8a9b8ba99731edf9cf7aa617c306b186">AST_EVENT_IE_MAILBOX</a>, <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a>, <a class="code" href="chan__mgcp_8c.html#be2fc5fd64209e633c78549d39c04fb2">mailbox</a>,
     <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>);
</pre></div><p>
This example will check for an MWI event in the cache that matches the specified mailbox. This would be the way to find out the last known state of a mailbox without having to poll the mailbox directly. 
<p>
Definition at line <a class="el" href="event_8c-source.html#l00508">508</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
References <a class="el" href="event_8c-source.html#l00493">ast_event_dup()</a>, <a class="el" href="event_8c-source.html#l00376">ast_event_get_ie_raw()</a>, <a class="el" href="event_8c-source.html#l00371">ast_event_get_ie_str()</a>, <a class="el" href="event_8c-source.html#l00362">ast_event_get_ie_uint()</a>, <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>, <a class="el" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0ed653825efb5c5a5abeea257a3d3081ee">AST_EVENT_IE_PLTYPE_EXISTS</a>, <a class="el" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a>, <a class="el" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>, <a class="el" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f56c0d85a4badc26620b04ecd2a4dfbd6b">AST_EVENT_TOTAL</a>, <a class="el" href="linkedlists_8h-source.html#l00413">AST_LIST_EMPTY</a>, <a class="el" href="linkedlists_8h-source.html#l00374">AST_LIST_ENTRY</a>, <a class="el" href="linkedlists_8h-source.html#l00310">AST_LIST_HEAD_NOLOCK_STATIC</a>, <a class="el" href="linkedlists_8h-source.html#l00670">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h-source.html#l00453">AST_LIST_TRAVERSE</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="linkedlists_8h-source.html#l00060">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00503">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h-source.html#l00556">AST_RWLIST_TRAVERSE_SAFE_END</a>, <a class="el" href="linkedlists_8h-source.html#l00115">AST_RWLIST_UNLOCK</a>, <a class="el" href="utils_8h.html#b38bbfc0f090d7e013ad805ff172a7d2">ast_strdupa</a>, <a class="el" href="event_8c-source.html#l00064">ast_event_ref::event</a>, and <a class="el" href="logger_8h-source.html#l00118">LOG_ERROR</a>.
<p>
Referenced by <a class="el" href="res__eventtest_8c-source.html#l00121">event_get_cached()</a>, <a class="el" href="chan__mgcp_8c-source.html#l00466">has_voicemail()</a>, <a class="el" href="chan__sip_8c-source.html#l15903">sip_send_mwi_to_peer()</a>, and <a class="el" href="chan__iax2_8c-source.html#l05757">update_registry()</a>.<div class="fragment"><pre class="fragment"><a name="l00509"></a>00509 {
<a name="l00510"></a>00510    va_list ap;
<a name="l00511"></a>00511    <span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b">ast_event_ie_type</a> ie_type;
<a name="l00512"></a>00512    <span class="keyword">struct </span><a class="code" href="structast__event.html">ast_event</a> *dup_event = NULL;
<a name="l00513"></a>00513    <span class="keyword">struct </span><a class="code" href="structast__event__ref.html">ast_event_ref</a> *event_ref;
<a name="l00514"></a>00514    <span class="keyword">struct </span>cache_arg {
<a name="l00515"></a>00515       <a class="code" href="linkedlists_8h.html#281773a259b5b580d77d636e50fff073">AST_LIST_ENTRY</a>(cache_arg) entry;
<a name="l00516"></a>00516       enum <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b">ast_event_ie_type</a> ie_type;
<a name="l00517"></a>00517       enum <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e">ast_event_ie_pltype</a> ie_pltype;
<a name="l00518"></a>00518       union {
<a name="l00519"></a>00519          uint32_t uint;
<a name="l00520"></a>00520          <span class="keyword">const</span> <span class="keywordtype">char</span> *str;
<a name="l00521"></a>00521       } payload;
<a name="l00522"></a>00522    } *cache_arg;
<a name="l00523"></a>00523    <a class="code" href="linkedlists_8h.html#c2fac4140618038d0d4f6a81e315cda6">AST_LIST_HEAD_NOLOCK_STATIC</a>(cache_args, cache_arg);
<a name="l00524"></a>00524 
<a name="l00525"></a>00525    <span class="keywordflow">if</span> (<a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a> &gt;= <a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f56c0d85a4badc26620b04ecd2a4dfbd6b">AST_EVENT_TOTAL</a>) {
<a name="l00526"></a>00526       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#4490aa3d29644e716440fada68f54032">LOG_ERROR</a>, <span class="stringliteral">"%u is an invalid type!\n"</span>, <a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>);
<a name="l00527"></a>00527       <span class="keywordflow">return</span> NULL;
<a name="l00528"></a>00528    }
<a name="l00529"></a>00529 
<a name="l00530"></a>00530    va_start(ap, <a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>);
<a name="l00531"></a>00531    <span class="keywordflow">for</span> (ie_type = va_arg(ap, <span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5">ast_event_type</a>);
<a name="l00532"></a>00532       ie_type != <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>;
<a name="l00533"></a>00533       ie_type = va_arg(ap, <span class="keyword">enum</span> ast_event_type))
<a name="l00534"></a>00534    {
<a name="l00535"></a>00535       cache_arg = alloca(<span class="keyword">sizeof</span>(*cache_arg));
<a name="l00536"></a>00536       memset(cache_arg, 0, <span class="keyword">sizeof</span>(*cache_arg));
<a name="l00537"></a>00537       cache_arg-&gt;ie_type = ie_type;
<a name="l00538"></a>00538       cache_arg-&gt;ie_pltype = va_arg(ap, <span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e">ast_event_ie_pltype</a>);
<a name="l00539"></a>00539       <span class="keywordflow">if</span> (cache_arg-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>)
<a name="l00540"></a>00540          cache_arg-&gt;payload.uint = va_arg(ap, uint32_t);
<a name="l00541"></a>00541       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cache_arg-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a>)
<a name="l00542"></a>00542          cache_arg-&gt;payload.str = <a class="code" href="utils_8h.html#b38bbfc0f090d7e013ad805ff172a7d2">ast_strdupa</a>(va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *));
<a name="l00543"></a>00543       <a class="code" href="linkedlists_8h.html#8de6ce8a3b9d59e7e7fddee6b62b32a7">AST_LIST_INSERT_TAIL</a>(&amp;cache_args, cache_arg, entry);
<a name="l00544"></a>00544    }
<a name="l00545"></a>00545    va_end(ap);
<a name="l00546"></a>00546 
<a name="l00547"></a>00547    <span class="keywordflow">if</span> (<a class="code" href="linkedlists_8h.html#0a9573eff61452c49019359bfc0df565">AST_LIST_EMPTY</a>(&amp;cache_args)) {
<a name="l00548"></a>00548       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#4490aa3d29644e716440fada68f54032">LOG_ERROR</a>, <span class="stringliteral">"Events can not be retrieved from the cache without "</span>
<a name="l00549"></a>00549          <span class="stringliteral">"specifying at least one IE type!\n"</span>);
<a name="l00550"></a>00550       <span class="keywordflow">return</span> NULL;
<a name="l00551"></a>00551    }
<a name="l00552"></a>00552 
<a name="l00553"></a>00553    <a class="code" href="linkedlists_8h.html#23c0c844e5abcb474854867b408e3be8">AST_RWLIST_RDLOCK</a>(&amp;ast_event_cache[<a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>]);
<a name="l00554"></a>00554    <a class="code" href="linkedlists_8h.html#b564f1f262db6464e1644462c38d61e3">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>(&amp;ast_event_cache[<a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>], event_ref, entry) {
<a name="l00555"></a>00555       <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;cache_args, cache_arg, entry) {
<a name="l00556"></a>00556          <span class="keywordflow">if</span> ( ! ( (cache_arg-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a> &amp;&amp;
<a name="l00557"></a>00557             (cache_arg-&gt;payload.uint ==
<a name="l00558"></a>00558              <a class="code" href="event_8c.html#4d7c0eaf32d6754b1e2e556f8a9b7bbb">ast_event_get_ie_uint</a>(event_ref-&gt;<a class="code" href="structast__event__ref.html#4119639092e62c55ea8be348e4d9260d">event</a>, cache_arg-&gt;ie_type))) ||
<a name="l00559"></a>00559 
<a name="l00560"></a>00560             (cache_arg-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a> &amp;&amp;
<a name="l00561"></a>00561             (!strcmp(cache_arg-&gt;payload.str,
<a name="l00562"></a>00562               <a class="code" href="event_8c.html#12352be9265cdaceb97d8b4e628d7aaf">ast_event_get_ie_str</a>(event_ref-&gt;<a class="code" href="structast__event__ref.html#4119639092e62c55ea8be348e4d9260d">event</a>, cache_arg-&gt;ie_type)))) ||
<a name="l00563"></a>00563 
<a name="l00564"></a>00564             (cache_arg-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0ed653825efb5c5a5abeea257a3d3081ee">AST_EVENT_IE_PLTYPE_EXISTS</a> &amp;&amp;
<a name="l00565"></a>00565              <a class="code" href="event_8c.html#e468dffe85e40bc098d4f54a781845b1">ast_event_get_ie_raw</a>(event_ref-&gt;<a class="code" href="structast__event__ref.html#4119639092e62c55ea8be348e4d9260d">event</a>, cache_arg-&gt;ie_type)) ) ) 
<a name="l00566"></a>00566          {
<a name="l00567"></a>00567             <span class="keywordflow">break</span>;   
<a name="l00568"></a>00568          }
<a name="l00569"></a>00569       }
<a name="l00570"></a>00570       <span class="keywordflow">if</span> (!cache_arg) {
<a name="l00571"></a>00571          <span class="comment">/* All parameters were matched on this cache entry, so return it */</span>
<a name="l00572"></a>00572          dup_event = <a class="code" href="event_8c.html#a8426bfff9d6f34ef98e8394dedb4994">ast_event_dup</a>(event_ref-&gt;<a class="code" href="structast__event__ref.html#4119639092e62c55ea8be348e4d9260d">event</a>);
<a name="l00573"></a>00573          <span class="keywordflow">break</span>;
<a name="l00574"></a>00574       }
<a name="l00575"></a>00575    }
<a name="l00576"></a>00576    <a class="code" href="linkedlists_8h.html#e5be717f6b8c1586fa30a060b56403fe">AST_RWLIST_TRAVERSE_SAFE_END</a>
<a name="l00577"></a>00577    <a class="code" href="linkedlists_8h.html#470215c8af4ffcdb09701e5d092a9205">AST_RWLIST_UNLOCK</a>(&amp;ast_event_cache[type]);
<a name="l00578"></a>00578 
<a name="l00579"></a>00579    <span class="keywordflow">return</span> dup_event;
<a name="l00580"></a>00580 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="e468dffe85e40bc098d4f54a781845b1"></a><!-- doxytag: member="event.c::ast_event_get_ie_raw" ref="e468dffe85e40bc098d4f54a781845b1" args="(const struct ast_event *event, enum ast_event_ie_type ie_type)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const void* ast_event_get_ie_raw           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const struct <a class="el" href="structast__event.html">ast_event</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>enum <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b">ast_event_ie_type</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ie_type</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get the value of an information element that has a raw payload. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>event</em>&nbsp;</td><td>The event to get the IE from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ie_type</em>&nbsp;</td><td>the type of information element to retrieve</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>This returns the payload of the information element with the given type. If the information element isn't found, NULL will be returned. </dd></dl>

<p>
Definition at line <a class="el" href="event_8c-source.html#l00376">376</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
References <a class="el" href="event_8c-source.html#l00056">ast_event::event_len</a>, and <a class="el" href="event_8c-source.html#l00044">ast_event_ie::ie_payload</a>.
<p>
Referenced by <a class="el" href="event_8c-source.html#l00707">ast_event_dispatcher()</a>, <a class="el" href="event_8c-source.html#l00508">ast_event_get_cached()</a>, <a class="el" href="event_8c-source.html#l00371">ast_event_get_ie_str()</a>, <a class="el" href="event_8c-source.html#l00362">ast_event_get_ie_uint()</a>, and <a class="el" href="event_8c-source.html#l00601">ast_event_queue_and_cache()</a>.<div class="fragment"><pre class="fragment"><a name="l00377"></a>00377 {
<a name="l00378"></a>00378    <span class="keyword">struct </span><a class="code" href="structast__event__ie.html">ast_event_ie</a> *ie;
<a name="l00379"></a>00379    uint16_t event_len;
<a name="l00380"></a>00380 
<a name="l00381"></a>00381    ie_type = ntohs(ie_type);
<a name="l00382"></a>00382    event_len = ntohs(event-&gt;<a class="code" href="structast__event.html#5a6793a0da30dd0c8b301a673d69432d">event_len</a>);
<a name="l00383"></a>00383 
<a name="l00384"></a>00384    ie = ((<span class="keywordtype">void</span> *) event) + <span class="keyword">sizeof</span>(*event);
<a name="l00385"></a>00385 
<a name="l00386"></a>00386    <span class="keywordflow">while</span> ((((<span class="keywordtype">void</span> *) ie) - ((<span class="keywordtype">void</span> *) event)) &lt; event_len) {
<a name="l00387"></a>00387       <span class="keywordflow">if</span> (ie-&gt;ie_type == ie_type)
<a name="l00388"></a>00388          <span class="keywordflow">return</span> ie-&gt;<a class="code" href="structast__event__ie.html#3c2a9d800aede4080e6a2344f92cafd4">ie_payload</a>;
<a name="l00389"></a>00389       ie = ((<span class="keywordtype">void</span> *) ie) + <span class="keyword">sizeof</span>(*ie) + ntohs(ie-&gt;ie_payload_len);
<a name="l00390"></a>00390    }
<a name="l00391"></a>00391 
<a name="l00392"></a>00392    <span class="keywordflow">return</span> NULL;
<a name="l00393"></a>00393 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="12352be9265cdaceb97d8b4e628d7aaf"></a><!-- doxytag: member="event.c::ast_event_get_ie_str" ref="12352be9265cdaceb97d8b4e628d7aaf" args="(const struct ast_event *event, enum ast_event_ie_type ie_type)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char* ast_event_get_ie_str           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const struct <a class="el" href="structast__event.html">ast_event</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>enum <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b">ast_event_ie_type</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ie_type</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get the value of an information element that has a string payload. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>event</em>&nbsp;</td><td>The event to get the IE from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ie_type</em>&nbsp;</td><td>the type of information element to retrieve</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>This returns the payload of the information element with the given type. If the information element isn't found, NULL will be returned. </dd></dl>

<p>
Definition at line <a class="el" href="event_8c-source.html#l00371">371</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
References <a class="el" href="event_8c-source.html#l00376">ast_event_get_ie_raw()</a>.
<p>
Referenced by <a class="el" href="event_8c-source.html#l00707">ast_event_dispatcher()</a>, <a class="el" href="event_8c-source.html#l00508">ast_event_get_cached()</a>, <a class="el" href="event_8c-source.html#l00601">ast_event_queue_and_cache()</a>, <a class="el" href="app__voicemail_8c-source.html#l07431">mwi_sub_event_cb()</a>, and <a class="el" href="res__eventtest_8c-source.html#l00049">process_event_mwi()</a>.<div class="fragment"><pre class="fragment"><a name="l00372"></a>00372 {
<a name="l00373"></a>00373    <span class="keywordflow">return</span> <a class="code" href="event_8c.html#e468dffe85e40bc098d4f54a781845b1">ast_event_get_ie_raw</a>(event, ie_type);
<a name="l00374"></a>00374 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="4d7c0eaf32d6754b1e2e556f8a9b7bbb"></a><!-- doxytag: member="event.c::ast_event_get_ie_uint" ref="4d7c0eaf32d6754b1e2e556f8a9b7bbb" args="(const struct ast_event *event, enum ast_event_ie_type ie_type)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">uint32_t ast_event_get_ie_uint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const struct <a class="el" href="structast__event.html">ast_event</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>enum <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b">ast_event_ie_type</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ie_type</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get the value of an information element that has an integer payload. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>event</em>&nbsp;</td><td>The event to get the IE from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ie_type</em>&nbsp;</td><td>the type of information element to retrieve</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>This returns the payload of the information element with the given type. However, an IE with a payload of 0, and the case where no IE is found yield the same return value. </dd></dl>

<p>
Definition at line <a class="el" href="event_8c-source.html#l00362">362</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
References <a class="el" href="event_8c-source.html#l00376">ast_event_get_ie_raw()</a>.
<p>
Referenced by <a class="el" href="event_8c-source.html#l00707">ast_event_dispatcher()</a>, <a class="el" href="event_8c-source.html#l00508">ast_event_get_cached()</a>, <a class="el" href="event_8c-source.html#l00601">ast_event_queue_and_cache()</a>, <a class="el" href="res__eventtest_8c-source.html#l00121">event_get_cached()</a>, <a class="el" href="chan__mgcp_8c-source.html#l00466">has_voicemail()</a>, <a class="el" href="app__voicemail_8c-source.html#l07431">mwi_sub_event_cb()</a>, <a class="el" href="app__voicemail_8c-source.html#l07404">mwi_unsub_event_cb()</a>, <a class="el" href="res__eventtest_8c-source.html#l00049">process_event_mwi()</a>, <a class="el" href="chan__sip_8c-source.html#l15903">sip_send_mwi_to_peer()</a>, and <a class="el" href="chan__iax2_8c-source.html#l05757">update_registry()</a>.<div class="fragment"><pre class="fragment"><a name="l00363"></a>00363 {
<a name="l00364"></a>00364    <span class="keyword">const</span> uint32_t *ie_val;
<a name="l00365"></a>00365 
<a name="l00366"></a>00366    ie_val = <a class="code" href="event_8c.html#e468dffe85e40bc098d4f54a781845b1">ast_event_get_ie_raw</a>(event, ie_type);
<a name="l00367"></a>00367 
<a name="l00368"></a>00368    <span class="keywordflow">return</span> ie_val ? ntohl(*ie_val) : 0;
<a name="l00369"></a>00369 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="733e4e73cfb4593d04a71fdef29494e6"></a><!-- doxytag: member="event.c::ast_event_get_type" ref="733e4e73cfb4593d04a71fdef29494e6" args="(const struct ast_event *event)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">enum <a class="el" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5">ast_event_type</a> ast_event_get_type           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const struct <a class="el" href="structast__event.html">ast_event</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>event</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get the type for an event. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>event</em>&nbsp;</td><td>the event to get the type for</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>the event type as represented by one of the values in the ast_event_type enum </dd></dl>

<p>
Definition at line <a class="el" href="event_8c-source.html#l00357">357</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
Referenced by <a class="el" href="res__eventtest_8c-source.html#l00063">ast_event_process()</a>, <a class="el" href="app__voicemail_8c-source.html#l07431">mwi_sub_event_cb()</a>, <a class="el" href="app__voicemail_8c-source.html#l07404">mwi_unsub_event_cb()</a>, and <a class="el" href="res__eventtest_8c-source.html#l00044">process_event_generic()</a>.<div class="fragment"><pre class="fragment"><a name="l00358"></a>00358 {
<a name="l00359"></a>00359    <span class="keywordflow">return</span> ntohs(event-&gt;type);
<a name="l00360"></a>00360 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="8422fd37702f84a5ced85ca3a641915b"></a><!-- doxytag: member="event.c::ast_event_init" ref="8422fd37702f84a5ced85ca3a641915b" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_event_init           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Provided by <a class="el" href="event_8c.html">event.c</a> 
<p>
Definition at line <a class="el" href="event_8c-source.html#l00758">758</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
References <a class="el" href="lock_8h-source.html#l00542">ast_cond_init()</a>, <a class="el" href="event_8c-source.html#l00707">ast_event_dispatcher()</a>, <a class="el" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f56c0d85a4badc26620b04ecd2a4dfbd6b">AST_EVENT_TOTAL</a>, <a class="el" href="utils_8h-source.html#l00307">ast_pthread_create_background</a>, <a class="el" href="linkedlists_8h-source.html#l00578">AST_RWLIST_HEAD_INIT</a>, <a class="el" href="event_8c.html#13beb04f99cfd9fd4b1d9d303e774eff">event_thread</a>, and <a class="el" href="event_8c-source.html#l00038">NUM_EVENT_THREADS</a>.
<p>
Referenced by <a class="el" href="asterisk_8c-source.html#l02570">main()</a>.<div class="fragment"><pre class="fragment"><a name="l00759"></a>00759 {
<a name="l00760"></a>00760    <span class="keywordtype">int</span> i;
<a name="l00761"></a>00761 
<a name="l00762"></a>00762    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f56c0d85a4badc26620b04ecd2a4dfbd6b">AST_EVENT_TOTAL</a>; i++)
<a name="l00763"></a>00763       <a class="code" href="linkedlists_8h.html#e0c2d1850da548278dc3850748a8296f">AST_RWLIST_HEAD_INIT</a>(&amp;ast_event_subs[i]);
<a name="l00764"></a>00764 
<a name="l00765"></a>00765    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f56c0d85a4badc26620b04ecd2a4dfbd6b">AST_EVENT_TOTAL</a>; i++)
<a name="l00766"></a>00766       <a class="code" href="linkedlists_8h.html#e0c2d1850da548278dc3850748a8296f">AST_RWLIST_HEAD_INIT</a>(&amp;ast_event_cache[i]);
<a name="l00767"></a>00767 
<a name="l00768"></a>00768    <a class="code" href="lock_8h.html#26b556000e9ba452b40f732a86644de6">ast_cond_init</a>(&amp;<a class="code" href="event_8c.html#13beb04f99cfd9fd4b1d9d303e774eff">event_thread</a>.cond, NULL);
<a name="l00769"></a>00769 
<a name="l00770"></a>00770    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="event_8c.html#01b5e015ac0acb2f53df5744d6d5efbb">NUM_EVENT_THREADS</a>; i++) {
<a name="l00771"></a>00771       pthread_t dont_care;
<a name="l00772"></a>00772       <a class="code" href="utils_8h.html#351b78c7aeb62b2b57eb447287cdd9d4">ast_pthread_create_background</a>(&amp;dont_care, NULL, <a class="code" href="event_8c.html#76c4666a7e4da29982e909c9d8843feb">ast_event_dispatcher</a>, NULL);
<a name="l00773"></a>00773    }
<a name="l00774"></a>00774 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="24d00d946b24949294e1f91a535bd8b8"></a><!-- doxytag: member="event.c::ast_event_new" ref="24d00d946b24949294e1f91a535bd8b8" args="(enum ast_event_type type,...)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__event.html">ast_event</a>* ast_event_new           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">enum <a class="el" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5">ast_event_type</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>&nbsp;</td>
          <td class="mdname" nowrap> <em>...</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="event_8c-source.html#l00431">431</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
References <a class="el" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>, <a class="el" href="event_8c-source.html#l00395">ast_event_append_ie_str()</a>, <a class="el" href="event_8c-source.html#l00401">ast_event_append_ie_uint()</a>, <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>, <a class="el" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a>, <a class="el" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>, <a class="el" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f56c0d85a4badc26620b04ecd2a4dfbd6b">AST_EVENT_TOTAL</a>, <a class="el" href="linkedlists_8h-source.html#l00310">AST_LIST_HEAD_NOLOCK_STATIC</a>, <a class="el" href="linkedlists_8h-source.html#l00670">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h-source.html#l00453">AST_LIST_TRAVERSE</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="utils_8h.html#b38bbfc0f090d7e013ad805ff172a7d2">ast_strdupa</a>, <a class="el" href="event_8c-source.html#l00064">ast_event_ref::event</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, and <a class="el" href="event_8c-source.html#l00084">ast_event_ie_val::payload</a>.
<p>
Referenced by <a class="el" href="event_8c-source.html#l00187">ast_event_report_subs()</a>, <a class="el" href="event_8c-source.html#l00243">ast_event_subscribe()</a>, <a class="el" href="event_8c-source.html#l00333">ast_event_unsubscribe()</a>, <a class="el" href="res__eventtest_8c-source.html#l00074">event_gen()</a>, and <a class="el" href="app__voicemail_8c-source.html#l04051">queue_mwi_event()</a>.<div class="fragment"><pre class="fragment"><a name="l00432"></a>00432 {
<a name="l00433"></a>00433    va_list ap;
<a name="l00434"></a>00434    <span class="keyword">struct </span><a class="code" href="structast__event.html">ast_event</a> *<a class="code" href="manager_8h.html#4119639092e62c55ea8be348e4d9260d">event</a>;
<a name="l00435"></a>00435    <span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5">ast_event_type</a> ie_type;
<a name="l00436"></a>00436    <span class="keyword">struct </span><a class="code" href="structast__event__ie__val.html">ast_event_ie_val</a> *ie_val;
<a name="l00437"></a>00437    <a class="code" href="linkedlists_8h.html#c2fac4140618038d0d4f6a81e315cda6">AST_LIST_HEAD_NOLOCK_STATIC</a>(ie_vals, <a class="code" href="structast__event__ie__val.html">ast_event_ie_val</a>);
<a name="l00438"></a>00438 
<a name="l00439"></a>00439    <span class="comment">/* Invalid type */</span>
<a name="l00440"></a>00440    <span class="keywordflow">if</span> (<a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a> &gt;= <a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f56c0d85a4badc26620b04ecd2a4dfbd6b">AST_EVENT_TOTAL</a>) {
<a name="l00441"></a>00441       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Someone tried to create an event of invalid "</span>
<a name="l00442"></a>00442          <span class="stringliteral">"type '%d'!\n"</span>, <a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>);
<a name="l00443"></a>00443       <span class="keywordflow">return</span> NULL;
<a name="l00444"></a>00444    }
<a name="l00445"></a>00445 
<a name="l00446"></a>00446    va_start(ap, <a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>);
<a name="l00447"></a>00447    <span class="keywordflow">for</span> (ie_type = va_arg(ap, <span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5">ast_event_type</a>);
<a name="l00448"></a>00448       ie_type != <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>;
<a name="l00449"></a>00449       ie_type = va_arg(ap, <span class="keyword">enum</span> ast_event_type))
<a name="l00450"></a>00450    {
<a name="l00451"></a>00451       <span class="keyword">struct </span><a class="code" href="structast__event__ie__val.html">ast_event_ie_val</a> *ie_val = alloca(<span class="keyword">sizeof</span>(*ie_val));
<a name="l00452"></a>00452       memset(ie_val, 0, <span class="keyword">sizeof</span>(*ie_val));
<a name="l00453"></a>00453       ie_val-&gt;ie_type = ie_type;
<a name="l00454"></a>00454       ie_val-&gt;ie_pltype = va_arg(ap, <span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e">ast_event_ie_pltype</a>);
<a name="l00455"></a>00455       <span class="keywordflow">if</span> (ie_val-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>)
<a name="l00456"></a>00456          ie_val-&gt;<a class="code" href="structast__event__ie__val.html#321c3cf486ed509164edec1e1981fec8">payload</a>.uint = va_arg(ap, uint32_t);
<a name="l00457"></a>00457       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ie_val-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a>)
<a name="l00458"></a>00458          ie_val-&gt;<a class="code" href="structast__event__ie__val.html#321c3cf486ed509164edec1e1981fec8">payload</a>.str = <a class="code" href="utils_8h.html#b38bbfc0f090d7e013ad805ff172a7d2">ast_strdupa</a>(va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *));
<a name="l00459"></a>00459       <a class="code" href="linkedlists_8h.html#8de6ce8a3b9d59e7e7fddee6b62b32a7">AST_LIST_INSERT_TAIL</a>(&amp;ie_vals, ie_val, entry);
<a name="l00460"></a>00460    }
<a name="l00461"></a>00461    va_end(ap);
<a name="l00462"></a>00462 
<a name="l00463"></a>00463    <span class="keywordflow">if</span> (!(event = <a class="code" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*event))))
<a name="l00464"></a>00464       <span class="keywordflow">return</span> NULL;
<a name="l00465"></a>00465 
<a name="l00466"></a>00466    event-&gt;type = htons(<a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>);
<a name="l00467"></a>00467    event-&gt;event_len = htons(<span class="keyword">sizeof</span>(*event));
<a name="l00468"></a>00468 
<a name="l00469"></a>00469    <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;ie_vals, ie_val, entry) {
<a name="l00470"></a>00470       <span class="keywordflow">if</span> (ie_val-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a>)
<a name="l00471"></a>00471          <a class="code" href="event_8c.html#ce8164c48165ba6cb58965b5b60ac9c8">ast_event_append_ie_str</a>(&amp;event, ie_val-&gt;ie_type, ie_val-&gt;<a class="code" href="structast__event__ie__val.html#321c3cf486ed509164edec1e1981fec8">payload</a>.str);
<a name="l00472"></a>00472       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ie_val-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>)
<a name="l00473"></a>00473          <a class="code" href="event_8c.html#50a3fbc77a7e217fe88c814a022948cc">ast_event_append_ie_uint</a>(&amp;event, ie_val-&gt;ie_type, ie_val-&gt;<a class="code" href="structast__event__ie__val.html#321c3cf486ed509164edec1e1981fec8">payload</a>.uint);
<a name="l00474"></a>00474 
<a name="l00475"></a>00475       <span class="keywordflow">if</span> (!event)
<a name="l00476"></a>00476          <span class="keywordflow">break</span>;
<a name="l00477"></a>00477    }
<a name="l00478"></a>00478 
<a name="l00479"></a>00479    <span class="keywordflow">return</span> event;
<a name="l00480"></a>00480 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="dcae48afacd545a6d29f8e89ef042cf5"></a><!-- doxytag: member="event.c::ast_event_queue" ref="dcae48afacd545a6d29f8e89ef042cf5" args="(struct ast_event *event)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_event_queue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__event.html">ast_event</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>event</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="event_8c-source.html#l00673">673</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
References <a class="el" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>, <a class="el" href="lock_8h-source.html#l00547">ast_cond_signal()</a>, <a class="el" href="event_8c-source.html#l00117">ast_event_check_subscriber()</a>, <a class="el" href="event_8c-source.html#l00482">ast_event_destroy()</a>, <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>, <a class="el" href="event__defs_8h.html#424fad4518162205ad01c55fcbd21777c65f9b17adec5191e644719fb53f9965">AST_EVENT_SUB_NONE</a>, <a class="el" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f56c0d85a4badc26620b04ecd2a4dfbd6b">AST_EVENT_TOTAL</a>, <a class="el" href="linkedlists_8h-source.html#l00670">AST_LIST_INSERT_TAIL</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="event_8c.html#13beb04f99cfd9fd4b1d9d303e774eff">event_thread</a>, and <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>.
<p>
Referenced by <a class="el" href="event_8c-source.html#l00601">ast_event_queue_and_cache()</a>, <a class="el" href="event_8c-source.html#l00243">ast_event_subscribe()</a>, and <a class="el" href="event_8c-source.html#l00333">ast_event_unsubscribe()</a>.<div class="fragment"><pre class="fragment"><a name="l00674"></a>00674 {
<a name="l00675"></a>00675    <span class="keyword">struct </span><a class="code" href="structast__event__ref.html">ast_event_ref</a> *event_ref;
<a name="l00676"></a>00676    uint16_t host_event_type;
<a name="l00677"></a>00677 
<a name="l00678"></a>00678    host_event_type = ntohs(event-&gt;type);
<a name="l00679"></a>00679 
<a name="l00680"></a>00680    <span class="comment">/* Invalid type */</span>
<a name="l00681"></a>00681    <span class="keywordflow">if</span> (host_event_type &gt;= <a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f56c0d85a4badc26620b04ecd2a4dfbd6b">AST_EVENT_TOTAL</a>) {
<a name="l00682"></a>00682       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Someone tried to queue an event of invalid "</span>
<a name="l00683"></a>00683          <span class="stringliteral">"type '%d'!\n"</span>, host_event_type);
<a name="l00684"></a>00684       <span class="keywordflow">return</span> -1;
<a name="l00685"></a>00685    }
<a name="l00686"></a>00686 
<a name="l00687"></a>00687    <span class="comment">/* If nobody has subscribed to this event type, throw it away now */</span>
<a name="l00688"></a>00688    <span class="keywordflow">if</span> (<a class="code" href="event_8c.html#45a2646c9399f2c44643eb59567ce37e">ast_event_check_subscriber</a>(host_event_type, <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>) 
<a name="l00689"></a>00689       == <a class="code" href="event__defs_8h.html#424fad4518162205ad01c55fcbd21777c65f9b17adec5191e644719fb53f9965">AST_EVENT_SUB_NONE</a>) {
<a name="l00690"></a>00690       <a class="code" href="event_8c.html#4b37332f515288396b68b385758f1e17">ast_event_destroy</a>(event);
<a name="l00691"></a>00691       <span class="keywordflow">return</span> 0;
<a name="l00692"></a>00692    }
<a name="l00693"></a>00693 
<a name="l00694"></a>00694    <span class="keywordflow">if</span> (!(event_ref = <a class="code" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*event_ref))))
<a name="l00695"></a>00695       <span class="keywordflow">return</span> -1;
<a name="l00696"></a>00696 
<a name="l00697"></a>00697    event_ref-&gt;event = event;
<a name="l00698"></a>00698 
<a name="l00699"></a>00699    <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;<a class="code" href="event_8c.html#13beb04f99cfd9fd4b1d9d303e774eff">event_thread</a>.lock);
<a name="l00700"></a>00700    <a class="code" href="linkedlists_8h.html#8de6ce8a3b9d59e7e7fddee6b62b32a7">AST_LIST_INSERT_TAIL</a>(&amp;<a class="code" href="event_8c.html#13beb04f99cfd9fd4b1d9d303e774eff">event_thread</a>.event_q, event_ref, entry);
<a name="l00701"></a>00701    <a class="code" href="lock_8h.html#119b205a84b106ec84a3a496dbe88082">ast_cond_signal</a>(&amp;<a class="code" href="event_8c.html#13beb04f99cfd9fd4b1d9d303e774eff">event_thread</a>.cond);
<a name="l00702"></a>00702    <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;<a class="code" href="event_8c.html#13beb04f99cfd9fd4b1d9d303e774eff">event_thread</a>.lock);
<a name="l00703"></a>00703 
<a name="l00704"></a>00704    <span class="keywordflow">return</span> 0;
<a name="l00705"></a>00705 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="2a5828dac3c92eb431574796e82dee89"></a><!-- doxytag: member="event.c::ast_event_queue_and_cache" ref="2a5828dac3c92eb431574796e82dee89" args="(struct ast_event *event,...)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_event_queue_and_cache           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__event.html">ast_event</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>&nbsp;</td>
          <td class="mdname" nowrap> <em>...</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Create a new event. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>event_type</em>&nbsp;</td><td>The type of event to create</td></tr>
  </table>
</dl>
The rest of the arguments to this function specify information elements to add to the event. They are specified in the form: <div class="fragment"><pre class="fragment">    &lt;<span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b">ast_event_ie_type</a>&gt;, [<span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e">ast_event_ie_pltype</a>, [payload] ]
</pre></div> and must end with AST_EVENT_IE_END.<p>
If the ie_type specified is *not* AST_EVENT_IE_END, then it must be followed by a valid IE payload type. The payload type, EXISTS, should not be used here because it makes no sense to do so. So, a payload must also be specified after the IE payload type.<p>
<dl compact><dt><b>Returns:</b></dt><dd>This returns the event that has been created. If there is an error creating the event, NULL will be returned.</dd></dl>
Example usage:<p>
<div class="fragment"><pre class="fragment"> <span class="keywordflow">if</span> (!(event = <a class="code" href="event_8c.html#24d00d946b24949294e1f91a535bd8b8">ast_event_new</a>(<a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f500f99a8ee32335ae54d70cea64e9170e">AST_EVENT_MWI</a>,
     <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b8a9b8ba99731edf9cf7aa617c306b186">AST_EVENT_IE_MAILBOX</a>, <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a>, <a class="code" href="chan__mgcp_8c.html#be2fc5fd64209e633c78549d39c04fb2">mailbox</a>,
     <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b03c8bdecd609b0ab1a00c6cf4f019e33">AST_EVENT_IE_NEWMSGS</a>, <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>, <span class="keyword">new</span>,
     <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b692dd3212594167187db7bc1910a33f9">AST_EVENT_IE_OLDMSGS</a>, <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>, old,
     <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>))) {
       <span class="keywordflow">return</span>;
 }
 \code

 This creates a MWI event with 3 information elements, a <a class="code" href="chan__mgcp_8c.html#be2fc5fd64209e633c78549d39c04fb2">mailbox</a> which is
 a string, and the <a class="code" href="structnumber.html">number</a> of <span class="keyword">new</span> and old messages, specified as integers.
 */
<span class="keyword">struct </span><a class="code" href="structast__event.html">ast_event</a> *<a class="code" href="event_8c.html#24d00d946b24949294e1f91a535bd8b8">ast_event_new</a>(<span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5">ast_event_type</a> event_type, ...);
<span class="comment"></span>
<span class="comment">/*!</span>
<span class="comment"> \brief Destroy an event</span>
<span class="comment"></span>
<span class="comment"> \param event the event to destroy</span>
<span class="comment"></span>
<span class="comment"> \return Nothing</span>
<span class="comment"></span>
<span class="comment"> \note Events that have been queued should *not* be destroyed by the code that</span>
<span class="comment">       created the event.  It will be automatically destroyed after being</span>
<span class="comment">       dispatched to the appropriate subscribers.</span>
<span class="comment"> */</span>
<span class="keywordtype">void</span> <a class="code" href="event_8c.html#4b37332f515288396b68b385758f1e17">ast_event_destroy</a>(<span class="keyword">struct</span> <a class="code" href="structast__event.html">ast_event</a> *event);
<span class="comment"></span>
<span class="comment">/*!</span>
<span class="comment"> \brief Queue an event</span>
<span class="comment"></span>
<span class="comment"> \param event the event to be queued</span>
<span class="comment"></span>
<span class="comment"> \retval zero success</span>
<span class="comment"> \retval non-zero failure</span>
<span class="comment"></span>
<span class="comment"> This function queues an event to be dispatched to all of the appropriate</span>
<span class="comment"> subscribers.  This function will not block while the event is being</span>
<span class="comment"> dispatched because a pool of event dispatching threads handle the event </span>
<span class="comment"> queue.</span>
<span class="comment"> */</span>
<span class="keywordtype">int</span> <a class="code" href="event_8c.html#dcae48afacd545a6d29f8e89ef042cf5">ast_event_queue</a>(<span class="keyword">struct</span> <a class="code" href="structast__event.html">ast_event</a> *event);
<span class="comment"></span>
<span class="comment">/*!</span>
<span class="comment"> \brief Queue and cache an event</span>
<span class="comment"></span>
<span class="comment"> \param event the event to be queued and cached</span>
<span class="comment"></span>
<span class="comment"> The rest of the arguments to this function specify information elements to</span>
<span class="comment"> use for determining which events in the cache that this event should replace.</span>
<span class="comment"> All events in the cache that match the specified criteria will be removed from</span>
<span class="comment"> the cache and then this one will be added.  The arguments are specified in </span>
<span class="comment"> the form:</span>
<span class="comment"></span>
<span class="comment"> \code</span>
<span class="comment">    &lt;enum ast_event_ie_type&gt;, [enum ast_event_ie_pltype]</span>
</pre></div> and must end with AST_EVENT_IE_END.<p>
If the ie_type specified is *not* AST_EVENT_IE_END, then it must be followed by a valid IE payload type. If the payload type given is EXISTS, then all events that contain that information element will be removed from the cache. Otherwise, all events in the cache that contain an information element with the same value as the new event will be removed.<p>
<dl compact><dt><b>Note:</b></dt><dd>If more than one IE parameter is specified, they *all* must match for the event to be removed from the cache.</dd></dl>
Example usage:<p>
<div class="fragment"><pre class="fragment"> <a class="code" href="event_8c.html#2a5828dac3c92eb431574796e82dee89">ast_event_queue_and_cache</a>(event,
     <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b8a9b8ba99731edf9cf7aa617c306b186">AST_EVENT_IE_MAILBOX</a>, <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a>,
     <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>);
</pre></div><p>
This example queues and caches an event. Any events in the cache that have the same MAILBOX information element as this event will be removed.<p>
The purpose of caching events is so that the core can retain the last known information for events that represent some sort of state. That way, when code needs to find out the current state, it can query the cache. 
<p>
Definition at line <a class="el" href="event_8c-source.html#l00601">601</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
References <a class="el" href="event_8c-source.html#l00584">ast_event_dup_and_cache()</a>, <a class="el" href="event_8c-source.html#l00376">ast_event_get_ie_raw()</a>, <a class="el" href="event_8c-source.html#l00371">ast_event_get_ie_str()</a>, <a class="el" href="event_8c-source.html#l00362">ast_event_get_ie_uint()</a>, <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>, <a class="el" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0ed653825efb5c5a5abeea257a3d3081ee">AST_EVENT_IE_PLTYPE_EXISTS</a>, <a class="el" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a>, <a class="el" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>, <a class="el" href="event_8c-source.html#l00673">ast_event_queue()</a>, <a class="el" href="event_8c-source.html#l00487">ast_event_ref_destroy()</a>, <a class="el" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f56c0d85a4badc26620b04ecd2a4dfbd6b">AST_EVENT_TOTAL</a>, <a class="el" href="linkedlists_8h-source.html#l00413">AST_LIST_EMPTY</a>, <a class="el" href="linkedlists_8h-source.html#l00374">AST_LIST_ENTRY</a>, <a class="el" href="linkedlists_8h-source.html#l00310">AST_LIST_HEAD_NOLOCK_STATIC</a>, <a class="el" href="linkedlists_8h-source.html#l00670">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h-source.html#l00516">AST_LIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h-source.html#l00453">AST_LIST_TRAVERSE</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="linkedlists_8h-source.html#l00503">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h-source.html#l00556">AST_RWLIST_TRAVERSE_SAFE_END</a>, <a class="el" href="linkedlists_8h-source.html#l00115">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00049">AST_RWLIST_WRLOCK</a>, <a class="el" href="event_8c-source.html#l00064">ast_event_ref::event</a>, <a class="el" href="logger_8h-source.html#l00118">LOG_ERROR</a>, and <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>.
<p>
Referenced by <a class="el" href="res__eventtest_8c-source.html#l00074">event_gen()</a>, and <a class="el" href="app__voicemail_8c-source.html#l04051">queue_mwi_event()</a>.<div class="fragment"><pre class="fragment"><a name="l00602"></a>00602 {
<a name="l00603"></a>00603    va_list ap;
<a name="l00604"></a>00604    <span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5">ast_event_type</a> ie_type;
<a name="l00605"></a>00605    uint16_t host_event_type;
<a name="l00606"></a>00606    <span class="keyword">struct </span><a class="code" href="structast__event__ref.html">ast_event_ref</a> *event_ref;
<a name="l00607"></a>00607    <span class="keywordtype">int</span> res;
<a name="l00608"></a>00608    <span class="keyword">struct </span>cache_arg {
<a name="l00609"></a>00609       <a class="code" href="linkedlists_8h.html#281773a259b5b580d77d636e50fff073">AST_LIST_ENTRY</a>(cache_arg) entry;
<a name="l00610"></a>00610       enum <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b">ast_event_ie_type</a> ie_type;
<a name="l00611"></a>00611       enum <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e">ast_event_ie_pltype</a> ie_pltype;
<a name="l00612"></a>00612    } *cache_arg;
<a name="l00613"></a>00613    <a class="code" href="linkedlists_8h.html#c2fac4140618038d0d4f6a81e315cda6">AST_LIST_HEAD_NOLOCK_STATIC</a>(cache_args, cache_arg);
<a name="l00614"></a>00614 
<a name="l00615"></a>00615    host_event_type = ntohs(event-&gt;<a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>);
<a name="l00616"></a>00616 
<a name="l00617"></a>00617    <span class="comment">/* Invalid type */</span>
<a name="l00618"></a>00618    if (host_event_type &gt;= <a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f56c0d85a4badc26620b04ecd2a4dfbd6b">AST_EVENT_TOTAL</a>) {
<a name="l00619"></a>00619       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Someone tried to queue an event of invalid "</span>
<a name="l00620"></a>00620          <span class="stringliteral">"type '%d'!\n"</span>, host_event_type);
<a name="l00621"></a>00621       <span class="keywordflow">return</span> -1;
<a name="l00622"></a>00622    }
<a name="l00623"></a>00623 
<a name="l00624"></a>00624    va_start(ap, event);
<a name="l00625"></a>00625    <span class="keywordflow">for</span> (ie_type = va_arg(ap, <span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5">ast_event_type</a>);
<a name="l00626"></a>00626       ie_type != <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>;
<a name="l00627"></a>00627       ie_type = va_arg(ap, <span class="keyword">enum</span> ast_event_type))
<a name="l00628"></a>00628    {
<a name="l00629"></a>00629       cache_arg = alloca(<span class="keyword">sizeof</span>(*cache_arg));
<a name="l00630"></a>00630       memset(cache_arg, 0, <span class="keyword">sizeof</span>(*cache_arg));
<a name="l00631"></a>00631       cache_arg-&gt;ie_type = ie_type;
<a name="l00632"></a>00632       cache_arg-&gt;ie_pltype = va_arg(ap, <span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e">ast_event_ie_pltype</a>);
<a name="l00633"></a>00633       <a class="code" href="linkedlists_8h.html#8de6ce8a3b9d59e7e7fddee6b62b32a7">AST_LIST_INSERT_TAIL</a>(&amp;cache_args, cache_arg, entry);
<a name="l00634"></a>00634    }
<a name="l00635"></a>00635    va_end(ap);
<a name="l00636"></a>00636 
<a name="l00637"></a>00637    <span class="keywordflow">if</span> (<a class="code" href="linkedlists_8h.html#0a9573eff61452c49019359bfc0df565">AST_LIST_EMPTY</a>(&amp;cache_args)) {
<a name="l00638"></a>00638       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#4490aa3d29644e716440fada68f54032">LOG_ERROR</a>, <span class="stringliteral">"Events can not be cached without specifying at "</span>
<a name="l00639"></a>00639          <span class="stringliteral">"least one IE type!\n"</span>);
<a name="l00640"></a>00640       <span class="keywordflow">return</span> <a class="code" href="event_8c.html#dcae48afacd545a6d29f8e89ef042cf5">ast_event_queue</a>(event);
<a name="l00641"></a>00641    }
<a name="l00642"></a>00642  
<a name="l00643"></a>00643    <a class="code" href="linkedlists_8h.html#a8a78c1cb0b68179bb2e44d27216a5af">AST_RWLIST_WRLOCK</a>(&amp;ast_event_cache[host_event_type]);
<a name="l00644"></a>00644    <a class="code" href="linkedlists_8h.html#b564f1f262db6464e1644462c38d61e3">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>(&amp;ast_event_cache[host_event_type], event_ref, entry) {
<a name="l00645"></a>00645       <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;cache_args, cache_arg, entry) {
<a name="l00646"></a>00646          <span class="keywordflow">if</span> ( ! ( (cache_arg-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a> &amp;&amp;
<a name="l00647"></a>00647             (<a class="code" href="event_8c.html#4d7c0eaf32d6754b1e2e556f8a9b7bbb">ast_event_get_ie_uint</a>(event, cache_arg-&gt;ie_type) ==
<a name="l00648"></a>00648              <a class="code" href="event_8c.html#4d7c0eaf32d6754b1e2e556f8a9b7bbb">ast_event_get_ie_uint</a>(event_ref-&gt;<a class="code" href="structast__event__ref.html#4119639092e62c55ea8be348e4d9260d">event</a>, cache_arg-&gt;ie_type))) ||
<a name="l00649"></a>00649 
<a name="l00650"></a>00650             (cache_arg-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a> &amp;&amp;
<a name="l00651"></a>00651             (!strcmp(<a class="code" href="event_8c.html#12352be9265cdaceb97d8b4e628d7aaf">ast_event_get_ie_str</a>(event, cache_arg-&gt;ie_type),
<a name="l00652"></a>00652               <a class="code" href="event_8c.html#12352be9265cdaceb97d8b4e628d7aaf">ast_event_get_ie_str</a>(event_ref-&gt;<a class="code" href="structast__event__ref.html#4119639092e62c55ea8be348e4d9260d">event</a>, cache_arg-&gt;ie_type)))) ||
<a name="l00653"></a>00653 
<a name="l00654"></a>00654             (cache_arg-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0ed653825efb5c5a5abeea257a3d3081ee">AST_EVENT_IE_PLTYPE_EXISTS</a> &amp;&amp;
<a name="l00655"></a>00655              <a class="code" href="event_8c.html#e468dffe85e40bc098d4f54a781845b1">ast_event_get_ie_raw</a>(event_ref-&gt;<a class="code" href="structast__event__ref.html#4119639092e62c55ea8be348e4d9260d">event</a>, cache_arg-&gt;ie_type)) ) )
<a name="l00656"></a>00656          {
<a name="l00657"></a>00657             <span class="keywordflow">break</span>;   
<a name="l00658"></a>00658          }
<a name="l00659"></a>00659       }
<a name="l00660"></a>00660       <span class="keywordflow">if</span> (!cache_arg) {
<a name="l00661"></a>00661          <span class="comment">/* All parameters were matched on this cache entry, so remove it */</span>
<a name="l00662"></a>00662          <a class="code" href="linkedlists_8h.html#37f99379dafa45c921f95bf7235eb91d">AST_LIST_REMOVE_CURRENT</a>(&amp;ast_event_cache[host_event_type], entry);
<a name="l00663"></a>00663          <a class="code" href="event_8c.html#04e74e5322c1b16de9116d071e86423b">ast_event_ref_destroy</a>(event_ref);
<a name="l00664"></a>00664       }
<a name="l00665"></a>00665    }
<a name="l00666"></a>00666    <a class="code" href="linkedlists_8h.html#e5be717f6b8c1586fa30a060b56403fe">AST_RWLIST_TRAVERSE_SAFE_END</a>
<a name="l00667"></a>00667    res = <a class="code" href="event_8c.html#8b0d7c8a7cddfc61bbd82963b4de7913">ast_event_dup_and_cache</a>(event);
<a name="l00668"></a>00668    <a class="code" href="linkedlists_8h.html#470215c8af4ffcdb09701e5d092a9205">AST_RWLIST_UNLOCK</a>(&amp;ast_event_cache[host_event_type]);
<a name="l00669"></a>00669 
<a name="l00670"></a>00670    <span class="keywordflow">return</span> (<a class="code" href="event_8c.html#dcae48afacd545a6d29f8e89ef042cf5">ast_event_queue</a>(event) || res) ? -1 : 0;
<a name="l00671"></a>00671 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="04e74e5322c1b16de9116d071e86423b"></a><!-- doxytag: member="event.c::ast_event_ref_destroy" ref="04e74e5322c1b16de9116d071e86423b" args="(struct ast_event_ref *event_ref)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void ast_event_ref_destroy           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__event__ref.html">ast_event_ref</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>event_ref</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="event_8c-source.html#l00487">487</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
References <a class="el" href="event_8c-source.html#l00482">ast_event_destroy()</a>, <a class="el" href="event_8c-source.html#l00064">ast_event_ref::event</a>, and <a class="el" href="astmm_8h-source.html#l00069">free</a>.
<p>
Referenced by <a class="el" href="event_8c-source.html#l00707">ast_event_dispatcher()</a>, and <a class="el" href="event_8c-source.html#l00601">ast_event_queue_and_cache()</a>.<div class="fragment"><pre class="fragment"><a name="l00488"></a>00488 {
<a name="l00489"></a>00489    <a class="code" href="event_8c.html#4b37332f515288396b68b385758f1e17">ast_event_destroy</a>(event_ref-&gt;<a class="code" href="structast__event__ref.html#4119639092e62c55ea8be348e4d9260d">event</a>);
<a name="l00490"></a>00490    <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(event_ref);
<a name="l00491"></a>00491 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="7ba4be66d52b4fed9efa3a0a598b6466"></a><!-- doxytag: member="event.c::ast_event_report_subs" ref="7ba4be66d52b4fed9efa3a0a598b6466" args="(const struct ast_event_sub *event_sub)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_event_report_subs           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const struct <a class="el" href="structast__event__sub.html">ast_event_sub</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>sub</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Report current subscriptions to a subscription subscriber. 
<p>
<ul>
<li>sub the subscription subscriber</li>
</ul>
<dl compact><dt><b>Returns:</b></dt><dd>nothing</dd></dl>
This reports all of the current subscribers to a subscriber of subscribers to a specific event type. (Try saying that a few times fast).<p>
The idea here is that it is sometimes very useful for a module to know when someone subscribes to events. However, when they first subscribe, this provides that module the ability to request the event core report to them all of the subscriptions to that event type that already exist. 
<p>
Definition at line <a class="el" href="event_8c-source.html#l00187">187</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
References <a class="el" href="event_8c-source.html#l00395">ast_event_append_ie_str()</a>, <a class="el" href="event_8c-source.html#l00401">ast_event_append_ie_uint()</a>, <a class="el" href="event_8c-source.html#l00482">ast_event_destroy()</a>, <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>, <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b403817adf29809505998018f3771f4a3">AST_EVENT_IE_EVENTTYPE</a>, <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b3b5ced01fe878c1bdf668fec84b5da9b">AST_EVENT_IE_EXISTS</a>, <a class="el" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0ed653825efb5c5a5abeea257a3d3081ee">AST_EVENT_IE_PLTYPE_EXISTS</a>, <a class="el" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a>, <a class="el" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>, <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba9fef880e1da81f5689d71f14370e865">AST_EVENT_IE_UNIQUEID</a>, <a class="el" href="event_8c-source.html#l00431">ast_event_new()</a>, <a class="el" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f50f1cbc996f6194bf6921832a675d40b7">AST_EVENT_SUB</a>, <a class="el" href="linkedlists_8h-source.html#l00453">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h-source.html#l00060">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00456">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h-source.html#l00115">AST_RWLIST_UNLOCK</a>, <a class="el" href="event_8c-source.html#l00090">ast_event_sub::cb</a>, <a class="el" href="event_8c-source.html#l00064">ast_event_ref::event</a>, <a class="el" href="event_8c-source.html#l00084">ast_event_ie_val::payload</a>, <a class="el" href="event_8c-source.html#l00089">ast_event_sub::type</a>, <a class="el" href="event_8c-source.html#l00092">ast_event_sub::uniqueid</a>, and <a class="el" href="event_8c-source.html#l00091">ast_event_sub::userdata</a>.
<p>
Referenced by <a class="el" href="app__voicemail_8c-source.html#l07463">start_poll_thread()</a>.<div class="fragment"><pre class="fragment"><a name="l00188"></a>00188 {
<a name="l00189"></a>00189    <span class="keyword">struct </span><a class="code" href="structast__event.html">ast_event</a> *<a class="code" href="manager_8h.html#4119639092e62c55ea8be348e4d9260d">event</a>;
<a name="l00190"></a>00190    <span class="keyword">struct </span><a class="code" href="structast__event__sub.html">ast_event_sub</a> *sub;
<a name="l00191"></a>00191    <span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5">ast_event_type</a> event_type = -1;
<a name="l00192"></a>00192    <span class="keyword">struct </span><a class="code" href="structast__event__ie__val.html">ast_event_ie_val</a> *ie_val;
<a name="l00193"></a>00193 
<a name="l00194"></a>00194    <span class="keywordflow">if</span> (event_sub-&gt;<a class="code" href="structast__event__sub.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a> != <a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f50f1cbc996f6194bf6921832a675d40b7">AST_EVENT_SUB</a>)
<a name="l00195"></a>00195       <span class="keywordflow">return</span>;
<a name="l00196"></a>00196 
<a name="l00197"></a>00197    <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;event_sub-&gt;ie_vals, ie_val, entry) {
<a name="l00198"></a>00198       <span class="keywordflow">if</span> (ie_val-&gt;ie_type == <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b403817adf29809505998018f3771f4a3">AST_EVENT_IE_EVENTTYPE</a>) {
<a name="l00199"></a>00199          event_type = ie_val-&gt;<a class="code" href="structast__event__ie__val.html#321c3cf486ed509164edec1e1981fec8">payload</a>.uint;
<a name="l00200"></a>00200          <span class="keywordflow">break</span>;
<a name="l00201"></a>00201       }
<a name="l00202"></a>00202    }
<a name="l00203"></a>00203 
<a name="l00204"></a>00204    <span class="keywordflow">if</span> (event_type == -1)
<a name="l00205"></a>00205       <span class="keywordflow">return</span>;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207    <a class="code" href="linkedlists_8h.html#23c0c844e5abcb474854867b408e3be8">AST_RWLIST_RDLOCK</a>(&amp;ast_event_subs[event_type]);
<a name="l00208"></a>00208    <a class="code" href="linkedlists_8h.html#36b8c64a6c62cb77baa726f81dcaa7f5">AST_RWLIST_TRAVERSE</a>(&amp;ast_event_subs[event_type], sub, entry) {
<a name="l00209"></a>00209       <span class="keywordflow">if</span> (event_sub == sub)
<a name="l00210"></a>00210          <span class="keywordflow">continue</span>;
<a name="l00211"></a>00211 
<a name="l00212"></a>00212       event = <a class="code" href="event_8c.html#24d00d946b24949294e1f91a535bd8b8">ast_event_new</a>(<a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f50f1cbc996f6194bf6921832a675d40b7">AST_EVENT_SUB</a>,
<a name="l00213"></a>00213          <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba9fef880e1da81f5689d71f14370e865">AST_EVENT_IE_UNIQUEID</a>,  <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>, sub-&gt;<a class="code" href="structast__event__sub.html#ad6f74111cf7845baae01b25dbc589b9">uniqueid</a>,
<a name="l00214"></a>00214          <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b403817adf29809505998018f3771f4a3">AST_EVENT_IE_EVENTTYPE</a>, <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>, sub-&gt;<a class="code" href="structast__event__sub.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>,
<a name="l00215"></a>00215          <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>);
<a name="l00216"></a>00216 
<a name="l00217"></a>00217       <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;sub-&gt;ie_vals, ie_val, entry) {
<a name="l00218"></a>00218          <span class="keywordflow">switch</span> (ie_val-&gt;ie_pltype) {
<a name="l00219"></a>00219          <span class="keywordflow">case</span> <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0ed653825efb5c5a5abeea257a3d3081ee">AST_EVENT_IE_PLTYPE_EXISTS</a>:
<a name="l00220"></a>00220             <a class="code" href="event_8c.html#50a3fbc77a7e217fe88c814a022948cc">ast_event_append_ie_uint</a>(&amp;event, <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b3b5ced01fe878c1bdf668fec84b5da9b">AST_EVENT_IE_EXISTS</a>, ie_val-&gt;ie_type);
<a name="l00221"></a>00221             <span class="keywordflow">break</span>;
<a name="l00222"></a>00222          <span class="keywordflow">case</span> <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>:
<a name="l00223"></a>00223             <a class="code" href="event_8c.html#50a3fbc77a7e217fe88c814a022948cc">ast_event_append_ie_uint</a>(&amp;event, ie_val-&gt;ie_type, ie_val-&gt;<a class="code" href="structast__event__ie__val.html#321c3cf486ed509164edec1e1981fec8">payload</a>.uint);
<a name="l00224"></a>00224             <span class="keywordflow">break</span>;
<a name="l00225"></a>00225          <span class="keywordflow">case</span> <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a>:
<a name="l00226"></a>00226             <a class="code" href="event_8c.html#ce8164c48165ba6cb58965b5b60ac9c8">ast_event_append_ie_str</a>(&amp;event, ie_val-&gt;ie_type, ie_val-&gt;<a class="code" href="structast__event__ie__val.html#321c3cf486ed509164edec1e1981fec8">payload</a>.str);
<a name="l00227"></a>00227             <span class="keywordflow">break</span>;
<a name="l00228"></a>00228          }
<a name="l00229"></a>00229          <span class="keywordflow">if</span> (!event)
<a name="l00230"></a>00230             <span class="keywordflow">break</span>;
<a name="l00231"></a>00231       }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233       <span class="keywordflow">if</span> (!event)
<a name="l00234"></a>00234          <span class="keywordflow">continue</span>;
<a name="l00235"></a>00235 
<a name="l00236"></a>00236       event_sub-&gt;<a class="code" href="structast__event__sub.html#d0d7fdb6977b26929fb68c6083c0b439">cb</a>(event, event_sub-&gt;<a class="code" href="structast__event__sub.html#08fd04da1b9c3e4c1c9ab1fe42494a35">userdata</a>);
<a name="l00237"></a>00237 
<a name="l00238"></a>00238       <a class="code" href="event_8c.html#4b37332f515288396b68b385758f1e17">ast_event_destroy</a>(event);
<a name="l00239"></a>00239    }
<a name="l00240"></a>00240    <a class="code" href="linkedlists_8h.html#470215c8af4ffcdb09701e5d092a9205">AST_RWLIST_UNLOCK</a>(&amp;ast_event_subs[event_type]);
<a name="l00241"></a>00241 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="63ec1fe5d72d4f6094b11f741647ac85"></a><!-- doxytag: member="event.c::ast_event_sub_destroy" ref="63ec1fe5d72d4f6094b11f741647ac85" args="(struct ast_event_sub *sub)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void ast_event_sub_destroy           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__event__sub.html">ast_event_sub</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>sub</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="event_8c-source.html#l00323">323</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
References <a class="el" href="linkedlists_8h-source.html#l00710">AST_LIST_REMOVE_HEAD</a>, and <a class="el" href="astmm_8h-source.html#l00069">free</a>.
<p>
Referenced by <a class="el" href="event_8c-source.html#l00333">ast_event_unsubscribe()</a>.<div class="fragment"><pre class="fragment"><a name="l00324"></a>00324 {
<a name="l00325"></a>00325    <span class="keyword">struct </span><a class="code" href="structast__event__ie__val.html">ast_event_ie_val</a> *ie_val;
<a name="l00326"></a>00326 
<a name="l00327"></a>00327    <span class="keywordflow">while</span> ((ie_val = <a class="code" href="linkedlists_8h.html#beec347da29fe6b0d7fdb3e80b851f90">AST_LIST_REMOVE_HEAD</a>(&amp;sub-&gt;ie_vals, entry)))
<a name="l00328"></a>00328       ast_event_ie_val_destroy(ie_val);
<a name="l00329"></a>00329 
<a name="l00330"></a>00330    <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(sub);
<a name="l00331"></a>00331 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="8f5090576abeadfdfdc7f31900bb1f5b"></a><!-- doxytag: member="event.c::ast_event_subscribe" ref="8f5090576abeadfdfdc7f31900bb1f5b" args="(enum ast_event_type type, ast_event_cb_t cb, void *userdata,...)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__event__sub.html">ast_event_sub</a>* ast_event_subscribe           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">enum <a class="el" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5">ast_event_type</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>event_type</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="event_8h.html#305f03516e6e75e083b6719a720b43e4">ast_event_cb_t</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>userdata</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>&nbsp;</td>
          <td class="mdname" nowrap> <em>...</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Subscribe to events. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>event_type</em>&nbsp;</td><td>The type of events to subscribe to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cb</em>&nbsp;</td><td>The function to be called with events </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>userdata</em>&nbsp;</td><td>data to be passed to the event callback</td></tr>
  </table>
</dl>
The rest of the arguments to this function specify additional parameters for the subscription to filter which events are passed to this subscriber. The arguments must be in sets of: <div class="fragment"><pre class="fragment">    &lt;<span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b">ast_event_ie_type</a>&gt;, [<span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e">ast_event_ie_pltype</a>, [<a class="code" href="structast__event__ie__val.html#321c3cf486ed509164edec1e1981fec8">payload</a>] ]
</pre></div> and must end with AST_EVENT_IE_END.<p>
If the ie_type specified is *not* AST_EVENT_IE_END, then it must be followed by a valid IE payload type. If the payload type specified is AST_EVENT_IE_PLTYPE_EXISTS, then the 3rd argument should not be provided. Otherwise, a payload must also be specified.<p>
<dl compact><dt><b>Returns:</b></dt><dd>This returns a reference to the subscription for use with un-subscribing later. If there is a failure in creating the subscription, NULL will be returned.</dd></dl>
Example usage:<p>
<div class="fragment"><pre class="fragment"> peer-&gt;mwi_event_sub = <a class="code" href="event_8c.html#8f5090576abeadfdfdc7f31900bb1f5b">ast_event_subscribe</a>(<a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f500f99a8ee32335ae54d70cea64e9170e">AST_EVENT_MWI</a>, <a class="code" href="chan__iax2_8c.html#679bcfa7a17dfff5745ca3d78f39396a">mwi_event_cb</a>, peer,
     <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b8a9b8ba99731edf9cf7aa617c306b186">AST_EVENT_IE_MAILBOX</a>, <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a>, peer-&gt;mailbox,
     <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>);
</pre></div><p>
This creates a subscription to AST_EVENT_MWI events that contain an information element, AST_EVENT_IE_MAILBOX, with the same string value contained in peer-&gt;mailbox. Also, the event callback will be passed a pointer to the peer. 
<p>
Definition at line <a class="el" href="event_8c-source.html#l00243">243</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
References <a class="el" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>, <a class="el" href="event_8c-source.html#l00395">ast_event_append_ie_str()</a>, <a class="el" href="event_8c-source.html#l00401">ast_event_append_ie_uint()</a>, <a class="el" href="event_8c-source.html#l00117">ast_event_check_subscriber()</a>, <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>, <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b403817adf29809505998018f3771f4a3">AST_EVENT_IE_EVENTTYPE</a>, <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b3b5ced01fe878c1bdf668fec84b5da9b">AST_EVENT_IE_EXISTS</a>, <a class="el" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0ed653825efb5c5a5abeea257a3d3081ee">AST_EVENT_IE_PLTYPE_EXISTS</a>, <a class="el" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a>, <a class="el" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>, <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba9fef880e1da81f5689d71f14370e865">AST_EVENT_IE_UNIQUEID</a>, <a class="el" href="event_8c-source.html#l00431">ast_event_new()</a>, <a class="el" href="event_8c-source.html#l00673">ast_event_queue()</a>, <a class="el" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f50f1cbc996f6194bf6921832a675d40b7">AST_EVENT_SUB</a>, <a class="el" href="event__defs_8h.html#424fad4518162205ad01c55fcbd21777c65f9b17adec5191e644719fb53f9965">AST_EVENT_SUB_NONE</a>, <a class="el" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f56c0d85a4badc26620b04ecd2a4dfbd6b">AST_EVENT_TOTAL</a>, <a class="el" href="linkedlists_8h-source.html#l00670">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h-source.html#l00453">AST_LIST_TRAVERSE</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="linkedlists_8h-source.html#l00680">AST_RWLIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h-source.html#l00115">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00049">AST_RWLIST_WRLOCK</a>, <a class="el" href="utils_8h.html#d67aacdb581292a9d103cf349d0d2862">ast_strdup</a>, <a class="el" href="event_8c-source.html#l00064">ast_event_ref::event</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="logger_8h-source.html#l00118">LOG_ERROR</a>, <a class="el" href="event_8c-source.html#l00084">ast_event_ie_val::payload</a>, and <a class="el" href="event_8c-source.html#l00097">sub_uniqueid</a>.
<p>
Referenced by <a class="el" href="chan__mgcp_8c-source.html#l03593">build_gateway()</a>, <a class="el" href="chan__sip_8c-source.html#l16894">build_peer()</a>, <a class="el" href="res__eventtest_8c-source.html#l00074">event_gen()</a>, <a class="el" href="chan__sip_8c-source.html#l15240">handle_request_subscribe()</a>, <a class="el" href="chan__zap_8c-source.html#l07493">mkintf()</a>, and <a class="el" href="app__voicemail_8c-source.html#l07463">start_poll_thread()</a>.<div class="fragment"><pre class="fragment"><a name="l00245"></a>00245 {
<a name="l00246"></a>00246    va_list ap;
<a name="l00247"></a>00247    <span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b">ast_event_ie_type</a> ie_type;
<a name="l00248"></a>00248    <span class="keyword">struct </span><a class="code" href="structast__event__sub.html">ast_event_sub</a> *sub;
<a name="l00249"></a>00249    <span class="keyword">struct </span><a class="code" href="structast__event.html">ast_event</a> *<a class="code" href="manager_8h.html#4119639092e62c55ea8be348e4d9260d">event</a>;
<a name="l00250"></a>00250 
<a name="l00251"></a>00251    <span class="keywordflow">if</span> (<a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a> &gt;= <a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f56c0d85a4badc26620b04ecd2a4dfbd6b">AST_EVENT_TOTAL</a>) {
<a name="l00252"></a>00252       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#4490aa3d29644e716440fada68f54032">LOG_ERROR</a>, <span class="stringliteral">"%u is an invalid type!\n"</span>, <a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>);
<a name="l00253"></a>00253       <span class="keywordflow">return</span> NULL;
<a name="l00254"></a>00254    }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256    <span class="keywordflow">if</span> (!(sub = <a class="code" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*sub))))
<a name="l00257"></a>00257       <span class="keywordflow">return</span> NULL;
<a name="l00258"></a>00258 
<a name="l00259"></a>00259    va_start(ap, userdata);
<a name="l00260"></a>00260    <span class="keywordflow">for</span> (ie_type = va_arg(ap, <span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f5">ast_event_type</a>);
<a name="l00261"></a>00261       ie_type != <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>;
<a name="l00262"></a>00262       ie_type = va_arg(ap, <span class="keyword">enum</span> ast_event_type))
<a name="l00263"></a>00263    {
<a name="l00264"></a>00264       <span class="keyword">struct </span><a class="code" href="structast__event__ie__val.html">ast_event_ie_val</a> *ie_val;
<a name="l00265"></a>00265       <span class="keywordflow">if</span> (!(ie_val = <a class="code" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*ie_val))))
<a name="l00266"></a>00266          <span class="keywordflow">continue</span>;
<a name="l00267"></a>00267       ie_val-&gt;ie_type = ie_type;
<a name="l00268"></a>00268       ie_val-&gt;ie_pltype = va_arg(ap, <span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e">ast_event_ie_pltype</a>);
<a name="l00269"></a>00269       <span class="keywordflow">if</span> (ie_val-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>)
<a name="l00270"></a>00270          ie_val-&gt;payload.uint = va_arg(ap, uint32_t);
<a name="l00271"></a>00271       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ie_val-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a>) {
<a name="l00272"></a>00272          <span class="keywordflow">if</span> (!(ie_val-&gt;payload.str = <a class="code" href="utils_8h.html#d67aacdb581292a9d103cf349d0d2862">ast_strdup</a>(va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *)))) {
<a name="l00273"></a>00273             <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(ie_val);
<a name="l00274"></a>00274             <span class="keywordflow">continue</span>;
<a name="l00275"></a>00275          }
<a name="l00276"></a>00276       }
<a name="l00277"></a>00277       <a class="code" href="linkedlists_8h.html#8de6ce8a3b9d59e7e7fddee6b62b32a7">AST_LIST_INSERT_TAIL</a>(&amp;sub-&gt;ie_vals, ie_val, entry);
<a name="l00278"></a>00278    }
<a name="l00279"></a>00279    va_end(ap);
<a name="l00280"></a>00280 
<a name="l00281"></a>00281    sub-&gt;type = <a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>;
<a name="l00282"></a>00282    sub-&gt;cb = cb;
<a name="l00283"></a>00283    sub-&gt;userdata = userdata;
<a name="l00284"></a>00284    sub-&gt;uniqueid = ast_atomic_fetchadd_int((<span class="keywordtype">int</span> *) &amp;<a class="code" href="event_8c.html#7b3644b799dd7d86b42a289c7442a07a">sub_uniqueid</a>, 1);
<a name="l00285"></a>00285 
<a name="l00286"></a>00286    <span class="keywordflow">if</span> (<a class="code" href="event_8c.html#45a2646c9399f2c44643eb59567ce37e">ast_event_check_subscriber</a>(<a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f50f1cbc996f6194bf6921832a675d40b7">AST_EVENT_SUB</a>,
<a name="l00287"></a>00287       <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b403817adf29809505998018f3771f4a3">AST_EVENT_IE_EVENTTYPE</a>, <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>, <a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>,
<a name="l00288"></a>00288       <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>) != <a class="code" href="event__defs_8h.html#424fad4518162205ad01c55fcbd21777c65f9b17adec5191e644719fb53f9965">AST_EVENT_SUB_NONE</a>) {
<a name="l00289"></a>00289       <span class="keyword">struct </span><a class="code" href="structast__event__ie__val.html">ast_event_ie_val</a> *ie_val;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291       event = <a class="code" href="event_8c.html#24d00d946b24949294e1f91a535bd8b8">ast_event_new</a>(<a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f50f1cbc996f6194bf6921832a675d40b7">AST_EVENT_SUB</a>,
<a name="l00292"></a>00292          <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba9fef880e1da81f5689d71f14370e865">AST_EVENT_IE_UNIQUEID</a>,  <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>, sub-&gt;uniqueid,
<a name="l00293"></a>00293          <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b403817adf29809505998018f3771f4a3">AST_EVENT_IE_EVENTTYPE</a>, <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>, sub-&gt;type,
<a name="l00294"></a>00294          <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>);
<a name="l00295"></a>00295 
<a name="l00296"></a>00296       <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;sub-&gt;ie_vals, ie_val, entry) {
<a name="l00297"></a>00297          <span class="keywordflow">switch</span> (ie_val-&gt;ie_pltype) {
<a name="l00298"></a>00298          <span class="keywordflow">case</span> <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0ed653825efb5c5a5abeea257a3d3081ee">AST_EVENT_IE_PLTYPE_EXISTS</a>:
<a name="l00299"></a>00299             <a class="code" href="event_8c.html#50a3fbc77a7e217fe88c814a022948cc">ast_event_append_ie_uint</a>(&amp;event, <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b3b5ced01fe878c1bdf668fec84b5da9b">AST_EVENT_IE_EXISTS</a>, ie_val-&gt;ie_type);
<a name="l00300"></a>00300             <span class="keywordflow">break</span>;
<a name="l00301"></a>00301          <span class="keywordflow">case</span> <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>:
<a name="l00302"></a>00302             <a class="code" href="event_8c.html#50a3fbc77a7e217fe88c814a022948cc">ast_event_append_ie_uint</a>(&amp;event, ie_val-&gt;ie_type, ie_val-&gt;<a class="code" href="structast__event__ie__val.html#321c3cf486ed509164edec1e1981fec8">payload</a>.uint);
<a name="l00303"></a>00303             <span class="keywordflow">break</span>;
<a name="l00304"></a>00304          <span class="keywordflow">case</span> <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a>:
<a name="l00305"></a>00305             <a class="code" href="event_8c.html#ce8164c48165ba6cb58965b5b60ac9c8">ast_event_append_ie_str</a>(&amp;event, ie_val-&gt;ie_type, ie_val-&gt;<a class="code" href="structast__event__ie__val.html#321c3cf486ed509164edec1e1981fec8">payload</a>.str);
<a name="l00306"></a>00306             <span class="keywordflow">break</span>;
<a name="l00307"></a>00307          }
<a name="l00308"></a>00308          <span class="keywordflow">if</span> (!event)
<a name="l00309"></a>00309             <span class="keywordflow">break</span>;
<a name="l00310"></a>00310       }
<a name="l00311"></a>00311 
<a name="l00312"></a>00312       <span class="keywordflow">if</span> (event)
<a name="l00313"></a>00313          <a class="code" href="event_8c.html#dcae48afacd545a6d29f8e89ef042cf5">ast_event_queue</a>(event);
<a name="l00314"></a>00314    }
<a name="l00315"></a>00315 
<a name="l00316"></a>00316    <a class="code" href="linkedlists_8h.html#a8a78c1cb0b68179bb2e44d27216a5af">AST_RWLIST_WRLOCK</a>(&amp;ast_event_subs[<a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>]);
<a name="l00317"></a>00317    <a class="code" href="linkedlists_8h.html#64b41a3e9f2e6a867c09431dfae7ce21">AST_RWLIST_INSERT_TAIL</a>(&amp;ast_event_subs[<a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>], sub, entry);
<a name="l00318"></a>00318    <a class="code" href="linkedlists_8h.html#470215c8af4ffcdb09701e5d092a9205">AST_RWLIST_UNLOCK</a>(&amp;ast_event_subs[<a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>]);
<a name="l00319"></a>00319 
<a name="l00320"></a>00320    <span class="keywordflow">return</span> sub;
<a name="l00321"></a>00321 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a403abf8cb435f491d27e3f0585a7170"></a><!-- doxytag: member="event.c::ast_event_unsubscribe" ref="a403abf8cb435f491d27e3f0585a7170" args="(struct ast_event_sub *sub)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_event_unsubscribe           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__event__sub.html">ast_event_sub</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>event_sub</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Un-subscribe from events. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>event_sub</em>&nbsp;</td><td>This is the reference to the subscription returned by ast_event_subscribe.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Nothing </dd></dl>

<p>
Definition at line <a class="el" href="event_8c-source.html#l00333">333</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
References <a class="el" href="event_8c-source.html#l00117">ast_event_check_subscriber()</a>, <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>, <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b403817adf29809505998018f3771f4a3">AST_EVENT_IE_EVENTTYPE</a>, <a class="el" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>, <a class="el" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba9fef880e1da81f5689d71f14370e865">AST_EVENT_IE_UNIQUEID</a>, <a class="el" href="event_8c-source.html#l00431">ast_event_new()</a>, <a class="el" href="event_8c-source.html#l00673">ast_event_queue()</a>, <a class="el" href="event_8c-source.html#l00323">ast_event_sub_destroy()</a>, <a class="el" href="event__defs_8h.html#424fad4518162205ad01c55fcbd21777c65f9b17adec5191e644719fb53f9965">AST_EVENT_SUB_NONE</a>, <a class="el" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f55f1ac1651affbfddd5f2ff67cabaca0e">AST_EVENT_UNSUB</a>, <a class="el" href="linkedlists_8h-source.html#l00731">AST_LIST_REMOVE</a>, <a class="el" href="linkedlists_8h-source.html#l00115">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00049">AST_RWLIST_WRLOCK</a>, <a class="el" href="event_8c-source.html#l00064">ast_event_ref::event</a>, <a class="el" href="event_8c-source.html#l00089">ast_event_sub::type</a>, and <a class="el" href="event_8c-source.html#l00092">ast_event_sub::uniqueid</a>.
<p>
Referenced by <a class="el" href="chan__mgcp_8c-source.html#l04010">destroy_endpoint()</a>, <a class="el" href="chan__iax2_8c-source.html#l09131">destroy_peer()</a>, <a class="el" href="chan__zap_8c-source.html#l02407">destroy_zt_pvt()</a>, <a class="el" href="res__eventtest_8c-source.html#l00074">event_gen()</a>, <a class="el" href="chan__sip_8c-source.html#l02679">sip_destroy_peer()</a>, and <a class="el" href="app__voicemail_8c-source.html#l07485">stop_poll_thread()</a>.<div class="fragment"><pre class="fragment"><a name="l00334"></a>00334 {
<a name="l00335"></a>00335    <span class="keyword">struct </span><a class="code" href="structast__event.html">ast_event</a> *<a class="code" href="manager_8h.html#4119639092e62c55ea8be348e4d9260d">event</a>;
<a name="l00336"></a>00336 
<a name="l00337"></a>00337    <a class="code" href="linkedlists_8h.html#a8a78c1cb0b68179bb2e44d27216a5af">AST_RWLIST_WRLOCK</a>(&amp;ast_event_subs[sub-&gt;<a class="code" href="structast__event__sub.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>]);
<a name="l00338"></a>00338    <a class="code" href="linkedlists_8h.html#d4a4c53d3b264b4e1c5e3fdd84cd8b5a">AST_LIST_REMOVE</a>(&amp;ast_event_subs[sub-&gt;<a class="code" href="structast__event__sub.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>], sub, entry);
<a name="l00339"></a>00339    <a class="code" href="linkedlists_8h.html#470215c8af4ffcdb09701e5d092a9205">AST_RWLIST_UNLOCK</a>(&amp;ast_event_subs[sub-&gt;<a class="code" href="structast__event__sub.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>]);
<a name="l00340"></a>00340 
<a name="l00341"></a>00341    <span class="keywordflow">if</span> (<a class="code" href="event_8c.html#45a2646c9399f2c44643eb59567ce37e">ast_event_check_subscriber</a>(<a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f55f1ac1651affbfddd5f2ff67cabaca0e">AST_EVENT_UNSUB</a>,
<a name="l00342"></a>00342       <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b403817adf29809505998018f3771f4a3">AST_EVENT_IE_EVENTTYPE</a>, <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>, sub-&gt;<a class="code" href="structast__event__sub.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>,
<a name="l00343"></a>00343       <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>) != <a class="code" href="event__defs_8h.html#424fad4518162205ad01c55fcbd21777c65f9b17adec5191e644719fb53f9965">AST_EVENT_SUB_NONE</a>) {
<a name="l00344"></a>00344       
<a name="l00345"></a>00345       event = <a class="code" href="event_8c.html#24d00d946b24949294e1f91a535bd8b8">ast_event_new</a>(<a class="code" href="event__defs_8h.html#6113ee9ad28cba551a4b7c7f9e13d8f55f1ac1651affbfddd5f2ff67cabaca0e">AST_EVENT_UNSUB</a>,
<a name="l00346"></a>00346          <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba9fef880e1da81f5689d71f14370e865">AST_EVENT_IE_UNIQUEID</a>,  <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>, sub-&gt;<a class="code" href="structast__event__sub.html#ad6f74111cf7845baae01b25dbc589b9">uniqueid</a>,
<a name="l00347"></a>00347          <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5b403817adf29809505998018f3771f4a3">AST_EVENT_IE_EVENTTYPE</a>, <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e81566e85012ce12c7b33f3ed528897c4">AST_EVENT_IE_PLTYPE_UINT</a>, sub-&gt;<a class="code" href="structast__event__sub.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>,
<a name="l00348"></a>00348          <a class="code" href="event__defs_8h.html#4e33d342642490be8f879fcd3de37d5ba93e1d517a21c40c31b632da129697dc">AST_EVENT_IE_END</a>);
<a name="l00349"></a>00349 
<a name="l00350"></a>00350       <span class="keywordflow">if</span> (event)
<a name="l00351"></a>00351          <a class="code" href="event_8c.html#dcae48afacd545a6d29f8e89ef042cf5">ast_event_queue</a>(event);
<a name="l00352"></a>00352    }
<a name="l00353"></a>00353 
<a name="l00354"></a>00354    <a class="code" href="event_8c.html#63ec1fe5d72d4f6094b11f741647ac85">ast_event_sub_destroy</a>(sub);
<a name="l00355"></a>00355 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="eee218ca1332c96b3329869a3748d564"></a><!-- doxytag: member="event.c::AST_RWLIST_HEAD" ref="eee218ca1332c96b3329869a3748d564" args="(ast_event_sub_list, ast_event_sub)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static AST_RWLIST_HEAD           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ast_event_sub_list&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="structast__event__sub.html">ast_event_sub</a>&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Event subscriptions The event subscribers are indexed by which event they are subscribed to. 
<p>

<p>
Definition at line <a class="el" href="event_8c-source.html#l00101">101</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
References <a class="el" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a>, and <a class="el" href="astmm_8h-source.html#l00069">free</a>.<div class="fragment"><pre class="fragment"><a name="l00110"></a>00110 {
<a name="l00111"></a>00111    <span class="keywordflow">if</span> (ie_val-&gt;ie_pltype == <a class="code" href="event__defs_8h.html#abdea4272a95ef2cccab32aa20f04e0e06c5ddb525d5d2a15e32ea64a829a315">AST_EVENT_IE_PLTYPE_STR</a>)
<a name="l00112"></a>00112       <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>((<span class="keywordtype">void</span> *) ie_val-&gt;payload.str);
<a name="l00113"></a>00113 
<a name="l00114"></a>00114    <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(ie_val);
<a name="l00115"></a>00115 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="26542fb18a8b14c9775aa475f23c909f"></a><!-- doxytag: member="event.c::cond" ref="26542fb18a8b14c9775aa475f23c909f" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="lock_8h.html#c514af1097ce92209d8aac256b1c5850">ast_cond_t</a> <a class="el" href="app__queue_8c.html#26542fb18a8b14c9775aa475f23c909f">cond</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="event_8c-source.html#l00070">70</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
Referenced by <a class="el" href="app__stack_8c-source.html#l00277">gosubif_exec()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="13beb04f99cfd9fd4b1d9d303e774eff"></a><!-- doxytag: member="event.c::event_thread" ref="13beb04f99cfd9fd4b1d9d303e774eff" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct { ... }   <a class="el" href="event_8c.html#13beb04f99cfd9fd4b1d9d303e774eff">event_thread</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
data shared between event dispatching threads 
<p>

<p>
Referenced by <a class="el" href="event_8c-source.html#l00707">ast_event_dispatcher()</a>, <a class="el" href="event_8c-source.html#l00758">ast_event_init()</a>, and <a class="el" href="event_8c-source.html#l00673">ast_event_queue()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="dce7c4174ce9323904a934a486c41288"></a><!-- doxytag: member="event.c::lock" ref="dce7c4174ce9323904a934a486c41288" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="lock_8h.html#55c65f4d641fac96608dabb20791a062">ast_mutex_t</a> <a class="el" href="app__queue_8c.html#dce7c4174ce9323904a934a486c41288">lock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="event_8c-source.html#l00071">71</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
Referenced by <a class="el" href="cdr__custom_8c-source.html#l00067">load_config()</a>, <a class="el" href="chan__zap_8c-source.html#l12765">load_module()</a>, <a class="el" href="app__rpt_8c-source.html#l00904">load_rpt_vars()</a>, <a class="el" href="cdr__sqlite3__custom_8c-source.html#l00249">reload()</a>, <a class="el" href="app__rpt_8c-source.html#l06656">rpt_master()</a>, <a class="el" href="cdr__sqlite3__custom_8c-source.html#l00151">sqlite3_log()</a>, <a class="el" href="app__rpt_8c-source.html#l07381">unload_module()</a>, <a class="el" href="chan__zap_8c-source.html#l10886">zap_show_channel()</a>, <a class="el" href="chan__zap_8c-source.html#l10773">zap_show_channels()</a>, and <a class="el" href="chan__zap_8c-source.html#l08173">zt_request()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="f59dcd306ec32930f1e78a1d82280b48"></a><!-- doxytag: member="event.c::packed" ref="f59dcd306ec32930f1e78a1d82280b48" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structstun__addr.html">stun_addr</a> <a class="el" href="rtp_8c.html#f59dcd306ec32930f1e78a1d82280b48">packed</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
An event. 
<p>
<dl compact><dt><b>Note:</b></dt><dd>The format of this structure is important, and can not change, since they are sent directly over the network (via IAX2). </dd></dl>

<p>
Referenced by <a class="el" href="unaligned_8h-source.html#l00038">get_unaligned_uint16()</a>, <a class="el" href="unaligned_8h-source.html#l00032">get_unaligned_uint32()</a>, <a class="el" href="unaligned_8h-source.html#l00052">put_unaligned_uint16()</a>, and <a class="el" href="unaligned_8h-source.html#l00045">put_unaligned_uint32()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="7b3644b799dd7d86b42a289c7442a07a"></a><!-- doxytag: member="event.c::sub_uniqueid" ref="7b3644b799dd7d86b42a289c7442a07a" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">uint32_t <a class="el" href="event_8c.html#7b3644b799dd7d86b42a289c7442a07a">sub_uniqueid</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="event_8c-source.html#l00097">97</a> of file <a class="el" href="event_8c-source.html">event.c</a>.
<p>
Referenced by <a class="el" href="event_8c-source.html#l00243">ast_event_subscribe()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu May 24 22:27:28 2007 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.5 </small></address>
</body>
</html>
