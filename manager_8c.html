<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (24 May 2007)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Thu May 24 22:27:36 2007</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Fmain_2F.html">main</a></div>
<h1>manager.c File Reference</h1>The Asterisk Management Interface - AMI. <a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="asterisk_8h-source.html">asterisk.h</a>&quot;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;ctype.h&gt;</code><br>
<code>#include &lt;sys/time.h&gt;</code><br>
<code>#include &lt;sys/types.h&gt;</code><br>
<code>#include &lt;netdb.h&gt;</code><br>
<code>#include &lt;sys/socket.h&gt;</code><br>
<code>#include &lt;netinet/in.h&gt;</code><br>
<code>#include &lt;netinet/tcp.h&gt;</code><br>
<code>#include &lt;arpa/inet.h&gt;</code><br>
<code>#include &lt;signal.h&gt;</code><br>
<code>#include &lt;errno.h&gt;</code><br>
<code>#include &lt;unistd.h&gt;</code><br>
<code>#include &lt;sys/mman.h&gt;</code><br>
<code>#include &quot;<a class="el" href="channel_8h-source.html">asterisk/channel.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="file_8h-source.html">asterisk/file.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="manager_8h-source.html">asterisk/manager.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="config_8h-source.html">asterisk/config.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="callerid_8h-source.html">asterisk/callerid.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="lock_8h-source.html">asterisk/lock.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="logger_8h-source.html">asterisk/logger.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="options_8h-source.html">asterisk/options.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="cli_8h-source.html">asterisk/cli.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="app_8h-source.html">asterisk/app.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="pbx_8h-source.html">asterisk/pbx.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="md5_8h-source.html">asterisk/md5.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="acl_8h-source.html">asterisk/acl.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="utils_8h-source.html">asterisk/utils.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="http_8h-source.html">asterisk/http.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="version_8h-source.html">asterisk/version.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="threadstorage_8h-source.html">asterisk/threadstorage.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="linkedlists_8h-source.html">asterisk/linkedlists.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="term_8h-source.html">asterisk/term.h</a>&quot;</code><br>

<p>
<a href="manager_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__manager__user.html">ast_manager_user</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">user descriptor, as read from the config file.  <a href="structast__manager__user.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structeventqent.html">eventqent</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfast__originate__helper.html">fast_originate_helper</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmansession.html">mansession</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpermalias.html">permalias</a></td></tr>

<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gf9f69200540a7ff01b9714a361ccf60b">ASTMAN_APPEND_BUF_INITSIZE</a>&nbsp;&nbsp;&nbsp;256</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g9ee41aa642997459a48320201907d377">MANAGER_EVENT_BUF_INITSIZE</a>&nbsp;&nbsp;&nbsp;256</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g707bedc997e8781f153bcc7a5d1a944a">MSG_MOREDATA</a>&nbsp;&nbsp;&nbsp;((char *)astman_send_response)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">send a response with an optional message, and terminate it with an empty line. m is used only to grab the 'ActionID' field.  <a href="group__Group__AMI.html#g707bedc997e8781f153bcc7a5d1a944a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gf074edf91f83d1f06f7e1bb384bb050a">NEW_EVENT</a>(m)&nbsp;&nbsp;&nbsp;(AST_LIST_NEXT(m-&gt;last_ev, eq_next))</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#021d0ed88d27a243afcbb3be748af954">ROW_FMT</a>&nbsp;&nbsp;&nbsp;&quot;&lt;tr&gt;&lt;td colspan=\&quot;2\&quot; bgcolor=\&quot;#f1f1ff\&quot;&gt;%s&lt;/td&gt;&lt;/tr&gt;\r\n&quot;</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#8852eebb4d58b3f87ab1f0e4542d086b">TEST_STRING</a>&nbsp;&nbsp;&nbsp;&quot;&lt;form action=\&quot;manager\&quot;&gt;action: &lt;input <a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>=\&quot;action\&quot;&gt; cmd &lt;input <a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>=\&quot;command\&quot;&gt;&lt;br&gt; \	user &lt;input <a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>=\&quot;username\&quot;&gt; pass &lt;input <a class="el" href="chan__nbs_8c.html#a73364531569a868150462e5a44f29c8">type</a>=\&quot;password\&quot; name=\&quot;secret\&quot;&gt;&lt;br&gt; \	&lt;input <a class="el" href="chan__nbs_8c.html#a73364531569a868150462e5a44f29c8">type</a>=\&quot;submit\&quot;&gt;&lt;/form&gt;&quot;</td></tr>

<tr><td colspan="2"><br><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b7">output_format</a> { <a class="el" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b76e6d9740a556bec5c9d2165c11a08a72">FORMAT_RAW</a>, 
<a class="el" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b76c694e73146f86874cd23ec4940be5d7">FORMAT_HTML</a>, 
<a class="el" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b79662bb8a01203e653f85d8e19d4ed3c3">FORMAT_XML</a>
 }</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gfdfb08c15e19a1826e7fe3599e4563f6">__manager_event</a> (int category, const char *<a class="el" href="manager_8h.html#4119639092e62c55ea8be348e4d9260d">event</a>, const char *<a class="el" href="utils_8h.html#8c7dd922ad47494fc02c388e12c00eac">file</a>, int <a class="el" href="manager_8h.html#6438c669e0d0de98e6929c2cc0fac474">line</a>, const char *<a class="el" href="utils_8h.html#7df4935f4a5a2865191ef74f64df8754">func</a>, const char *<a class="el" href="strings_8h.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>,...)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">manager_event: Send AMI event to client  <a href="group__Group__AMI.html#gfdfb08c15e19a1826e7fe3599e4563f6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g9ba77c553c77f8cd95e812fc9a3cbf38">action_challenge</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g6c71a4a16dd2e3115f1235a25a8fdb70">action_command</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Manager command "command" - execute CLI command.  <a href="group__Group__AMI.html#g6c71a4a16dd2e3115f1235a25a8fdb70"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g4572bba9501a379251e6d7712a077035">action_coresettings</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Show PBX core settings information.  <a href="group__Group__AMI.html#g4572bba9501a379251e6d7712a077035"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g48f94483856e54f9d016fd4e00963a5c">action_corestatus</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Show PBX core status information.  <a href="group__Group__AMI.html#g48f94483856e54f9d016fd4e00963a5c"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g77d280f8038dfa2bb4b1ea13569c07df">action_events</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g58e43ceaccf852d6a41133bc5cfadc13">action_extensionstate</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#geeb75cf41619f536caffbbef71e3f730">action_getconfig</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g51d0d48508ddb1374a9b28d95b5702d6">action_getconfigjson</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gdb0963bfde8071d731420ac8def41f9e">action_getvar</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gcee30e0477fbe6f85ac98e124a25289d">action_hangup</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gc47a6ddacfc4e36cfb9ab30e2baf7de0">action_listcommands</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gbd3f1f5c2f6fa1c0db6646c765751566">action_login</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g655a6b9be76687e4d0887bffacd41b3d">action_logoff</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g86017430079df84ea69c923aa234bdcd">action_mailboxcount</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g44d5b6b832d95db5bfb983d39e56ee21">action_mailboxstatus</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gd8bc04cda5ffb147cb7c5542d3f8c1ea">action_originate</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gbd5ac0feea5a76122c4bb7950f72dba9">action_ping</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g0076609fb6806996b6584b7a37870927">action_redirect</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">action_redirect: The redirect manager command  <a href="group__Group__AMI.html#g0076609fb6806996b6584b7a37870927"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g250e20c09ed384cd90623cfd01f8b551">action_sendtext</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gff61c40432e7043889c37096ac0560c7">action_setvar</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g6a023aadcdeed0f3c8db7756f06a85fe">action_status</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Manager "status" command to show channels.  <a href="group__Group__AMI.html#g6a023aadcdeed0f3c8db7756f06a85fe"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#ga8bc516739f567719fd6e75177f08f27">action_timeout</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g2543b90f06c6700af2c68d854b6b4558">action_updateconfig</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g81297609484dc4a21d32483e91c8b11d">action_userevent</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g8c03c9dc4ab8279645aa28d8ec5d7290">action_waitevent</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g38726448f966fa5ad7aaa3141ba16235">append_event</a> (const char *str, int category)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g5084ba51108af1062dd03070916e4990">ast_instring</a> (const char *bigstr, const char *smallstr, const char delim)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g27dd5ddaaf167c42db67c0ca97effe80">AST_LIST_HEAD_STATIC</a> (users, <a class="el" href="structast__manager__user.html">ast_manager_user</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">list of users found in the config file  <a href="group__Group__AMI.html#g27dd5ddaaf167c42db67c0ca97effe80"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g2c7cd483b33dbd5909699ec9fead5820">AST_LIST_HEAD_STATIC</a> (<a class="el" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>, <a class="el" href="structmansession.html">mansession</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g43f98ff67535a3a333db98cd235b847b">AST_LIST_HEAD_STATIC</a> (all_events, <a class="el" href="structeventqent.html">eventqent</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a> (const char *action, int auth, int(*<a class="el" href="utils_8h.html#7df4935f4a5a2865191ef74f64df8754">func</a>)(struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m), const char *<a class="el" href="res__features_8c.html#512fbb4e7b617c04031f58b631f2b05d">synopsis</a>, const char *description)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">register a new command with manager, including online help. This is the preferred way to register a manager command  <a href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g6c0dd33a0e93b1a38be809f2e99980e4">ast_manager_register_hook</a> (struct <a class="el" href="structmanager__custom__hook.html">manager_custom_hook</a> *hook)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a custom hook to be called when an event is fired.  <a href="group__Group__AMI.html#g6c0dd33a0e93b1a38be809f2e99980e4"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g1c56b6ed4b387e1facec1c969283ad56">ast_manager_register_struct</a> (struct <a class="el" href="structmanager__action.html">manager_action</a> *act)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g2ec5f3830dfb4a55fdf0ad8e78bc0db6">ast_manager_unregister</a> (char *action)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g146f09ab1ed1df560f0ffe8113b3a88d">ast_manager_unregister_hook</a> (struct <a class="el" href="structmanager__custom__hook.html">manager_custom_hook</a> *hook)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Delete a custom hook to be called when an event is fired.  <a href="group__Group__AMI.html#g146f09ab1ed1df560f0ffe8113b3a88d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gdbef91cfd3f735bb23131f3ba504e92c">AST_RWLIST_HEAD_STATIC</a> (manager_hooks, <a class="el" href="structmanager__custom__hook.html">manager_custom_hook</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g65d58d1cf1ff44fff0b3a95a45ab8ce4">AST_RWLOCK_DEFINE_STATIC</a> (actionlock)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gc8eeff4c44733611adbabf832d757bcc">AST_THREADSTORAGE</a> (manager_event_buf)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g4512bf7f1ec9d9c1e5a77990fe18ea5f">AST_THREADSTORAGE</a> (astman_append_buf)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const char *<a class="el" href="strings_8h.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>,...)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a> (const struct <a class="el" href="structmessage.html">message</a> *m, char *var)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gf6be899da040cd416bb8317db016c1ff">astman_get_variables</a> (const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g0c64878b307241bfe01cea67e09f49e2">astman_send_ack</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m, char *<a class="el" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m, char *error)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#ga868a0aada874f97606fcc3119bad3da">astman_send_listack</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m, char *<a class="el" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>, char *listflag)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g005978ca7456f4c36c0cd89907d68fdb">astman_send_response</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m, char *resp, char *<a class="el" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g653336d14301d38a863c7b20ccec8a1c">astman_send_response_full</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m, char *resp, char *<a class="el" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>, char *listflag)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gbbca0d5619931eef0a531fe18c27416a">astman_start_ack</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#cd5d8fb2d13b6780ba64c65a02485168">astman_verify_session_readpermissions</a> (unsigned long ident, int perm)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Verify a session's read permissions against a permission mask.  <a href="#cd5d8fb2d13b6780ba64c65a02485168"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#26f962a7a7a8f0cfadc06b37b77863bc">astman_verify_session_writepermissions</a> (unsigned long ident, int perm)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Verify a session's write permissions against a permission mask.  <a href="#26f962a7a7a8f0cfadc06b37b77863bc"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g0c601c39a357acbe91e4070d54d89001">authenticate</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g7a74ba6c31130ec1d434b549ec0bd523">authority_to_str</a> (int authority, struct <a class="el" href="structast__str.html">ast_str</a> **res)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert authority code to a list of options.  <a href="group__Group__AMI.html#g7a74ba6c31130ec1d434b549ec0bd523"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gd45bb050dddb40e1768551d6be08c1ad">check_manager_enabled</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check if AMI is enabled.  <a href="group__Group__AMI.html#gd45bb050dddb40e1768551d6be08c1ad"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g1889b1316d12271fa30e9f302c0da675">check_manager_session_inuse</a> (const char *<a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g6fcd08c8c073e9da6c6f96d6663d69d9">check_webmanager_enabled</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check if AMI/HTTP is enabled.  <a href="group__Group__AMI.html#g6fcd08c8c073e9da6c6f96d6663d69d9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g4602d648ab671d826260eb839d90ab26">complete_show_mancmd</a> (const char *<a class="el" href="manager_8h.html#6438c669e0d0de98e6929c2cc0fac474">line</a>, const char *word, int pos, int <a class="el" href="structstate.html">state</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g2748014a620509eb30d57cd01d0218ce">destroy_session</a> (struct <a class="el" href="structmansession.html">mansession</a> *s)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g9af7cd1eddf73300ec737507cdaee283">do_message</a> (struct <a class="el" href="structmansession.html">mansession</a> *s)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g07edcd94b098b94138489a2a65ce84f8">fast_originate</a> (void *data)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#eb5eef6f13f7164665f4b8c1ba7ab8a3">find_session</a> (unsigned long ident)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g1ea5536cdcef90f22613b5db2ee59b0d">free_session</a> (struct <a class="el" href="structmansession.html">mansession</a> *s)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structast__str.html">ast_str</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#d29cc4351fa8d1b4650f737d9bf6a630">generic_http_callback</a> (enum <a class="el" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b7">output_format</a> <a class="el" href="cdr__custom_8c.html#b954976e6264c40232046aacb5b7c390">format</a>, struct sockaddr_in *requestor, const char *uri, struct <a class="el" href="structast__variable.html">ast_variable</a> *params, int *status, char **title, int *contentlength)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gf6b259125b17075ea07ee9939d7fdbf5">get_input</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, char *output)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structast__manager__user.html">ast_manager_user</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gcf9022296a6e52672bd7bf89e570c7e0">get_manager_by_name_locked</a> (const char *<a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g6bfcdc2d3a50cfc5be0ca0b6dbc622ea">get_perm</a> (const char *instr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structeventqent.html">eventqent</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g3bc926ccadf91a299fff3f875979895f">grab_last</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g92af1877a38de15bb9ee5483d0f277f7">handle_mandebug</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gdcf525aba75386762df1e64fa94431fd">handle_showmanager</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g26d7d1506f2ef8110c9c01f335f07911">handle_showmanagers</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#ge553b01c2e0c4bf2d135796bb81c4826">handle_showmancmd</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gb93d1c6d033baab667f87c2ec9ff671c">handle_showmancmds</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">CLI command manager list commands.  <a href="group__Group__AMI.html#gb93d1c6d033baab667f87c2ec9ff671c"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gb88212ea47b4627cdab59b899f6fb328">handle_showmanconn</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">CLI command manager list connected.  <a href="group__Group__AMI.html#gb88212ea47b4627cdab59b899f6fb328"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g6a11926a741d1c7d51260d13fbc4c74c">handle_showmaneventq</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">CLI command manager list eventq.  <a href="group__Group__AMI.html#g6a11926a741d1c7d51260d13fbc4c74c"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g745d3d4809316e9124d216a6e3ce93d3">handle_updates</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m, struct <a class="el" href="structast__config.html">ast_config</a> *cfg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#31a28c522e71a1df85feb1926f943821">init_manager</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#ge5f94d60aa1b0c445a48748f89b2a78d">json_escape</a> (char *out, const char *in)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structast__str.html">ast_str</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#9d3f921f1e6cf458c3a2f5cea1c24dc7">manager_http_callback</a> (struct sockaddr_in *requestor, const char *uri, struct <a class="el" href="structast__variable.html">ast_variable</a> *params, int *status, char **title, int *contentlength)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gff6bb88658011308f835d9278cf7f4b5">manager_state_cb</a> (char *<a class="el" href="cdr__tds_8c.html#5c18ef72771564b7f43c497dc507aeab">context</a>, char *<a class="el" href="chan__alsa_8c.html#5aedfeaeaac21e5e5f297360633ea9a3">exten</a>, int <a class="el" href="structstate.html">state</a>, void *data)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structast__str.html">ast_str</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#119c80dcebb27185d75f23a60e6c1046">mxml_http_callback</a> (struct sockaddr_in *requestor, const char *uri, struct <a class="el" href="structast__variable.html">ast_variable</a> *params, int *status, char **title, int *contentlength)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g83b7cdf115b0fd94f4417d71e9f3abe2">process_events</a> (struct <a class="el" href="structmansession.html">mansession</a> *s)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g4b975e0463cced020259b711bb8481e2">process_message</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g50cd338ac6ba658c88ad6a7752b556e8">purge_events</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#96788aa2f4896a4c18fb160b2f4c19c6">purge_old_stuff</a> (void *data)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">cleanup code called at each iteration of server_root, guaranteed to happen every 5 seconds at most  <a href="#96788aa2f4896a4c18fb160b2f4c19c6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g4051b884ed44c7d2b8b79ed1ffb0cd26">purge_sessions</a> (int n_max)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">remove at most n_max stale session from the list.  <a href="group__Group__AMI.html#g4051b884ed44c7d2b8b79ed1ffb0cd26"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structast__str.html">ast_str</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#e1be75554d9d46ab3593321aa97d81de">rawman_http_callback</a> (struct sockaddr_in *requestor, const char *uri, struct <a class="el" href="structast__variable.html">ast_variable</a> *params, int *status, char **title, int *contentlength)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#ga640283e96a4cdde5b36633464a1318a">ref_event</a> (struct <a class="el" href="structeventqent.html">eventqent</a> *e)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#5261ebdd008364aa84e6d7254982898e">reload_manager</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g28148bd9372a54210c67afe221c2141a">send_string</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, char *string)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g5014c646ffd1bd67b43210a9a22c136a">session_do</a> (void *data)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The body of the individual manager session. Call <a class="el" href="group__Group__AMI.html#gf6b259125b17075ea07ee9939d7fdbf5">get_input()</a> to read one line at a time (or be woken up on new events), collect the lines in a message until found an empty line, and execute the request. In any case, deliver events asynchronously through <a class="el" href="group__Group__AMI.html#g83b7cdf115b0fd94f4417d71e9f3abe2">process_events()</a> (called from here if no line is available, or at the end of <a class="el" href="group__Group__AMI.html#g4b975e0463cced020259b711bb8481e2">process_message()</a>. ).  <a href="group__Group__AMI.html#g5014c646ffd1bd67b43210a9a22c136a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gca4968afc65b84cc5b3781d465536b32">set_eventmask</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const char *eventmask)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Rather than braindead on,off this now can also accept a specific int mask value or a ',' delim list of mask strings (the same as manager.conf) -anthm.  <a href="group__Group__AMI.html#gca4968afc65b84cc5b3781d465536b32"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g84442272098545210b360ac4f131f10f">strings_to_mask</a> (const char *string)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structeventqent.html">eventqent</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gfb5ee4f215d8a2bd0f91355e21f53df5">unref_event</a> (struct <a class="el" href="structeventqent.html">eventqent</a> *e)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#38980e0b6876fe8f2a22a1841fee0895">xml_copy_escape</a> (struct <a class="el" href="structast__str.html">ast_str</a> **out, const char *src, int mode)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#645ff123f7ab62c33c2c22d620e044bb">xml_translate</a> (struct <a class="el" href="structast__str.html">ast_str</a> **out, char *in, struct <a class="el" href="structast__variable.html">ast_variable</a> *vars, enum <a class="el" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b7">output_format</a> <a class="el" href="cdr__custom_8c.html#b954976e6264c40232046aacb5b7c390">format</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert the input into XML or HTML. The input is supposed to be a sequence of lines of the form Name: value optionally followed by a blob of unformatted text. A blank line is a section separator. Basically, this is a mixture of the format of Manager Interface and CLI commands. The unformatted text is considered as a single value of a field named 'Opaque-data'.  <a href="#645ff123f7ab62c33c2c22d620e044bb"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g96f294e808841cbd886011c9d0192687">allowmultiplelogin</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structserver__args.html">server_args</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#300cdb1a12b392413a97b68c6e659d08">ami_desc</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structtls__config.html">tls_config</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#1d13b7f019c0c316c9b46d22c8dbd337">ami_tls_cfg</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structserver__args.html">server_args</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#d60178c503bef15cc7591c2c82a11fe7">amis_desc</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g58780e565b16019054545fbf6ba26a24">block_sockets</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gc63528124b8cf02a55bec42906b204ca">cli_manager</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g7c3e6bc8d40097fbec8dfa709b99eee1">command_blacklist</a> []</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Descriptor for a manager session, either on the AMI socket or over HTTP.  <a href="group__Group__AMI.html#g7c3e6bc8d40097fbec8dfa709b99eee1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#a89f2caaaac4606099b86e300edf06de">contenttype</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#ga3b408e54a36d8024f4861b84f8648fb">displayconnects</a> = 1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structmanager__action.html">manager_action</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gb9fdf2c32a9e1ffe8bea294eb2132fe6">first_action</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">list of actions registered  <a href="group__Group__AMI.html#gb9fdf2c32a9e1ffe8bea294eb2132fe6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gff966934ba065051f34a94a400e43b17">httptimeout</a> = 60</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g065d88d3234671acf0f5980f9228b827">manager_debug</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g7fa4f9f44eb840da897cd6df25e71ea4">manager_enabled</a> = 0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__http__uri.html">ast_http_uri</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#813ec6aec886e6bbb6ef9a1b455d78a8">manageruri</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__http__uri.html">ast_http_uri</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#7b55e3a11caef236115e71b9ea5a4304">managerxmluri</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g7ef45bd71ec09dcb2c7e6b8d6e48e57f">mandescr_command</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#ge402cc29f5a0d8a9001d5071152b1281">mandescr_coresettings</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g54e903fbbc11dec18a6971c0b9f89df1">mandescr_corestatus</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gadfa58476f08d0f14e4209140d4ddf57">mandescr_events</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gc23a0e40c449c0ff093ebb890078ccd7">mandescr_extensionstate</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g47ba7bebfd930c7ba1797e460b0c261b">mandescr_getconfig</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gd3137ad18fefbbb17e1e3848b7423d16">mandescr_getconfigjson</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g7e44f6255d335a2c07e5a08424d9ab47">mandescr_getvar</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gcd3c210737ab7a7dea258825b16345a4">mandescr_hangup</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g8ff25cb8fe76a131a2401ce3e51ee07e">mandescr_listcommands</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g4eb25b527bf76f2c94ee7f6a1727706c">mandescr_logoff</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g4c3b52b7ac90a43027758d2aaf218202">mandescr_mailboxcount</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gfbeefe3f5b56dfe8f2379f93f8699b13">mandescr_mailboxstatus</a> []</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Help text for manager command mailboxstatus.  <a href="group__Group__AMI.html#gfbeefe3f5b56dfe8f2379f93f8699b13"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gb8d0d86508e429319171f702da06978f">mandescr_originate</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gd19fc2f4e2bf2f2b6e916f370a345957">mandescr_ping</a> []</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Manager PING.  <a href="group__Group__AMI.html#gd19fc2f4e2bf2f2b6e916f370a345957"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gac91809519e0b430f42ce4cfdf5c5a2a">mandescr_redirect</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g718ec14078a25254e40cb5ea875d4955">mandescr_sendtext</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g011be8a601adfe631d2040fd2b3e347d">mandescr_setvar</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gd5b2a1a9f5c7c824e21d0345f08ad0d4">mandescr_timeout</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gb327aa5c1fa62b6a6ea1eff221976639">mandescr_updateconfig</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g6c5c4b2a4fc6e25aac2fbc21cbbe12e4">mandescr_userevent</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g5ac7170aaf87a7b17bc4b85f93facd3a">mandescr_waitevent</a> []</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Manager WAITEVENT.  <a href="group__Group__AMI.html#g5ac7170aaf87a7b17bc4b85f93facd3a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g16d027da9851b664ff9336caf28769e8">num_sessions</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structpermalias.html">permalias</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g94a45625d6a1e46563105bbad0c894f9">perms</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__http__uri.html">ast_http_uri</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#8318a86553fb0a8bdb35f3f61b21eed8">rawmanuri</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#a2b8ed9c305b8ea86116b603cca78a97">registered</a> = 0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gea495796afbed327cab82112a7b06e91">showmanager_help</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g6629e3faec13dd829b44497132cd264c">showmanagers_help</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g293b0679af0df6d889fa669b0c0cbdf2">showmancmd_help</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g9547e3c81ba49eaa71b260516bf756f2">showmancmds_help</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g14d45ff06ab8d3edb8c57d75dd7cd939">showmanconn_help</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gcafda953885f99fc273e3097cdc36867">showmaneventq_help</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g846e7158f3a1a166b993bbea7e34c1e0">timestampevents</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#ge48c16ca333fc1529958ca58131fd875">webmanager_enabled</a> = 0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="manager_8c.html#9327cfe8492c3330bf4d51ded3e8d1a8">webregged</a> = 0</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
The Asterisk Management Interface - AMI. 
<p>
<dl compact><dt><b>Author:</b></dt><dd>Mark Spencer &lt;<a href="mailto:markster@digium.com">markster@digium.com</a>&gt;</dd></dl>
<dl compact><dt><b><a class="el" href="extref.html#_extref000001">ExtRef:</a></b></dt><dd>OpenSSL <a href="http://www.openssl.org">http://www.openssl.org</a> - for AMI/SSL</dd></dl>
At the moment this file contains a number of functions, namely:<p>
<ul>
<li>data structures storing AMI state</li><li>AMI-related API functions, used by internal asterisk components</li><li>handlers for AMI-related CLI functions</li><li>handlers for AMI functions (available through the AMI socket)</li><li>the code for the main AMI listener thread and individual session threads</li><li>the http handlers invoked for AMI-over-HTTP by the threads in main/http.c</li></ul>
<p>
<a class="el" href="Config_ami.html#amiconf">manager.conf</a> 
<p>
Definition in file <a class="el" href="manager_8c-source.html">manager.c</a>.<hr><h2>Define Documentation</h2>
<a class="anchor" name="021d0ed88d27a243afcbb3be748af954"></a><!-- doxytag: member="manager.c::ROW_FMT" ref="021d0ed88d27a243afcbb3be748af954" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define ROW_FMT&nbsp;&nbsp;&nbsp;&quot;&lt;tr&gt;&lt;td colspan=\&quot;2\&quot; bgcolor=\&quot;#f1f1ff\&quot;&gt;%s&lt;/td&gt;&lt;/tr&gt;\r\n&quot;          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="manager_8c-source.html#l02988">generic_http_callback()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="8852eebb4d58b3f87ab1f0e4542d086b"></a><!-- doxytag: member="manager.c::TEST_STRING" ref="8852eebb4d58b3f87ab1f0e4542d086b" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define TEST_STRING&nbsp;&nbsp;&nbsp;&quot;&lt;form action=\&quot;manager\&quot;&gt;action: &lt;input <a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>=\&quot;action\&quot;&gt; cmd &lt;input <a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>=\&quot;command\&quot;&gt;&lt;br&gt; \	user &lt;input <a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>=\&quot;username\&quot;&gt; pass &lt;input <a class="el" href="chan__nbs_8c.html#a73364531569a868150462e5a44f29c8">type</a>=\&quot;password\&quot; name=\&quot;secret\&quot;&gt;&lt;br&gt; \	&lt;input <a class="el" href="chan__nbs_8c.html#a73364531569a868150462e5a44f29c8">type</a>=\&quot;submit\&quot;&gt;&lt;/form&gt;&quot;          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="manager_8c-source.html#l02988">generic_http_callback()</a>.    </td>
  </tr>
</table>
<hr><h2>Enumeration Type Documentation</h2>
<a class="anchor" name="50ca0e02bf37d3e8838a9ae27b99d9b7"></a><!-- doxytag: member="manager.c::output_format" ref="50ca0e02bf37d3e8838a9ae27b99d9b7" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">enum <a class="el" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b7">output_format</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
END Doxygen group <dl compact><dt><b>Enumerator: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" name="50ca0e02bf37d3e8838a9ae27b99d9b76e6d9740a556bec5c9d2165c11a08a72"></a><!-- doxytag: member="FORMAT_RAW" ref="50ca0e02bf37d3e8838a9ae27b99d9b76e6d9740a556bec5c9d2165c11a08a72" args="" -->FORMAT_RAW</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" name="50ca0e02bf37d3e8838a9ae27b99d9b76c694e73146f86874cd23ec4940be5d7"></a><!-- doxytag: member="FORMAT_HTML" ref="50ca0e02bf37d3e8838a9ae27b99d9b76c694e73146f86874cd23ec4940be5d7" args="" -->FORMAT_HTML</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" name="50ca0e02bf37d3e8838a9ae27b99d9b79662bb8a01203e653f85d8e19d4ed3c3"></a><!-- doxytag: member="FORMAT_XML" ref="50ca0e02bf37d3e8838a9ae27b99d9b79662bb8a01203e653f85d8e19d4ed3c3" args="" -->FORMAT_XML</em>&nbsp;</td><td>
</td></tr>
</table>
</dl>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02728">2728</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.<div class="fragment"><pre class="fragment"><a name="l02728"></a>02728                    {
<a name="l02729"></a>02729    <a class="code" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b76e6d9740a556bec5c9d2165c11a08a72">FORMAT_RAW</a>,
<a name="l02730"></a>02730    <a class="code" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b76c694e73146f86874cd23ec4940be5d7">FORMAT_HTML</a>,
<a name="l02731"></a>02731    <a class="code" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b79662bb8a01203e653f85d8e19d4ed3c3">FORMAT_XML</a>,
<a name="l02732"></a>02732 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="cd5d8fb2d13b6780ba64c65a02485168"></a><!-- doxytag: member="manager.c::astman_verify_session_readpermissions" ref="cd5d8fb2d13b6780ba64c65a02485168" args="(unsigned long ident, int perm)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int astman_verify_session_readpermissions           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned long&nbsp;</td>
          <td class="mdname" nowrap> <em>ident</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>perm</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Verify a session's read permissions against a permission mask. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ident</em>&nbsp;</td><td>session identity </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>perm</em>&nbsp;</td><td>permission mask to verify </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>1 if the session has the permission mask capabilities, otherwise 0 </dd></dl>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02766">2766</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00141">mansession::__lock</a>, <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00453">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="manager_8c-source.html#l00149">mansession::managerid</a>, <a class="el" href="manager_8c-source.html#l00154">mansession::readperm</a>, <a class="el" href="cdr__pgsql_8c-source.html#l00071">result</a>, and <a class="el" href="aesopt_8h-source.html#l00399">s</a>.<div class="fragment"><pre class="fragment"><a name="l02767"></a>02767 {
<a name="l02768"></a>02768    <span class="keywordtype">int</span> <a class="code" href="cdr__pgsql_8c.html#b4a88417b3d0170d754c647c30b7216a">result</a> = 0;
<a name="l02769"></a>02769    <span class="keyword">struct </span><a class="code" href="structmansession.html">mansession</a> *<a class="code" href="aesopt_8h.html#8d6242bc80162ac99dd4d368eabe77cc">s</a>;
<a name="l02770"></a>02770 
<a name="l02771"></a>02771    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>);
<a name="l02772"></a>02772    <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>, s, list) {
<a name="l02773"></a>02773       <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02774"></a>02774       <span class="keywordflow">if</span> ((s-&gt;<a class="code" href="structmansession.html#5eb0038a1d93de54c255dc46dcd40c66">managerid</a> == ident) &amp;&amp; (s-&gt;<a class="code" href="structmansession.html#e12b8f9551a73d6196648b62754aa9e1">readperm</a> &amp; perm)) {
<a name="l02775"></a>02775          result = 1;
<a name="l02776"></a>02776          <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02777"></a>02777          <span class="keywordflow">break</span>;
<a name="l02778"></a>02778       }
<a name="l02779"></a>02779       <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02780"></a>02780    }
<a name="l02781"></a>02781    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>);
<a name="l02782"></a>02782    <span class="keywordflow">return</span> result;
<a name="l02783"></a>02783 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="26f962a7a7a8f0cfadc06b37b77863bc"></a><!-- doxytag: member="manager.c::astman_verify_session_writepermissions" ref="26f962a7a7a8f0cfadc06b37b77863bc" args="(unsigned long ident, int perm)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int astman_verify_session_writepermissions           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned long&nbsp;</td>
          <td class="mdname" nowrap> <em>ident</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>perm</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Verify a session's write permissions against a permission mask. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ident</em>&nbsp;</td><td>session identity </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>perm</em>&nbsp;</td><td>permission mask to verify </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>1 if the session has the permission mask capabilities, otherwise 0 </dd></dl>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02785">2785</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00141">mansession::__lock</a>, <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00453">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="manager_8c-source.html#l00149">mansession::managerid</a>, <a class="el" href="cdr__pgsql_8c-source.html#l00071">result</a>, <a class="el" href="aesopt_8h-source.html#l00399">s</a>, and <a class="el" href="manager_8c-source.html#l00155">mansession::writeperm</a>.
<p>
Referenced by <a class="el" href="http_8c-source.html#l00416">handle_post()</a>.<div class="fragment"><pre class="fragment"><a name="l02786"></a>02786 {
<a name="l02787"></a>02787    <span class="keywordtype">int</span> <a class="code" href="cdr__pgsql_8c.html#b4a88417b3d0170d754c647c30b7216a">result</a> = 0;
<a name="l02788"></a>02788    <span class="keyword">struct </span><a class="code" href="structmansession.html">mansession</a> *<a class="code" href="aesopt_8h.html#8d6242bc80162ac99dd4d368eabe77cc">s</a>;
<a name="l02789"></a>02789 
<a name="l02790"></a>02790    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>);
<a name="l02791"></a>02791    <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>, s, list) {
<a name="l02792"></a>02792       <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02793"></a>02793       <span class="keywordflow">if</span> ((s-&gt;<a class="code" href="structmansession.html#5eb0038a1d93de54c255dc46dcd40c66">managerid</a> == ident) &amp;&amp; (s-&gt;<a class="code" href="structmansession.html#1cc72854e73b9b510a12e993d6479e86">writeperm</a> &amp; perm)) {
<a name="l02794"></a>02794          result = 1;
<a name="l02795"></a>02795          <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02796"></a>02796          <span class="keywordflow">break</span>;
<a name="l02797"></a>02797       }
<a name="l02798"></a>02798       <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02799"></a>02799    }
<a name="l02800"></a>02800    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>);
<a name="l02801"></a>02801    <span class="keywordflow">return</span> result;
<a name="l02802"></a>02802 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="eb5eef6f13f7164665f4b8c1ba7ab8a3"></a><!-- doxytag: member="manager.c::find_session" ref="eb5eef6f13f7164665f4b8c1ba7ab8a3" args="(unsigned long ident)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static struct <a class="el" href="structmansession.html">mansession</a>* find_session           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned long&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ident</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
locate an http session in the list. The search key (ident) is the value of the mansession_id cookie (0 is not valid and means a session on the AMI socket). 
<p>
Definition at line <a class="el" href="manager_8c-source.html#l02745">2745</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00141">mansession::__lock</a>, <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00453">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="manager_8c-source.html#l00146">mansession::inuse</a>, <a class="el" href="manager_8c-source.html#l00149">mansession::managerid</a>, <a class="el" href="manager_8c-source.html#l00147">mansession::needdestroy</a>, and <a class="el" href="aesopt_8h-source.html#l00399">s</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l02988">generic_http_callback()</a>.<div class="fragment"><pre class="fragment"><a name="l02746"></a>02746 {
<a name="l02747"></a>02747    <span class="keyword">struct </span><a class="code" href="structmansession.html">mansession</a> *<a class="code" href="aesopt_8h.html#8d6242bc80162ac99dd4d368eabe77cc">s</a>;
<a name="l02748"></a>02748 
<a name="l02749"></a>02749    <span class="keywordflow">if</span> (ident == 0)
<a name="l02750"></a>02750       <span class="keywordflow">return</span> NULL;
<a name="l02751"></a>02751 
<a name="l02752"></a>02752    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>);
<a name="l02753"></a>02753    <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>, s, list) {
<a name="l02754"></a>02754       <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02755"></a>02755       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structmansession.html#5eb0038a1d93de54c255dc46dcd40c66">managerid</a> == ident &amp;&amp; !s-&gt;<a class="code" href="structmansession.html#550961e9c744e38a27b28e50d66f595d">needdestroy</a>) {
<a name="l02756"></a>02756          ast_atomic_fetchadd_int(&amp;s-&gt;<a class="code" href="structmansession.html#9ac84af00bd68fa1e4441a101c6b6305">inuse</a>, 1);
<a name="l02757"></a>02757          <span class="keywordflow">break</span>;
<a name="l02758"></a>02758       }
<a name="l02759"></a>02759       <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02760"></a>02760    }
<a name="l02761"></a>02761    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>);
<a name="l02762"></a>02762 
<a name="l02763"></a>02763    <span class="keywordflow">return</span> s;
<a name="l02764"></a>02764 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d29cc4351fa8d1b4650f737d9bf6a630"></a><!-- doxytag: member="manager.c::generic_http_callback" ref="d29cc4351fa8d1b4650f737d9bf6a630" args="(enum output_format format, struct sockaddr_in *requestor, const char *uri, struct ast_variable *params, int *status, char **title, int *contentlength)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static struct <a class="el" href="structast__str.html">ast_str</a>* generic_http_callback           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">enum <a class="el" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b7">output_format</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct sockaddr_in *&nbsp;</td>
          <td class="mdname" nowrap> <em>requestor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>uri</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>params</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>status</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char **&nbsp;</td>
          <td class="mdname" nowrap> <em>title</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>contentlength</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02988">2988</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00141">mansession::__lock</a>, <a class="el" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>, <a class="el" href="http_8c-source.html#l00280">ast_http_error()</a>, <a class="el" href="utils_8c-source.html#l00493">ast_inet_ntoa()</a>, <a class="el" href="linkedlists_8h-source.html#l00650">AST_LIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="manager_8h-source.html#l00062">AST_MAX_MANHEADERS</a>, <a class="el" href="lock_8h-source.html#l00508">ast_mutex_init()</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="lock_8h-source.html#l00074">AST_PTHREADT_NULL</a>, <a class="el" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append()</a>, <a class="el" href="logger_8c-source.html#l00989">ast_verbose()</a>, <a class="el" href="manager_8c-source.html#l00153">mansession::authenticated</a>, <a class="el" href="adsistub_8c-source.html#l00065">buf</a>, <a class="el" href="manager_8c-source.html#l00703">destroy_session()</a>, <a class="el" href="manager_8c-source.html#l00144">mansession::f</a>, <a class="el" href="manager_8c-source.html#l00145">mansession::fd</a>, <a class="el" href="manager_8c-source.html#l02745">find_session()</a>, <a class="el" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b76c694e73146f86874cd23ec4940be5d7">FORMAT_HTML</a>, <a class="el" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b79662bb8a01203e653f85d8e19d4ed3c3">FORMAT_XML</a>, <a class="el" href="manager_8c-source.html#l00271">grab_last()</a>, <a class="el" href="manager_8h-source.html#l00096">message::hdrcount</a>, <a class="el" href="manager_8h-source.html#l00097">message::headers</a>, <a class="el" href="manager_8c-source.html#l00116">httptimeout</a>, <a class="el" href="manager_8c-source.html#l00146">mansession::inuse</a>, <a class="el" href="logger_8h-source.html#l00094">LOG_DEBUG</a>, <a class="el" href="logger_8h-source.html#l00100">LOG_EVENT</a>, <a class="el" href="manager_8c-source.html#l00149">mansession::managerid</a>, <a class="el" href="config_8h-source.html#l00039">ast_variable::name</a>, <a class="el" href="manager_8c-source.html#l00147">mansession::needdestroy</a>, <a class="el" href="config_8h-source.html#l00046">ast_variable::next</a>, <a class="el" href="manager_8c-source.html#l00121">num_sessions</a>, <a class="el" href="asterisk_8c-source.html#l00164">option_debug</a>, <a class="el" href="asterisk_8c-source.html#l00163">option_verbose</a>, <a class="el" href="manager_8c-source.html#l02288">process_message()</a>, <a class="el" href="manager_8c.html#021d0ed88d27a243afcbb3be748af954">ROW_FMT</a>, <a class="el" href="aesopt_8h-source.html#l00399">s</a>, <a class="el" href="manager_8c-source.html#l00150">mansession::sessiontimeout</a>, <a class="el" href="manager_8c-source.html#l00143">mansession::sin</a>, <a class="el" href="manager_8c.html#8852eebb4d58b3f87ab1f0e4542d086b">TEST_STRING</a>, <a class="el" href="manager_8c-source.html#l00151">mansession::username</a>, <a class="el" href="config_8h-source.html#l00040">ast_variable::value</a>, <a class="el" href="logger_8h-source.html#l00044">VERBOSE_PREFIX_2</a>, <a class="el" href="manager_8c-source.html#l00148">mansession::waiting_thread</a>, and <a class="el" href="manager_8c-source.html#l02890">xml_translate()</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03145">manager_http_callback()</a>, <a class="el" href="manager_8c-source.html#l03150">mxml_http_callback()</a>, and <a class="el" href="manager_8c-source.html#l03155">rawman_http_callback()</a>.<div class="fragment"><pre class="fragment"><a name="l02992"></a>02992 {
<a name="l02993"></a>02993    <span class="keyword">struct </span><a class="code" href="structmansession.html">mansession</a> *<a class="code" href="aesopt_8h.html#8d6242bc80162ac99dd4d368eabe77cc">s</a> = NULL;
<a name="l02994"></a>02994    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ident = 0; <span class="comment">/* invalid, so find_session will fail if not set through the cookie */</span>
<a name="l02995"></a>02995    <span class="keywordtype">int</span> blastaway = 0;
<a name="l02996"></a>02996    <span class="keyword">struct </span><a class="code" href="structast__variable.html">ast_variable</a> *v;
<a name="l02997"></a>02997    <span class="keywordtype">char</span> <span class="keyword">template</span>[] = <span class="stringliteral">"/tmp/ast-http-XXXXXX"</span>; <span class="comment">/* template for temporary file */</span>
<a name="l02998"></a>02998    <span class="keyword">struct </span><a class="code" href="structast__str.html">ast_str</a> *out = NULL;
<a name="l02999"></a>02999    <span class="keyword">struct </span><a class="code" href="structmessage.html">message</a> m = { 0 };
<a name="l03000"></a>03000    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x;
<a name="l03001"></a>03001    size_t hdrlen;
<a name="l03002"></a>03002 
<a name="l03003"></a>03003    <span class="keywordflow">for</span> (v = params; v; v = v-&gt;<a class="code" href="structast__variable.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>) {
<a name="l03004"></a>03004       <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"mansession_id"</span>)) {
<a name="l03005"></a>03005          sscanf(v-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>, <span class="stringliteral">"%lx"</span>, &amp;ident);
<a name="l03006"></a>03006          <span class="keywordflow">break</span>;
<a name="l03007"></a>03007       }
<a name="l03008"></a>03008    }
<a name="l03009"></a>03009 
<a name="l03010"></a>03010    <span class="keywordflow">if</span> (!(s = <a class="code" href="manager_8c.html#eb5eef6f13f7164665f4b8c1ba7ab8a3">find_session</a>(ident))) {
<a name="l03011"></a>03011       <span class="comment">/* Create new session.</span>
<a name="l03012"></a>03012 <span class="comment">       * While it is not in the list we don't need any locking</span>
<a name="l03013"></a>03013 <span class="comment">       */</span>
<a name="l03014"></a>03014       <span class="keywordflow">if</span> (!(s = <a class="code" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*s)))) {
<a name="l03015"></a>03015          *status = 500;
<a name="l03016"></a>03016          <span class="keywordflow">goto</span> generic_callback_out;
<a name="l03017"></a>03017       }
<a name="l03018"></a>03018       s-&gt;sin = *requestor;
<a name="l03019"></a>03019       s-&gt;fd = -1;
<a name="l03020"></a>03020       s-&gt;waiting_thread = <a class="code" href="lock_8h.html#84e4b34008de83ea9d1fa44057758022">AST_PTHREADT_NULL</a>;
<a name="l03021"></a>03021       s-&gt;send_events = 0;
<a name="l03022"></a>03022       <a class="code" href="lock_8h.html#33e99ac90b0ca47211841b5cab79ffc4">ast_mutex_init</a>(&amp;s-&gt;__lock);
<a name="l03023"></a>03023       <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;s-&gt;__lock);
<a name="l03024"></a>03024       s-&gt;inuse = 1;
<a name="l03025"></a>03025       s-&gt;managerid = rand() | 1; <span class="comment">/* make sure it is non-zero */</span>
<a name="l03026"></a>03026       s-&gt;last_ev = <a class="code" href="group__Group__AMI.html#g3bc926ccadf91a299fff3f875979895f">grab_last</a>();
<a name="l03027"></a>03027       <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>);
<a name="l03028"></a>03028       <a class="code" href="linkedlists_8h.html#5df56040a8838bdc841ef8eb179b7609">AST_LIST_INSERT_HEAD</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>, s, list);
<a name="l03029"></a>03029       <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>);
<a name="l03030"></a>03030       ast_atomic_fetchadd_int(&amp;<a class="code" href="group__Group__AMI.html#g16d027da9851b664ff9336caf28769e8">num_sessions</a>, 1);
<a name="l03031"></a>03031    }
<a name="l03032"></a>03032 
<a name="l03033"></a>03033    <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l03034"></a>03034 
<a name="l03035"></a>03035    <span class="keywordflow">if</span> (!(out = ast_str_create(1024))) {
<a name="l03036"></a>03036       *status = 500;
<a name="l03037"></a>03037       <span class="keywordflow">goto</span> generic_callback_out;
<a name="l03038"></a>03038    }
<a name="l03039"></a>03039 
<a name="l03040"></a>03040    s-&gt;<a class="code" href="structmansession.html#36eba1e1e343279857ea7f69a597324e">fd</a> = mkstemp(<span class="keyword">template</span>); <span class="comment">/* create a temporary file for command output */</span>
<a name="l03041"></a>03041    unlink(<span class="keyword">template</span>);
<a name="l03042"></a>03042    s-&gt;<a class="code" href="structmansession.html#8fa14cdd754f91cc6554c9e71929cce7">f</a> = fdopen(s-&gt;<a class="code" href="structmansession.html#36eba1e1e343279857ea7f69a597324e">fd</a>, <span class="stringliteral">"w+"</span>);
<a name="l03043"></a>03043 
<a name="l03044"></a>03044    <span class="keywordflow">for</span> (x = 0, v = params; v &amp;&amp; (x &lt; <a class="code" href="manager_8h.html#233ac9532f94e3f2b355891d25414118">AST_MAX_MANHEADERS</a>); x++, v = v-&gt;<a class="code" href="structast__variable.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>) {
<a name="l03045"></a>03045       hdrlen = strlen(v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>) + strlen(v-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>) + 3;
<a name="l03046"></a>03046       m.<a class="code" href="structmessage.html#0e403735bca63ec8eb4378badc1c98d0">headers</a>[m.<a class="code" href="structmessage.html#76e7ad105b17b3d39436c0487d899200">hdrcount</a>] = alloca(hdrlen);
<a name="l03047"></a>03047       snprintf((<span class="keywordtype">char</span> *) m.<a class="code" href="structmessage.html#0e403735bca63ec8eb4378badc1c98d0">headers</a>[m.<a class="code" href="structmessage.html#76e7ad105b17b3d39436c0487d899200">hdrcount</a>], hdrlen, <span class="stringliteral">"%s: %s"</span>, v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, v-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>);
<a name="l03048"></a>03048       m.<a class="code" href="structmessage.html#76e7ad105b17b3d39436c0487d899200">hdrcount</a> = x + 1;
<a name="l03049"></a>03049    }
<a name="l03050"></a>03050 
<a name="l03051"></a>03051    <span class="keywordflow">if</span> (<a class="code" href="group__Group__AMI.html#g4b975e0463cced020259b711bb8481e2">process_message</a>(s, &amp;m)) {
<a name="l03052"></a>03052       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structmansession.html#700633a1b0f65fa8456a18bd6053193c">authenticated</a>) {
<a name="l03053"></a>03053          <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ge36cdd7167e060bff70d00fbd82809eb">option_verbose</a> &gt; 1) {
<a name="l03054"></a>03054             <span class="keywordflow">if</span> (<a class="code" href="group__Group__AMI.html#ga3b408e54a36d8024f4861b84f8648fb">displayconnects</a>)
<a name="l03055"></a>03055                <a class="code" href="logger_8c.html#6a1ef0a194bcc79fccfb662192954477">ast_verbose</a>(<a class="code" href="logger_8h.html#6e3640436a97291b451a8d264b5ab15d">VERBOSE_PREFIX_2</a> <span class="stringliteral">"HTTP Manager '%s' logged off from %s\n"</span>, s-&gt;<a class="code" href="structmansession.html#5aec535b6e1a39142c62cb283d7f9268">username</a>, <a class="code" href="utils_8c.html#d5490a9b672272bd2f20ee1e5b72c11e">ast_inet_ntoa</a>(s-&gt;<a class="code" href="structmansession.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_addr));
<a name="l03056"></a>03056          }
<a name="l03057"></a>03057          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#4671d62857becc386bbe4cfdc0d96fdc">LOG_EVENT</a>, <span class="stringliteral">"HTTP Manager '%s' logged off from %s\n"</span>, s-&gt;<a class="code" href="structmansession.html#5aec535b6e1a39142c62cb283d7f9268">username</a>, <a class="code" href="utils_8c.html#d5490a9b672272bd2f20ee1e5b72c11e">ast_inet_ntoa</a>(s-&gt;<a class="code" href="structmansession.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_addr));
<a name="l03058"></a>03058       } <span class="keywordflow">else</span> {
<a name="l03059"></a>03059          <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ge36cdd7167e060bff70d00fbd82809eb">option_verbose</a> &gt; 1) {
<a name="l03060"></a>03060             <span class="keywordflow">if</span> (<a class="code" href="group__Group__AMI.html#ga3b408e54a36d8024f4861b84f8648fb">displayconnects</a>)
<a name="l03061"></a>03061                <a class="code" href="logger_8c.html#6a1ef0a194bcc79fccfb662192954477">ast_verbose</a>(<a class="code" href="logger_8h.html#6e3640436a97291b451a8d264b5ab15d">VERBOSE_PREFIX_2</a> <span class="stringliteral">"HTTP Connect attempt from '%s' unable to authenticate\n"</span>, <a class="code" href="utils_8c.html#d5490a9b672272bd2f20ee1e5b72c11e">ast_inet_ntoa</a>(s-&gt;<a class="code" href="structmansession.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_addr));
<a name="l03062"></a>03062          }
<a name="l03063"></a>03063          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#4671d62857becc386bbe4cfdc0d96fdc">LOG_EVENT</a>, <span class="stringliteral">"HTTP Failed attempt from %s\n"</span>, <a class="code" href="utils_8c.html#d5490a9b672272bd2f20ee1e5b72c11e">ast_inet_ntoa</a>(s-&gt;<a class="code" href="structmansession.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_addr));
<a name="l03064"></a>03064       }
<a name="l03065"></a>03065       s-&gt;<a class="code" href="structmansession.html#550961e9c744e38a27b28e50d66f595d">needdestroy</a> = 1;
<a name="l03066"></a>03066    }
<a name="l03067"></a>03067 
<a name="l03068"></a>03068    <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(&amp;out, 0,
<a name="l03069"></a>03069              <span class="stringliteral">"Content-type: text/%s\r\n"</span>
<a name="l03070"></a>03070              <span class="stringliteral">"Cache-Control: no-cache;\r\n"</span>
<a name="l03071"></a>03071              <span class="stringliteral">"Set-Cookie: mansession_id=\"%08lx\"; Version=\"1\"; Max-Age=%d\r\n"</span>
<a name="l03072"></a>03072              <span class="stringliteral">"\r\n"</span>,
<a name="l03073"></a>03073          <a class="code" href="manager_8c.html#a89f2caaaac4606099b86e300edf06de">contenttype</a>[<a class="code" href="chan__alsa_8c.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a>],
<a name="l03074"></a>03074          s-&gt;<a class="code" href="structmansession.html#5eb0038a1d93de54c255dc46dcd40c66">managerid</a>, <a class="code" href="group__Group__AMI.html#gff966934ba065051f34a94a400e43b17">httptimeout</a>);
<a name="l03075"></a>03075 
<a name="l03076"></a>03076    <span class="keywordflow">if</span> (<a class="code" href="chan__alsa_8c.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a> == <a class="code" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b79662bb8a01203e653f85d8e19d4ed3c3">FORMAT_XML</a>) {
<a name="l03077"></a>03077       <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(&amp;out, 0, <span class="stringliteral">"&lt;ajax-response&gt;\n"</span>);
<a name="l03078"></a>03078    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="chan__alsa_8c.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a> == <a class="code" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b76c694e73146f86874cd23ec4940be5d7">FORMAT_HTML</a>) {
<a name="l03079"></a>03079 
<a name="l03080"></a>03080 <span class="preprocessor">#define ROW_FMT   "&lt;tr&gt;&lt;td colspan=\"2\" bgcolor=\"#f1f1ff\"&gt;%s&lt;/td&gt;&lt;/tr&gt;\r\n"</span>
<a name="l03081"></a>03081 <span class="preprocessor"></span><span class="preprocessor">#define TEST_STRING \</span>
<a name="l03082"></a>03082 <span class="preprocessor">   "&lt;form action=\"manager\"&gt;action: &lt;input name=\"action\"&gt; cmd &lt;input name=\"command\"&gt;&lt;br&gt; \</span>
<a name="l03083"></a>03083 <span class="preprocessor">   user &lt;input name=\"username\"&gt; pass &lt;input type=\"password\" name=\"secret\"&gt;&lt;br&gt; \</span>
<a name="l03084"></a>03084 <span class="preprocessor">   &lt;input type=\"submit\"&gt;&lt;/form&gt;"</span>
<a name="l03085"></a>03085 <span class="preprocessor"></span>
<a name="l03086"></a>03086       <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(&amp;out, 0, <span class="stringliteral">"&lt;title&gt;Asterisk&amp;trade; Manager Interface&lt;/title&gt;"</span>);
<a name="l03087"></a>03087       <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(&amp;out, 0, <span class="stringliteral">"&lt;body bgcolor=\"#ffffff\"&gt;&lt;table align=center bgcolor=\"#f1f1f1\" width=\"500\"&gt;\r\n"</span>);
<a name="l03088"></a>03088       <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(&amp;out, 0, ROW_FMT, <span class="stringliteral">"&lt;h1&gt;Manager Tester&lt;/h1&gt;"</span>);
<a name="l03089"></a>03089       <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(&amp;out, 0, ROW_FMT, TEST_STRING);
<a name="l03090"></a>03090    }
<a name="l03091"></a>03091 
<a name="l03092"></a>03092    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structmansession.html#8fa14cdd754f91cc6554c9e71929cce7">f</a> != NULL) {  <span class="comment">/* have temporary output */</span>
<a name="l03093"></a>03093       <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>;
<a name="l03094"></a>03094       size_t l = ftell(s-&gt;<a class="code" href="structmansession.html#8fa14cdd754f91cc6554c9e71929cce7">f</a>);
<a name="l03095"></a>03095       
<a name="l03096"></a>03096       <span class="keywordflow">if</span> (l) {
<a name="l03097"></a>03097          <span class="keywordflow">if</span> ((buf = mmap(NULL, l, PROT_READ | PROT_WRITE, MAP_SHARED, s-&gt;<a class="code" href="structmansession.html#36eba1e1e343279857ea7f69a597324e">fd</a>, 0))) {
<a name="l03098"></a>03098             <span class="keywordflow">if</span> (<a class="code" href="chan__alsa_8c.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a> == <a class="code" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b79662bb8a01203e653f85d8e19d4ed3c3">FORMAT_XML</a> || <a class="code" href="chan__alsa_8c.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a> == <a class="code" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b76c694e73146f86874cd23ec4940be5d7">FORMAT_HTML</a>)
<a name="l03099"></a>03099                <a class="code" href="manager_8c.html#645ff123f7ab62c33c2c22d620e044bb">xml_translate</a>(&amp;out, buf, params, <a class="code" href="chan__alsa_8c.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a>);
<a name="l03100"></a>03100             <span class="keywordflow">else</span>
<a name="l03101"></a>03101                <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(&amp;out, 0, buf);
<a name="l03102"></a>03102             munmap(buf, l);
<a name="l03103"></a>03103          }
<a name="l03104"></a>03104       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="chan__alsa_8c.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a> == <a class="code" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b79662bb8a01203e653f85d8e19d4ed3c3">FORMAT_XML</a> || <a class="code" href="chan__alsa_8c.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a> == <a class="code" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b76c694e73146f86874cd23ec4940be5d7">FORMAT_HTML</a>) {
<a name="l03105"></a>03105          <a class="code" href="manager_8c.html#645ff123f7ab62c33c2c22d620e044bb">xml_translate</a>(&amp;out, <span class="stringliteral">""</span>, params, <a class="code" href="chan__alsa_8c.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a>);
<a name="l03106"></a>03106       }
<a name="l03107"></a>03107       fclose(s-&gt;<a class="code" href="structmansession.html#8fa14cdd754f91cc6554c9e71929cce7">f</a>);
<a name="l03108"></a>03108       s-&gt;<a class="code" href="structmansession.html#8fa14cdd754f91cc6554c9e71929cce7">f</a> = NULL;
<a name="l03109"></a>03109       s-&gt;<a class="code" href="structmansession.html#36eba1e1e343279857ea7f69a597324e">fd</a> = -1;
<a name="l03110"></a>03110    }
<a name="l03111"></a>03111 
<a name="l03112"></a>03112    <span class="keywordflow">if</span> (<a class="code" href="chan__alsa_8c.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a> == <a class="code" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b79662bb8a01203e653f85d8e19d4ed3c3">FORMAT_XML</a>) {
<a name="l03113"></a>03113       <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(&amp;out, 0, <span class="stringliteral">"&lt;/ajax-response&gt;\n"</span>);
<a name="l03114"></a>03114    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="chan__alsa_8c.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a> == <a class="code" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b76c694e73146f86874cd23ec4940be5d7">FORMAT_HTML</a>)
<a name="l03115"></a>03115       <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(&amp;out, 0, <span class="stringliteral">"&lt;/table&gt;&lt;/body&gt;\r\n"</span>);
<a name="l03116"></a>03116 
<a name="l03117"></a>03117    <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l03118"></a>03118    <span class="comment">/* Reset HTTP timeout.  If we're not authenticated, keep it extremely short */</span>
<a name="l03119"></a>03119    s-&gt;<a class="code" href="structmansession.html#cc09d7a7585e6c67ce40707760dd8ba2">sessiontimeout</a> = time(NULL) + ((s-&gt;<a class="code" href="structmansession.html#700633a1b0f65fa8456a18bd6053193c">authenticated</a> || <a class="code" href="group__Group__AMI.html#gff966934ba065051f34a94a400e43b17">httptimeout</a> &lt; 5) ? <a class="code" href="group__Group__AMI.html#gff966934ba065051f34a94a400e43b17">httptimeout</a> : 5);
<a name="l03120"></a>03120 
<a name="l03121"></a>03121    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structmansession.html#550961e9c744e38a27b28e50d66f595d">needdestroy</a>) {
<a name="l03122"></a>03122       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structmansession.html#9ac84af00bd68fa1e4441a101c6b6305">inuse</a> == 1) {
<a name="l03123"></a>03123          <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a>)
<a name="l03124"></a>03124             <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"Need destroy, doing it now!\n"</span>);
<a name="l03125"></a>03125          blastaway = 1;
<a name="l03126"></a>03126       } <span class="keywordflow">else</span> {
<a name="l03127"></a>03127          <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a>)
<a name="l03128"></a>03128             <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"Need destroy, but can't do it yet!\n"</span>);
<a name="l03129"></a>03129          <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structmansession.html#6ab67d39209330f594dbe0828ca5ac80">waiting_thread</a> != <a class="code" href="lock_8h.html#84e4b34008de83ea9d1fa44057758022">AST_PTHREADT_NULL</a>)
<a name="l03130"></a>03130             pthread_kill(s-&gt;<a class="code" href="structmansession.html#6ab67d39209330f594dbe0828ca5ac80">waiting_thread</a>, SIGURG);
<a name="l03131"></a>03131          s-&gt;<a class="code" href="structmansession.html#9ac84af00bd68fa1e4441a101c6b6305">inuse</a>--;
<a name="l03132"></a>03132       }
<a name="l03133"></a>03133    } <span class="keywordflow">else</span>
<a name="l03134"></a>03134       s-&gt;<a class="code" href="structmansession.html#9ac84af00bd68fa1e4441a101c6b6305">inuse</a>--;
<a name="l03135"></a>03135    <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l03136"></a>03136 
<a name="l03137"></a>03137    <span class="keywordflow">if</span> (blastaway)
<a name="l03138"></a>03138       <a class="code" href="group__Group__AMI.html#g2748014a620509eb30d57cd01d0218ce">destroy_session</a>(s);
<a name="l03139"></a>03139 generic_callback_out:
<a name="l03140"></a>03140    <span class="keywordflow">if</span> (*status != 200)
<a name="l03141"></a>03141       <span class="keywordflow">return</span> <a class="code" href="http_8c.html#d2f8473f573a2c0dd699a68d1ff970ef">ast_http_error</a>(500, <span class="stringliteral">"Server Error"</span>, NULL, <span class="stringliteral">"Internal Server Error (out of memory)\n"</span>);
<a name="l03142"></a>03142    <span class="keywordflow">return</span> out;
<a name="l03143"></a>03143 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="31a28c522e71a1df85feb1926f943821"></a><!-- doxytag: member="manager.c::init_manager" ref="31a28c522e71a1df85feb1926f943821" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int init_manager           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Called by Asterisk initialization 
<p>
Definition at line <a class="el" href="manager_8c-source.html#l03215">3215</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l01458">action_challenge()</a>, <a class="el" href="manager_8c-source.html#l01797">action_command()</a>, <a class="el" href="manager_8c-source.html#l02200">action_coresettings()</a>, <a class="el" href="manager_8c-source.html#l02244">action_corestatus()</a>, <a class="el" href="manager_8c-source.html#l01416">action_events()</a>, <a class="el" href="manager_8c-source.html#l02085">action_extensionstate()</a>, <a class="el" href="manager_8c-source.html#l01065">action_getconfig()</a>, <a class="el" href="manager_8c-source.html#l01114">action_getconfigjson()</a>, <a class="el" href="manager_8c-source.html#l01548">action_getvar()</a>, <a class="el" href="manager_8c-source.html#l01480">action_hangup()</a>, <a class="el" href="manager_8c-source.html#l01392">action_listcommands()</a>, <a class="el" href="manager_8c-source.html#l01440">action_login()</a>, <a class="el" href="manager_8c-source.html#l01434">action_logoff()</a>, <a class="el" href="manager_8c-source.html#l02054">action_mailboxcount()</a>, <a class="el" href="manager_8c-source.html#l02026">action_mailboxstatus()</a>, <a class="el" href="manager_8c-source.html#l01912">action_originate()</a>, <a class="el" href="manager_8c-source.html#l01053">action_ping()</a>, <a class="el" href="manager_8c-source.html#l01726">action_redirect()</a>, <a class="el" href="manager_8c-source.html#l01681">action_sendtext()</a>, <a class="el" href="manager_8c-source.html#l01506">action_setvar()</a>, <a class="el" href="manager_8c-source.html#l01587">action_status()</a>, <a class="el" href="manager_8c-source.html#l02116">action_timeout()</a>, <a class="el" href="manager_8c-source.html#l01251">action_updateconfig()</a>, <a class="el" href="manager_8c-source.html#l02176">action_userevent()</a>, <a class="el" href="manager_8c-source.html#l01291">action_waitevent()</a>, <a class="el" href="chan__skinny_8c-source.html#l00759">ahp</a>, <a class="el" href="manager_8c-source.html#l00114">allowmultiplelogin</a>, <a class="el" href="manager_8c-source.html#l02536">append_event()</a>, <a class="el" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>, <a class="el" href="config_8c-source.html#l00357">ast_category_browse()</a>, <a class="el" href="http_8h-source.html#l00067">AST_CERTFILE</a>, <a class="el" href="cli_8c-source.html#l01352">ast_cli_register_multiple()</a>, <a class="el" href="config_8c-source.html#l00555">ast_config_destroy()</a>, <a class="el" href="config_8c-source.html#l01278">ast_config_load()</a>, <a class="el" href="pbx_8c-source.html#l01964">ast_extension_state_add()</a>, <a class="el" href="utils_8c-source.html#l00182">ast_gethostbyname()</a>, <a class="el" href="http_8c-source.html#l00311">ast_http_uri_link()</a>, <a class="el" href="http_8c-source.html#l00340">ast_http_uri_unlink()</a>, <a class="el" href="linkedlists_8h-source.html#l00670">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00516">AST_LIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h-source.html#l00491">AST_LIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h-source.html#l00554">AST_LIST_TRAVERSE_SAFE_END</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="manager_8h-source.html#l00116">ast_manager_register</a>, <a class="el" href="manager_8c-source.html#l02694">ast_manager_register2()</a>, <a class="el" href="utils_8h.html#d67aacdb581292a9d103cf349d0d2862">ast_strdup</a>, <a class="el" href="utils_8c-source.html#l00724">ast_true()</a>, <a class="el" href="config_8c-source.html#l00222">ast_variable_browse()</a>, <a class="el" href="manager_8c-source.html#l00120">block_sockets</a>, <a class="el" href="http_8h-source.html#l00071">tls_config::certfile</a>, <a class="el" href="http_8h-source.html#l00072">tls_config::cipher</a>, <a class="el" href="manager_8h-source.html#l00049">DEFAULT_MANAGER_PORT</a>, <a class="el" href="manager_8c-source.html#l00178">ast_manager_user::deny</a>, <a class="el" href="manager_8c-source.html#l00182">ast_manager_user::displayconnects</a>, <a class="el" href="http_8h-source.html#l00070">tls_config::enabled</a>, <a class="el" href="manager_8h-source.html#l00052">EVENT_FLAG_CALL</a>, <a class="el" href="manager_8h-source.html#l00055">EVENT_FLAG_COMMAND</a>, <a class="el" href="manager_8h-source.html#l00058">EVENT_FLAG_CONFIG</a>, <a class="el" href="manager_8h-source.html#l00051">EVENT_FLAG_SYSTEM</a>, <a class="el" href="manager_8h-source.html#l00057">EVENT_FLAG_USER</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="manager_8c-source.html#l00445">get_manager_by_name_locked()</a>, <a class="el" href="chan__skinny_8c-source.html#l00760">hp</a>, <a class="el" href="manager_8c-source.html#l00116">httptimeout</a>, <a class="el" href="manager_8c-source.html#l00183">ast_manager_user::keep</a>, <a class="el" href="logger_8h-source.html#l00094">LOG_DEBUG</a>, <a class="el" href="logger_8h-source.html#l00106">LOG_NOTICE</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="manager_8c-source.html#l00123">manager_debug</a>, <a class="el" href="manager_8c-source.html#l00117">manager_enabled</a>, <a class="el" href="manager_8c-source.html#l02654">manager_state_cb()</a>, <a class="el" href="config_8h-source.html#l00039">ast_variable::name</a>, <a class="el" href="config_8h-source.html#l00046">ast_variable::next</a>, <a class="el" href="asterisk_8c-source.html#l00164">option_debug</a>, <a class="el" href="manager_8c-source.html#l00179">ast_manager_user::permit</a>, <a class="el" href="manager_8c-source.html#l00180">ast_manager_user::read</a>, <a class="el" href="manager_8c-source.html#l00177">ast_manager_user::secret</a>, <a class="el" href="http_8c-source.html#l00987">server_start()</a>, <a class="el" href="http_8h-source.html#l00122">server_args::sin</a>, <a class="el" href="http_8c-source.html#l00948">ssl_setup()</a>, <a class="el" href="manager_8c-source.html#l00115">timestampevents</a>, <a class="el" href="http_8h-source.html#l00124">server_args::tls_cfg</a>, <a class="el" href="config_8h-source.html#l00040">ast_variable::value</a>, <a class="el" href="ast__expr2f_8c-source.html#l01417">var</a>, <a class="el" href="manager_8c-source.html#l00118">webmanager_enabled</a>, and <a class="el" href="manager_8c-source.html#l00181">ast_manager_user::write</a>.
<p>
Referenced by <a class="el" href="asterisk_8c-source.html#l02570">main()</a>, and <a class="el" href="manager_8c-source.html#l03442">reload_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l03216"></a>03216 {
<a name="l03217"></a>03217    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg = NULL;
<a name="l03218"></a>03218    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structval.html">val</a>;
<a name="l03219"></a>03219    <span class="keywordtype">char</span> *cat = NULL;
<a name="l03220"></a>03220    <span class="keywordtype">int</span> newhttptimeout = 60;
<a name="l03221"></a>03221    <span class="keywordtype">int</span> have_sslbindaddr = 0;
<a name="l03222"></a>03222    <span class="keyword">struct </span>hostent *<a class="code" href="chan__skinny_8c.html#d2ccda10db94c2b5d51beed10484c025">hp</a>;
<a name="l03223"></a>03223    <span class="keyword">struct </span><a class="code" href="structast__hostent.html">ast_hostent</a> ahp;
<a name="l03224"></a>03224    <span class="keyword">struct </span><a class="code" href="structast__manager__user.html">ast_manager_user</a> *user = NULL;
<a name="l03225"></a>03225    <span class="keyword">struct </span><a class="code" href="structast__variable.html">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#b2145aac704ce76dbe1ac7adac535b23">var</a>;
<a name="l03226"></a>03226 
<a name="l03227"></a>03227    <span class="keywordflow">if</span> (!<a class="code" href="manager_8c.html#a2b8ed9c305b8ea86116b603cca78a97">registered</a>) {
<a name="l03228"></a>03228       <span class="comment">/* Register default actions */</span>
<a name="l03229"></a>03229       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"Ping"</span>, 0, <a class="code" href="group__Group__AMI.html#gbd5ac0feea5a76122c4bb7950f72dba9">action_ping</a>, <span class="stringliteral">"Keepalive command"</span>, <a class="code" href="group__Group__AMI.html#gd19fc2f4e2bf2f2b6e916f370a345957">mandescr_ping</a>);
<a name="l03230"></a>03230       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"Events"</span>, 0, <a class="code" href="group__Group__AMI.html#g77d280f8038dfa2bb4b1ea13569c07df">action_events</a>, <span class="stringliteral">"Control Event Flow"</span>, <a class="code" href="group__Group__AMI.html#gadfa58476f08d0f14e4209140d4ddf57">mandescr_events</a>);
<a name="l03231"></a>03231       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"Logoff"</span>, 0, <a class="code" href="group__Group__AMI.html#g655a6b9be76687e4d0887bffacd41b3d">action_logoff</a>, <span class="stringliteral">"Logoff Manager"</span>, <a class="code" href="group__Group__AMI.html#g4eb25b527bf76f2c94ee7f6a1727706c">mandescr_logoff</a>);
<a name="l03232"></a>03232       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"Login"</span>, 0, <a class="code" href="group__Group__AMI.html#gbd3f1f5c2f6fa1c0db6646c765751566">action_login</a>, <span class="stringliteral">"Login Manager"</span>, NULL);
<a name="l03233"></a>03233       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"Challenge"</span>, 0, <a class="code" href="group__Group__AMI.html#g9ba77c553c77f8cd95e812fc9a3cbf38">action_challenge</a>, <span class="stringliteral">"Generate Challenge for MD5 Auth"</span>, NULL);
<a name="l03234"></a>03234       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"Hangup"</span>, <a class="code" href="manager_8h.html#c81a36aac6503176bd649993386b23e4">EVENT_FLAG_CALL</a>, <a class="code" href="group__Group__AMI.html#gcee30e0477fbe6f85ac98e124a25289d">action_hangup</a>, <span class="stringliteral">"Hangup Channel"</span>, <a class="code" href="group__Group__AMI.html#gcd3c210737ab7a7dea258825b16345a4">mandescr_hangup</a>);
<a name="l03235"></a>03235       <a class="code" href="manager_8h.html#e4738d78136f7a3a390d7729872d206e">ast_manager_register</a>(<span class="stringliteral">"Status"</span>, <a class="code" href="manager_8h.html#c81a36aac6503176bd649993386b23e4">EVENT_FLAG_CALL</a>, <a class="code" href="group__Group__AMI.html#g6a023aadcdeed0f3c8db7756f06a85fe">action_status</a>, <span class="stringliteral">"Lists channel status"</span> );
<a name="l03236"></a>03236       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"Setvar"</span>, <a class="code" href="manager_8h.html#c81a36aac6503176bd649993386b23e4">EVENT_FLAG_CALL</a>, <a class="code" href="group__Group__AMI.html#gff61c40432e7043889c37096ac0560c7">action_setvar</a>, <span class="stringliteral">"Set Channel Variable"</span>, <a class="code" href="group__Group__AMI.html#g011be8a601adfe631d2040fd2b3e347d">mandescr_setvar</a> );
<a name="l03237"></a>03237       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"Getvar"</span>, <a class="code" href="manager_8h.html#c81a36aac6503176bd649993386b23e4">EVENT_FLAG_CALL</a>, <a class="code" href="group__Group__AMI.html#gdb0963bfde8071d731420ac8def41f9e">action_getvar</a>, <span class="stringliteral">"Gets a Channel Variable"</span>, <a class="code" href="group__Group__AMI.html#g7e44f6255d335a2c07e5a08424d9ab47">mandescr_getvar</a> );
<a name="l03238"></a>03238       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"GetConfig"</span>, <a class="code" href="manager_8h.html#31c33938947056ad055258c5c585812c">EVENT_FLAG_CONFIG</a>, <a class="code" href="group__Group__AMI.html#geeb75cf41619f536caffbbef71e3f730">action_getconfig</a>, <span class="stringliteral">"Retrieve configuration"</span>, <a class="code" href="group__Group__AMI.html#g47ba7bebfd930c7ba1797e460b0c261b">mandescr_getconfig</a>);
<a name="l03239"></a>03239       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"GetConfigJSON"</span>, <a class="code" href="manager_8h.html#31c33938947056ad055258c5c585812c">EVENT_FLAG_CONFIG</a>, <a class="code" href="group__Group__AMI.html#g51d0d48508ddb1374a9b28d95b5702d6">action_getconfigjson</a>, <span class="stringliteral">"Retrieve configuration (JSON format)"</span>, <a class="code" href="group__Group__AMI.html#gd3137ad18fefbbb17e1e3848b7423d16">mandescr_getconfigjson</a>);
<a name="l03240"></a>03240       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"UpdateConfig"</span>, <a class="code" href="manager_8h.html#31c33938947056ad055258c5c585812c">EVENT_FLAG_CONFIG</a>, <a class="code" href="group__Group__AMI.html#g2543b90f06c6700af2c68d854b6b4558">action_updateconfig</a>, <span class="stringliteral">"Update basic configuration"</span>, <a class="code" href="group__Group__AMI.html#gb327aa5c1fa62b6a6ea1eff221976639">mandescr_updateconfig</a>);
<a name="l03241"></a>03241       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"Redirect"</span>, <a class="code" href="manager_8h.html#c81a36aac6503176bd649993386b23e4">EVENT_FLAG_CALL</a>, <a class="code" href="group__Group__AMI.html#g0076609fb6806996b6584b7a37870927">action_redirect</a>, <span class="stringliteral">"Redirect (transfer) a call"</span>, <a class="code" href="group__Group__AMI.html#gac91809519e0b430f42ce4cfdf5c5a2a">mandescr_redirect</a> );
<a name="l03242"></a>03242       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"Originate"</span>, <a class="code" href="manager_8h.html#c81a36aac6503176bd649993386b23e4">EVENT_FLAG_CALL</a>, <a class="code" href="group__Group__AMI.html#gd8bc04cda5ffb147cb7c5542d3f8c1ea">action_originate</a>, <span class="stringliteral">"Originate Call"</span>, <a class="code" href="group__Group__AMI.html#gb8d0d86508e429319171f702da06978f">mandescr_originate</a>);
<a name="l03243"></a>03243       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"Command"</span>, <a class="code" href="manager_8h.html#055847dde76185d8491133f37610d68d">EVENT_FLAG_COMMAND</a>, <a class="code" href="group__Group__AMI.html#g6c71a4a16dd2e3115f1235a25a8fdb70">action_command</a>, <span class="stringliteral">"Execute Asterisk CLI Command"</span>, <a class="code" href="group__Group__AMI.html#g7ef45bd71ec09dcb2c7e6b8d6e48e57f">mandescr_command</a> );
<a name="l03244"></a>03244       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"ExtensionState"</span>, <a class="code" href="manager_8h.html#c81a36aac6503176bd649993386b23e4">EVENT_FLAG_CALL</a>, <a class="code" href="group__Group__AMI.html#g58e43ceaccf852d6a41133bc5cfadc13">action_extensionstate</a>, <span class="stringliteral">"Check Extension Status"</span>, <a class="code" href="group__Group__AMI.html#gc23a0e40c449c0ff093ebb890078ccd7">mandescr_extensionstate</a> );
<a name="l03245"></a>03245       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"AbsoluteTimeout"</span>, <a class="code" href="manager_8h.html#c81a36aac6503176bd649993386b23e4">EVENT_FLAG_CALL</a>, <a class="code" href="group__Group__AMI.html#ga8bc516739f567719fd6e75177f08f27">action_timeout</a>, <span class="stringliteral">"Set Absolute Timeout"</span>, <a class="code" href="group__Group__AMI.html#gd5b2a1a9f5c7c824e21d0345f08ad0d4">mandescr_timeout</a> );
<a name="l03246"></a>03246       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"MailboxStatus"</span>, <a class="code" href="manager_8h.html#c81a36aac6503176bd649993386b23e4">EVENT_FLAG_CALL</a>, <a class="code" href="group__Group__AMI.html#g44d5b6b832d95db5bfb983d39e56ee21">action_mailboxstatus</a>, <span class="stringliteral">"Check Mailbox"</span>, <a class="code" href="group__Group__AMI.html#gfbeefe3f5b56dfe8f2379f93f8699b13">mandescr_mailboxstatus</a> );
<a name="l03247"></a>03247       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"MailboxCount"</span>, <a class="code" href="manager_8h.html#c81a36aac6503176bd649993386b23e4">EVENT_FLAG_CALL</a>, <a class="code" href="group__Group__AMI.html#g86017430079df84ea69c923aa234bdcd">action_mailboxcount</a>, <span class="stringliteral">"Check Mailbox Message Count"</span>, <a class="code" href="group__Group__AMI.html#g4c3b52b7ac90a43027758d2aaf218202">mandescr_mailboxcount</a> );
<a name="l03248"></a>03248       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"ListCommands"</span>, 0, <a class="code" href="group__Group__AMI.html#gc47a6ddacfc4e36cfb9ab30e2baf7de0">action_listcommands</a>, <span class="stringliteral">"List available manager commands"</span>, <a class="code" href="group__Group__AMI.html#g8ff25cb8fe76a131a2401ce3e51ee07e">mandescr_listcommands</a>);
<a name="l03249"></a>03249       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"SendText"</span>, <a class="code" href="manager_8h.html#c81a36aac6503176bd649993386b23e4">EVENT_FLAG_CALL</a>, <a class="code" href="group__Group__AMI.html#g250e20c09ed384cd90623cfd01f8b551">action_sendtext</a>, <span class="stringliteral">"Send text message to channel"</span>, <a class="code" href="group__Group__AMI.html#g718ec14078a25254e40cb5ea875d4955">mandescr_sendtext</a>);
<a name="l03250"></a>03250       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"UserEvent"</span>, <a class="code" href="manager_8h.html#87a2ec651ddd1db88b41715162d7a242">EVENT_FLAG_USER</a>, <a class="code" href="group__Group__AMI.html#g81297609484dc4a21d32483e91c8b11d">action_userevent</a>, <span class="stringliteral">"Send an arbitrary event"</span>, <a class="code" href="group__Group__AMI.html#g6c5c4b2a4fc6e25aac2fbc21cbbe12e4">mandescr_userevent</a>);
<a name="l03251"></a>03251       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"WaitEvent"</span>, 0, <a class="code" href="group__Group__AMI.html#g8c03c9dc4ab8279645aa28d8ec5d7290">action_waitevent</a>, <span class="stringliteral">"Wait for an event to occur"</span>, <a class="code" href="group__Group__AMI.html#g5ac7170aaf87a7b17bc4b85f93facd3a">mandescr_waitevent</a>);
<a name="l03252"></a>03252       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"CoreSettings"</span>, <a class="code" href="manager_8h.html#440ebd9d80179402b9cd76c426adb8d2">EVENT_FLAG_SYSTEM</a>, <a class="code" href="group__Group__AMI.html#g4572bba9501a379251e6d7712a077035">action_coresettings</a>, <span class="stringliteral">"Show PBX core settings (version etc)"</span>, <a class="code" href="group__Group__AMI.html#ge402cc29f5a0d8a9001d5071152b1281">mandescr_coresettings</a>);
<a name="l03253"></a>03253       <a class="code" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a>(<span class="stringliteral">"CoreStatus"</span>, <a class="code" href="manager_8h.html#440ebd9d80179402b9cd76c426adb8d2">EVENT_FLAG_SYSTEM</a>, <a class="code" href="group__Group__AMI.html#g48f94483856e54f9d016fd4e00963a5c">action_corestatus</a>, <span class="stringliteral">"Show PBX core status variables"</span>, <a class="code" href="group__Group__AMI.html#g54e903fbbc11dec18a6971c0b9f89df1">mandescr_corestatus</a>);
<a name="l03254"></a>03254 
<a name="l03255"></a>03255       <a class="code" href="cli_8c.html#a334dfd903e83eea3729ff37aa372781">ast_cli_register_multiple</a>(<a class="code" href="group__Group__AMI.html#gc63528124b8cf02a55bec42906b204ca">cli_manager</a>, <span class="keyword">sizeof</span>(<a class="code" href="group__Group__AMI.html#gc63528124b8cf02a55bec42906b204ca">cli_manager</a>) / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html">ast_cli_entry</a>));
<a name="l03256"></a>03256       <a class="code" href="pbx_8c.html#14f63100164300fc4b55b09d6c3474fd">ast_extension_state_add</a>(NULL, NULL, <a class="code" href="group__Group__AMI.html#gff6bb88658011308f835d9278cf7f4b5">manager_state_cb</a>, NULL);
<a name="l03257"></a>03257       <a class="code" href="manager_8c.html#a2b8ed9c305b8ea86116b603cca78a97">registered</a> = 1;
<a name="l03258"></a>03258       <span class="comment">/* Append placeholder event so master_eventq never runs dry */</span>
<a name="l03259"></a>03259       <a class="code" href="group__Group__AMI.html#g38726448f966fa5ad7aaa3141ba16235">append_event</a>(<span class="stringliteral">"Event: Placeholder\r\n\r\n"</span>, 0);
<a name="l03260"></a>03260    }
<a name="l03261"></a>03261    <a class="code" href="group__Group__AMI.html#ga3b408e54a36d8024f4861b84f8648fb">displayconnects</a> = 1;
<a name="l03262"></a>03262    cfg = <a class="code" href="config_8c.html#0ea8bde5422fa0db50302e0f710e18c1">ast_config_load</a>(<span class="stringliteral">"manager.conf"</span>);
<a name="l03263"></a>03263    <span class="keywordflow">if</span> (!cfg) {
<a name="l03264"></a>03264       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#bbf95aad74d847cd4bcb129604f798cd">LOG_NOTICE</a>, <span class="stringliteral">"Unable to open management configuration manager.conf.  Call management disabled.\n"</span>);
<a name="l03265"></a>03265       <span class="keywordflow">return</span> 0;
<a name="l03266"></a>03266    }
<a name="l03267"></a>03267 
<a name="l03268"></a>03268    <span class="comment">/* default values */</span>
<a name="l03269"></a>03269    memset(&amp;<a class="code" href="manager_8c.html#300cdb1a12b392413a97b68c6e659d08">ami_desc</a>.<a class="code" href="structserver__args.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_in));
<a name="l03270"></a>03270    memset(&amp;<a class="code" href="manager_8c.html#d60178c503bef15cc7591c2c82a11fe7">amis_desc</a>.<a class="code" href="structserver__args.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="manager_8c.html#d60178c503bef15cc7591c2c82a11fe7">amis_desc</a>.<a class="code" href="structserver__args.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>));
<a name="l03271"></a>03271    <a class="code" href="manager_8c.html#d60178c503bef15cc7591c2c82a11fe7">amis_desc</a>.<a class="code" href="structserver__args.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_port = htons(5039);
<a name="l03272"></a>03272    <a class="code" href="manager_8c.html#300cdb1a12b392413a97b68c6e659d08">ami_desc</a>.<a class="code" href="structserver__args.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_port = htons(<a class="code" href="manager_8h.html#46c656f1ee5c96c2595d976973a96b7d">DEFAULT_MANAGER_PORT</a>);
<a name="l03273"></a>03273 
<a name="l03274"></a>03274    <a class="code" href="manager_8c.html#1d13b7f019c0c316c9b46d22c8dbd337">ami_tls_cfg</a>.<a class="code" href="structtls__config.html#a10311459433adf322f2590a4987c423">enabled</a> = 0;
<a name="l03275"></a>03275    <span class="keywordflow">if</span> (<a class="code" href="manager_8c.html#1d13b7f019c0c316c9b46d22c8dbd337">ami_tls_cfg</a>.<a class="code" href="structtls__config.html#b239093132d939820c54744c1ca8bb55">certfile</a>)
<a name="l03276"></a>03276       <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(<a class="code" href="manager_8c.html#1d13b7f019c0c316c9b46d22c8dbd337">ami_tls_cfg</a>.<a class="code" href="structtls__config.html#b239093132d939820c54744c1ca8bb55">certfile</a>);
<a name="l03277"></a>03277    <a class="code" href="manager_8c.html#1d13b7f019c0c316c9b46d22c8dbd337">ami_tls_cfg</a>.<a class="code" href="structtls__config.html#b239093132d939820c54744c1ca8bb55">certfile</a> = <a class="code" href="utils_8h.html#d67aacdb581292a9d103cf349d0d2862">ast_strdup</a>(<a class="code" href="http_8h.html#681deafbde5165912b512a6dfc3a4cbc">AST_CERTFILE</a>);
<a name="l03278"></a>03278    <span class="keywordflow">if</span> (<a class="code" href="manager_8c.html#1d13b7f019c0c316c9b46d22c8dbd337">ami_tls_cfg</a>.<a class="code" href="structtls__config.html#08406a6e18bdf83010ddd1187251454d">cipher</a>)
<a name="l03279"></a>03279       <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(<a class="code" href="manager_8c.html#1d13b7f019c0c316c9b46d22c8dbd337">ami_tls_cfg</a>.<a class="code" href="structtls__config.html#08406a6e18bdf83010ddd1187251454d">cipher</a>);
<a name="l03280"></a>03280    <a class="code" href="manager_8c.html#1d13b7f019c0c316c9b46d22c8dbd337">ami_tls_cfg</a>.<a class="code" href="structtls__config.html#08406a6e18bdf83010ddd1187251454d">cipher</a> = <a class="code" href="utils_8h.html#d67aacdb581292a9d103cf349d0d2862">ast_strdup</a>(<span class="stringliteral">""</span>);
<a name="l03281"></a>03281 
<a name="l03282"></a>03282    <span class="keywordflow">for</span> (var = <a class="code" href="config_8c.html#65ed813ca973e0e5dd3426804249db4f">ast_variable_browse</a>(cfg, <span class="stringliteral">"general"</span>); var; var = var-&gt;<a class="code" href="structast__variable.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>) {
<a name="l03283"></a>03283       val = var-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>;
<a name="l03284"></a>03284       <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"ssenable"</span>))
<a name="l03285"></a>03285          <a class="code" href="manager_8c.html#1d13b7f019c0c316c9b46d22c8dbd337">ami_tls_cfg</a>.<a class="code" href="structtls__config.html#a10311459433adf322f2590a4987c423">enabled</a> = <a class="code" href="utils_8c.html#63bb02e4d6f18c1dbeca92dc63310685">ast_true</a>(val);
<a name="l03286"></a>03286       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"ssbindport"</span>))
<a name="l03287"></a>03287          <a class="code" href="manager_8c.html#d60178c503bef15cc7591c2c82a11fe7">amis_desc</a>.<a class="code" href="structserver__args.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_port = htons(atoi(val));
<a name="l03288"></a>03288       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"ssbindaddr"</span>)) {
<a name="l03289"></a>03289          <span class="keywordflow">if</span> ((hp = <a class="code" href="utils_8c.html#00f9ad2be8cda9c885557d03568816ec">ast_gethostbyname</a>(val, &amp;ahp))) {
<a name="l03290"></a>03290             memcpy(&amp;<a class="code" href="manager_8c.html#d60178c503bef15cc7591c2c82a11fe7">amis_desc</a>.<a class="code" href="structserver__args.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_addr, hp-&gt;h_addr, <span class="keyword">sizeof</span>(<a class="code" href="manager_8c.html#d60178c503bef15cc7591c2c82a11fe7">amis_desc</a>.<a class="code" href="structserver__args.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_addr));
<a name="l03291"></a>03291             have_sslbindaddr = 1;
<a name="l03292"></a>03292          } <span class="keywordflow">else</span> {
<a name="l03293"></a>03293             <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Invalid bind address '%s'\n"</span>, val);
<a name="l03294"></a>03294          }
<a name="l03295"></a>03295       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"sslcert"</span>)) {
<a name="l03296"></a>03296          <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(<a class="code" href="manager_8c.html#1d13b7f019c0c316c9b46d22c8dbd337">ami_tls_cfg</a>.<a class="code" href="structtls__config.html#b239093132d939820c54744c1ca8bb55">certfile</a>);
<a name="l03297"></a>03297          <a class="code" href="manager_8c.html#1d13b7f019c0c316c9b46d22c8dbd337">ami_tls_cfg</a>.<a class="code" href="structtls__config.html#b239093132d939820c54744c1ca8bb55">certfile</a> = <a class="code" href="utils_8h.html#d67aacdb581292a9d103cf349d0d2862">ast_strdup</a>(val);
<a name="l03298"></a>03298       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"sslcipher"</span>)) {
<a name="l03299"></a>03299          <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(<a class="code" href="manager_8c.html#1d13b7f019c0c316c9b46d22c8dbd337">ami_tls_cfg</a>.<a class="code" href="structtls__config.html#08406a6e18bdf83010ddd1187251454d">cipher</a>);
<a name="l03300"></a>03300          <a class="code" href="manager_8c.html#1d13b7f019c0c316c9b46d22c8dbd337">ami_tls_cfg</a>.<a class="code" href="structtls__config.html#08406a6e18bdf83010ddd1187251454d">cipher</a> = <a class="code" href="utils_8h.html#d67aacdb581292a9d103cf349d0d2862">ast_strdup</a>(val);
<a name="l03301"></a>03301       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"enabled"</span>)) {
<a name="l03302"></a>03302          <a class="code" href="group__Group__AMI.html#g7fa4f9f44eb840da897cd6df25e71ea4">manager_enabled</a> = <a class="code" href="utils_8c.html#63bb02e4d6f18c1dbeca92dc63310685">ast_true</a>(val);
<a name="l03303"></a>03303       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"block-sockets"</span>)) {
<a name="l03304"></a>03304          <a class="code" href="group__Group__AMI.html#g58780e565b16019054545fbf6ba26a24">block_sockets</a> = <a class="code" href="utils_8c.html#63bb02e4d6f18c1dbeca92dc63310685">ast_true</a>(val);
<a name="l03305"></a>03305       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"webenabled"</span>)) {
<a name="l03306"></a>03306          <a class="code" href="group__Group__AMI.html#ge48c16ca333fc1529958ca58131fd875">webmanager_enabled</a> = <a class="code" href="utils_8c.html#63bb02e4d6f18c1dbeca92dc63310685">ast_true</a>(val);
<a name="l03307"></a>03307       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"port"</span>)) {
<a name="l03308"></a>03308          <a class="code" href="manager_8c.html#300cdb1a12b392413a97b68c6e659d08">ami_desc</a>.<a class="code" href="structserver__args.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_port = htons(atoi(val));
<a name="l03309"></a>03309       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"bindaddr"</span>)) {
<a name="l03310"></a>03310          <span class="keywordflow">if</span> (!inet_aton(val, &amp;<a class="code" href="manager_8c.html#300cdb1a12b392413a97b68c6e659d08">ami_desc</a>.<a class="code" href="structserver__args.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_addr)) {
<a name="l03311"></a>03311             <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Invalid address '%s' specified, using 0.0.0.0\n"</span>, val);
<a name="l03312"></a>03312             memset(&amp;<a class="code" href="manager_8c.html#300cdb1a12b392413a97b68c6e659d08">ami_desc</a>.<a class="code" href="structserver__args.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_addr, 0, <span class="keyword">sizeof</span>(<a class="code" href="manager_8c.html#300cdb1a12b392413a97b68c6e659d08">ami_desc</a>.<a class="code" href="structserver__args.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_addr));
<a name="l03313"></a>03313          }
<a name="l03314"></a>03314       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"allowmultiplelogin"</span>)) { 
<a name="l03315"></a>03315          <a class="code" href="group__Group__AMI.html#g96f294e808841cbd886011c9d0192687">allowmultiplelogin</a> = <a class="code" href="utils_8c.html#63bb02e4d6f18c1dbeca92dc63310685">ast_true</a>(val);
<a name="l03316"></a>03316       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"displayconnects"</span>)) {
<a name="l03317"></a>03317          <a class="code" href="group__Group__AMI.html#ga3b408e54a36d8024f4861b84f8648fb">displayconnects</a> = <a class="code" href="utils_8c.html#63bb02e4d6f18c1dbeca92dc63310685">ast_true</a>(val);
<a name="l03318"></a>03318       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"timestampevents"</span>)) {
<a name="l03319"></a>03319          <a class="code" href="group__Group__AMI.html#g846e7158f3a1a166b993bbea7e34c1e0">timestampevents</a> = <a class="code" href="utils_8c.html#63bb02e4d6f18c1dbeca92dc63310685">ast_true</a>(val);
<a name="l03320"></a>03320       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"debug"</span>)) {
<a name="l03321"></a>03321          <a class="code" href="group__Group__AMI.html#g065d88d3234671acf0f5980f9228b827">manager_debug</a> = <a class="code" href="utils_8c.html#63bb02e4d6f18c1dbeca92dc63310685">ast_true</a>(val);
<a name="l03322"></a>03322       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"httptimeout"</span>)) {
<a name="l03323"></a>03323          newhttptimeout = atoi(val);
<a name="l03324"></a>03324       } <span class="keywordflow">else</span> {
<a name="l03325"></a>03325          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#bbf95aad74d847cd4bcb129604f798cd">LOG_NOTICE</a>, <span class="stringliteral">"Invalid keyword &lt;%s&gt; = &lt;%s&gt; in manager.conf [general]\n"</span>,
<a name="l03326"></a>03326             var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, val);
<a name="l03327"></a>03327       }  
<a name="l03328"></a>03328    }
<a name="l03329"></a>03329 
<a name="l03330"></a>03330    <span class="keywordflow">if</span> (<a class="code" href="group__Group__AMI.html#g7fa4f9f44eb840da897cd6df25e71ea4">manager_enabled</a>)
<a name="l03331"></a>03331       <a class="code" href="manager_8c.html#300cdb1a12b392413a97b68c6e659d08">ami_desc</a>.<a class="code" href="structserver__args.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_family = AF_INET;
<a name="l03332"></a>03332    <span class="keywordflow">if</span> (!have_sslbindaddr)
<a name="l03333"></a>03333       <a class="code" href="manager_8c.html#d60178c503bef15cc7591c2c82a11fe7">amis_desc</a>.<a class="code" href="structserver__args.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_addr = <a class="code" href="manager_8c.html#300cdb1a12b392413a97b68c6e659d08">ami_desc</a>.<a class="code" href="structserver__args.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_addr;
<a name="l03334"></a>03334    <span class="keywordflow">if</span> (<a class="code" href="manager_8c.html#1d13b7f019c0c316c9b46d22c8dbd337">ami_tls_cfg</a>.<a class="code" href="structtls__config.html#a10311459433adf322f2590a4987c423">enabled</a>)
<a name="l03335"></a>03335       <a class="code" href="manager_8c.html#d60178c503bef15cc7591c2c82a11fe7">amis_desc</a>.<a class="code" href="structserver__args.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_family = AF_INET;
<a name="l03336"></a>03336 
<a name="l03337"></a>03337    
<a name="l03338"></a>03338    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;users);
<a name="l03339"></a>03339 
<a name="l03340"></a>03340    <span class="keywordflow">while</span> ((cat = <a class="code" href="config_8c.html#38fbac9adb1c1bf165ecce251cb206a8">ast_category_browse</a>(cfg, cat))) {
<a name="l03341"></a>03341 
<a name="l03342"></a>03342       <span class="keywordflow">if</span> (!strcasecmp(cat, <span class="stringliteral">"general"</span>))
<a name="l03343"></a>03343          <span class="keywordflow">continue</span>;
<a name="l03344"></a>03344 
<a name="l03345"></a>03345       <span class="comment">/* Look for an existing entry, if none found - create one and add it to the list */</span>
<a name="l03346"></a>03346       <span class="keywordflow">if</span> (!(user = <a class="code" href="group__Group__AMI.html#gcf9022296a6e52672bd7bf89e570c7e0">get_manager_by_name_locked</a>(cat))) {
<a name="l03347"></a>03347          <span class="keywordflow">if</span> (!(user = <a class="code" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*user))))
<a name="l03348"></a>03348             <span class="keywordflow">break</span>;
<a name="l03349"></a>03349          <span class="comment">/* Copy name over */</span>
<a name="l03350"></a>03350          ast_copy_string(user-&gt;username, cat, <span class="keyword">sizeof</span>(user-&gt;username));
<a name="l03351"></a>03351          <span class="comment">/* Insert into list */</span>
<a name="l03352"></a>03352          <a class="code" href="linkedlists_8h.html#8de6ce8a3b9d59e7e7fddee6b62b32a7">AST_LIST_INSERT_TAIL</a>(&amp;users, user, list);
<a name="l03353"></a>03353       }
<a name="l03354"></a>03354 
<a name="l03355"></a>03355       <span class="comment">/* Make sure we keep this user and don't destroy it during cleanup */</span>
<a name="l03356"></a>03356       user-&gt;<a class="code" href="structast__manager__user.html#18ccf61d533b600bbf5a963359223fe4">keep</a> = 1;
<a name="l03357"></a>03357 
<a name="l03358"></a>03358       var = <a class="code" href="config_8c.html#65ed813ca973e0e5dd3426804249db4f">ast_variable_browse</a>(cfg, cat);
<a name="l03359"></a>03359       <span class="keywordflow">while</span> (var) {
<a name="l03360"></a>03360          <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"secret"</span>)) {
<a name="l03361"></a>03361             <span class="keywordflow">if</span> (user-&gt;<a class="code" href="structast__manager__user.html#5ebe2294ecd0e0f08eab7690d2a6ee69">secret</a>)
<a name="l03362"></a>03362                <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(user-&gt;<a class="code" href="structast__manager__user.html#5ebe2294ecd0e0f08eab7690d2a6ee69">secret</a>);
<a name="l03363"></a>03363             user-&gt;<a class="code" href="structast__manager__user.html#5ebe2294ecd0e0f08eab7690d2a6ee69">secret</a> = <a class="code" href="utils_8h.html#d67aacdb581292a9d103cf349d0d2862">ast_strdup</a>(var-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>);
<a name="l03364"></a>03364          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"deny"</span>) ) {
<a name="l03365"></a>03365             <span class="keywordflow">if</span> (user-&gt;<a class="code" href="structast__manager__user.html#05afb6ce69b9cef1bd6ece7e4745f96c">deny</a>)
<a name="l03366"></a>03366                <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(user-&gt;<a class="code" href="structast__manager__user.html#05afb6ce69b9cef1bd6ece7e4745f96c">deny</a>);
<a name="l03367"></a>03367             user-&gt;<a class="code" href="structast__manager__user.html#05afb6ce69b9cef1bd6ece7e4745f96c">deny</a> = <a class="code" href="utils_8h.html#d67aacdb581292a9d103cf349d0d2862">ast_strdup</a>(var-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>);
<a name="l03368"></a>03368          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"permit"</span>) ) {
<a name="l03369"></a>03369             <span class="keywordflow">if</span> (user-&gt;<a class="code" href="structast__manager__user.html#0931be4cc434934e64b1894aa2dba1ae">permit</a>)
<a name="l03370"></a>03370                <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(user-&gt;<a class="code" href="structast__manager__user.html#0931be4cc434934e64b1894aa2dba1ae">permit</a>);
<a name="l03371"></a>03371             user-&gt;<a class="code" href="structast__manager__user.html#0931be4cc434934e64b1894aa2dba1ae">permit</a> = <a class="code" href="utils_8h.html#d67aacdb581292a9d103cf349d0d2862">ast_strdup</a>(var-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>);
<a name="l03372"></a>03372          }  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"read"</span>) ) {
<a name="l03373"></a>03373             <span class="keywordflow">if</span> (user-&gt;<a class="code" href="structast__manager__user.html#ecae13117d6f0584c25a9da6c8f8415e">read</a>)
<a name="l03374"></a>03374                <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(user-&gt;<a class="code" href="structast__manager__user.html#ecae13117d6f0584c25a9da6c8f8415e">read</a>);
<a name="l03375"></a>03375             user-&gt;<a class="code" href="structast__manager__user.html#ecae13117d6f0584c25a9da6c8f8415e">read</a> = <a class="code" href="utils_8h.html#d67aacdb581292a9d103cf349d0d2862">ast_strdup</a>(var-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>);
<a name="l03376"></a>03376          }  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"write"</span>) ) {
<a name="l03377"></a>03377             <span class="keywordflow">if</span> (user-&gt;<a class="code" href="structast__manager__user.html#efb2a684e4afb7d55e6147fbe5a332ee">write</a>)
<a name="l03378"></a>03378                <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(user-&gt;<a class="code" href="structast__manager__user.html#efb2a684e4afb7d55e6147fbe5a332ee">write</a>);
<a name="l03379"></a>03379             user-&gt;<a class="code" href="structast__manager__user.html#efb2a684e4afb7d55e6147fbe5a332ee">write</a> = <a class="code" href="utils_8h.html#d67aacdb581292a9d103cf349d0d2862">ast_strdup</a>(var-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>);
<a name="l03380"></a>03380          }  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"displayconnects"</span>) )
<a name="l03381"></a>03381             user-&gt;<a class="code" href="structast__manager__user.html#a3b408e54a36d8024f4861b84f8648fb">displayconnects</a> = <a class="code" href="utils_8c.html#63bb02e4d6f18c1dbeca92dc63310685">ast_true</a>(var-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>);
<a name="l03382"></a>03382          <span class="keywordflow">else</span> {
<a name="l03383"></a>03383             <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a>)
<a name="l03384"></a>03384                <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"%s is an unknown option.\n"</span>, var-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>);
<a name="l03385"></a>03385          }
<a name="l03386"></a>03386          var = var-&gt;<a class="code" href="structast__variable.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>;
<a name="l03387"></a>03387       }
<a name="l03388"></a>03388    }
<a name="l03389"></a>03389 
<a name="l03390"></a>03390    <span class="comment">/* Perform cleanup - essentially prune out old users that no longer exist */</span>
<a name="l03391"></a>03391    <a class="code" href="linkedlists_8h.html#915e438a9528c8d6316c617b5bd84487">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;users, user, list) {
<a name="l03392"></a>03392       <span class="keywordflow">if</span> (user-&gt;<a class="code" href="structast__manager__user.html#18ccf61d533b600bbf5a963359223fe4">keep</a>) { <span class="comment">/* valid record. clear flag for the next round */</span>
<a name="l03393"></a>03393          user-&gt;<a class="code" href="structast__manager__user.html#18ccf61d533b600bbf5a963359223fe4">keep</a> = 0;
<a name="l03394"></a>03394          <span class="keywordflow">continue</span>;
<a name="l03395"></a>03395       }
<a name="l03396"></a>03396       <span class="comment">/* We do not need to keep this user so take them out of the list */</span>
<a name="l03397"></a>03397       <a class="code" href="linkedlists_8h.html#37f99379dafa45c921f95bf7235eb91d">AST_LIST_REMOVE_CURRENT</a>(&amp;users, list);
<a name="l03398"></a>03398       <span class="comment">/* Free their memory now */</span>
<a name="l03399"></a>03399       <span class="keywordflow">if</span> (user-&gt;<a class="code" href="structast__manager__user.html#5ebe2294ecd0e0f08eab7690d2a6ee69">secret</a>)
<a name="l03400"></a>03400          <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(user-&gt;<a class="code" href="structast__manager__user.html#5ebe2294ecd0e0f08eab7690d2a6ee69">secret</a>);
<a name="l03401"></a>03401       <span class="keywordflow">if</span> (user-&gt;<a class="code" href="structast__manager__user.html#05afb6ce69b9cef1bd6ece7e4745f96c">deny</a>)
<a name="l03402"></a>03402          <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(user-&gt;<a class="code" href="structast__manager__user.html#05afb6ce69b9cef1bd6ece7e4745f96c">deny</a>);
<a name="l03403"></a>03403       <span class="keywordflow">if</span> (user-&gt;<a class="code" href="structast__manager__user.html#0931be4cc434934e64b1894aa2dba1ae">permit</a>)
<a name="l03404"></a>03404          <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(user-&gt;<a class="code" href="structast__manager__user.html#0931be4cc434934e64b1894aa2dba1ae">permit</a>);
<a name="l03405"></a>03405       <span class="keywordflow">if</span> (user-&gt;<a class="code" href="structast__manager__user.html#ecae13117d6f0584c25a9da6c8f8415e">read</a>)
<a name="l03406"></a>03406          <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(user-&gt;<a class="code" href="structast__manager__user.html#ecae13117d6f0584c25a9da6c8f8415e">read</a>);
<a name="l03407"></a>03407       <span class="keywordflow">if</span> (user-&gt;<a class="code" href="structast__manager__user.html#efb2a684e4afb7d55e6147fbe5a332ee">write</a>)
<a name="l03408"></a>03408          <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(user-&gt;<a class="code" href="structast__manager__user.html#efb2a684e4afb7d55e6147fbe5a332ee">write</a>);
<a name="l03409"></a>03409       <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(user);
<a name="l03410"></a>03410    }
<a name="l03411"></a>03411    <a class="code" href="linkedlists_8h.html#a93fdadc00a2a090968004b7d9c79630">AST_LIST_TRAVERSE_SAFE_END</a>
<a name="l03412"></a>03412 
<a name="l03413"></a>03413    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;users);
<a name="l03414"></a>03414 
<a name="l03415"></a>03415    <a class="code" href="config_8c.html#ad84c9d29ca53758c2a113d057e221a0">ast_config_destroy</a>(cfg);
<a name="l03416"></a>03416 
<a name="l03417"></a>03417    <span class="keywordflow">if</span> (<a class="code" href="group__Group__AMI.html#ge48c16ca333fc1529958ca58131fd875">webmanager_enabled</a> &amp;&amp; <a class="code" href="group__Group__AMI.html#g7fa4f9f44eb840da897cd6df25e71ea4">manager_enabled</a>) {
<a name="l03418"></a>03418       <span class="keywordflow">if</span> (!<a class="code" href="manager_8c.html#9327cfe8492c3330bf4d51ded3e8d1a8">webregged</a>) {
<a name="l03419"></a>03419          <a class="code" href="http_8c.html#6842958ab454952c76e8111211b76e5a">ast_http_uri_link</a>(&amp;<a class="code" href="manager_8c.html#8318a86553fb0a8bdb35f3f61b21eed8">rawmanuri</a>);
<a name="l03420"></a>03420          <a class="code" href="http_8c.html#6842958ab454952c76e8111211b76e5a">ast_http_uri_link</a>(&amp;<a class="code" href="manager_8c.html#813ec6aec886e6bbb6ef9a1b455d78a8">manageruri</a>);
<a name="l03421"></a>03421          <a class="code" href="http_8c.html#6842958ab454952c76e8111211b76e5a">ast_http_uri_link</a>(&amp;<a class="code" href="manager_8c.html#7b55e3a11caef236115e71b9ea5a4304">managerxmluri</a>);
<a name="l03422"></a>03422          <a class="code" href="manager_8c.html#9327cfe8492c3330bf4d51ded3e8d1a8">webregged</a> = 1;
<a name="l03423"></a>03423       }
<a name="l03424"></a>03424    } <span class="keywordflow">else</span> {
<a name="l03425"></a>03425       <span class="keywordflow">if</span> (<a class="code" href="manager_8c.html#9327cfe8492c3330bf4d51ded3e8d1a8">webregged</a>) {
<a name="l03426"></a>03426          <a class="code" href="http_8c.html#8ea490df30f4610a42a214261b1f1e99">ast_http_uri_unlink</a>(&amp;<a class="code" href="manager_8c.html#8318a86553fb0a8bdb35f3f61b21eed8">rawmanuri</a>);
<a name="l03427"></a>03427          <a class="code" href="http_8c.html#8ea490df30f4610a42a214261b1f1e99">ast_http_uri_unlink</a>(&amp;<a class="code" href="manager_8c.html#813ec6aec886e6bbb6ef9a1b455d78a8">manageruri</a>);
<a name="l03428"></a>03428          <a class="code" href="http_8c.html#8ea490df30f4610a42a214261b1f1e99">ast_http_uri_unlink</a>(&amp;<a class="code" href="manager_8c.html#7b55e3a11caef236115e71b9ea5a4304">managerxmluri</a>);
<a name="l03429"></a>03429          <a class="code" href="manager_8c.html#9327cfe8492c3330bf4d51ded3e8d1a8">webregged</a> = 0;
<a name="l03430"></a>03430       }
<a name="l03431"></a>03431    }
<a name="l03432"></a>03432 
<a name="l03433"></a>03433    <span class="keywordflow">if</span> (newhttptimeout &gt; 0)
<a name="l03434"></a>03434       <a class="code" href="group__Group__AMI.html#gff966934ba065051f34a94a400e43b17">httptimeout</a> = newhttptimeout;
<a name="l03435"></a>03435 
<a name="l03436"></a>03436    <a class="code" href="http_8c.html#78825d347437f6b39162f2bb595118fb">server_start</a>(&amp;<a class="code" href="manager_8c.html#300cdb1a12b392413a97b68c6e659d08">ami_desc</a>);
<a name="l03437"></a>03437    <span class="keywordflow">if</span> (<a class="code" href="http_8c.html#099674f856134f6c71303eceb54558dd">ssl_setup</a>(<a class="code" href="manager_8c.html#d60178c503bef15cc7591c2c82a11fe7">amis_desc</a>.<a class="code" href="structserver__args.html#4043ce151e607087eae7215e08cc837d">tls_cfg</a>))
<a name="l03438"></a>03438       <a class="code" href="http_8c.html#78825d347437f6b39162f2bb595118fb">server_start</a>(&amp;<a class="code" href="manager_8c.html#d60178c503bef15cc7591c2c82a11fe7">amis_desc</a>);
<a name="l03439"></a>03439    <span class="keywordflow">return</span> 0;
<a name="l03440"></a>03440 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="9d3f921f1e6cf458c3a2f5cea1c24dc7"></a><!-- doxytag: member="manager.c::manager_http_callback" ref="9d3f921f1e6cf458c3a2f5cea1c24dc7" args="(struct sockaddr_in *requestor, const char *uri, struct ast_variable *params, int *status, char **title, int *contentlength)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static struct <a class="el" href="structast__str.html">ast_str</a>* manager_http_callback           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct sockaddr_in *&nbsp;</td>
          <td class="mdname" nowrap> <em>requestor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>uri</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>params</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>status</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char **&nbsp;</td>
          <td class="mdname" nowrap> <em>title</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>contentlength</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l03145">3145</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b76c694e73146f86874cd23ec4940be5d7">FORMAT_HTML</a>, and <a class="el" href="manager_8c-source.html#l02988">generic_http_callback()</a>.<div class="fragment"><pre class="fragment"><a name="l03146"></a>03146 {
<a name="l03147"></a>03147    <span class="keywordflow">return</span> <a class="code" href="manager_8c.html#d29cc4351fa8d1b4650f737d9bf6a630">generic_http_callback</a>(<a class="code" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b76c694e73146f86874cd23ec4940be5d7">FORMAT_HTML</a>, requestor, uri, params, status, title, contentlength);
<a name="l03148"></a>03148 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="119c80dcebb27185d75f23a60e6c1046"></a><!-- doxytag: member="manager.c::mxml_http_callback" ref="119c80dcebb27185d75f23a60e6c1046" args="(struct sockaddr_in *requestor, const char *uri, struct ast_variable *params, int *status, char **title, int *contentlength)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static struct <a class="el" href="structast__str.html">ast_str</a>* mxml_http_callback           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct sockaddr_in *&nbsp;</td>
          <td class="mdname" nowrap> <em>requestor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>uri</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>params</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>status</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char **&nbsp;</td>
          <td class="mdname" nowrap> <em>title</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>contentlength</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l03150">3150</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b79662bb8a01203e653f85d8e19d4ed3c3">FORMAT_XML</a>, and <a class="el" href="manager_8c-source.html#l02988">generic_http_callback()</a>.<div class="fragment"><pre class="fragment"><a name="l03151"></a>03151 {
<a name="l03152"></a>03152    <span class="keywordflow">return</span> <a class="code" href="manager_8c.html#d29cc4351fa8d1b4650f737d9bf6a630">generic_http_callback</a>(<a class="code" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b79662bb8a01203e653f85d8e19d4ed3c3">FORMAT_XML</a>, requestor, uri, params, status, title, contentlength);
<a name="l03153"></a>03153 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="96788aa2f4896a4c18fb160b2f4c19c6"></a><!-- doxytag: member="manager.c::purge_old_stuff" ref="96788aa2f4896a4c18fb160b2f4c19c6" args="(void *data)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void purge_old_stuff           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>data</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
cleanup code called at each iteration of server_root, guaranteed to happen every 5 seconds at most 
<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l03187">3187</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00290">purge_events()</a>, and <a class="el" href="manager_8c-source.html#l02509">purge_sessions()</a>.<div class="fragment"><pre class="fragment"><a name="l03188"></a>03188 {
<a name="l03189"></a>03189    <a class="code" href="group__Group__AMI.html#g4051b884ed44c7d2b8b79ed1ffb0cd26">purge_sessions</a>(1);
<a name="l03190"></a>03190    <a class="code" href="group__Group__AMI.html#g50cd338ac6ba658c88ad6a7752b556e8">purge_events</a>();
<a name="l03191"></a>03191 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="e1be75554d9d46ab3593321aa97d81de"></a><!-- doxytag: member="manager.c::rawman_http_callback" ref="e1be75554d9d46ab3593321aa97d81de" args="(struct sockaddr_in *requestor, const char *uri, struct ast_variable *params, int *status, char **title, int *contentlength)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static struct <a class="el" href="structast__str.html">ast_str</a>* rawman_http_callback           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct sockaddr_in *&nbsp;</td>
          <td class="mdname" nowrap> <em>requestor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>uri</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>params</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>status</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char **&nbsp;</td>
          <td class="mdname" nowrap> <em>title</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>contentlength</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l03155">3155</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b76e6d9740a556bec5c9d2165c11a08a72">FORMAT_RAW</a>, and <a class="el" href="manager_8c-source.html#l02988">generic_http_callback()</a>.<div class="fragment"><pre class="fragment"><a name="l03156"></a>03156 {
<a name="l03157"></a>03157    <span class="keywordflow">return</span> <a class="code" href="manager_8c.html#d29cc4351fa8d1b4650f737d9bf6a630">generic_http_callback</a>(<a class="code" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b76e6d9740a556bec5c9d2165c11a08a72">FORMAT_RAW</a>, requestor, uri, params, status, title, contentlength);
<a name="l03158"></a>03158 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="5261ebdd008364aa84e6d7254982898e"></a><!-- doxytag: member="manager.c::reload_manager" ref="5261ebdd008364aa84e6d7254982898e" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int reload_manager           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l03442">3442</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8h-source.html#l00051">EVENT_FLAG_SYSTEM</a>, <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>, and <a class="el" href="manager_8h-source.html#l00163">manager_event</a>.<div class="fragment"><pre class="fragment"><a name="l03443"></a>03443 {
<a name="l03444"></a>03444    <a class="code" href="manager_8h.html#17a8c809d5b2d04cbb8969a209134c2b">manager_event</a>(<a class="code" href="manager_8h.html#440ebd9d80179402b9cd76c426adb8d2">EVENT_FLAG_SYSTEM</a>, <span class="stringliteral">"Reload"</span>, <span class="stringliteral">"Message: Reload Requested\r\n"</span>);
<a name="l03445"></a>03445    <span class="keywordflow">return</span> <a class="code" href="manager_8c.html#31a28c522e71a1df85feb1926f943821">init_manager</a>();
<a name="l03446"></a>03446 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="38980e0b6876fe8f2a22a1841fee0895"></a><!-- doxytag: member="manager.c::xml_copy_escape" ref="38980e0b6876fe8f2a22a1841fee0895" args="(struct ast_str **out, const char *src, int mode)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void xml_copy_escape           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__str.html">ast_str</a> **&nbsp;</td>
          <td class="mdname" nowrap> <em>out</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02809">2809</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append()</a>, <a class="el" href="adsistub_8c-source.html#l00065">buf</a>, and <a class="el" href="strings_8h-source.html#l00191">space</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l02890">xml_translate()</a>.<div class="fragment"><pre class="fragment"><a name="l02810"></a>02810 {
<a name="l02811"></a>02811    <span class="comment">/* store in a local buffer to avoid calling ast_str_append too often */</span>
<a name="l02812"></a>02812    <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>[256];
<a name="l02813"></a>02813    <span class="keywordtype">char</span> *dst = buf;
<a name="l02814"></a>02814    <span class="keywordtype">int</span> <a class="code" href="strings_8h.html#ff2364a0be3d20e46cc69efb36afe9a5">space</a> = <span class="keyword">sizeof</span>(buf);
<a name="l02815"></a>02815    <span class="comment">/* repeat until done and nothing to flush */</span>
<a name="l02816"></a>02816    <span class="keywordflow">for</span> ( ; *src || dst != buf ; src++) {
<a name="l02817"></a>02817       <span class="keywordflow">if</span> (*src == <span class="charliteral">'\0'</span> || space &lt; 10) {   <span class="comment">/* flush */</span>
<a name="l02818"></a>02818          *dst++ = <span class="charliteral">'\0'</span>;
<a name="l02819"></a>02819          <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(out, 0, <span class="stringliteral">"%s"</span>, buf);
<a name="l02820"></a>02820          dst = buf;
<a name="l02821"></a>02821          space = <span class="keyword">sizeof</span>(buf);
<a name="l02822"></a>02822          <span class="keywordflow">if</span> (*src == <span class="charliteral">'\0'</span>)
<a name="l02823"></a>02823             <span class="keywordflow">break</span>;
<a name="l02824"></a>02824       }
<a name="l02825"></a>02825          
<a name="l02826"></a>02826       <span class="keywordflow">if</span> ( (mode &amp; 2) &amp;&amp; !isalnum(*src)) {
<a name="l02827"></a>02827          *dst++ = <span class="charliteral">'_'</span>;
<a name="l02828"></a>02828          space--;
<a name="l02829"></a>02829          <span class="keywordflow">continue</span>;
<a name="l02830"></a>02830       }
<a name="l02831"></a>02831       <span class="keywordflow">switch</span> (*src) {
<a name="l02832"></a>02832       <span class="keywordflow">case</span> <span class="charliteral">'&lt;'</span>:
<a name="l02833"></a>02833          strcpy(dst, <span class="stringliteral">"&amp;lt;"</span>);
<a name="l02834"></a>02834          dst += 4;
<a name="l02835"></a>02835          space -= 4;
<a name="l02836"></a>02836          <span class="keywordflow">break</span>;
<a name="l02837"></a>02837       <span class="keywordflow">case</span> <span class="charliteral">'&gt;'</span>:
<a name="l02838"></a>02838          strcpy(dst, <span class="stringliteral">"&amp;gt;"</span>);
<a name="l02839"></a>02839          dst += 4;
<a name="l02840"></a>02840          space -= 4;
<a name="l02841"></a>02841          <span class="keywordflow">break</span>;
<a name="l02842"></a>02842       <span class="keywordflow">case</span> <span class="charliteral">'\"'</span>:
<a name="l02843"></a>02843          strcpy(dst, <span class="stringliteral">"&amp;quot;"</span>);
<a name="l02844"></a>02844          dst += 6;
<a name="l02845"></a>02845          space -= 6;
<a name="l02846"></a>02846          <span class="keywordflow">break</span>;
<a name="l02847"></a>02847       <span class="keywordflow">case</span> <span class="charliteral">'\''</span>:
<a name="l02848"></a>02848          strcpy(dst, <span class="stringliteral">"&amp;apos;"</span>);
<a name="l02849"></a>02849          dst += 6;
<a name="l02850"></a>02850          space -= 6;
<a name="l02851"></a>02851          <span class="keywordflow">break</span>;
<a name="l02852"></a>02852       <span class="keywordflow">case</span> <span class="charliteral">'&amp;'</span>:
<a name="l02853"></a>02853          strcpy(dst, <span class="stringliteral">"&amp;amp;"</span>);
<a name="l02854"></a>02854          dst += 5;
<a name="l02855"></a>02855          space -= 5;
<a name="l02856"></a>02856          <span class="keywordflow">break</span>;
<a name="l02857"></a>02857 
<a name="l02858"></a>02858       <span class="keywordflow">default</span>:
<a name="l02859"></a>02859          *dst++ = mode ? tolower(*src) : *src;
<a name="l02860"></a>02860          space--;
<a name="l02861"></a>02861       }
<a name="l02862"></a>02862    }
<a name="l02863"></a>02863 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="645ff123f7ab62c33c2c22d620e044bb"></a><!-- doxytag: member="manager.c::xml_translate" ref="645ff123f7ab62c33c2c22d620e044bb" args="(struct ast_str **out, char *in, struct ast_variable *vars, enum output_format format)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void xml_translate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__str.html">ast_str</a> **&nbsp;</td>
          <td class="mdname" nowrap> <em>out</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>in</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>vars</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>enum <a class="el" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b7">output_format</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>format</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Convert the input into XML or HTML. The input is supposed to be a sequence of lines of the form Name: value optionally followed by a blob of unformatted text. A blank line is a section separator. Basically, this is a mixture of the format of Manager Interface and CLI commands. The unformatted text is considered as a single value of a field named 'Opaque-data'. 
<p>
At the moment the output format is the following (but it may change depending on future requirements so don't count too much on it when writing applications):<p>
General: the unformatted text is used as a value of XML output: to be completed Each section is within &lt;response type="object" id="xxx"&gt; where xxx is taken from ajaxdest variable or defaults to unknown Each row is reported as an attribute Name="value" of an XML entity named from the variable ajaxobjtype, default to "generic"<p>
HTML output: each Name-value pair is output as a single row of a two-column table. Sections (blank lines in the input) are separated by a<hr>
 
<p>
Definition at line <a class="el" href="manager_8c-source.html#l02890">2890</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="utils_8h-source.html#l00359">ast_malloc</a>, <a class="el" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="logger_8c-source.html#l00989">ast_verbose()</a>, <a class="el" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b79662bb8a01203e653f85d8e19d4ed3c3">FORMAT_XML</a>, <a class="el" href="utils_8h-source.html#l00386">len</a>, <a class="el" href="config_8h-source.html#l00039">ast_variable::name</a>, <a class="el" href="config_8h-source.html#l00046">ast_variable::next</a>, <a class="el" href="strcompat_8c-source.html#l00035">strsep()</a>, <a class="el" href="config_8h-source.html#l00040">ast_variable::value</a>, <a class="el" href="ast__expr2f_8c-source.html#l01417">var</a>, and <a class="el" href="manager_8c-source.html#l02809">xml_copy_escape()</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l02988">generic_http_callback()</a>.<div class="fragment"><pre class="fragment"><a name="l02891"></a>02891 {
<a name="l02892"></a>02892    <span class="keyword">struct </span><a class="code" href="structast__variable.html">ast_variable</a> *v;
<a name="l02893"></a>02893    <span class="keywordtype">char</span> *dest = NULL;
<a name="l02894"></a>02894    <span class="keywordtype">char</span> *<a class="code" href="ast__expr2f_8c.html#b2145aac704ce76dbe1ac7adac535b23">var</a>, *<a class="code" href="structval.html">val</a>;
<a name="l02895"></a>02895    <span class="keywordtype">char</span> *objtype = NULL;
<a name="l02896"></a>02896    <span class="keywordtype">int</span> in_data = 0;  <span class="comment">/* parsing data */</span>
<a name="l02897"></a>02897    <span class="keywordtype">int</span> inobj = 0;
<a name="l02898"></a>02898    <span class="keywordtype">int</span> xml = (<a class="code" href="chan__alsa_8c.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a> == <a class="code" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b79662bb8a01203e653f85d8e19d4ed3c3">FORMAT_XML</a>);
<a name="l02899"></a>02899 
<a name="l02900"></a>02900    <span class="keywordflow">for</span> (v = vars; v; v = v-&gt;<a class="code" href="structast__variable.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>) {
<a name="l02901"></a>02901       <span class="keywordflow">if</span> (!dest &amp;&amp; !strcasecmp(v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"ajaxdest"</span>))
<a name="l02902"></a>02902          dest = v-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>;
<a name="l02903"></a>02903       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!objtype &amp;&amp; !strcasecmp(v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"ajaxobjtype"</span>))
<a name="l02904"></a>02904          objtype = v-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>;
<a name="l02905"></a>02905    }
<a name="l02906"></a>02906    <span class="keywordflow">if</span> (!dest)
<a name="l02907"></a>02907       dest = <span class="stringliteral">"unknown"</span>;
<a name="l02908"></a>02908    <span class="keywordflow">if</span> (!objtype)
<a name="l02909"></a>02909       objtype = <span class="stringliteral">"generic"</span>;
<a name="l02910"></a>02910 <span class="preprocessor">#if 0</span>
<a name="l02911"></a>02911 <span class="preprocessor"></span>   <span class="comment">/* determine how large is the response.</span>
<a name="l02912"></a>02912 <span class="comment">    * This is a heuristic - counting colons (for headers),</span>
<a name="l02913"></a>02913 <span class="comment">    * newlines (for extra arguments), and escaped chars.</span>
<a name="l02914"></a>02914 <span class="comment">    * XXX needs to be checked carefully for overflows.</span>
<a name="l02915"></a>02915 <span class="comment">    * Even better, use some code that allows extensible strings.</span>
<a name="l02916"></a>02916 <span class="comment">    */</span>
<a name="l02917"></a>02917    <span class="keywordflow">for</span> (x = 0; in[x]; x++) {
<a name="l02918"></a>02918       <span class="keywordflow">if</span> (in[x] == <span class="charliteral">':'</span>)
<a name="l02919"></a>02919          colons++;
<a name="l02920"></a>02920       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (in[x] == <span class="charliteral">'\n'</span>)
<a name="l02921"></a>02921          breaks++;
<a name="l02922"></a>02922       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strchr(<span class="stringliteral">"&amp;\"&lt;&gt;"</span>, in[x]))
<a name="l02923"></a>02923          escaped++;
<a name="l02924"></a>02924    }
<a name="l02925"></a>02925    <a class="code" href="utils_8h.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a> = (size_t) (1 + strlen(in) + colons * 5 + breaks * (40 + strlen(dest) + strlen(objtype)) + escaped * 10); <span class="comment">/* foo="bar", "&lt;response type=\"object\" id=\"dest\"", "&amp;amp;" */</span>
<a name="l02926"></a>02926    out = <a class="code" href="utils_8h.html#efc2f2f953e736b509e4a2cee96151db">ast_malloc</a>(<a class="code" href="utils_8h.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a>);
<a name="l02927"></a>02927    <span class="keywordflow">if</span> (!out)
<a name="l02928"></a>02928       <span class="keywordflow">return</span> NULL;
<a name="l02929"></a>02929    tmp = out;
<a name="l02930"></a>02930    *tmp = <span class="charliteral">'\0'</span>;
<a name="l02931"></a>02931 <span class="preprocessor">#endif</span>
<a name="l02932"></a>02932 <span class="preprocessor"></span>   <span class="comment">/* we want to stop when we find an empty line */</span>
<a name="l02933"></a>02933    <span class="keywordflow">while</span> (in &amp;&amp; *in) {
<a name="l02934"></a>02934       val = <a class="code" href="strcompat_8c.html#a541370456ac872bdb4bdcc462fc6a6e">strsep</a>(&amp;in, <span class="stringliteral">"\r\n"</span>); <span class="comment">/* mark start and end of line */</span>
<a name="l02935"></a>02935       <span class="keywordflow">if</span> (in &amp;&amp; *in == <span class="charliteral">'\n'</span>)     <span class="comment">/* remove trailing \n if any */</span>
<a name="l02936"></a>02936          in++;
<a name="l02937"></a>02937       ast_trim_blanks(val);
<a name="l02938"></a>02938       <span class="keywordflow">if</span> (0)
<a name="l02939"></a>02939          <a class="code" href="logger_8c.html#6a1ef0a194bcc79fccfb662192954477">ast_verbose</a>(<span class="stringliteral">"inobj %d in_data %d line &lt;%s&gt;\n"</span>, inobj, in_data, val);
<a name="l02940"></a>02940       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(val)) {
<a name="l02941"></a>02941          <span class="keywordflow">if</span> (in_data) { <span class="comment">/* close data */</span>
<a name="l02942"></a>02942             <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(out, 0, xml ? <span class="stringliteral">"'"</span> : <span class="stringliteral">"&lt;/td&gt;&lt;/tr&gt;\n"</span>);
<a name="l02943"></a>02943             in_data = 0;
<a name="l02944"></a>02944          }
<a name="l02945"></a>02945          <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(out, 0, xml ? <span class="stringliteral">" /&gt;&lt;/response&gt;\n"</span> :
<a name="l02946"></a>02946             <span class="stringliteral">"&lt;tr&gt;&lt;td colspan=\"2\"&gt;&lt;hr&gt;&lt;/td&gt;&lt;/tr&gt;\r\n"</span>);
<a name="l02947"></a>02947          inobj = 0;
<a name="l02948"></a>02948          <span class="keywordflow">continue</span>;
<a name="l02949"></a>02949       }
<a name="l02950"></a>02950       <span class="comment">/* we expect Name: value lines */</span>
<a name="l02951"></a>02951       <span class="keywordflow">if</span> (in_data) {
<a name="l02952"></a>02952          var = NULL;
<a name="l02953"></a>02953       } <span class="keywordflow">else</span> {
<a name="l02954"></a>02954          var = <a class="code" href="strcompat_8c.html#a541370456ac872bdb4bdcc462fc6a6e">strsep</a>(&amp;val, <span class="stringliteral">":"</span>);
<a name="l02955"></a>02955          <span class="keywordflow">if</span> (val) {  <span class="comment">/* found the field name */</span>
<a name="l02956"></a>02956             val = ast_skip_blanks(val);
<a name="l02957"></a>02957             ast_trim_blanks(var);
<a name="l02958"></a>02958          } <span class="keywordflow">else</span> {    <span class="comment">/* field name not found, move to opaque mode */</span>
<a name="l02959"></a>02959             val = var;
<a name="l02960"></a>02960             var = <span class="stringliteral">"Opaque-data"</span>;
<a name="l02961"></a>02961          }
<a name="l02962"></a>02962       }
<a name="l02963"></a>02963       <span class="keywordflow">if</span> (!inobj) {
<a name="l02964"></a>02964          <span class="keywordflow">if</span> (xml)
<a name="l02965"></a>02965             <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(out, 0, <span class="stringliteral">"&lt;response type='object' id='%s'&gt;&lt;%s"</span>, dest, objtype);
<a name="l02966"></a>02966          <span class="keywordflow">else</span>
<a name="l02967"></a>02967             <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(out, 0, <span class="stringliteral">"&lt;body&gt;\n"</span>);
<a name="l02968"></a>02968          inobj = 1;
<a name="l02969"></a>02969       }
<a name="l02970"></a>02970       <span class="keywordflow">if</span> (!in_data) {   <span class="comment">/* build appropriate line start */</span>
<a name="l02971"></a>02971          <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(out, 0, xml ? <span class="stringliteral">" "</span> : <span class="stringliteral">"&lt;tr&gt;&lt;td&gt;"</span>);
<a name="l02972"></a>02972          <a class="code" href="manager_8c.html#38980e0b6876fe8f2a22a1841fee0895">xml_copy_escape</a>(out, var, xml ? 1 | 2 : 0);
<a name="l02973"></a>02973          <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(out, 0, xml ? <span class="stringliteral">"='"</span> : <span class="stringliteral">"&lt;/td&gt;&lt;td&gt;"</span>);
<a name="l02974"></a>02974          <span class="keywordflow">if</span> (!strcmp(var, <span class="stringliteral">"Opaque-data"</span>))
<a name="l02975"></a>02975             in_data = 1;
<a name="l02976"></a>02976       }
<a name="l02977"></a>02977       <a class="code" href="manager_8c.html#38980e0b6876fe8f2a22a1841fee0895">xml_copy_escape</a>(out, val, 0); <span class="comment">/* data field */</span>
<a name="l02978"></a>02978       <span class="keywordflow">if</span> (!in_data)
<a name="l02979"></a>02979          <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(out, 0, xml ? <span class="stringliteral">"'"</span> : <span class="stringliteral">"&lt;/td&gt;&lt;/tr&gt;\n"</span>);
<a name="l02980"></a>02980       <span class="keywordflow">else</span>
<a name="l02981"></a>02981          <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(out, 0, xml ? <span class="stringliteral">"\n"</span> : <span class="stringliteral">"&lt;br&gt;\n"</span>);
<a name="l02982"></a>02982    }
<a name="l02983"></a>02983    <span class="keywordflow">if</span> (inobj)
<a name="l02984"></a>02984       <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(out, 0, xml ? <span class="stringliteral">" /&gt;&lt;/response&gt;\n"</span> :
<a name="l02985"></a>02985          <span class="stringliteral">"&lt;tr&gt;&lt;td colspan=\"2\"&gt;&lt;hr&gt;&lt;/td&gt;&lt;/tr&gt;\r\n"</span>);
<a name="l02986"></a>02986 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="300cdb1a12b392413a97b68c6e659d08"></a><!-- doxytag: member="manager.c::ami_desc" ref="300cdb1a12b392413a97b68c6e659d08" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structserver__args.html">server_args</a> <a class="el" href="manager_8c.html#300cdb1a12b392413a97b68c6e659d08">ami_desc</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l03194">3194</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="1d13b7f019c0c316c9b46d22c8dbd337"></a><!-- doxytag: member="manager.c::ami_tls_cfg" ref="1d13b7f019c0c316c9b46d22c8dbd337" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structtls__config.html">tls_config</a> <a class="el" href="manager_8c.html#1d13b7f019c0c316c9b46d22c8dbd337">ami_tls_cfg</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l03193">3193</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="d60178c503bef15cc7591c2c82a11fe7"></a><!-- doxytag: member="manager.c::amis_desc" ref="d60178c503bef15cc7591c2c82a11fe7" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structserver__args.html">server_args</a> <a class="el" href="manager_8c.html#d60178c503bef15cc7591c2c82a11fe7">amis_desc</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l03205">3205</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a89f2caaaac4606099b86e300edf06de"></a><!-- doxytag: member="manager.c::contenttype" ref="a89f2caaaac4606099b86e300edf06de" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char* <a class="el" href="manager_8c.html#a89f2caaaac4606099b86e300edf06de">contenttype</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
   [<a class="code" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b76e6d9740a556bec5c9d2165c11a08a72">FORMAT_RAW</a>] = <span class="stringliteral">"plain"</span>,
   [<a class="code" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b76c694e73146f86874cd23ec4940be5d7">FORMAT_HTML</a>] = <span class="stringliteral">"html"</span>,
   [<a class="code" href="manager_8c.html#50ca0e02bf37d3e8838a9ae27b99d9b79662bb8a01203e653f85d8e19d4ed3c3">FORMAT_XML</a>] =  <span class="stringliteral">"xml"</span>,
}
</pre></div>
<p>
Definition at line <a class="el" href="manager_8c-source.html#l02734">2734</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="813ec6aec886e6bbb6ef9a1b455d78a8"></a><!-- doxytag: member="manager.c::manageruri" ref="813ec6aec886e6bbb6ef9a1b455d78a8" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__http__uri.html">ast_http_uri</a> <a class="el" href="manager_8c.html#813ec6aec886e6bbb6ef9a1b455d78a8">manageruri</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l03167">3167</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="7b55e3a11caef236115e71b9ea5a4304"></a><!-- doxytag: member="manager.c::managerxmluri" ref="7b55e3a11caef236115e71b9ea5a4304" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__http__uri.html">ast_http_uri</a> <a class="el" href="manager_8c.html#7b55e3a11caef236115e71b9ea5a4304">managerxmluri</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l03174">3174</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="8318a86553fb0a8bdb35f3f61b21eed8"></a><!-- doxytag: member="manager.c::rawmanuri" ref="8318a86553fb0a8bdb35f3f61b21eed8" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__http__uri.html">ast_http_uri</a> <a class="el" href="manager_8c.html#8318a86553fb0a8bdb35f3f61b21eed8">rawmanuri</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l03160">3160</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2b8ed9c305b8ea86116b603cca78a97"></a><!-- doxytag: member="manager.c::registered" ref="a2b8ed9c305b8ea86116b603cca78a97" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="manager_8c.html#a2b8ed9c305b8ea86116b603cca78a97">registered</a> = 0<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l03181">3181</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="9327cfe8492c3330bf4d51ded3e8d1a8"></a><!-- doxytag: member="manager.c::webregged" ref="9327cfe8492c3330bf4d51ded3e8d1a8" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="manager_8c.html#9327cfe8492c3330bf4d51ded3e8d1a8">webregged</a> = 0<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l03182">3182</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu May 24 22:27:37 2007 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.5 </small></address>
</body>
</html>
