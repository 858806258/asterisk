<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (24 May 2007)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Thu May 24 22:27:26 2007</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Fmain_2F.html">main</a></div>
<h1>db.c File Reference</h1>ASTdb Management. <a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="asterisk_8h-source.html">asterisk.h</a>&quot;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;sys/time.h&gt;</code><br>
<code>#include &lt;signal.h&gt;</code><br>
<code>#include &lt;errno.h&gt;</code><br>
<code>#include &lt;unistd.h&gt;</code><br>
<code>#include &lt;dirent.h&gt;</code><br>
<code>#include &quot;<a class="el" href="channel_8h-source.html">asterisk/channel.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="file_8h-source.html">asterisk/file.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="app_8h-source.html">asterisk/app.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="dsp_8h-source.html">asterisk/dsp.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="logger_8h-source.html">asterisk/logger.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="options_8h-source.html">asterisk/options.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="astdb_8h-source.html">asterisk/astdb.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="cli_8h-source.html">asterisk/cli.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="utils_8h-source.html">asterisk/utils.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="lock_8h-source.html">asterisk/lock.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="manager_8h-source.html">asterisk/manager.h</a>&quot;</code><br>
<code>#include &quot;db1-ast/include/db.h&quot;</code><br>

<p>
<a href="db_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#c2c657f2d37dd1dc1aca774f16b5a4a4">ast_db_del</a> (const char *family, const char *<a class="el" href="res__crypto_8c.html#14f802e1fba977727845e8872c1743a7">keys</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#5d82f4659e09c74ec7d2509d149256f1">ast_db_deltree</a> (const char *family, const char *keytree)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#e27b402614b69d646a14ebfa060e5e35">ast_db_freetree</a> (struct <a class="el" href="structast__db__entry.html">ast_db_entry</a> *dbe)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#b231f400b91f7d6fc366d33bf95beb5b">ast_db_get</a> (const char *family, const char *<a class="el" href="res__crypto_8c.html#14f802e1fba977727845e8872c1743a7">keys</a>, char *value, int valuelen)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__db__entry.html">ast_db_entry</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#8fb9bb3a7a427ce7d9f45746df356837">ast_db_gettree</a> (const char *family, const char *keytree)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#64bcb3650812a7f83ccc47971e23bedd">ast_db_put</a> (const char *family, const char *<a class="el" href="res__crypto_8c.html#14f802e1fba977727845e8872c1743a7">keys</a>, const char *value)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#f3978812b0d936cf68e0f480142e8549">AST_MUTEX_DEFINE_STATIC</a> (dblock)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#ffa7bfa9223627041ba7b94fc751b4e9">astdb_init</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#c565b73cdc967706e44b3dcdb5afdf33">database_del</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#4c7dc746de7080fed0577ca0023a6976">database_deltree</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#878344b1e73ffbe73e008f704880d971">database_get</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#508831cf0ca1372657b7e6bbc862f814">database_put</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#3acfb570fb1a8622d924173d9e8fc1f9">database_show</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#c07dd7058d87c56143c7733b319c7e69">database_showkey</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#c857b472b20815fc30d31312a5cf8088">dbinit</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#a91f08864414f9ac7b2a64c6f3bd725e">keymatch</a> (const char *key, const char *<a class="el" href="http_8c.html#93583f8993b24e7afddf9578925bd1d8">prefix</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#489adf32d1a534c047d92b2d0076b911">manager_dbdel</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#13190961f97155bcd5301b8bdc47b32e">manager_dbdeltree</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#c2a39921a6d94211a25b4f06e69cf111">manager_dbget</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#88ff77a9e9c584cea2b64503e085d041">manager_dbput</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#378c635e95ce32ce5616e2a0202f6cc7">subkeymatch</a> (const char *key, const char *suffix)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static DB *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__cli__entry.html">ast_cli_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#72d3b53f7516a86b85a9d93a183aa81a">cli_database</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#30ac7158aaa9f4ae45b94cd9de76e2b4">database_del_usage</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#dd0c221c376cb4a45b237e1d9873c8de">database_deltree_usage</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#cbaefee4c21ba22cd8838ca3ad544f86">database_get_usage</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#7b886ab534d8f8fd2e877b7f5e2fae0a">database_put_usage</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#6aec1394ad3414cad2eb1925acf60bc7">database_show_usage</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="db_8c.html#4eb01a74c9e39379e14c8c29582fb6c6">database_showkey_usage</a> []</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
ASTdb Management. 
<p>
<dl compact><dt><b>Author:</b></dt><dd>Mark Spencer &lt;<a href="mailto:markster@digium.com">markster@digium.com</a>&gt;</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>DB3 is licensed under Sleepycat Public License and is thus incompatible with GPL. To avoid having to make another exception (and complicate licensing even further) we elect to use DB1 which is BSD licensed </dd></dl>

<p>
Definition in file <a class="el" href="db_8c-source.html">db.c</a>.<hr><h2>Function Documentation</h2>
<a class="anchor" name="c2c657f2d37dd1dc1aca774f16b5a4a4"></a><!-- doxytag: member="db.c::ast_db_del" ref="c2c657f2d37dd1dc1aca774f16b5a4a4" args="(const char *family, const char *keys)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_db_del           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>family</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>keys</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="db_8c-source.html#l00214">214</a> of file <a class="el" href="db_8c-source.html">db.c</a>.
<p>
References <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="db_8c-source.html#l00060">astdb</a>, <a class="el" href="db_8c-source.html#l00063">dbinit()</a>, <a class="el" href="func__channel_8c-source.html#l00149">key()</a>, <a class="el" href="logger_8h-source.html#l00094">LOG_DEBUG</a>, and <a class="el" href="asterisk_8c-source.html#l00164">option_debug</a>.
<p>
Referenced by <a class="el" href="chan__iax2_8c-source.html#l05666">__expire_registry()</a>, <a class="el" href="privacy_8c-source.html#l00087">ast_privacy_set()</a>, <a class="el" href="app__authenticate_8c-source.html#l00094">auth_exec()</a>, <a class="el" href="pbx__dundi_8c-source.html#l01132">cache_lookup_internal()</a>, <a class="el" href="db_8c-source.html#l00272">database_del()</a>, <a class="el" href="app__db_8c-source.html#l00110">del_exec()</a>, <a class="el" href="chan__sip_8c-source.html#l08253">destroy_association()</a>, <a class="el" href="chan__agent_8c-source.html#l02266">dump_agents()</a>, <a class="el" href="app__queue_8c-source.html#l02883">dump_queue_members()</a>, <a class="el" href="func__db_8c-source.html#l00165">function_db_delete()</a>, <a class="el" href="res__agi_8c-source.html#l01295">handle_dbdel()</a>, <a class="el" href="db_8c-source.html#l00594">manager_dbdel()</a>, <a class="el" href="chan__agent_8c-source.html#l02291">reload_agents()</a>, <a class="el" href="app__queue_8c-source.html#l03066">reload_queue_members()</a>, and <a class="el" href="chan__iax2_8c-source.html#l05757">update_registry()</a>.<div class="fragment"><pre class="fragment"><a name="l00215"></a>00215 {
<a name="l00216"></a>00216    <span class="keywordtype">char</span> fullkey[256];
<a name="l00217"></a>00217    DBT <a class="code" href="func__channel_8c.html#87ef31d54f81072952c331d5c7339d8e">key</a>;
<a name="l00218"></a>00218    <span class="keywordtype">int</span> res, fullkeylen;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220    <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;dblock);
<a name="l00221"></a>00221    <span class="keywordflow">if</span> (<a class="code" href="db_8c.html#c857b472b20815fc30d31312a5cf8088">dbinit</a>()) {
<a name="l00222"></a>00222       <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;dblock);
<a name="l00223"></a>00223       <span class="keywordflow">return</span> -1;
<a name="l00224"></a>00224    }
<a name="l00225"></a>00225    
<a name="l00226"></a>00226    fullkeylen = snprintf(fullkey, <span class="keyword">sizeof</span>(fullkey), <span class="stringliteral">"/%s/%s"</span>, family, <a class="code" href="res__crypto_8c.html#14f802e1fba977727845e8872c1743a7">keys</a>);
<a name="l00227"></a>00227    memset(&amp;key, 0, <span class="keyword">sizeof</span>(key));
<a name="l00228"></a>00228    key.data = fullkey;
<a name="l00229"></a>00229    key.size = fullkeylen + 1;
<a name="l00230"></a>00230    
<a name="l00231"></a>00231    res = <a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a>-&gt;del(<a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a>, &amp;key, 0);
<a name="l00232"></a>00232    <a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a>-&gt;sync(<a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a>, 0);
<a name="l00233"></a>00233    
<a name="l00234"></a>00234    <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;dblock);
<a name="l00235"></a>00235 
<a name="l00236"></a>00236    <span class="keywordflow">if</span> (res) {
<a name="l00237"></a>00237       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a>)
<a name="l00238"></a>00238          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"Unable to find key '%s' in family '%s'\n"</span>, <a class="code" href="res__crypto_8c.html#14f802e1fba977727845e8872c1743a7">keys</a>, family);
<a name="l00239"></a>00239    }
<a name="l00240"></a>00240    <span class="keywordflow">return</span> res;
<a name="l00241"></a>00241 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="5d82f4659e09c74ec7d2509d149256f1"></a><!-- doxytag: member="db.c::ast_db_deltree" ref="5d82f4659e09c74ec7d2509d149256f1" args="(const char *family, const char *keytree)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_db_deltree           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>family</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>keytree</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="db_8c-source.html#l00100">100</a> of file <a class="el" href="db_8c-source.html">db.c</a>.
<p>
References <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="db_8c-source.html#l00060">astdb</a>, <a class="el" href="db_8c-source.html#l00063">dbinit()</a>, <a class="el" href="func__channel_8c-source.html#l00149">key()</a>, <a class="el" href="db_8c-source.html#l00073">keymatch()</a>, <a class="el" href="res__crypto_8c-source.html#l00106">keys</a>, and <a class="el" href="http_8c-source.html#l00109">prefix</a>.
<p>
Referenced by <a class="el" href="privacy_8c-source.html#l00080">ast_privacy_reset()</a>, <a class="el" href="db_8c-source.html#l00286">database_deltree()</a>, <a class="el" href="app__db_8c-source.html#l00068">deltree_exec()</a>, <a class="el" href="pbx__dundi_8c-source.html#l02184">dundi_flush()</a>, <a class="el" href="res__agi_8c-source.html#l01306">handle_dbdeltree()</a>, and <a class="el" href="db_8c-source.html#l00619">manager_dbdeltree()</a>.<div class="fragment"><pre class="fragment"><a name="l00101"></a>00101 {
<a name="l00102"></a>00102    <span class="keywordtype">char</span> <a class="code" href="http_8c.html#93583f8993b24e7afddf9578925bd1d8">prefix</a>[256];
<a name="l00103"></a>00103    DBT <a class="code" href="func__channel_8c.html#87ef31d54f81072952c331d5c7339d8e">key</a>, data;
<a name="l00104"></a>00104    <span class="keywordtype">char</span> *<a class="code" href="res__crypto_8c.html#14f802e1fba977727845e8872c1743a7">keys</a>;
<a name="l00105"></a>00105    <span class="keywordtype">int</span> res;
<a name="l00106"></a>00106    <span class="keywordtype">int</span> pass;
<a name="l00107"></a>00107    
<a name="l00108"></a>00108    <span class="keywordflow">if</span> (family) {
<a name="l00109"></a>00109       <span class="keywordflow">if</span> (keytree) {
<a name="l00110"></a>00110          snprintf(prefix, <span class="keyword">sizeof</span>(prefix), <span class="stringliteral">"/%s/%s"</span>, family, keytree);
<a name="l00111"></a>00111       } <span class="keywordflow">else</span> {
<a name="l00112"></a>00112          snprintf(prefix, <span class="keyword">sizeof</span>(prefix), <span class="stringliteral">"/%s"</span>, family);
<a name="l00113"></a>00113       }
<a name="l00114"></a>00114    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (keytree) {
<a name="l00115"></a>00115       <span class="keywordflow">return</span> -1;
<a name="l00116"></a>00116    } <span class="keywordflow">else</span> {
<a name="l00117"></a>00117       prefix[0] = <span class="charliteral">'\0'</span>;
<a name="l00118"></a>00118    }
<a name="l00119"></a>00119    
<a name="l00120"></a>00120    <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;dblock);
<a name="l00121"></a>00121    <span class="keywordflow">if</span> (<a class="code" href="db_8c.html#c857b472b20815fc30d31312a5cf8088">dbinit</a>()) {
<a name="l00122"></a>00122       <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;dblock);
<a name="l00123"></a>00123       <span class="keywordflow">return</span> -1;
<a name="l00124"></a>00124    }
<a name="l00125"></a>00125    
<a name="l00126"></a>00126    memset(&amp;key, 0, <span class="keyword">sizeof</span>(key));
<a name="l00127"></a>00127    memset(&amp;data, 0, <span class="keyword">sizeof</span>(data));
<a name="l00128"></a>00128    pass = 0;
<a name="l00129"></a>00129    <span class="keywordflow">while</span> (!(res = <a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a>-&gt;seq(<a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a>, &amp;key, &amp;data, pass++ ? R_NEXT : R_FIRST))) {
<a name="l00130"></a>00130       <span class="keywordflow">if</span> (key.size) {
<a name="l00131"></a>00131          keys = key.data;
<a name="l00132"></a>00132          keys[key.size - 1] = <span class="charliteral">'\0'</span>;
<a name="l00133"></a>00133       } <span class="keywordflow">else</span> {
<a name="l00134"></a>00134          keys = <span class="stringliteral">"&lt;bad key&gt;"</span>;
<a name="l00135"></a>00135       }
<a name="l00136"></a>00136       <span class="keywordflow">if</span> (<a class="code" href="db_8c.html#a91f08864414f9ac7b2a64c6f3bd725e">keymatch</a>(keys, prefix)) {
<a name="l00137"></a>00137          <a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a>-&gt;del(<a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a>, &amp;key, 0);
<a name="l00138"></a>00138       }
<a name="l00139"></a>00139    }
<a name="l00140"></a>00140    <a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a>-&gt;sync(<a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a>, 0);
<a name="l00141"></a>00141    <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;dblock);
<a name="l00142"></a>00142    <span class="keywordflow">return</span> 0;
<a name="l00143"></a>00143 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="e27b402614b69d646a14ebfa060e5e35"></a><!-- doxytag: member="db.c::ast_db_freetree" ref="e27b402614b69d646a14ebfa060e5e35" args="(struct ast_db_entry *dbe)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_db_freetree           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__db__entry.html">ast_db_entry</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>dbe</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="db_8c-source.html#l00463">463</a> of file <a class="el" href="db_8c-source.html">db.c</a>.
<p>
References <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="pbx__gtkconsole_8c-source.html#l00073">last</a>, and <a class="el" href="astdb_8h-source.html#l00031">ast_db_entry::next</a>.
<p>
Referenced by <a class="el" href="chan__agent_8c-source.html#l02291">reload_agents()</a>, and <a class="el" href="app__queue_8c-source.html#l03066">reload_queue_members()</a>.<div class="fragment"><pre class="fragment"><a name="l00464"></a>00464 {
<a name="l00465"></a>00465    <span class="keyword">struct </span><a class="code" href="structast__db__entry.html">ast_db_entry</a> *<a class="code" href="pbx__gtkconsole_8c.html#98bd1c45684cf587ac2347a92dd7bb51">last</a>;
<a name="l00466"></a>00466    <span class="keywordflow">while</span> (dbe) {
<a name="l00467"></a>00467       last = dbe;
<a name="l00468"></a>00468       dbe = dbe-&gt;<a class="code" href="structast__db__entry.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>;
<a name="l00469"></a>00469       <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(last);
<a name="l00470"></a>00470    }
<a name="l00471"></a>00471 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b231f400b91f7d6fc366d33bf95beb5b"></a><!-- doxytag: member="db.c::ast_db_get" ref="b231f400b91f7d6fc366d33bf95beb5b" args="(const char *family, const char *keys, char *value, int valuelen)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_db_get           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>family</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>keys</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>value</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>valuelen</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="db_8c-source.html#l00172">172</a> of file <a class="el" href="db_8c-source.html">db.c</a>.
<p>
References <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="db_8c-source.html#l00060">astdb</a>, <a class="el" href="db_8c-source.html#l00063">dbinit()</a>, <a class="el" href="func__channel_8c-source.html#l00149">key()</a>, <a class="el" href="logger_8h-source.html#l00094">LOG_DEBUG</a>, <a class="el" href="logger_8h-source.html#l00106">LOG_NOTICE</a>, and <a class="el" href="asterisk_8c-source.html#l00164">option_debug</a>.
<p>
Referenced by <a class="el" href="privacy_8c-source.html#l00051">ast_privacy_check()</a>, <a class="el" href="app__authenticate_8c-source.html#l00094">auth_exec()</a>, <a class="el" href="func__blacklist_8c-source.html#l00050">blacklist_read()</a>, <a class="el" href="pbx__dundi_8c-source.html#l01132">cache_lookup_internal()</a>, <a class="el" href="chan__iax2_8c-source.html#l02722">create_addr()</a>, <a class="el" href="db_8c-source.html#l00257">database_get()</a>, <a class="el" href="app__alarmreceiver_8c-source.html#l00108">database_increment()</a>, <a class="el" href="func__db_8c-source.html#l00165">function_db_delete()</a>, <a class="el" href="func__db_8c-source.html#l00121">function_db_exists()</a>, <a class="el" href="func__db_8c-source.html#l00049">function_db_read()</a>, <a class="el" href="res__agi_8c-source.html#l01268">handle_dbget()</a>, <a class="el" href="iax2-provision_8c-source.html#l00240">iax_provision_version()</a>, <a class="el" href="pbx__dundi_8c-source.html#l02046">load_password()</a>, <a class="el" href="db_8c-source.html#l00557">manager_dbget()</a>, <a class="el" href="pbx__dundi_8c-source.html#l04258">populate_addr()</a>, <a class="el" href="chan__iax2_8c-source.html#l05719">reg_source_db()</a>, <a class="el" href="chan__agent_8c-source.html#l02291">reload_agents()</a>, and <a class="el" href="app__queue_8c-source.html#l03066">reload_queue_members()</a>.<div class="fragment"><pre class="fragment"><a name="l00173"></a>00173 {
<a name="l00174"></a>00174    <span class="keywordtype">char</span> fullkey[256] = <span class="stringliteral">""</span>;
<a name="l00175"></a>00175    DBT <a class="code" href="func__channel_8c.html#87ef31d54f81072952c331d5c7339d8e">key</a>, <a class="code" href="structast__db__entry.html#59a6c49cfff82ce638c44fec9cd91ddb">data</a>;
<a name="l00176"></a>00176    <span class="keywordtype">int</span> res, fullkeylen;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178    <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;dblock);
<a name="l00179"></a>00179    <span class="keywordflow">if</span> (<a class="code" href="db_8c.html#c857b472b20815fc30d31312a5cf8088">dbinit</a>()) {
<a name="l00180"></a>00180       <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;dblock);
<a name="l00181"></a>00181       <span class="keywordflow">return</span> -1;
<a name="l00182"></a>00182    }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184    fullkeylen = snprintf(fullkey, <span class="keyword">sizeof</span>(fullkey), <span class="stringliteral">"/%s/%s"</span>, family, <a class="code" href="res__crypto_8c.html#14f802e1fba977727845e8872c1743a7">keys</a>);
<a name="l00185"></a>00185    memset(&amp;key, 0, <span class="keyword">sizeof</span>(key));
<a name="l00186"></a>00186    memset(&amp;data, 0, <span class="keyword">sizeof</span>(data));
<a name="l00187"></a>00187    memset(value, 0, valuelen);
<a name="l00188"></a>00188    key.data = fullkey;
<a name="l00189"></a>00189    key.size = fullkeylen + 1;
<a name="l00190"></a>00190    
<a name="l00191"></a>00191    res = <a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a>-&gt;get(<a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a>, &amp;key, &amp;data, 0);
<a name="l00192"></a>00192    
<a name="l00193"></a>00193    <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;dblock);
<a name="l00194"></a>00194 
<a name="l00195"></a>00195    <span class="comment">/* Be sure to NULL terminate our data either way */</span>
<a name="l00196"></a>00196    <span class="keywordflow">if</span> (res) {
<a name="l00197"></a>00197       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a>)
<a name="l00198"></a>00198          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"Unable to find key '%s' in family '%s'\n"</span>, <a class="code" href="res__crypto_8c.html#14f802e1fba977727845e8872c1743a7">keys</a>, family);
<a name="l00199"></a>00199    } <span class="keywordflow">else</span> {
<a name="l00200"></a>00200 <span class="preprocessor">#if 0</span>
<a name="l00201"></a>00201 <span class="preprocessor"></span>      printf(<span class="stringliteral">"Got value of size %d\n"</span>, data.size);
<a name="l00202"></a>00202 <span class="preprocessor">#endif</span>
<a name="l00203"></a>00203 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (data.size) {
<a name="l00204"></a>00204          ((<span class="keywordtype">char</span> *)data.data)[data.size - 1] = <span class="charliteral">'\0'</span>;
<a name="l00205"></a>00205          <span class="comment">/* Make sure that we don't write too much to the dst pointer or we don't read too much from the source pointer */</span>
<a name="l00206"></a>00206          ast_copy_string(value, data.data, (valuelen &gt; data.size) ? data.size : valuelen);
<a name="l00207"></a>00207       } <span class="keywordflow">else</span> {
<a name="l00208"></a>00208          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#bbf95aad74d847cd4bcb129604f798cd">LOG_NOTICE</a>, <span class="stringliteral">"Strange, empty value for /%s/%s\n"</span>, family, <a class="code" href="res__crypto_8c.html#14f802e1fba977727845e8872c1743a7">keys</a>);
<a name="l00209"></a>00209       }
<a name="l00210"></a>00210    }
<a name="l00211"></a>00211    <span class="keywordflow">return</span> res;
<a name="l00212"></a>00212 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="8fb9bb3a7a427ce7d9f45746df356837"></a><!-- doxytag: member="db.c::ast_db_gettree" ref="8fb9bb3a7a427ce7d9f45746df356837" args="(const char *family, const char *keytree)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__db__entry.html">ast_db_entry</a>* ast_db_gettree           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>family</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>keytree</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="db_8c-source.html#l00401">401</a> of file <a class="el" href="db_8c-source.html">db.c</a>.
<p>
References <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="utils_8h-source.html#l00359">ast_malloc</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="db_8c-source.html#l00060">astdb</a>, <a class="el" href="astdb_8h-source.html#l00033">ast_db_entry::data</a>, <a class="el" href="db_8c-source.html#l00063">dbinit()</a>, <a class="el" href="func__channel_8c-source.html#l00149">key()</a>, <a class="el" href="db_8c-source.html#l00073">keymatch()</a>, <a class="el" href="res__crypto_8c-source.html#l00106">keys</a>, <a class="el" href="pbx__gtkconsole_8c-source.html#l00073">last</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="astdb_8h-source.html#l00031">ast_db_entry::next</a>, <a class="el" href="http_8c-source.html#l00109">prefix</a>, and <a class="el" href="cdr__sqlite3__custom_8c-source.html#l00072">values</a>.
<p>
Referenced by <a class="el" href="chan__agent_8c-source.html#l02291">reload_agents()</a>, and <a class="el" href="app__queue_8c-source.html#l03066">reload_queue_members()</a>.<div class="fragment"><pre class="fragment"><a name="l00402"></a>00402 {
<a name="l00403"></a>00403    <span class="keywordtype">char</span> <a class="code" href="http_8c.html#93583f8993b24e7afddf9578925bd1d8">prefix</a>[256];
<a name="l00404"></a>00404    DBT <a class="code" href="func__channel_8c.html#87ef31d54f81072952c331d5c7339d8e">key</a>, <a class="code" href="structast__db__entry.html#59a6c49cfff82ce638c44fec9cd91ddb">data</a>;
<a name="l00405"></a>00405    <span class="keywordtype">char</span> *<a class="code" href="res__crypto_8c.html#14f802e1fba977727845e8872c1743a7">keys</a>, *<a class="code" href="cdr__sqlite3__custom_8c.html#745718bbe43a52774b8f96898d45740a">values</a>;
<a name="l00406"></a>00406    <span class="keywordtype">int</span> values_len;
<a name="l00407"></a>00407    <span class="keywordtype">int</span> res;
<a name="l00408"></a>00408    <span class="keywordtype">int</span> pass;
<a name="l00409"></a>00409    <span class="keyword">struct </span><a class="code" href="structast__db__entry.html">ast_db_entry</a> *<a class="code" href="pbx__gtkconsole_8c.html#98bd1c45684cf587ac2347a92dd7bb51">last</a> = NULL;
<a name="l00410"></a>00410    <span class="keyword">struct </span><a class="code" href="structast__db__entry.html">ast_db_entry</a> *cur, *ret=NULL;
<a name="l00411"></a>00411 
<a name="l00412"></a>00412    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(family)) {
<a name="l00413"></a>00413       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(keytree)) {
<a name="l00414"></a>00414          <span class="comment">/* Family and key tree */</span>
<a name="l00415"></a>00415          snprintf(prefix, <span class="keyword">sizeof</span>(prefix), <span class="stringliteral">"/%s/%s"</span>, family, prefix);
<a name="l00416"></a>00416       } <span class="keywordflow">else</span> {
<a name="l00417"></a>00417          <span class="comment">/* Family only */</span>
<a name="l00418"></a>00418          snprintf(prefix, <span class="keyword">sizeof</span>(prefix), <span class="stringliteral">"/%s"</span>, family);
<a name="l00419"></a>00419       }
<a name="l00420"></a>00420    } <span class="keywordflow">else</span> {
<a name="l00421"></a>00421       prefix[0] = <span class="charliteral">'\0'</span>;
<a name="l00422"></a>00422    }
<a name="l00423"></a>00423    <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;dblock);
<a name="l00424"></a>00424    <span class="keywordflow">if</span> (<a class="code" href="db_8c.html#c857b472b20815fc30d31312a5cf8088">dbinit</a>()) {
<a name="l00425"></a>00425       <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;dblock);
<a name="l00426"></a>00426       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Database unavailable\n"</span>);
<a name="l00427"></a>00427       <span class="keywordflow">return</span> NULL;   
<a name="l00428"></a>00428    }
<a name="l00429"></a>00429    memset(&amp;key, 0, <span class="keyword">sizeof</span>(key));
<a name="l00430"></a>00430    memset(&amp;data, 0, <span class="keyword">sizeof</span>(data));
<a name="l00431"></a>00431    pass = 0;
<a name="l00432"></a>00432    <span class="keywordflow">while</span> (!(res = <a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a>-&gt;seq(<a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a>, &amp;key, &amp;data, pass++ ? R_NEXT : R_FIRST))) {
<a name="l00433"></a>00433       <span class="keywordflow">if</span> (key.size) {
<a name="l00434"></a>00434          keys = key.data;
<a name="l00435"></a>00435          keys[key.size - 1] = <span class="charliteral">'\0'</span>;
<a name="l00436"></a>00436       } <span class="keywordflow">else</span> {
<a name="l00437"></a>00437          keys = <span class="stringliteral">"&lt;bad key&gt;"</span>;
<a name="l00438"></a>00438       }
<a name="l00439"></a>00439       <span class="keywordflow">if</span> (data.size) {
<a name="l00440"></a>00440          values = data.data;
<a name="l00441"></a>00441          values[data.size - 1] = <span class="charliteral">'\0'</span>;
<a name="l00442"></a>00442       } <span class="keywordflow">else</span> {
<a name="l00443"></a>00443          values = <span class="stringliteral">"&lt;bad value&gt;"</span>;
<a name="l00444"></a>00444       }
<a name="l00445"></a>00445       values_len = strlen(values) + 1;
<a name="l00446"></a>00446       <span class="keywordflow">if</span> (<a class="code" href="db_8c.html#a91f08864414f9ac7b2a64c6f3bd725e">keymatch</a>(keys, prefix) &amp;&amp; (cur = <a class="code" href="utils_8h.html#efc2f2f953e736b509e4a2cee96151db">ast_malloc</a>(<span class="keyword">sizeof</span>(*cur) + strlen(keys) + 1 + values_len))) {
<a name="l00447"></a>00447          cur-&gt;next = NULL;
<a name="l00448"></a>00448          cur-&gt;key = cur-&gt;data + values_len;
<a name="l00449"></a>00449          strcpy(cur-&gt;data, values);
<a name="l00450"></a>00450          strcpy(cur-&gt;key, keys);
<a name="l00451"></a>00451          <span class="keywordflow">if</span> (last) {
<a name="l00452"></a>00452             last-&gt;<a class="code" href="structast__db__entry.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a> = cur;
<a name="l00453"></a>00453          } <span class="keywordflow">else</span> {
<a name="l00454"></a>00454             ret = cur;
<a name="l00455"></a>00455          }
<a name="l00456"></a>00456          last = cur;
<a name="l00457"></a>00457       }
<a name="l00458"></a>00458    }
<a name="l00459"></a>00459    <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;dblock);
<a name="l00460"></a>00460    <span class="keywordflow">return</span> ret; 
<a name="l00461"></a>00461 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="64bcb3650812a7f83ccc47971e23bedd"></a><!-- doxytag: member="db.c::ast_db_put" ref="64bcb3650812a7f83ccc47971e23bedd" args="(const char *family, const char *keys, const char *value)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_db_put           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>family</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>keys</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>value</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="db_8c-source.html#l00145">145</a> of file <a class="el" href="db_8c-source.html">db.c</a>.
<p>
References <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="db_8c-source.html#l00060">astdb</a>, <a class="el" href="db_8c-source.html#l00063">dbinit()</a>, <a class="el" href="func__channel_8c-source.html#l00149">key()</a>, and <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>.
<p>
Referenced by <a class="el" href="privacy_8c-source.html#l00087">ast_privacy_set()</a>, <a class="el" href="pbx__dundi_8c-source.html#l00859">cache_save()</a>, <a class="el" href="pbx__dundi_8c-source.html#l00822">cache_save_hint()</a>, <a class="el" href="app__alarmreceiver_8c-source.html#l00108">database_increment()</a>, <a class="el" href="db_8c-source.html#l00243">database_put()</a>, <a class="el" href="chan__agent_8c-source.html#l02266">dump_agents()</a>, <a class="el" href="app__queue_8c-source.html#l02883">dump_queue_members()</a>, <a class="el" href="func__db_8c-source.html#l00081">function_db_write()</a>, <a class="el" href="pbx__dundi_8c-source.html#l01515">handle_command_response()</a>, <a class="el" href="res__agi_8c-source.html#l01284">handle_dbput()</a>, <a class="el" href="iax2-provision_8c-source.html#l00191">iax_provision_build()</a>, <a class="el" href="db_8c-source.html#l00528">manager_dbput()</a>, <a class="el" href="chan__mgcp_8c-source.html#l02638">mgcp_ss()</a>, <a class="el" href="chan__sip_8c-source.html#l08437">parse_register_contact()</a>, <a class="el" href="pbx__dundi_8c-source.html#l02033">save_secret()</a>, <a class="el" href="chan__zap_8c-source.html#l05744">ss_thread()</a>, and <a class="el" href="chan__iax2_8c-source.html#l05757">update_registry()</a>.<div class="fragment"><pre class="fragment"><a name="l00146"></a>00146 {
<a name="l00147"></a>00147    <span class="keywordtype">char</span> fullkey[256];
<a name="l00148"></a>00148    DBT <a class="code" href="func__channel_8c.html#87ef31d54f81072952c331d5c7339d8e">key</a>, <a class="code" href="structast__db__entry.html#59a6c49cfff82ce638c44fec9cd91ddb">data</a>;
<a name="l00149"></a>00149    <span class="keywordtype">int</span> res, fullkeylen;
<a name="l00150"></a>00150 
<a name="l00151"></a>00151    <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;dblock);
<a name="l00152"></a>00152    <span class="keywordflow">if</span> (<a class="code" href="db_8c.html#c857b472b20815fc30d31312a5cf8088">dbinit</a>()) {
<a name="l00153"></a>00153       <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;dblock);
<a name="l00154"></a>00154       <span class="keywordflow">return</span> -1;
<a name="l00155"></a>00155    }
<a name="l00156"></a>00156 
<a name="l00157"></a>00157    fullkeylen = snprintf(fullkey, <span class="keyword">sizeof</span>(fullkey), <span class="stringliteral">"/%s/%s"</span>, family, <a class="code" href="res__crypto_8c.html#14f802e1fba977727845e8872c1743a7">keys</a>);
<a name="l00158"></a>00158    memset(&amp;key, 0, <span class="keyword">sizeof</span>(key));
<a name="l00159"></a>00159    memset(&amp;data, 0, <span class="keyword">sizeof</span>(data));
<a name="l00160"></a>00160    key.data = fullkey;
<a name="l00161"></a>00161    key.size = fullkeylen + 1;
<a name="l00162"></a>00162    data.data = (<span class="keywordtype">char</span> *) value;
<a name="l00163"></a>00163    data.size = strlen(value) + 1;
<a name="l00164"></a>00164    res = <a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a>-&gt;put(<a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a>, &amp;key, &amp;data, 0);
<a name="l00165"></a>00165    <a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a>-&gt;sync(<a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a>, 0);
<a name="l00166"></a>00166    <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;dblock);
<a name="l00167"></a>00167    <span class="keywordflow">if</span> (res)
<a name="l00168"></a>00168       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Unable to put value '%s' for key '%s' in family '%s'\n"</span>, value, <a class="code" href="res__crypto_8c.html#14f802e1fba977727845e8872c1743a7">keys</a>, family);
<a name="l00169"></a>00169    <span class="keywordflow">return</span> res;
<a name="l00170"></a>00170 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="f3978812b0d936cf68e0f480142e8549"></a><!-- doxytag: member="db.c::AST_MUTEX_DEFINE_STATIC" ref="f3978812b0d936cf68e0f480142e8549" args="(dblock)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">AST_MUTEX_DEFINE_STATIC           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">dblock&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="ffa7bfa9223627041ba7b94fc751b4e9"></a><!-- doxytag: member="db.c::astdb_init" ref="ffa7bfa9223627041ba7b94fc751b4e9" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int astdb_init           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Provided by <a class="el" href="db_8c.html">db.c</a> 
<p>
Definition at line <a class="el" href="db_8c-source.html#l00643">643</a> of file <a class="el" href="db_8c-source.html">db.c</a>.
<p>
References <a class="el" href="cli_8c-source.html#l01352">ast_cli_register_multiple()</a>, <a class="el" href="manager_8h-source.html#l00116">ast_manager_register</a>, <a class="el" href="db_8c-source.html#l00063">dbinit()</a>, <a class="el" href="manager_8h-source.html#l00051">EVENT_FLAG_SYSTEM</a>, <a class="el" href="db_8c-source.html#l00594">manager_dbdel()</a>, <a class="el" href="db_8c-source.html#l00619">manager_dbdeltree()</a>, <a class="el" href="db_8c-source.html#l00557">manager_dbget()</a>, and <a class="el" href="db_8c-source.html#l00528">manager_dbput()</a>.
<p>
Referenced by <a class="el" href="asterisk_8c-source.html#l02570">main()</a>.<div class="fragment"><pre class="fragment"><a name="l00644"></a>00644 {
<a name="l00645"></a>00645    <a class="code" href="db_8c.html#c857b472b20815fc30d31312a5cf8088">dbinit</a>();
<a name="l00646"></a>00646    <a class="code" href="cli_8c.html#a334dfd903e83eea3729ff37aa372781">ast_cli_register_multiple</a>(<a class="code" href="db_8c.html#72d3b53f7516a86b85a9d93a183aa81a">cli_database</a>, <span class="keyword">sizeof</span>(<a class="code" href="db_8c.html#72d3b53f7516a86b85a9d93a183aa81a">cli_database</a>) / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html">ast_cli_entry</a>));
<a name="l00647"></a>00647    <a class="code" href="manager_8h.html#e4738d78136f7a3a390d7729872d206e">ast_manager_register</a>(<span class="stringliteral">"DBGet"</span>, <a class="code" href="manager_8h.html#440ebd9d80179402b9cd76c426adb8d2">EVENT_FLAG_SYSTEM</a>, <a class="code" href="db_8c.html#c2a39921a6d94211a25b4f06e69cf111">manager_dbget</a>, <span class="stringliteral">"Get DB Entry"</span>);
<a name="l00648"></a>00648    <a class="code" href="manager_8h.html#e4738d78136f7a3a390d7729872d206e">ast_manager_register</a>(<span class="stringliteral">"DBPut"</span>, <a class="code" href="manager_8h.html#440ebd9d80179402b9cd76c426adb8d2">EVENT_FLAG_SYSTEM</a>, <a class="code" href="db_8c.html#88ff77a9e9c584cea2b64503e085d041">manager_dbput</a>, <span class="stringliteral">"Put DB Entry"</span>);
<a name="l00649"></a>00649    <a class="code" href="manager_8h.html#e4738d78136f7a3a390d7729872d206e">ast_manager_register</a>(<span class="stringliteral">"DBDel"</span>, <a class="code" href="manager_8h.html#440ebd9d80179402b9cd76c426adb8d2">EVENT_FLAG_SYSTEM</a>, <a class="code" href="db_8c.html#489adf32d1a534c047d92b2d0076b911">manager_dbdel</a>, <span class="stringliteral">"Delete DB Entry"</span>);
<a name="l00650"></a>00650    <a class="code" href="manager_8h.html#e4738d78136f7a3a390d7729872d206e">ast_manager_register</a>(<span class="stringliteral">"DBDelTree"</span>, <a class="code" href="manager_8h.html#440ebd9d80179402b9cd76c426adb8d2">EVENT_FLAG_SYSTEM</a>, <a class="code" href="db_8c.html#13190961f97155bcd5301b8bdc47b32e">manager_dbdeltree</a>, <span class="stringliteral">"Delete DB Tree"</span>);
<a name="l00651"></a>00651    <span class="keywordflow">return</span> 0;
<a name="l00652"></a>00652 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="c565b73cdc967706e44b3dcdb5afdf33"></a><!-- doxytag: member="db.c::database_del" ref="c565b73cdc967706e44b3dcdb5afdf33" args="(int fd, int argc, char *argv[])" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int database_del           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em>[]</td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="db_8c-source.html#l00272">272</a> of file <a class="el" href="db_8c-source.html">db.c</a>.
<p>
References <a class="el" href="cli_8c-source.html#l00057">ast_cli()</a>, <a class="el" href="db_8c-source.html#l00214">ast_db_del()</a>, <a class="el" href="cli_8h-source.html#l00038">RESULT_SHOWUSAGE</a>, and <a class="el" href="cli_8h-source.html#l00037">RESULT_SUCCESS</a>.<div class="fragment"><pre class="fragment"><a name="l00273"></a>00273 {
<a name="l00274"></a>00274    <span class="keywordtype">int</span> res;
<a name="l00275"></a>00275    <span class="keywordflow">if</span> (argc != 4)
<a name="l00276"></a>00276       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d7f3bcd35c16172e6fc0964a175fcadb">RESULT_SHOWUSAGE</a>;
<a name="l00277"></a>00277    res = <a class="code" href="db_8c.html#c2c657f2d37dd1dc1aca774f16b5a4a4">ast_db_del</a>(argv[2], argv[3]);
<a name="l00278"></a>00278    <span class="keywordflow">if</span> (res) {
<a name="l00279"></a>00279       <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"Database entry does not exist.\n"</span>);
<a name="l00280"></a>00280    } <span class="keywordflow">else</span> {
<a name="l00281"></a>00281       <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"Database entry removed.\n"</span>);
<a name="l00282"></a>00282    }
<a name="l00283"></a>00283    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d92028a33e35e9d037718f4d846096f9">RESULT_SUCCESS</a>;
<a name="l00284"></a>00284 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="4c7dc746de7080fed0577ca0023a6976"></a><!-- doxytag: member="db.c::database_deltree" ref="4c7dc746de7080fed0577ca0023a6976" args="(int fd, int argc, char *argv[])" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int database_deltree           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em>[]</td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="db_8c-source.html#l00286">286</a> of file <a class="el" href="db_8c-source.html">db.c</a>.
<p>
References <a class="el" href="cli_8c-source.html#l00057">ast_cli()</a>, <a class="el" href="db_8c-source.html#l00100">ast_db_deltree()</a>, <a class="el" href="cli_8h-source.html#l00038">RESULT_SHOWUSAGE</a>, and <a class="el" href="cli_8h-source.html#l00037">RESULT_SUCCESS</a>.<div class="fragment"><pre class="fragment"><a name="l00287"></a>00287 {
<a name="l00288"></a>00288    <span class="keywordtype">int</span> res;
<a name="l00289"></a>00289    <span class="keywordflow">if</span> ((argc &lt; 3) || (argc &gt; 4))
<a name="l00290"></a>00290       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d7f3bcd35c16172e6fc0964a175fcadb">RESULT_SHOWUSAGE</a>;
<a name="l00291"></a>00291    <span class="keywordflow">if</span> (argc == 4) {
<a name="l00292"></a>00292       res = <a class="code" href="db_8c.html#5d82f4659e09c74ec7d2509d149256f1">ast_db_deltree</a>(argv[2], argv[3]);
<a name="l00293"></a>00293    } <span class="keywordflow">else</span> {
<a name="l00294"></a>00294       res = <a class="code" href="db_8c.html#5d82f4659e09c74ec7d2509d149256f1">ast_db_deltree</a>(argv[2], NULL);
<a name="l00295"></a>00295    }
<a name="l00296"></a>00296    <span class="keywordflow">if</span> (res) {
<a name="l00297"></a>00297       <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"Database entries do not exist.\n"</span>);
<a name="l00298"></a>00298    } <span class="keywordflow">else</span> {
<a name="l00299"></a>00299       <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"Database entries removed.\n"</span>);
<a name="l00300"></a>00300    }
<a name="l00301"></a>00301    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d92028a33e35e9d037718f4d846096f9">RESULT_SUCCESS</a>;
<a name="l00302"></a>00302 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="878344b1e73ffbe73e008f704880d971"></a><!-- doxytag: member="db.c::database_get" ref="878344b1e73ffbe73e008f704880d971" args="(int fd, int argc, char *argv[])" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int database_get           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em>[]</td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="db_8c-source.html#l00257">257</a> of file <a class="el" href="db_8c-source.html">db.c</a>.
<p>
References <a class="el" href="cli_8c-source.html#l00057">ast_cli()</a>, <a class="el" href="db_8c-source.html#l00172">ast_db_get()</a>, <a class="el" href="cli_8h-source.html#l00038">RESULT_SHOWUSAGE</a>, and <a class="el" href="cli_8h-source.html#l00037">RESULT_SUCCESS</a>.<div class="fragment"><pre class="fragment"><a name="l00258"></a>00258 {
<a name="l00259"></a>00259    <span class="keywordtype">int</span> res;
<a name="l00260"></a>00260    <span class="keywordtype">char</span> tmp[256];
<a name="l00261"></a>00261    <span class="keywordflow">if</span> (argc != 4)
<a name="l00262"></a>00262       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d7f3bcd35c16172e6fc0964a175fcadb">RESULT_SHOWUSAGE</a>;
<a name="l00263"></a>00263    res = <a class="code" href="db_8c.html#b231f400b91f7d6fc366d33bf95beb5b">ast_db_get</a>(argv[2], argv[3], tmp, <span class="keyword">sizeof</span>(tmp));
<a name="l00264"></a>00264    <span class="keywordflow">if</span> (res) {
<a name="l00265"></a>00265       <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"Database entry not found.\n"</span>);
<a name="l00266"></a>00266    } <span class="keywordflow">else</span> {
<a name="l00267"></a>00267       <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"Value: %s\n"</span>, tmp);
<a name="l00268"></a>00268    }
<a name="l00269"></a>00269    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d92028a33e35e9d037718f4d846096f9">RESULT_SUCCESS</a>;
<a name="l00270"></a>00270 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="508831cf0ca1372657b7e6bbc862f814"></a><!-- doxytag: member="db.c::database_put" ref="508831cf0ca1372657b7e6bbc862f814" args="(int fd, int argc, char *argv[])" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int database_put           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em>[]</td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="db_8c-source.html#l00243">243</a> of file <a class="el" href="db_8c-source.html">db.c</a>.
<p>
References <a class="el" href="cli_8c-source.html#l00057">ast_cli()</a>, <a class="el" href="db_8c-source.html#l00145">ast_db_put()</a>, <a class="el" href="cli_8h-source.html#l00038">RESULT_SHOWUSAGE</a>, and <a class="el" href="cli_8h-source.html#l00037">RESULT_SUCCESS</a>.<div class="fragment"><pre class="fragment"><a name="l00244"></a>00244 {
<a name="l00245"></a>00245    <span class="keywordtype">int</span> res;
<a name="l00246"></a>00246    <span class="keywordflow">if</span> (argc != 5)
<a name="l00247"></a>00247       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d7f3bcd35c16172e6fc0964a175fcadb">RESULT_SHOWUSAGE</a>;
<a name="l00248"></a>00248    res = <a class="code" href="db_8c.html#64bcb3650812a7f83ccc47971e23bedd">ast_db_put</a>(argv[2], argv[3], argv[4]);
<a name="l00249"></a>00249    <span class="keywordflow">if</span> (res)  {
<a name="l00250"></a>00250       <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"Failed to update entry\n"</span>);
<a name="l00251"></a>00251    } <span class="keywordflow">else</span> {
<a name="l00252"></a>00252       <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"Updated database successfully\n"</span>);
<a name="l00253"></a>00253    }
<a name="l00254"></a>00254    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d92028a33e35e9d037718f4d846096f9">RESULT_SUCCESS</a>;
<a name="l00255"></a>00255 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="3acfb570fb1a8622d924173d9e8fc1f9"></a><!-- doxytag: member="db.c::database_show" ref="3acfb570fb1a8622d924173d9e8fc1f9" args="(int fd, int argc, char *argv[])" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int database_show           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em>[]</td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="db_8c-source.html#l00304">304</a> of file <a class="el" href="db_8c-source.html">db.c</a>.
<p>
References <a class="el" href="cli_8c-source.html#l00057">ast_cli()</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="db_8c-source.html#l00060">astdb</a>, <a class="el" href="db_8c-source.html#l00063">dbinit()</a>, <a class="el" href="func__channel_8c-source.html#l00149">key()</a>, <a class="el" href="db_8c-source.html#l00073">keymatch()</a>, <a class="el" href="res__crypto_8c-source.html#l00106">keys</a>, <a class="el" href="http_8c-source.html#l00109">prefix</a>, <a class="el" href="cli_8h-source.html#l00038">RESULT_SHOWUSAGE</a>, <a class="el" href="cli_8h-source.html#l00037">RESULT_SUCCESS</a>, and <a class="el" href="cdr__sqlite3__custom_8c-source.html#l00072">values</a>.<div class="fragment"><pre class="fragment"><a name="l00305"></a>00305 {
<a name="l00306"></a>00306    <span class="keywordtype">char</span> <a class="code" href="http_8c.html#93583f8993b24e7afddf9578925bd1d8">prefix</a>[256];
<a name="l00307"></a>00307    DBT <a class="code" href="func__channel_8c.html#87ef31d54f81072952c331d5c7339d8e">key</a>, <a class="code" href="structast__db__entry.html#59a6c49cfff82ce638c44fec9cd91ddb">data</a>;
<a name="l00308"></a>00308    <span class="keywordtype">char</span> *<a class="code" href="res__crypto_8c.html#14f802e1fba977727845e8872c1743a7">keys</a>, *<a class="code" href="cdr__sqlite3__custom_8c.html#745718bbe43a52774b8f96898d45740a">values</a>;
<a name="l00309"></a>00309    <span class="keywordtype">int</span> res;
<a name="l00310"></a>00310    <span class="keywordtype">int</span> pass;
<a name="l00311"></a>00311 
<a name="l00312"></a>00312    <span class="keywordflow">if</span> (argc == 4) {
<a name="l00313"></a>00313       <span class="comment">/* Family and key tree */</span>
<a name="l00314"></a>00314       snprintf(prefix, <span class="keyword">sizeof</span>(prefix), <span class="stringliteral">"/%s/%s"</span>, argv[2], argv[3]);
<a name="l00315"></a>00315    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argc == 3) {
<a name="l00316"></a>00316       <span class="comment">/* Family only */</span>
<a name="l00317"></a>00317       snprintf(prefix, <span class="keyword">sizeof</span>(prefix), <span class="stringliteral">"/%s"</span>, argv[2]);
<a name="l00318"></a>00318    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argc == 2) {
<a name="l00319"></a>00319       <span class="comment">/* Neither */</span>
<a name="l00320"></a>00320       prefix[0] = <span class="charliteral">'\0'</span>;
<a name="l00321"></a>00321    } <span class="keywordflow">else</span> {
<a name="l00322"></a>00322       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d7f3bcd35c16172e6fc0964a175fcadb">RESULT_SHOWUSAGE</a>;
<a name="l00323"></a>00323    }
<a name="l00324"></a>00324    <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;dblock);
<a name="l00325"></a>00325    <span class="keywordflow">if</span> (<a class="code" href="db_8c.html#c857b472b20815fc30d31312a5cf8088">dbinit</a>()) {
<a name="l00326"></a>00326       <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;dblock);
<a name="l00327"></a>00327       <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"Database unavailable\n"</span>);
<a name="l00328"></a>00328       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d92028a33e35e9d037718f4d846096f9">RESULT_SUCCESS</a>;  
<a name="l00329"></a>00329    }
<a name="l00330"></a>00330    memset(&amp;key, 0, <span class="keyword">sizeof</span>(key));
<a name="l00331"></a>00331    memset(&amp;data, 0, <span class="keyword">sizeof</span>(data));
<a name="l00332"></a>00332    pass = 0;
<a name="l00333"></a>00333    <span class="keywordflow">while</span> (!(res = <a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a>-&gt;seq(<a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a>, &amp;key, &amp;data, pass++ ? R_NEXT : R_FIRST))) {
<a name="l00334"></a>00334       <span class="keywordflow">if</span> (key.size) {
<a name="l00335"></a>00335          keys = key.data;
<a name="l00336"></a>00336          keys[key.size - 1] = <span class="charliteral">'\0'</span>;
<a name="l00337"></a>00337       } <span class="keywordflow">else</span> {
<a name="l00338"></a>00338          keys = <span class="stringliteral">"&lt;bad key&gt;"</span>;
<a name="l00339"></a>00339       }
<a name="l00340"></a>00340       <span class="keywordflow">if</span> (data.size) {
<a name="l00341"></a>00341          values = data.data;
<a name="l00342"></a>00342          values[data.size - 1]=<span class="charliteral">'\0'</span>;
<a name="l00343"></a>00343       } <span class="keywordflow">else</span> {
<a name="l00344"></a>00344          values = <span class="stringliteral">"&lt;bad value&gt;"</span>;
<a name="l00345"></a>00345       }
<a name="l00346"></a>00346       <span class="keywordflow">if</span> (<a class="code" href="db_8c.html#a91f08864414f9ac7b2a64c6f3bd725e">keymatch</a>(keys, prefix)) {
<a name="l00347"></a>00347             <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"%-50s: %-25s\n"</span>, keys, values);
<a name="l00348"></a>00348       }
<a name="l00349"></a>00349    }
<a name="l00350"></a>00350    <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;dblock);
<a name="l00351"></a>00351    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d92028a33e35e9d037718f4d846096f9">RESULT_SUCCESS</a>;  
<a name="l00352"></a>00352 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="c07dd7058d87c56143c7733b319c7e69"></a><!-- doxytag: member="db.c::database_showkey" ref="c07dd7058d87c56143c7733b319c7e69" args="(int fd, int argc, char *argv[])" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int database_showkey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em>[]</td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="db_8c-source.html#l00354">354</a> of file <a class="el" href="db_8c-source.html">db.c</a>.
<p>
References <a class="el" href="cli_8c-source.html#l00057">ast_cli()</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="db_8c-source.html#l00060">astdb</a>, <a class="el" href="db_8c-source.html#l00063">dbinit()</a>, <a class="el" href="func__channel_8c-source.html#l00149">key()</a>, <a class="el" href="res__crypto_8c-source.html#l00106">keys</a>, <a class="el" href="cli_8h-source.html#l00038">RESULT_SHOWUSAGE</a>, <a class="el" href="cli_8h-source.html#l00037">RESULT_SUCCESS</a>, <a class="el" href="db_8c-source.html#l00087">subkeymatch()</a>, and <a class="el" href="cdr__sqlite3__custom_8c-source.html#l00072">values</a>.<div class="fragment"><pre class="fragment"><a name="l00355"></a>00355 {
<a name="l00356"></a>00356    <span class="keywordtype">char</span> suffix[256];
<a name="l00357"></a>00357    DBT <a class="code" href="func__channel_8c.html#87ef31d54f81072952c331d5c7339d8e">key</a>, <a class="code" href="structast__db__entry.html#59a6c49cfff82ce638c44fec9cd91ddb">data</a>;
<a name="l00358"></a>00358    <span class="keywordtype">char</span> *<a class="code" href="res__crypto_8c.html#14f802e1fba977727845e8872c1743a7">keys</a>, *<a class="code" href="cdr__sqlite3__custom_8c.html#745718bbe43a52774b8f96898d45740a">values</a>;
<a name="l00359"></a>00359    <span class="keywordtype">int</span> res;
<a name="l00360"></a>00360    <span class="keywordtype">int</span> pass;
<a name="l00361"></a>00361    <span class="keywordtype">int</span> counter = 0;
<a name="l00362"></a>00362 
<a name="l00363"></a>00363    <span class="keywordflow">if</span> (argc == 3) {
<a name="l00364"></a>00364       <span class="comment">/* Key only */</span>
<a name="l00365"></a>00365       snprintf(suffix, <span class="keyword">sizeof</span>(suffix), <span class="stringliteral">"/%s"</span>, argv[2]);
<a name="l00366"></a>00366    } <span class="keywordflow">else</span> {
<a name="l00367"></a>00367       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d7f3bcd35c16172e6fc0964a175fcadb">RESULT_SHOWUSAGE</a>;
<a name="l00368"></a>00368    }
<a name="l00369"></a>00369    <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;dblock);
<a name="l00370"></a>00370    <span class="keywordflow">if</span> (<a class="code" href="db_8c.html#c857b472b20815fc30d31312a5cf8088">dbinit</a>()) {
<a name="l00371"></a>00371       <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;dblock);
<a name="l00372"></a>00372       <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"Database unavailable\n"</span>);
<a name="l00373"></a>00373       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d92028a33e35e9d037718f4d846096f9">RESULT_SUCCESS</a>;  
<a name="l00374"></a>00374    }
<a name="l00375"></a>00375    memset(&amp;key, 0, <span class="keyword">sizeof</span>(key));
<a name="l00376"></a>00376    memset(&amp;data, 0, <span class="keyword">sizeof</span>(data));
<a name="l00377"></a>00377    pass = 0;
<a name="l00378"></a>00378    <span class="keywordflow">while</span> (!(res = <a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a>-&gt;seq(<a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a>, &amp;key, &amp;data, pass++ ? R_NEXT : R_FIRST))) {
<a name="l00379"></a>00379       <span class="keywordflow">if</span> (key.size) {
<a name="l00380"></a>00380          keys = key.data;
<a name="l00381"></a>00381          keys[key.size - 1] = <span class="charliteral">'\0'</span>;
<a name="l00382"></a>00382       } <span class="keywordflow">else</span> {
<a name="l00383"></a>00383          keys = <span class="stringliteral">"&lt;bad key&gt;"</span>;
<a name="l00384"></a>00384       }
<a name="l00385"></a>00385       <span class="keywordflow">if</span> (data.size) {
<a name="l00386"></a>00386          values = data.data;
<a name="l00387"></a>00387          values[data.size - 1]=<span class="charliteral">'\0'</span>;
<a name="l00388"></a>00388       } <span class="keywordflow">else</span> {
<a name="l00389"></a>00389          values = <span class="stringliteral">"&lt;bad value&gt;"</span>;
<a name="l00390"></a>00390       }
<a name="l00391"></a>00391       <span class="keywordflow">if</span> (<a class="code" href="db_8c.html#378c635e95ce32ce5616e2a0202f6cc7">subkeymatch</a>(keys, suffix)) {
<a name="l00392"></a>00392             <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"%-50s: %-25s\n"</span>, keys, values);
<a name="l00393"></a>00393             counter++;
<a name="l00394"></a>00394       }
<a name="l00395"></a>00395    }
<a name="l00396"></a>00396    <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;dblock);
<a name="l00397"></a>00397    <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"%d results found.\n"</span>, counter);
<a name="l00398"></a>00398    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d92028a33e35e9d037718f4d846096f9">RESULT_SUCCESS</a>;  
<a name="l00399"></a>00399 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="c857b472b20815fc30d31312a5cf8088"></a><!-- doxytag: member="db.c::dbinit" ref="c857b472b20815fc30d31312a5cf8088" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int dbinit           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="db_8c-source.html#l00063">63</a> of file <a class="el" href="db_8c-source.html">db.c</a>.
<p>
References <a class="el" href="asterisk_8c-source.html#l00219">ast_config_AST_DB</a>, <a class="el" href="asterisk_8h-source.html#l00041">AST_FILE_MODE</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="db_8c-source.html#l00060">astdb</a>, and <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>.
<p>
Referenced by <a class="el" href="db_8c-source.html#l00214">ast_db_del()</a>, <a class="el" href="db_8c-source.html#l00100">ast_db_deltree()</a>, <a class="el" href="db_8c-source.html#l00172">ast_db_get()</a>, <a class="el" href="db_8c-source.html#l00401">ast_db_gettree()</a>, <a class="el" href="db_8c-source.html#l00145">ast_db_put()</a>, <a class="el" href="db_8c-source.html#l00643">astdb_init()</a>, <a class="el" href="db_8c-source.html#l00304">database_show()</a>, and <a class="el" href="db_8c-source.html#l00354">database_showkey()</a>.<div class="fragment"><pre class="fragment"><a name="l00064"></a>00064 {
<a name="l00065"></a>00065    <span class="keywordflow">if</span> (!<a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a> &amp;&amp; !(<a class="code" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a> = dbopen((<span class="keywordtype">char</span> *)<a class="code" href="asterisk_8c.html#876cf5a30ab9549d0f5d72d8fac4ab1c">ast_config_AST_DB</a>, O_CREAT | O_RDWR, <a class="code" href="asterisk_8h.html#40c72ca4a20a53b69eb99c554e214a82">AST_FILE_MODE</a>, DB_BTREE, NULL))) {
<a name="l00066"></a>00066       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Unable to open Asterisk database\n"</span>);
<a name="l00067"></a>00067       <span class="keywordflow">return</span> -1;
<a name="l00068"></a>00068    }
<a name="l00069"></a>00069    <span class="keywordflow">return</span> 0;
<a name="l00070"></a>00070 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a91f08864414f9ac7b2a64c6f3bd725e"></a><!-- doxytag: member="db.c::keymatch" ref="a91f08864414f9ac7b2a64c6f3bd725e" args="(const char *key, const char *prefix)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int keymatch           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>key</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>prefix</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [inline, static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="db_8c-source.html#l00073">73</a> of file <a class="el" href="db_8c-source.html">db.c</a>.
<p>
Referenced by <a class="el" href="db_8c-source.html#l00100">ast_db_deltree()</a>, <a class="el" href="db_8c-source.html#l00401">ast_db_gettree()</a>, and <a class="el" href="db_8c-source.html#l00304">database_show()</a>.<div class="fragment"><pre class="fragment"><a name="l00074"></a>00074 {
<a name="l00075"></a>00075    <span class="keywordtype">int</span> preflen = strlen(<a class="code" href="http_8c.html#93583f8993b24e7afddf9578925bd1d8">prefix</a>);
<a name="l00076"></a>00076    <span class="keywordflow">if</span> (!preflen)
<a name="l00077"></a>00077       <span class="keywordflow">return</span> 1;
<a name="l00078"></a>00078    <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="func__channel_8c.html#87ef31d54f81072952c331d5c7339d8e">key</a>, <a class="code" href="http_8c.html#93583f8993b24e7afddf9578925bd1d8">prefix</a>))
<a name="l00079"></a>00079       <span class="keywordflow">return</span> 1;
<a name="l00080"></a>00080    <span class="keywordflow">if</span> ((strlen(<a class="code" href="func__channel_8c.html#87ef31d54f81072952c331d5c7339d8e">key</a>) &gt; preflen) &amp;&amp; !strncasecmp(<a class="code" href="func__channel_8c.html#87ef31d54f81072952c331d5c7339d8e">key</a>, <a class="code" href="http_8c.html#93583f8993b24e7afddf9578925bd1d8">prefix</a>, preflen)) {
<a name="l00081"></a>00081       <span class="keywordflow">if</span> (<a class="code" href="func__channel_8c.html#87ef31d54f81072952c331d5c7339d8e">key</a>[preflen] == <span class="charliteral">'/'</span>)
<a name="l00082"></a>00082          <span class="keywordflow">return</span> 1;
<a name="l00083"></a>00083    }
<a name="l00084"></a>00084    <span class="keywordflow">return</span> 0;
<a name="l00085"></a>00085 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="489adf32d1a534c047d92b2d0076b911"></a><!-- doxytag: member="db.c::manager_dbdel" ref="489adf32d1a534c047d92b2d0076b911" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int manager_dbdel           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="db_8c-source.html#l00594">594</a> of file <a class="el" href="db_8c-source.html">db.c</a>.
<p>
References <a class="el" href="db_8c-source.html#l00214">ast_db_del()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00864">astman_send_ack()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, and <a class="el" href="func__channel_8c-source.html#l00149">key()</a>.
<p>
Referenced by <a class="el" href="db_8c-source.html#l00643">astdb_init()</a>.<div class="fragment"><pre class="fragment"><a name="l00595"></a>00595 {
<a name="l00596"></a>00596    <span class="keyword">const</span> <span class="keywordtype">char</span> *family = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Family"</span>);
<a name="l00597"></a>00597    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="func__channel_8c.html#87ef31d54f81072952c331d5c7339d8e">key</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Key"</span>);
<a name="l00598"></a>00598    <span class="keywordtype">int</span> res;
<a name="l00599"></a>00599 
<a name="l00600"></a>00600    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(family)) {
<a name="l00601"></a>00601       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"No family specified."</span>);
<a name="l00602"></a>00602       <span class="keywordflow">return</span> 0;
<a name="l00603"></a>00603    }
<a name="l00604"></a>00604 
<a name="l00605"></a>00605    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(key)) {
<a name="l00606"></a>00606       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"No key specified."</span>);
<a name="l00607"></a>00607       <span class="keywordflow">return</span> 0;
<a name="l00608"></a>00608    }
<a name="l00609"></a>00609 
<a name="l00610"></a>00610    res = <a class="code" href="db_8c.html#c2c657f2d37dd1dc1aca774f16b5a4a4">ast_db_del</a>(family, key);
<a name="l00611"></a>00611    <span class="keywordflow">if</span> (res)
<a name="l00612"></a>00612       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Database entry not found"</span>);
<a name="l00613"></a>00613    <span class="keywordflow">else</span>
<a name="l00614"></a>00614       <a class="code" href="group__Group__AMI.html#g0c64878b307241bfe01cea67e09f49e2">astman_send_ack</a>(s, m, <span class="stringliteral">"Key deleted successfully"</span>);
<a name="l00615"></a>00615 
<a name="l00616"></a>00616    <span class="keywordflow">return</span> 0;
<a name="l00617"></a>00617 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="13190961f97155bcd5301b8bdc47b32e"></a><!-- doxytag: member="db.c::manager_dbdeltree" ref="13190961f97155bcd5301b8bdc47b32e" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int manager_dbdeltree           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="db_8c-source.html#l00619">619</a> of file <a class="el" href="db_8c-source.html">db.c</a>.
<p>
References <a class="el" href="db_8c-source.html#l00100">ast_db_deltree()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00864">astman_send_ack()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, and <a class="el" href="func__channel_8c-source.html#l00149">key()</a>.
<p>
Referenced by <a class="el" href="db_8c-source.html#l00643">astdb_init()</a>.<div class="fragment"><pre class="fragment"><a name="l00620"></a>00620 {
<a name="l00621"></a>00621    <span class="keyword">const</span> <span class="keywordtype">char</span> *family = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Family"</span>);
<a name="l00622"></a>00622    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="func__channel_8c.html#87ef31d54f81072952c331d5c7339d8e">key</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Key"</span>);
<a name="l00623"></a>00623    <span class="keywordtype">int</span> res;
<a name="l00624"></a>00624 
<a name="l00625"></a>00625    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(family)) {
<a name="l00626"></a>00626       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"No family specified."</span>);
<a name="l00627"></a>00627       <span class="keywordflow">return</span> 0;
<a name="l00628"></a>00628    }
<a name="l00629"></a>00629 
<a name="l00630"></a>00630    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(key))
<a name="l00631"></a>00631       res = <a class="code" href="db_8c.html#5d82f4659e09c74ec7d2509d149256f1">ast_db_deltree</a>(family, key);
<a name="l00632"></a>00632    <span class="keywordflow">else</span>
<a name="l00633"></a>00633       res = <a class="code" href="db_8c.html#5d82f4659e09c74ec7d2509d149256f1">ast_db_deltree</a>(family, NULL);
<a name="l00634"></a>00634 
<a name="l00635"></a>00635    <span class="keywordflow">if</span> (res)
<a name="l00636"></a>00636       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Database entry not found"</span>);
<a name="l00637"></a>00637    <span class="keywordflow">else</span>
<a name="l00638"></a>00638       <a class="code" href="group__Group__AMI.html#g0c64878b307241bfe01cea67e09f49e2">astman_send_ack</a>(s, m, <span class="stringliteral">"Key tree deleted successfully"</span>);
<a name="l00639"></a>00639    
<a name="l00640"></a>00640    <span class="keywordflow">return</span> 0;
<a name="l00641"></a>00641 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="c2a39921a6d94211a25b4f06e69cf111"></a><!-- doxytag: member="db.c::manager_dbget" ref="c2a39921a6d94211a25b4f06e69cf111" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int manager_dbget           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="db_8c-source.html#l00557">557</a> of file <a class="el" href="db_8c-source.html">db.c</a>.
<p>
References <a class="el" href="db_8c-source.html#l00172">ast_db_get()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="manager_8c-source.html#l00802">astman_append()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00864">astman_send_ack()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, and <a class="el" href="func__channel_8c-source.html#l00149">key()</a>.
<p>
Referenced by <a class="el" href="db_8c-source.html#l00643">astdb_init()</a>.<div class="fragment"><pre class="fragment"><a name="l00558"></a>00558 {
<a name="l00559"></a>00559    <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m,<span class="stringliteral">"ActionID"</span>);
<a name="l00560"></a>00560    <span class="keywordtype">char</span> idText[256] = <span class="stringliteral">""</span>;
<a name="l00561"></a>00561    <span class="keyword">const</span> <span class="keywordtype">char</span> *family = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Family"</span>);
<a name="l00562"></a>00562    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="func__channel_8c.html#87ef31d54f81072952c331d5c7339d8e">key</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Key"</span>);
<a name="l00563"></a>00563    <span class="keywordtype">char</span> tmp[256];
<a name="l00564"></a>00564    <span class="keywordtype">int</span> res;
<a name="l00565"></a>00565 
<a name="l00566"></a>00566    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(family)) {
<a name="l00567"></a>00567       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"No family specified."</span>);
<a name="l00568"></a>00568       <span class="keywordflow">return</span> 0;
<a name="l00569"></a>00569    }
<a name="l00570"></a>00570    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(key)) {
<a name="l00571"></a>00571       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"No key specified."</span>);
<a name="l00572"></a>00572       <span class="keywordflow">return</span> 0;
<a name="l00573"></a>00573    }
<a name="l00574"></a>00574 
<a name="l00575"></a>00575    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(<span class="keywordtype">id</span>))
<a name="l00576"></a>00576       snprintf(idText, <span class="keyword">sizeof</span>(idText) ,<span class="stringliteral">"ActionID: %s\r\n"</span>, <span class="keywordtype">id</span>);
<a name="l00577"></a>00577 
<a name="l00578"></a>00578    res = <a class="code" href="db_8c.html#b231f400b91f7d6fc366d33bf95beb5b">ast_db_get</a>(family, key, tmp, <span class="keyword">sizeof</span>(tmp));
<a name="l00579"></a>00579    <span class="keywordflow">if</span> (res) {
<a name="l00580"></a>00580       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Database entry not found"</span>);
<a name="l00581"></a>00581    } <span class="keywordflow">else</span> {
<a name="l00582"></a>00582       <a class="code" href="group__Group__AMI.html#g0c64878b307241bfe01cea67e09f49e2">astman_send_ack</a>(s, m, <span class="stringliteral">"Result will follow"</span>);
<a name="l00583"></a>00583       <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"Event: DBGetResponse\r\n"</span>
<a name="l00584"></a>00584             <span class="stringliteral">"Family: %s\r\n"</span>
<a name="l00585"></a>00585             <span class="stringliteral">"Key: %s\r\n"</span>
<a name="l00586"></a>00586             <span class="stringliteral">"Val: %s\r\n"</span>
<a name="l00587"></a>00587             <span class="stringliteral">"%s"</span>
<a name="l00588"></a>00588             <span class="stringliteral">"\r\n"</span>,
<a name="l00589"></a>00589             family, key, tmp, idText);
<a name="l00590"></a>00590    }
<a name="l00591"></a>00591    <span class="keywordflow">return</span> 0;
<a name="l00592"></a>00592 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="88ff77a9e9c584cea2b64503e085d041"></a><!-- doxytag: member="db.c::manager_dbput" ref="88ff77a9e9c584cea2b64503e085d041" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int manager_dbput           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="db_8c-source.html#l00528">528</a> of file <a class="el" href="db_8c-source.html">db.c</a>.
<p>
References <a class="el" href="db_8c-source.html#l00145">ast_db_put()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00864">astman_send_ack()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, and <a class="el" href="func__channel_8c-source.html#l00149">key()</a>.
<p>
Referenced by <a class="el" href="db_8c-source.html#l00643">astdb_init()</a>.<div class="fragment"><pre class="fragment"><a name="l00529"></a>00529 {
<a name="l00530"></a>00530    <span class="keyword">const</span> <span class="keywordtype">char</span> *family = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Family"</span>);
<a name="l00531"></a>00531    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="func__channel_8c.html#87ef31d54f81072952c331d5c7339d8e">key</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Key"</span>);
<a name="l00532"></a>00532    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structval.html">val</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Val"</span>);
<a name="l00533"></a>00533    <span class="keywordtype">int</span> res;
<a name="l00534"></a>00534 
<a name="l00535"></a>00535    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(family)) {
<a name="l00536"></a>00536       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"No family specified"</span>);
<a name="l00537"></a>00537       <span class="keywordflow">return</span> 0;
<a name="l00538"></a>00538    }
<a name="l00539"></a>00539    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(key)) {
<a name="l00540"></a>00540       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"No key specified"</span>);
<a name="l00541"></a>00541       <span class="keywordflow">return</span> 0;
<a name="l00542"></a>00542    }
<a name="l00543"></a>00543    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(val)) {
<a name="l00544"></a>00544       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"No val specified"</span>);
<a name="l00545"></a>00545       <span class="keywordflow">return</span> 0;
<a name="l00546"></a>00546    }
<a name="l00547"></a>00547 
<a name="l00548"></a>00548    res = <a class="code" href="db_8c.html#64bcb3650812a7f83ccc47971e23bedd">ast_db_put</a>(family, key, val);
<a name="l00549"></a>00549    <span class="keywordflow">if</span> (res) {
<a name="l00550"></a>00550       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Failed to update entry"</span>);
<a name="l00551"></a>00551    } <span class="keywordflow">else</span> {
<a name="l00552"></a>00552       <a class="code" href="group__Group__AMI.html#g0c64878b307241bfe01cea67e09f49e2">astman_send_ack</a>(s, m, <span class="stringliteral">"Updated database successfully"</span>);
<a name="l00553"></a>00553    }
<a name="l00554"></a>00554    <span class="keywordflow">return</span> 0;
<a name="l00555"></a>00555 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="378c635e95ce32ce5616e2a0202f6cc7"></a><!-- doxytag: member="db.c::subkeymatch" ref="378c635e95ce32ce5616e2a0202f6cc7" args="(const char *key, const char *suffix)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int subkeymatch           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>key</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>suffix</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [inline, static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="db_8c-source.html#l00087">87</a> of file <a class="el" href="db_8c-source.html">db.c</a>.
<p>
Referenced by <a class="el" href="db_8c-source.html#l00354">database_showkey()</a>.<div class="fragment"><pre class="fragment"><a name="l00088"></a>00088 {
<a name="l00089"></a>00089    <span class="keywordtype">int</span> suffixlen = strlen(suffix);
<a name="l00090"></a>00090    <span class="keywordflow">if</span> (suffixlen) {
<a name="l00091"></a>00091       <span class="keyword">const</span> <span class="keywordtype">char</span> *subkey = <a class="code" href="func__channel_8c.html#87ef31d54f81072952c331d5c7339d8e">key</a> + strlen(<a class="code" href="func__channel_8c.html#87ef31d54f81072952c331d5c7339d8e">key</a>) - suffixlen;
<a name="l00092"></a>00092       <span class="keywordflow">if</span> (subkey &lt; <a class="code" href="func__channel_8c.html#87ef31d54f81072952c331d5c7339d8e">key</a>)
<a name="l00093"></a>00093          <span class="keywordflow">return</span> 0;
<a name="l00094"></a>00094       <span class="keywordflow">if</span> (!strcasecmp(subkey, suffix))
<a name="l00095"></a>00095          <span class="keywordflow">return</span> 1;
<a name="l00096"></a>00096    }
<a name="l00097"></a>00097    <span class="keywordflow">return</span> 0;
<a name="l00098"></a>00098 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="85f000e2bc62faee17332cf781ad4227"></a><!-- doxytag: member="db.c::astdb" ref="85f000e2bc62faee17332cf781ad4227" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">DB* <a class="el" href="db_8c.html#85f000e2bc62faee17332cf781ad4227">astdb</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="db_8c-source.html#l00060">60</a> of file <a class="el" href="db_8c-source.html">db.c</a>.
<p>
Referenced by <a class="el" href="db_8c-source.html#l00214">ast_db_del()</a>, <a class="el" href="db_8c-source.html#l00100">ast_db_deltree()</a>, <a class="el" href="db_8c-source.html#l00172">ast_db_get()</a>, <a class="el" href="db_8c-source.html#l00401">ast_db_gettree()</a>, <a class="el" href="db_8c-source.html#l00145">ast_db_put()</a>, <a class="el" href="db_8c-source.html#l00304">database_show()</a>, <a class="el" href="db_8c-source.html#l00354">database_showkey()</a>, and <a class="el" href="db_8c-source.html#l00063">dbinit()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="72d3b53f7516a86b85a9d93a183aa81a"></a><!-- doxytag: member="db.c::cli_database" ref="72d3b53f7516a86b85a9d93a183aa81a" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> <a class="el" href="db_8c.html#72d3b53f7516a86b85a9d93a183aa81a">cli_database</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="db_8c-source.html#l00502">502</a> of file <a class="el" href="db_8c-source.html">db.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="30ac7158aaa9f4ae45b94cd9de76e2b4"></a><!-- doxytag: member="db.c::database_del_usage" ref="30ac7158aaa9f4ae45b94cd9de76e2b4" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char <a class="el" href="db_8c.html#30ac7158aaa9f4ae45b94cd9de76e2b4">database_del_usage</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
<span class="stringliteral">"Usage: database del &lt;family&gt; &lt;key&gt;\n"</span>
<span class="stringliteral">"       Deletes an entry in the Asterisk database for a given\n"</span>
<span class="stringliteral">"family and key.\n"</span>
</pre></div>
<p>
Definition at line <a class="el" href="db_8c-source.html#l00492">492</a> of file <a class="el" href="db_8c-source.html">db.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="dd0c221c376cb4a45b237e1d9873c8de"></a><!-- doxytag: member="db.c::database_deltree_usage" ref="dd0c221c376cb4a45b237e1d9873c8de" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char <a class="el" href="db_8c.html#dd0c221c376cb4a45b237e1d9873c8de">database_deltree_usage</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
<span class="stringliteral">"Usage: database deltree &lt;family&gt; [keytree]\n"</span>
<span class="stringliteral">"       Deletes a family or specific keytree within a family\n"</span>
<span class="stringliteral">"in the Asterisk database.\n"</span>
</pre></div>
<p>
Definition at line <a class="el" href="db_8c-source.html#l00497">497</a> of file <a class="el" href="db_8c-source.html">db.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="cbaefee4c21ba22cd8838ca3ad544f86"></a><!-- doxytag: member="db.c::database_get_usage" ref="cbaefee4c21ba22cd8838ca3ad544f86" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char <a class="el" href="db_8c.html#cbaefee4c21ba22cd8838ca3ad544f86">database_get_usage</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
<span class="stringliteral">"Usage: database get &lt;family&gt; &lt;key&gt;\n"</span>
<span class="stringliteral">"       Retrieves an entry in the Asterisk database for a given\n"</span>
<span class="stringliteral">"family and key.\n"</span>
</pre></div>
<p>
Definition at line <a class="el" href="db_8c-source.html#l00487">487</a> of file <a class="el" href="db_8c-source.html">db.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="7b886ab534d8f8fd2e877b7f5e2fae0a"></a><!-- doxytag: member="db.c::database_put_usage" ref="7b886ab534d8f8fd2e877b7f5e2fae0a" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char <a class="el" href="db_8c.html#7b886ab534d8f8fd2e877b7f5e2fae0a">database_put_usage</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
<span class="stringliteral">"Usage: database put &lt;family&gt; &lt;key&gt; &lt;value&gt;\n"</span>
<span class="stringliteral">"       Adds or updates an entry in the Asterisk database for\n"</span>
<span class="stringliteral">"a given family, key, and value.\n"</span>
</pre></div>
<p>
Definition at line <a class="el" href="db_8c-source.html#l00482">482</a> of file <a class="el" href="db_8c-source.html">db.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="6aec1394ad3414cad2eb1925acf60bc7"></a><!-- doxytag: member="db.c::database_show_usage" ref="6aec1394ad3414cad2eb1925acf60bc7" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char <a class="el" href="db_8c.html#6aec1394ad3414cad2eb1925acf60bc7">database_show_usage</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
<span class="stringliteral">"Usage: database show [family [keytree]]\n"</span>
<span class="stringliteral">"       Shows Asterisk database contents, optionally restricted\n"</span>
<span class="stringliteral">"to a given family, or family and keytree.\n"</span>
</pre></div>
<p>
Definition at line <a class="el" href="db_8c-source.html#l00473">473</a> of file <a class="el" href="db_8c-source.html">db.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="4eb01a74c9e39379e14c8c29582fb6c6"></a><!-- doxytag: member="db.c::database_showkey_usage" ref="4eb01a74c9e39379e14c8c29582fb6c6" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char <a class="el" href="db_8c.html#4eb01a74c9e39379e14c8c29582fb6c6">database_showkey_usage</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
<span class="stringliteral">"Usage: database showkey &lt;keytree&gt;\n"</span>
<span class="stringliteral">"       Shows Asterisk database contents, restricted to a given key.\n"</span>
</pre></div>
<p>
Definition at line <a class="el" href="db_8c-source.html#l00478">478</a> of file <a class="el" href="db_8c-source.html">db.c</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu May 24 22:27:26 2007 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.5 </small></address>
</body>
</html>
