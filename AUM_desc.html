<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (24 May 2007)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Thu May 24 22:27:57 2007</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<h1><a class="anchor" name="AUM_desc">Asterisk User Managment - ASTUM - module</a></h1><dl compact><dt><b>What is ASTUM?</b></dt><dd>The ASTUM module implements common user management. A user can have one or several voicemail accounts, phones, IM accounts and other properties. A common user module mamkes it easier to manage passwords, e-mail addresses and properties that belong to the person who manages a device.</dd></dl>
<dl compact><dt><b></b></dt><dd>In ASTUM-enabled Asterisk modules (channels, applications, functions) you can refer to the AUMid and thus fetch configuration data from the ASTUM module for common properties.</dd></dl>
<dl compact><dt><b>Currently these modules support AUM:</b></dt><dd><ul>
<li>none</li></ul>
</dd></dl>
<dl compact><dt><b>Modules that may benefit from implementing AUM</b></dt><dd><ul>
<li>all channel drivers</li><li><a class="el" href="app__disa_8c.html">app_disa.c</a></li><li><a class="el" href="app__voicemail_8c.html">app_voicemail.c</a></li><li><a class="el" href="app__meetme_8c.html">app_meetme.c</a></li><li><a class="el" href="manager_8c.html">manager.c</a></li><li>The Asterisk CLI</li><li>Parking</li></ul>
</dd></dl>
<dl compact><dt><b>The ASTUM User object</b></dt><dd>The ASTUM user object consist of one general structure and linked lists for addresses, contexts and groups. When installed, the user inherit properties from the groups. <ul>
<li><a class="el" href="structaum__user.html">aum_user</a> The user object </li>
<li><a class="el" href="structaum__group.html">aum_group</a> The group object</li>
</ul>
</dd></dl>
<dl compact><dt><b></b></dt><dd>The user has a presence state that can be checked with a dial plan function. Presence can be changed from a SIP phone with publish or linked to an IM account (if there's code support for it).</dd></dl>
<dl compact><dt><b>The ASTUM Address Object</b></dt><dd>The address object consists of a type and a text string. The type can be a phone number, SIP uri, IAX number or cell phone number.</dd></dl>
We will not add an address type for each service provider out there. Instead, there are five "custom" addresses. These will be configurable so that they can have different labels, depending upon your configuration.<p>
<dl compact><dt><b>The ASTUM group object</b></dt><dd>Group objects are "master" objects that the User inherits properties from.</dd></dl>
There are dial plan functions to check if a user belongs to a user group or not.<p>
<dl compact><dt><b>The ASTUM context object</b></dt><dd>... </dd></dl>
<dl compact><dt><b>The ASTUM string object</b></dt><dd>The AUM string object is an encapsulation of a normal C character string, terminated with a zero character. It is a linked list of strings where each string is clearly marked with character set. If a different character set is asked for, the string handling functions will convert and add a new string in a linked list from the first one.</dd></dl>
<ul>
<li>String objects are created with <a class="el" href="astum_8h.html#1b2d57e8039de5eee85e4112c87799c6">aum_string_alloc()</a></li><li>String objects are destroyed with <a class="el" href="astum_8h.html#0a6bc70cf29eff252165312c9e7faba2">aum_string_destroy()</a></li></ul>
<p>
<dl compact><dt><b>Ideas for AUM presence</b></dt><dd></dd></dl>
Basically, we need to have a few classical PBX presence indicators with major status and substatus<ul>
<li>Away<ul>
<li>Meeting</li><li>Sick</li><li>Travelling</li></ul>
</li><li>Meeting</li><li>Busy</li><li>Not reachable (system error, network error)</li><li>Custom<ul>
<li>Custom</li></ul>
</li><li>Agent specific statuses</li></ul>
<p>
For each user, a chain of events need to maintained, current and future events. The handling of past events is up to another system.<p>
<ul>
<li>For each user, we need to keep track of next planned change.</li><li>For planned event changes, check whether the time is mandatory (should be executed) or a suggestion (don't time out, just keep current status while waiting for status change). Example:<ul>
<li>Meeting is planned to 13:00, but ran over to 14:15</li><li>I am busy to 10:45, open my phone after that.</li></ul>
</li></ul>
<p>
<ul>
<li>We need to store events somewhere (event silo) between reloads</li><li>Events can come in trough dial plan or manager</li><li>Current user status can be changed through dialplan functions, manager or IM channels/gateways (Jabber, SIP, other)</li><li>We need to synch status levels with other IM (SIMPLE/Jabber/XMPP)</li></ul>
<p>
<dl compact><dt><b>Realtime usage</b></dt><dd>ASTUM uses ARA - the realtime architecture - to load users and groups. The realtime handles for AUM is<ul>
<li><b>aumusers</b> For users</li><li><b>aumgroups</b> For the realtime groups</li></ul>
</dd></dl>
ASTUM will cache realtime users in memory after we load them. Every time a realtime user is accessed, it's moved to top of the cache. When we reach the maximum number of cached users, ASTUM mwill delete from the bottom of the cache while adding the missing user to the top.<p>
(Actually, the cache is implemented upside down, but I guess that does not matter.)<p>
The ASTUM cache size will be configurable in the general section of astum.conf<p>
<dl compact><dt><b>Channel usage</b></dt><dd>For channels, they can register a device that belongs to a user in combination with a callback function. It that callback is registred, it will be called each time a user state changes.</dd></dl>
<dl compact><dt><b>Things to do</b></dt><dd><ul>
<li>Implement all core AUM api functions from aum.h<ul>
<li>Revise the list</li></ul>
</li><li>Implement needed function in config engine (if needed)</li><li>Implement manager functions for AUM<ul>
<li>Read presence</li><li>Change presence</li></ul>
</li><li>Implement dial plan functions<ul>
<li>belong_to_group</li><li>check_presence</li><li>get_email_address</li><li>get_sip_address</li></ul>
</li><li>Implement AUM in channel drivers<ul>
<li>Implement in <a class="el" href="chan__sip_8c.html">chan_sip.c</a></li><li>Implement in <a class="el" href="chan__iax2_8c.html">chan_iax2.c</a></li></ul>
</li><li>Implement AUM in applications<ul>
<li>Implement AUM in <a class="el" href="app__disa_8c.html">app_disa.c</a></li><li>Implement AUM in <a class="el" href="app__voicemail_8c.html">app_voicemail.c</a></li></ul>
</li><li>Implement AUM functions<ul>
<li>Callback to register devices with AUM - $AUMUSERPHONE()</li></ul>
</li><li>Check if we can merge AUM with<ul>
<li>mogorman's jabber patch</li><li>file's SIP messaging patch</li></ul>
</li><li>Can we use aum_groups as callgroups/pickupgroups?</li><li>Internationalization issues<ul>
<li>Learn how to use utf-8 in source code and convert between different strings (firstname, lastname, sip uri etc)</li><li>Figure out what character set is used in config and relatime</li></ul>
</li><li>Investigate the possibility of a chan_user as a proxy channel (ssokol's idea)</li><li>Implement channel registration and callbacks</li><li>Continue with other projects</li><li><b>Remember:</b> It's only software </li></ul>
</dd></dl>
<hr size="1"><address style="align: right;"><small>Generated on Thu May 24 22:27:57 2007 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.5 </small></address>
</body>
</html>
