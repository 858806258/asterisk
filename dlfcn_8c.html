<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (24 May 2007)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Thu May 24 22:27:26 2007</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Fmain_2F.html">main</a></div>
<h1>dlfcn.c File Reference</h1><code>#include &lt;pthread.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;sys/types.h&gt;</code><br>
<code>#include &lt;sys/stat.h&gt;</code><br>
<code>#include &lt;stdarg.h&gt;</code><br>
<code>#include &lt;limits.h&gt;</code><br>
<code>#include &lt;mach-o/dyld.h&gt;</code><br>
<code>#include &lt;mach-o/nlist.h&gt;</code><br>
<code>#include &lt;mach-o/getsect.h&gt;</code><br>
<code>#include &quot;<a class="el" href="dlfcn-compat_8h-source.html">asterisk/dlfcn-compat.h</a>&quot;</code><br>

<p>
<a href="dlfcn_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdlstatus.html">dlstatus</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdlthread.html">dlthread</a></td></tr>

<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#417d50b03cc7e465a0d7e8510f183a1b">__BSD_VISIBLE</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#623f5284ca0d69050730d335ec3322c8">DL_IN_LIST</a>&nbsp;&nbsp;&nbsp;0x01</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#e3405fce965daa65a1561ec53eafb46b">dl_restrict</a>&nbsp;&nbsp;&nbsp;__restrict</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#13e7fe79d8e74ad50d94f63a2555d768">ERR_STR_LEN</a>&nbsp;&nbsp;&nbsp;251</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#fa155e16fdd5262004d5e3f58b998545">LC_LOAD_WEAK_DYLIB</a>&nbsp;&nbsp;&nbsp;(0x18 | LC_REQ_DYLD)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#ac5f51f867038347e9ac45defd1b26a9">LC_REQ_DYLD</a>&nbsp;&nbsp;&nbsp;0x80000000</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#7a6b0bdbbd9df80fd3f1044b33625543">MAGIC_DYLIB_MOD</a>&nbsp;&nbsp;&nbsp;((NSModule) 'DYMO')</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#833480468fa097cbd87d801ddbb89555">MAGIC_DYLIB_OFI</a>&nbsp;&nbsp;&nbsp;((NSObjectFileImage) 'DYOF')</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#2de067226d09024de7279a081ca98e05">MAX_SEARCH_PATHS</a>&nbsp;&nbsp;&nbsp;32</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#8bef999e98f5b17a42537ade68c2db1d">NSADDIMAGE_OPTION_RETURN_ON_ERROR</a>&nbsp;&nbsp;&nbsp;0x1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#87a157769830554a61b43585b3f66e05">NSADDIMAGE_OPTION_RETURN_ONLY_IF_LOADED</a>&nbsp;&nbsp;&nbsp;0x4</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#cc050e8021ee1d5275232968a4c8e381">NSLOOKUPSYMBOLINIMAGE_OPTION_BIND</a>&nbsp;&nbsp;&nbsp;0x0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#093a56fc66d422a12e681349f7fc31ee">NSLOOKUPSYMBOLINIMAGE_OPTION_RETURN_ON_ERROR</a>&nbsp;&nbsp;&nbsp;0x4</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#a4a62b2b396a125e09b721c4b48d19e9">RTLD_SELF</a>&nbsp;&nbsp;&nbsp;((void *) -3)</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structdlstatus.html">dlstatus</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#f9967e34823d8729bf12f0fad36a885d">allocStatus</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#1de850617a0e5f1b0585915acf78781b">debug</a> (const char *<a class="el" href="strings_8h.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>,...)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#d8cea3d64aea155f9baf923941850689">dladdr</a> (const void *dl_restrict p, <a class="el" href="structdl__info.html">Dl_info</a> *dl_restrict info)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#45a2f0c60f9c16390e6878ecc49d436d">dlclose</a> (void *handle)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#03f64046de974f91c1e196b315f17a6f">dlcompat_cleanup</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#83f7d76f85298415785439b62103645f">dlcompat_init_func</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#f4f18e7a664d25663c1a235c1fc7fade">dlerror</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#ce385803b09da205cc80aafca2fb1d11">dlerrorfree</a> (void *data)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#d4ea5e7e662612dc0e5a7ad0ff1e33b0">dlopen</a> (const char *path, int mode)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#def04fd1fe7f4abea4e0f3df9745048d">dlsym</a> (void *dl_restrict handle, const char *dl_restrict symbol)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#fbd7fb3690c8eff254f2690e831547b0">dlsymIntern</a> (struct <a class="el" href="structdlstatus.html">dlstatus</a> *dls, const char *symbol, int canSetError)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#3173031af7d4b847c50f22264d505a2a">dolock</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#1db4dbf9ea9f28b2fb35656635a0bebe">dounlock</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#c19c49edbff5e86e5280ee9f4c132344">dyld_error_str</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a> (const char *str,...)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const struct stat *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#5ce6066f9cbcf99b3cc6d47bc288daa8">findFile</a> (const char *<a class="el" href="utils_8h.html#8c7dd922ad47494fc02c388e12c00eac">file</a>, const char **fullPath)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#0b7d7a9f21dd25d6dc50d712552f343a">get_lib_name</a> (const struct mach_header *mh)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const struct mach_header *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#980566f5f6d3ca4e4f01c5d3cced8327">get_mach_header_from_NSModule</a> (NSModule *mod)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#b0b1ae2c747ce1724f672c6b823a6e80">getFullPath</a> (int i, const char *<a class="el" href="utils_8h.html#8c7dd922ad47494fc02c388e12c00eac">file</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#d51feb8815c9b0ac6afdcc317a0feded">getSearchPath</a> (int i)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const struct mach_header *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#edd4c3613a03834168b85d9192559af3">image_for_address</a> (const void *address)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#873dbb061fe03446f7abde7d232472c5">insertStatus</a> (struct <a class="el" href="structdlstatus.html">dlstatus</a> *dls, const struct stat *sbuf)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#de1ac04ff9536258d5099cd4ed3f0b84">isFlagSet</a> (int mode, int flag)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#94cc9569b7b9d1547f14f2ce0e5512cd">isValidStatus</a> (struct <a class="el" href="structdlstatus.html">dlstatus</a> *status)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structdlstatus.html">dlstatus</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#3ccd00c1b00c0a0c2098a526ed71fe32">loadModule</a> (const char *path, const struct stat *sbuf, int mode)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structdlstatus.html">dlstatus</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#302bcae6e1b779aec6b07c4891b9283f">lookupStatus</a> (const struct stat *sbuf)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const struct mach_header *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#34ff4ec7602f0ad36f2c5c5429ded9d0">my_find_image</a> (const char *<a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#55fad2fd5c7e0789f8c4b9d5e7ff4ffc">promoteLocalToGlobal</a> (struct <a class="el" href="structdlstatus.html">dlstatus</a> *dls)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#f9549c9322f3ac5e9f28e0bb7552f8a1">reference</a> (struct <a class="el" href="structdlstatus.html">dlstatus</a> *dls, int mode)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#f79dfe72a8a68fc21a7a43fdebe8771e">resetdlerror</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#9ca53afb0b5ad93c065fa8cd9608020e">safegetenv</a> (const char *s)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static NSSymbol *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#998125cc2be835ee34124f5221bdafce">search_linked_libs</a> (const struct mach_header *mh, const char *symbol)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#e3b786dcfbda95c5708dc4e648cb3fd8">searchList</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#a0054ad56afd71085b56813f21a1544c">warning</a> (const char *str)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static pthread_mutex_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#35bc2d3415a9f63bc5686e02a0f03883">dlcompat_mutex</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static pthread_key_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#446c9e2cac70c4a3977923451eea13da">dlerror_key</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const struct mach_header *(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#83168d8db5a85df2b3e7898c1230942f">dyld_NSAddImage</a> )(const char *, unsigned long)=0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#8efc76b493fa04cbcff731ebe67cb41f">dyld_NSIsSymbolNameDefinedInImage</a> )(const struct mach_header *, const char *)=0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static NSSymbol(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#9fc4abd8c5aaaa341566cf1cac760b38">dyld_NSLookupSymbolInImage</a> )(const struct mach_header *, const char *, unsigned long)=0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structdlstatus.html">dlstatus</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#86560ade58b777fa6f8f47ff729fee69">mainStatus</a> = { 0, MAGIC_DYLIB_MOD, NULL, -1, RTLD_GLOBAL, 0, 0, 0 }</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structdlstatus.html">dlstatus</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn_8c.html#263ae105fbf479a73d0cacf0db8538dd">stqueue</a> = &amp;<a class="el" href="dlfcn_8c.html#86560ade58b777fa6f8f47ff729fee69">mainStatus</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="417d50b03cc7e465a0d7e8510f183a1b"></a><!-- doxytag: member="dlfcn.c::__BSD_VISIBLE" ref="417d50b03cc7e465a0d7e8510f183a1b" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define __BSD_VISIBLE&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00048">48</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="623f5284ca0d69050730d335ec3322c8"></a><!-- doxytag: member="dlfcn.c::DL_IN_LIST" ref="623f5284ca0d69050730d335ec3322c8" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define DL_IN_LIST&nbsp;&nbsp;&nbsp;0x01          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00102">102</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00413">insertStatus()</a>, and <a class="el" href="dlfcn_8c-source.html#l00685">loadModule()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="e3405fce965daa65a1561ec53eafb46b"></a><!-- doxytag: member="dlfcn.c::dl_restrict" ref="e3405fce965daa65a1561ec53eafb46b" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define dl_restrict&nbsp;&nbsp;&nbsp;__restrict          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00054">54</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l01167">dladdr()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="13e7fe79d8e74ad50d94f63a2555d768"></a><!-- doxytag: member="dlfcn.c::ERR_STR_LEN" ref="13e7fe79d8e74ad50d94f63a2555d768" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define ERR_STR_LEN&nbsp;&nbsp;&nbsp;251          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00092">92</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00196">error()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="fa155e16fdd5262004d5e3f58b998545"></a><!-- doxytag: member="dlfcn.c::LC_LOAD_WEAK_DYLIB" ref="fa155e16fdd5262004d5e3f58b998545" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define LC_LOAD_WEAK_DYLIB&nbsp;&nbsp;&nbsp;(0x18 | LC_REQ_DYLD)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00058">58</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00506">search_linked_libs()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="ac5f51f867038347e9ac45defd1b26a9"></a><!-- doxytag: member="dlfcn.c::LC_REQ_DYLD" ref="ac5f51f867038347e9ac45defd1b26a9" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define LC_REQ_DYLD&nbsp;&nbsp;&nbsp;0x80000000          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00065">65</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="7a6b0bdbbd9df80fd3f1044b33625543"></a><!-- doxytag: member="dlfcn.c::MAGIC_DYLIB_MOD" ref="7a6b0bdbbd9df80fd3f1044b33625543" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define MAGIC_DYLIB_MOD&nbsp;&nbsp;&nbsp;((NSModule) 'DYMO')          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00099">99</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l01041">dlclose()</a>, <a class="el" href="dlfcn_8c-source.html#l00560">dlsymIntern()</a>, <a class="el" href="dlfcn_8c-source.html#l00685">loadModule()</a>, <a class="el" href="dlfcn_8c-source.html#l00442">promoteLocalToGlobal()</a>, and <a class="el" href="dlfcn_8c-source.html#l00451">reference()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="833480468fa097cbd87d801ddbb89555"></a><!-- doxytag: member="dlfcn.c::MAGIC_DYLIB_OFI" ref="833480468fa097cbd87d801ddbb89555" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define MAGIC_DYLIB_OFI&nbsp;&nbsp;&nbsp;((NSObjectFileImage) 'DYOF')          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00098">98</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00685">loadModule()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="2de067226d09024de7279a081ca98e05"></a><!-- doxytag: member="dlfcn.c::MAX_SEARCH_PATHS" ref="2de067226d09024de7279a081ca98e05" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define MAX_SEARCH_PATHS&nbsp;&nbsp;&nbsp;32          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00095">95</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00298">getSearchPath()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="8bef999e98f5b17a42537ade68c2db1d"></a><!-- doxytag: member="dlfcn.c::NSADDIMAGE_OPTION_RETURN_ON_ERROR" ref="8bef999e98f5b17a42537ade68c2db1d" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define NSADDIMAGE_OPTION_RETURN_ON_ERROR&nbsp;&nbsp;&nbsp;0x1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00071">71</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00685">loadModule()</a>, and <a class="el" href="dlfcn_8c-source.html#l00476">my_find_image()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="87a157769830554a61b43585b3f66e05"></a><!-- doxytag: member="dlfcn.c::NSADDIMAGE_OPTION_RETURN_ONLY_IF_LOADED" ref="87a157769830554a61b43585b3f66e05" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define NSADDIMAGE_OPTION_RETURN_ONLY_IF_LOADED&nbsp;&nbsp;&nbsp;0x4          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00068">68</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00476">my_find_image()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="cc050e8021ee1d5275232968a4c8e381"></a><!-- doxytag: member="dlfcn.c::NSLOOKUPSYMBOLINIMAGE_OPTION_BIND" ref="cc050e8021ee1d5275232968a4c8e381" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define NSLOOKUPSYMBOLINIMAGE_OPTION_BIND&nbsp;&nbsp;&nbsp;0x0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00074">74</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00560">dlsymIntern()</a>, and <a class="el" href="dlfcn_8c-source.html#l00506">search_linked_libs()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="093a56fc66d422a12e681349f7fc31ee"></a><!-- doxytag: member="dlfcn.c::NSLOOKUPSYMBOLINIMAGE_OPTION_RETURN_ON_ERROR" ref="093a56fc66d422a12e681349f7fc31ee" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define NSLOOKUPSYMBOLINIMAGE_OPTION_RETURN_ON_ERROR&nbsp;&nbsp;&nbsp;0x4          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00077">77</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00560">dlsymIntern()</a>, and <a class="el" href="dlfcn_8c-source.html#l00506">search_linked_libs()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4a62b2b396a125e09b721c4b48d19e9"></a><!-- doxytag: member="dlfcn.c::RTLD_SELF" ref="a4a62b2b396a125e09b721c4b48d19e9" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define RTLD_SELF&nbsp;&nbsp;&nbsp;((void *) -3)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00560">dlsymIntern()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="f9967e34823d8729bf12f0fad36a885d"></a><!-- doxytag: member="dlfcn.c::allocStatus" ref="f9967e34823d8729bf12f0fad36a885d" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static struct <a class="el" href="structdlstatus.html">dlstatus</a> * allocStatus           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00428">428</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="astmm_8h-source.html#l00066">malloc</a>, <a class="el" href="dlfcn_8c-source.html#l00123">dlstatus::module</a>, and <a class="el" href="dlfcn_8c-source.html#l00122">dlstatus::next</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00685">loadModule()</a>.<div class="fragment"><pre class="fragment"><a name="l00429"></a>00429 {
<a name="l00430"></a>00430    <span class="keyword">struct </span><a class="code" href="structdlstatus.html">dlstatus</a> *dls;
<a name="l00431"></a>00431 <span class="preprocessor">#ifdef REUSE_STATUS</span>
<a name="l00432"></a>00432 <span class="preprocessor"></span>   dls = <a class="code" href="dlfcn_8c.html#263ae105fbf479a73d0cacf0db8538dd">stqueue</a>;
<a name="l00433"></a>00433    <span class="keywordflow">while</span> (dls &amp;&amp; dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a>)
<a name="l00434"></a>00434       dls = dls-&gt;<a class="code" href="structdlstatus.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>;
<a name="l00435"></a>00435    <span class="keywordflow">if</span> (!dls)
<a name="l00436"></a>00436 <span class="preprocessor">#endif</span>
<a name="l00437"></a>00437 <span class="preprocessor"></span>      dls = <a class="code" href="astmm_8h.html#df74d22342f0da6246131193b1993a41">malloc</a>(<span class="keyword">sizeof</span>(*dls));
<a name="l00438"></a>00438    dls-&gt;<a class="code" href="structdlstatus.html#4e5868d676cb634aa75b125a0f741abf">flags</a> = 0;
<a name="l00439"></a>00439    <span class="keywordflow">return</span> dls;
<a name="l00440"></a>00440 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="1de850617a0e5f1b0585915acf78781b"></a><!-- doxytag: member="dlfcn.c::debug" ref="1de850617a0e5f1b0585915acf78781b" args="(const char *fmt,...)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void debug           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>&nbsp;</td>
          <td class="mdname" nowrap> <em>...</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00183">183</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.<div class="fragment"><pre class="fragment"><a name="l00184"></a>00184 {
<a name="l00185"></a>00185 <span class="preprocessor">#if DEBUG &gt; 1</span>
<a name="l00186"></a>00186 <span class="preprocessor"></span>   va_list arg;
<a name="l00187"></a>00187    va_start(arg, <a class="code" href="manager_8h.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>);
<a name="l00188"></a>00188    fprintf(stderr, <span class="stringliteral">"DLDEBUG: "</span>);
<a name="l00189"></a>00189    vfprintf(stderr, <a class="code" href="manager_8h.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>, arg);
<a name="l00190"></a>00190    fprintf(stderr, <span class="stringliteral">"\n"</span>);
<a name="l00191"></a>00191    fflush(stderr);
<a name="l00192"></a>00192    va_end(arg);
<a name="l00193"></a>00193 <span class="preprocessor">#endif</span>
<a name="l00194"></a>00194 <span class="preprocessor"></span>}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d8cea3d64aea155f9baf923941850689"></a><!-- doxytag: member="dlfcn.c::dladdr" ref="d8cea3d64aea155f9baf923941850689" args="(const void *dl_restrict p, Dl_info *dl_restrict info)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int dladdr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const void *dl_restrict&nbsp;</td>
          <td class="mdname" nowrap> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="structdl__info.html">Dl_info</a> *dl_restrict&nbsp;</td>
          <td class="mdname" nowrap> <em>info</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l01167">1167</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="app__rpt_8c-source.html#l00288">debug</a>, <a class="el" href="dlfcn_8c-source.html#l00054">dl_restrict</a>, <a class="el" href="dlfcn_8c-source.html#l00560">dlsymIntern()</a>, <a class="el" href="dlfcn_8c-source.html#l00862">dolock()</a>, <a class="el" href="dlfcn_8c-source.html#l00885">dounlock()</a>, <a class="el" href="dlfcn_8c-source.html#l00196">error()</a>, <a class="el" href="format__g726_8c-source.html#l00193">f</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="astmm_8h-source.html#l00066">malloc</a>, and <a class="el" href="dlfcn_8c-source.html#l00846">resetdlerror()</a>.<div class="fragment"><pre class="fragment"><a name="l01168"></a>01168 {
<a name="l01169"></a>01169 <span class="comment">/*</span>
<a name="l01170"></a>01170 <span class="comment">   FIXME: USe the routine image_for_address.</span>
<a name="l01171"></a>01171 <span class="comment">*/</span>
<a name="l01172"></a>01172    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i;
<a name="l01173"></a>01173    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> j;
<a name="l01174"></a>01174    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> count = _dyld_image_count();
<a name="l01175"></a>01175    <span class="keyword">struct </span>mach_header *mh = 0;
<a name="l01176"></a>01176    <span class="keyword">struct </span>load_command *lc = 0;
<a name="l01177"></a>01177    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> addr = NULL;
<a name="l01178"></a>01178    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> table_off = (<span class="keywordtype">unsigned</span> long)0;
<a name="l01179"></a>01179    <span class="keywordtype">int</span> found = 0;
<a name="l01180"></a>01180    <span class="keywordflow">if</span> (!info)
<a name="l01181"></a>01181       <span class="keywordflow">return</span> 0;
<a name="l01182"></a>01182    <a class="code" href="dlfcn_8c.html#3173031af7d4b847c50f22264d505a2a">dolock</a>();
<a name="l01183"></a>01183    <a class="code" href="dlfcn_8c.html#f79dfe72a8a68fc21a7a43fdebe8771e">resetdlerror</a>();
<a name="l01184"></a>01184    info-&gt;<a class="code" href="structdl__info.html#88b82cc0785cfe8fbc18ce458d92692d">dli_fname</a> = 0;
<a name="l01185"></a>01185    info-&gt;<a class="code" href="structdl__info.html#2ec9a49c88dcb3ec1ea06f99cd139903">dli_fbase</a> = 0;
<a name="l01186"></a>01186    info-&gt;<a class="code" href="structdl__info.html#93e43daba8fc441f472114b5b06d501b">dli_sname</a> = 0;
<a name="l01187"></a>01187    info-&gt;<a class="code" href="structdl__info.html#78a5fd56325207686d2bf96d83e46565">dli_saddr</a> = 0;
<a name="l01188"></a>01188 <span class="comment">/* Some of this was swiped from code posted by Douglas Davidson &lt;ddavidso AT apple DOT com&gt;</span>
<a name="l01189"></a>01189 <span class="comment"> * to darwin-development AT lists DOT apple DOT com and slightly modified</span>
<a name="l01190"></a>01190 <span class="comment"> */</span>
<a name="l01191"></a>01191    <span class="keywordflow">for</span> (i = 0; i &lt; count; i++)
<a name="l01192"></a>01192    {
<a name="l01193"></a>01193       addr = (<span class="keywordtype">unsigned</span> long)p - _dyld_get_image_vmaddr_slide(i);
<a name="l01194"></a>01194       mh = _dyld_get_image_header(i);
<a name="l01195"></a>01195       <span class="keywordflow">if</span> (mh)
<a name="l01196"></a>01196       {
<a name="l01197"></a>01197          lc = (<span class="keyword">struct </span>load_command *)((<span class="keywordtype">char</span> *)mh + <span class="keyword">sizeof</span>(<span class="keyword">struct</span> mach_header));
<a name="l01198"></a>01198          <span class="keywordflow">for</span> (j = 0; j &lt; mh-&gt;ncmds; j++, lc = (<span class="keyword">struct</span> load_command *)((<span class="keywordtype">char</span> *)lc + lc-&gt;cmdsize))
<a name="l01199"></a>01199          {
<a name="l01200"></a>01200             <span class="keywordflow">if</span> (LC_SEGMENT == lc-&gt;cmd &amp;&amp;
<a name="l01201"></a>01201                addr &gt;= ((<span class="keyword">struct</span> segment_command *)lc)-&gt;vmaddr &amp;&amp;
<a name="l01202"></a>01202                addr &lt;
<a name="l01203"></a>01203                ((<span class="keyword">struct</span> segment_command *)lc)-&gt;vmaddr + ((<span class="keyword">struct</span> segment_command *)lc)-&gt;vmsize)
<a name="l01204"></a>01204             {
<a name="l01205"></a>01205                info-&gt;<a class="code" href="structdl__info.html#88b82cc0785cfe8fbc18ce458d92692d">dli_fname</a> = _dyld_get_image_name(i);
<a name="l01206"></a>01206                info-&gt;<a class="code" href="structdl__info.html#2ec9a49c88dcb3ec1ea06f99cd139903">dli_fbase</a> = (<span class="keywordtype">void</span> *)mh;
<a name="l01207"></a>01207                found = 1;
<a name="l01208"></a>01208                <span class="keywordflow">break</span>;
<a name="l01209"></a>01209             }
<a name="l01210"></a>01210          }
<a name="l01211"></a>01211          <span class="keywordflow">if</span> (found)
<a name="l01212"></a>01212             <span class="keywordflow">break</span>;
<a name="l01213"></a>01213       }
<a name="l01214"></a>01214    }
<a name="l01215"></a>01215    <span class="keywordflow">if</span> (!found)
<a name="l01216"></a>01216    {
<a name="l01217"></a>01217       <a class="code" href="dlfcn_8c.html#1db4dbf9ea9f28b2fb35656635a0bebe">dounlock</a>();
<a name="l01218"></a>01218       <span class="keywordflow">return</span> 0;
<a name="l01219"></a>01219    }
<a name="l01220"></a>01220    lc = (<span class="keyword">struct </span>load_command *)((<span class="keywordtype">char</span> *)mh + <span class="keyword">sizeof</span>(<span class="keyword">struct</span> mach_header));
<a name="l01221"></a>01221    <span class="keywordflow">for</span> (j = 0; j &lt; mh-&gt;ncmds; j++, lc = (<span class="keyword">struct</span> load_command *)((<span class="keywordtype">char</span> *)lc + lc-&gt;cmdsize))
<a name="l01222"></a>01222    {
<a name="l01223"></a>01223       <span class="keywordflow">if</span> (LC_SEGMENT == lc-&gt;cmd)
<a name="l01224"></a>01224       {
<a name="l01225"></a>01225          <span class="keywordflow">if</span> (!strcmp(((<span class="keyword">struct</span> segment_command *)lc)-&gt;segname, <span class="stringliteral">"__LINKEDIT"</span>))
<a name="l01226"></a>01226             <span class="keywordflow">break</span>;
<a name="l01227"></a>01227       }
<a name="l01228"></a>01228    }
<a name="l01229"></a>01229    table_off =
<a name="l01230"></a>01230       ((<span class="keywordtype">unsigned</span> long)((<span class="keyword">struct</span> segment_command *)lc)-&gt;vmaddr) -
<a name="l01231"></a>01231       ((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)((<span class="keyword">struct</span> segment_command *)lc)-&gt;fileoff) + _dyld_get_image_vmaddr_slide(i);
<a name="l01232"></a>01232    <a class="code" href="app__rpt_8c.html#ad42f6697b035b7580e4fef93be20b4d">debug</a>(<span class="stringliteral">"table off %x"</span>, table_off);
<a name="l01233"></a>01233 
<a name="l01234"></a>01234    lc = (<span class="keyword">struct </span>load_command *)((<span class="keywordtype">char</span> *)mh + <span class="keyword">sizeof</span>(<span class="keyword">struct</span> mach_header));
<a name="l01235"></a>01235    <span class="keywordflow">for</span> (j = 0; j &lt; mh-&gt;ncmds; j++, lc = (<span class="keyword">struct</span> load_command *)((<span class="keywordtype">char</span> *)lc + lc-&gt;cmdsize))
<a name="l01236"></a>01236    {
<a name="l01237"></a>01237       <span class="keywordflow">if</span> (LC_SYMTAB == lc-&gt;cmd)
<a name="l01238"></a>01238       {
<a name="l01239"></a>01239 
<a name="l01240"></a>01240          <span class="keyword">struct </span>nlist *symtable = (<span class="keyword">struct </span>nlist *)(((<span class="keyword">struct</span> symtab_command *)lc)-&gt;symoff + table_off);
<a name="l01241"></a>01241          <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> numsyms = ((<span class="keyword">struct </span>symtab_command *)lc)-&gt;nsyms;
<a name="l01242"></a>01242          <span class="keyword">struct </span>nlist *nearest = NULL;
<a name="l01243"></a>01243          <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> diff = 0xffffffff;
<a name="l01244"></a>01244          <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> strtable = (<span class="keywordtype">unsigned</span> long)(((<span class="keyword">struct</span> symtab_command *)lc)-&gt;stroff + table_off);
<a name="l01245"></a>01245          <a class="code" href="app__rpt_8c.html#ad42f6697b035b7580e4fef93be20b4d">debug</a>(<span class="stringliteral">"symtable %x"</span>, symtable);
<a name="l01246"></a>01246          <span class="keywordflow">for</span> (i = 0; i &lt; numsyms; i++)
<a name="l01247"></a>01247          {
<a name="l01248"></a>01248             <span class="comment">/* Ignore the following kinds of Symbols */</span>
<a name="l01249"></a>01249             <span class="keywordflow">if</span> ((!symtable-&gt;n_value)   <span class="comment">/* Undefined */</span>
<a name="l01250"></a>01250                || (symtable-&gt;n_type &gt;= N_PEXT)  <span class="comment">/* Debug symbol */</span>
<a name="l01251"></a>01251                || (!(symtable-&gt;n_type &amp; N_EXT)) <span class="comment">/* Local Symbol */</span>
<a name="l01252"></a>01252                )
<a name="l01253"></a>01253             {
<a name="l01254"></a>01254                symtable++;
<a name="l01255"></a>01255                <span class="keywordflow">continue</span>;
<a name="l01256"></a>01256             }
<a name="l01257"></a>01257             <span class="keywordflow">if</span> ((addr &gt;= symtable-&gt;n_value) &amp;&amp; (diff &gt;= (symtable-&gt;n_value - addr)))
<a name="l01258"></a>01258             {
<a name="l01259"></a>01259                diff = (<span class="keywordtype">unsigned</span> long)symtable-&gt;n_value - addr;
<a name="l01260"></a>01260                nearest = symtable;
<a name="l01261"></a>01261             }
<a name="l01262"></a>01262             symtable++;
<a name="l01263"></a>01263          }
<a name="l01264"></a>01264          <span class="keywordflow">if</span> (nearest)
<a name="l01265"></a>01265          {
<a name="l01266"></a>01266             info-&gt;<a class="code" href="structdl__info.html#78a5fd56325207686d2bf96d83e46565">dli_saddr</a> = nearest-&gt;n_value + ((<span class="keywordtype">void</span> *)p - addr);
<a name="l01267"></a>01267             info-&gt;<a class="code" href="structdl__info.html#93e43daba8fc441f472114b5b06d501b">dli_sname</a> = (<span class="keywordtype">char</span> *)(strtable + nearest-&gt;n_un.n_strx);
<a name="l01268"></a>01268          }
<a name="l01269"></a>01269       }
<a name="l01270"></a>01270    }
<a name="l01271"></a>01271    <a class="code" href="dlfcn_8c.html#1db4dbf9ea9f28b2fb35656635a0bebe">dounlock</a>();
<a name="l01272"></a>01272    <span class="keywordflow">return</span> 1;
<a name="l01273"></a>01273 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="45a2f0c60f9c16390e6878ecc49d436d"></a><!-- doxytag: member="dlfcn.c::dlclose" ref="45a2f0c60f9c16390e6878ecc49d436d" args="(void *handle)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int dlclose           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>handle</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l01041">1041</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="app__rpt_8c-source.html#l00288">debug</a>, <a class="el" href="dlfcn_8c-source.html#l00560">dlsymIntern()</a>, <a class="el" href="dlfcn_8c-source.html#l00862">dolock()</a>, <a class="el" href="dlfcn_8c-source.html#l00885">dounlock()</a>, <a class="el" href="dlfcn_8c-source.html#l00196">error()</a>, <a class="el" href="dlfcn_8c-source.html#l00228">get_lib_name()</a>, <a class="el" href="dlfcn_8c-source.html#l00251">get_mach_header_from_NSModule()</a>, <a class="el" href="dlfcn_8c-source.html#l00398">isFlagSet()</a>, <a class="el" href="dlfcn_8c-source.html#l00383">isValidStatus()</a>, <a class="el" href="dlfcn_8c-source.html#l00124">dlstatus::lib</a>, <a class="el" href="dlfcn_8c-source.html#l00099">MAGIC_DYLIB_MOD</a>, <a class="el" href="dlfcn_8c-source.html#l00126">dlstatus::mode</a>, <a class="el" href="dlfcn_8c-source.html#l00123">dlstatus::module</a>, <a class="el" href="callerid_8c-source.html#l01043">name</a>, <a class="el" href="dlfcn_8c-source.html#l00125">dlstatus::refs</a>, <a class="el" href="dlfcn_8c-source.html#l00846">resetdlerror()</a>, <a class="el" href="dlfcn-compat_8h-source.html#l00076">RTLD_NODELETE</a>, and <a class="el" href="dlfcn_8c-source.html#l00211">warning()</a>.<div class="fragment"><pre class="fragment"><a name="l01042"></a>01042 {
<a name="l01043"></a>01043    <span class="keyword">struct </span><a class="code" href="structdlstatus.html">dlstatus</a> *dls = handle;
<a name="l01044"></a>01044    <a class="code" href="dlfcn_8c.html#3173031af7d4b847c50f22264d505a2a">dolock</a>();
<a name="l01045"></a>01045    <a class="code" href="dlfcn_8c.html#f79dfe72a8a68fc21a7a43fdebe8771e">resetdlerror</a>();
<a name="l01046"></a>01046    <span class="keywordflow">if</span> (!<a class="code" href="dlfcn_8c.html#94cc9569b7b9d1547f14f2ce0e5512cd">isValidStatus</a>(dls))
<a name="l01047"></a>01047    {
<a name="l01048"></a>01048       <span class="keywordflow">goto</span> dlcloseerror;
<a name="l01049"></a>01049    }
<a name="l01050"></a>01050    <span class="keywordflow">if</span> (dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a> == <a class="code" href="dlfcn_8c.html#7a6b0bdbbd9df80fd3f1044b33625543">MAGIC_DYLIB_MOD</a>)
<a name="l01051"></a>01051    {
<a name="l01052"></a>01052       <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>;
<a name="l01053"></a>01053       <span class="keywordflow">if</span> (!dls-&gt;<a class="code" href="structdlstatus.html#e8acc63b1e238f3255c900eed37254b8">lib</a>)
<a name="l01054"></a>01054       {
<a name="l01055"></a>01055          name = <span class="stringliteral">"global context"</span>;
<a name="l01056"></a>01056       }
<a name="l01057"></a>01057       <span class="keywordflow">else</span>
<a name="l01058"></a>01058       {
<a name="l01059"></a>01059          name = <a class="code" href="dlfcn_8c.html#0b7d7a9f21dd25d6dc50d712552f343a">get_lib_name</a>(dls-&gt;<a class="code" href="structdlstatus.html#e8acc63b1e238f3255c900eed37254b8">lib</a>);
<a name="l01060"></a>01060       }
<a name="l01061"></a>01061       <a class="code" href="dlfcn_8c.html#a0054ad56afd71085b56813f21a1544c">warning</a>(<span class="stringliteral">"trying to close a .dylib!"</span>);
<a name="l01062"></a>01062       <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"Not closing \"%s\" - dynamic libraries cannot be closed"</span>, name);
<a name="l01063"></a>01063       <span class="keywordflow">goto</span> dlcloseerror;
<a name="l01064"></a>01064    }
<a name="l01065"></a>01065    <span class="keywordflow">if</span> (!dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a>)
<a name="l01066"></a>01066    {
<a name="l01067"></a>01067       <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"module already closed"</span>);
<a name="l01068"></a>01068       <span class="keywordflow">goto</span> dlcloseerror;
<a name="l01069"></a>01069    }
<a name="l01070"></a>01070    
<a name="l01071"></a>01071    <span class="keywordflow">if</span> (dls-&gt;<a class="code" href="structdlstatus.html#5740713f144552f73502d802bc23dd35">refs</a> == 1)
<a name="l01072"></a>01072    {
<a name="l01073"></a>01073       <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> options = 0;
<a name="l01074"></a>01074       void (*fini) (void);
<a name="l01075"></a>01075       <span class="keywordflow">if</span> ((fini = <a class="code" href="dlfcn_8c.html#fbd7fb3690c8eff254f2690e831547b0">dlsymIntern</a>(dls, <span class="stringliteral">"__fini"</span>, 0)))
<a name="l01076"></a>01076       {
<a name="l01077"></a>01077          <a class="code" href="app__rpt_8c.html#ad42f6697b035b7580e4fef93be20b4d">debug</a>(<span class="stringliteral">"calling _fini()"</span>);
<a name="l01078"></a>01078          fini();
<a name="l01079"></a>01079       }
<a name="l01080"></a>01080 <span class="preprocessor">#ifdef __ppc__</span>
<a name="l01081"></a>01081 <span class="preprocessor"></span>      options |= NSUNLINKMODULE_OPTION_RESET_LAZY_REFERENCES;
<a name="l01082"></a>01082 <span class="preprocessor">#endif</span>
<a name="l01083"></a>01083 <span class="preprocessor"></span><span class="preprocessor">#if 1</span>
<a name="l01084"></a>01084 <span class="preprocessor"></span><span class="comment">/*  Currently, if a module contains c++ static destructors and it is unloaded, we</span>
<a name="l01085"></a>01085 <span class="comment"> *  get a segfault in atexit(), due to compiler and dynamic loader differences of</span>
<a name="l01086"></a>01086 <span class="comment"> *  opinion, this works around that.</span>
<a name="l01087"></a>01087 <span class="comment"> *  I really need a way to figure out from code if this is still necessary.</span>
<a name="l01088"></a>01088 <span class="comment"> */</span>
<a name="l01089"></a>01089       <span class="keywordflow">if</span> ((<span class="keyword">const</span> <span class="keyword">struct</span> section *)NULL !=
<a name="l01090"></a>01090          getsectbynamefromheader(<a class="code" href="dlfcn_8c.html#980566f5f6d3ca4e4f01c5d3cced8327">get_mach_header_from_NSModule</a>(dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a>),
<a name="l01091"></a>01091                            <span class="stringliteral">"__DATA"</span>, <span class="stringliteral">"__mod_term_func"</span>))
<a name="l01092"></a>01092       {
<a name="l01093"></a>01093          options |= NSUNLINKMODULE_OPTION_KEEP_MEMORY_MAPPED;
<a name="l01094"></a>01094       }
<a name="l01095"></a>01095 <span class="preprocessor">#endif</span>
<a name="l01096"></a>01096 <span class="preprocessor"></span><span class="preprocessor">#ifdef RTLD_NODELETE</span>
<a name="l01097"></a>01097 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="dlfcn_8c.html#de1ac04ff9536258d5099cd4ed3f0b84">isFlagSet</a>(dls-&gt;<a class="code" href="structdlstatus.html#15d61712450a686a7f365adf4fef581f">mode</a>, <a class="code" href="dlfcn-compat_8h.html#0cc0978e1ca3437f8a24fab84ea5f45a">RTLD_NODELETE</a>))
<a name="l01098"></a>01098          options |= NSUNLINKMODULE_OPTION_KEEP_MEMORY_MAPPED;
<a name="l01099"></a>01099 <span class="preprocessor">#endif</span>
<a name="l01100"></a>01100 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (!NSUnLinkModule(dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a>, options))
<a name="l01101"></a>01101       {
<a name="l01102"></a>01102          <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"unable to unlink module"</span>);
<a name="l01103"></a>01103          <span class="keywordflow">goto</span> dlcloseerror;
<a name="l01104"></a>01104       }
<a name="l01105"></a>01105       dls-&gt;<a class="code" href="structdlstatus.html#5740713f144552f73502d802bc23dd35">refs</a>--;
<a name="l01106"></a>01106       dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a> = 0;
<a name="l01107"></a>01107       <span class="comment">/* Note: the dlstatus struct dls is neither removed from the list</span>
<a name="l01108"></a>01108 <span class="comment">       * nor is the memory it occupies freed. This shouldn't pose a </span>
<a name="l01109"></a>01109 <span class="comment">       * problem in mostly all cases, though.</span>
<a name="l01110"></a>01110 <span class="comment">       */</span>
<a name="l01111"></a>01111    }
<a name="l01112"></a>01112    <a class="code" href="dlfcn_8c.html#1db4dbf9ea9f28b2fb35656635a0bebe">dounlock</a>();
<a name="l01113"></a>01113    <span class="keywordflow">return</span> 0;
<a name="l01114"></a>01114   dlcloseerror:
<a name="l01115"></a>01115    <a class="code" href="dlfcn_8c.html#1db4dbf9ea9f28b2fb35656635a0bebe">dounlock</a>();
<a name="l01116"></a>01116    <span class="keywordflow">return</span> 1;
<a name="l01117"></a>01117 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="03f64046de974f91c1e196b315f17a6f"></a><!-- doxytag: member="dlfcn.c::dlcompat_cleanup" ref="03f64046de974f91c1e196b315f17a6f" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void dlcompat_cleanup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00824">824</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="dlfcn_8c-source.html#l00298">getSearchPath()</a>, <a class="el" href="dlfcn_8c-source.html#l00122">dlstatus::next</a>, <a class="el" href="lock_8h-source.html#l00598">pthread_mutex_destroy</a>, and <a class="el" href="dlfcn_8c-source.html#l00278">searchList()</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00801">dlcompat_init_func()</a>.<div class="fragment"><pre class="fragment"><a name="l00825"></a>00825 {
<a name="l00826"></a>00826    <span class="keyword">struct </span><a class="code" href="structdlstatus.html">dlstatus</a> *dls;
<a name="l00827"></a>00827    <span class="keyword">struct </span><a class="code" href="structdlstatus.html">dlstatus</a> *<a class="code" href="structdlstatus.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>;
<a name="l00828"></a>00828    <span class="keywordtype">char</span> *data;
<a name="l00829"></a>00829    data = (<span class="keywordtype">char</span> *)<a class="code" href="dlfcn_8c.html#e3b786dcfbda95c5708dc4e648cb3fd8">searchList</a>();
<a name="l00830"></a>00830    <span class="keywordflow">if</span> ( data )
<a name="l00831"></a>00831       <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>( data );
<a name="l00832"></a>00832    data =   (<span class="keywordtype">char</span> *)<a class="code" href="dlfcn_8c.html#d51feb8815c9b0ac6afdcc317a0feded">getSearchPath</a>(-1);
<a name="l00833"></a>00833    <span class="keywordflow">if</span> ( data )
<a name="l00834"></a>00834       <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>( data );
<a name="l00835"></a>00835    <a class="code" href="lock_8h.html#935427d30189c26fb39425a12c9db3a1">pthread_mutex_destroy</a>(&amp;<a class="code" href="dlfcn_8c.html#35bc2d3415a9f63bc5686e02a0f03883">dlcompat_mutex</a>);
<a name="l00836"></a>00836    pthread_key_delete(<a class="code" href="dlfcn_8c.html#446c9e2cac70c4a3977923451eea13da">dlerror_key</a>);
<a name="l00837"></a>00837    next = <a class="code" href="dlfcn_8c.html#263ae105fbf479a73d0cacf0db8538dd">stqueue</a>;
<a name="l00838"></a>00838    <span class="keywordflow">while</span> (next &amp;&amp; (next != &amp;<a class="code" href="dlfcn_8c.html#86560ade58b777fa6f8f47ff729fee69">mainStatus</a>))
<a name="l00839"></a>00839    {
<a name="l00840"></a>00840       dls = next;
<a name="l00841"></a>00841       next = dls-&gt;<a class="code" href="structdlstatus.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>;
<a name="l00842"></a>00842       <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(dls);
<a name="l00843"></a>00843    }
<a name="l00844"></a>00844 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="83f7d76f85298415785439b62103645f"></a><!-- doxytag: member="dlfcn.c::dlcompat_init_func" ref="83f7d76f85298415785439b62103645f" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void dlcompat_init_func           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00801">801</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="dlfcn_8c-source.html#l00824">dlcompat_cleanup()</a>, <a class="el" href="dlfcn_8c-source.html#l00853">dlerrorfree()</a>, <a class="el" href="dlfcn_8c-source.html#l00080">dyld_NSAddImage</a>, and <a class="el" href="lock_8h-source.html#l00597">pthread_mutex_init</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00897">dlopen()</a>.<div class="fragment"><pre class="fragment"><a name="l00802"></a>00802 {
<a name="l00803"></a>00803    <span class="keyword">static</span> <span class="keywordtype">int</span> inited = 0;
<a name="l00804"></a>00804    <span class="keywordflow">if</span> (!inited)
<a name="l00805"></a>00805    {
<a name="l00806"></a>00806       inited = 1;
<a name="l00807"></a>00807       _dyld_func_lookup(<span class="stringliteral">"__dyld_NSAddImage"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *)&amp;<a class="code" href="dlfcn_8c.html#83168d8db5a85df2b3e7898c1230942f">dyld_NSAddImage</a>);
<a name="l00808"></a>00808       _dyld_func_lookup(<span class="stringliteral">"__dyld_NSIsSymbolNameDefinedInImage"</span>,
<a name="l00809"></a>00809                     (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *)&amp;<a class="code" href="dlfcn_8c.html#8efc76b493fa04cbcff731ebe67cb41f">dyld_NSIsSymbolNameDefinedInImage</a>);
<a name="l00810"></a>00810       _dyld_func_lookup(<span class="stringliteral">"__dyld_NSLookupSymbolInImage"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *)&amp;<a class="code" href="dlfcn_8c.html#9fc4abd8c5aaaa341566cf1cac760b38">dyld_NSLookupSymbolInImage</a>);
<a name="l00811"></a>00811       <span class="keywordflow">if</span> (<a class="code" href="lock_8h.html#0ed3695ec827e8564009fb1c31e24d87">pthread_mutex_init</a>(&amp;<a class="code" href="dlfcn_8c.html#35bc2d3415a9f63bc5686e02a0f03883">dlcompat_mutex</a>, NULL))
<a name="l00812"></a>00812          exit(1);
<a name="l00813"></a>00813       <span class="keywordflow">if</span> (pthread_key_create(&amp;<a class="code" href="dlfcn_8c.html#446c9e2cac70c4a3977923451eea13da">dlerror_key</a>, &amp;<a class="code" href="dlfcn_8c.html#ce385803b09da205cc80aafca2fb1d11">dlerrorfree</a>))
<a name="l00814"></a>00814          exit(1);
<a name="l00815"></a>00815       <span class="comment">/* And be neat and tidy and clean up after ourselves */</span>  
<a name="l00816"></a>00816       atexit(<a class="code" href="dlfcn_8c.html#03f64046de974f91c1e196b315f17a6f">dlcompat_cleanup</a>);
<a name="l00817"></a>00817    }
<a name="l00818"></a>00818 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="f4f18e7a664d25663c1a235c1fc7fade"></a><!-- doxytag: member="dlfcn.c::dlerror" ref="f4f18e7a664d25663c1a235c1fc7fade" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char* dlerror           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l01119">1119</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="dlfcn_8c-source.html#l00113">dlthread::errset</a>, and <a class="el" href="dlfcn_8c-source.html#l00114">dlthread::errstr</a>.<div class="fragment"><pre class="fragment"><a name="l01120"></a>01120 {
<a name="l01121"></a>01121    <span class="keyword">struct </span><a class="code" href="structdlthread.html">dlthread</a>  *tss;
<a name="l01122"></a>01122    <span class="keywordtype">char</span> * err_str;
<a name="l01123"></a>01123    tss = pthread_getspecific(<a class="code" href="dlfcn_8c.html#446c9e2cac70c4a3977923451eea13da">dlerror_key</a>);
<a name="l01124"></a>01124    err_str = tss-&gt;<a class="code" href="structdlthread.html#ac8ef2b34ca04ea40d46ffb53ef323f8">errstr</a>;
<a name="l01125"></a>01125    tss = pthread_getspecific(<a class="code" href="dlfcn_8c.html#446c9e2cac70c4a3977923451eea13da">dlerror_key</a>);
<a name="l01126"></a>01126    <span class="keywordflow">if</span> (tss-&gt;<a class="code" href="structdlthread.html#1d0e9ad7d1908eaf205e819f3255f92c">errset</a> == 0)
<a name="l01127"></a>01127       <span class="keywordflow">return</span> 0;
<a name="l01128"></a>01128    tss-&gt;<a class="code" href="structdlthread.html#1d0e9ad7d1908eaf205e819f3255f92c">errset</a> = 0;  
<a name="l01129"></a>01129    <span class="keywordflow">return</span> (err_str );
<a name="l01130"></a>01130 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="ce385803b09da205cc80aafca2fb1d11"></a><!-- doxytag: member="dlfcn.c::dlerrorfree" ref="ce385803b09da205cc80aafca2fb1d11" args="(void *data)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void dlerrorfree           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>data</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00853">853</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="astmm_8h-source.html#l00069">free</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00801">dlcompat_init_func()</a>.<div class="fragment"><pre class="fragment"><a name="l00854"></a>00854 {
<a name="l00855"></a>00855    <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(data);
<a name="l00856"></a>00856 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d4ea5e7e662612dc0e5a7ad0ff1e33b0"></a><!-- doxytag: member="dlfcn.c::dlopen" ref="d4ea5e7e662612dc0e5a7ad0ff1e33b0" args="(const char *path, int mode)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void* dlopen           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>path</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00897">897</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="dlfcn_8c-source.html#l00801">dlcompat_init_func()</a>, <a class="el" href="dlfcn_8c-source.html#l00862">dolock()</a>, <a class="el" href="dlfcn_8c-source.html#l00885">dounlock()</a>, <a class="el" href="dlfcn_8c-source.html#l00196">error()</a>, <a class="el" href="dlfcn_8c-source.html#l00359">findFile()</a>, <a class="el" href="dlfcn_8c-source.html#l00398">isFlagSet()</a>, <a class="el" href="dlfcn_8c-source.html#l00685">loadModule()</a>, <a class="el" href="dlfcn_8c-source.html#l00403">lookupStatus()</a>, <a class="el" href="dlfcn_8c-source.html#l00451">reference()</a>, <a class="el" href="dlfcn_8c-source.html#l00125">dlstatus::refs</a>, <a class="el" href="dlfcn_8c-source.html#l00846">resetdlerror()</a>, <a class="el" href="dlfcn-compat_8h-source.html#l00071">RTLD_LAZY</a>, <a class="el" href="dlfcn-compat_8h-source.html#l00075">RTLD_NOLOAD</a>, and <a class="el" href="loader_8c-source.html#l00065">RTLD_NOW</a>.<div class="fragment"><pre class="fragment"><a name="l00898"></a>00898 {
<a name="l00899"></a>00899    <span class="keyword">const</span> <span class="keyword">struct </span>stat *sbuf;
<a name="l00900"></a>00900    <span class="keyword">struct </span><a class="code" href="structdlstatus.html">dlstatus</a> *dls;
<a name="l00901"></a>00901    <span class="keyword">const</span> <span class="keywordtype">char</span> *fullPath;
<a name="l00902"></a>00902    <a class="code" href="dlfcn_8c.html#83f7d76f85298415785439b62103645f">dlcompat_init_func</a>();      <span class="comment">/* Just in case */</span>
<a name="l00903"></a>00903    <a class="code" href="dlfcn_8c.html#3173031af7d4b847c50f22264d505a2a">dolock</a>();
<a name="l00904"></a>00904    <a class="code" href="dlfcn_8c.html#f79dfe72a8a68fc21a7a43fdebe8771e">resetdlerror</a>();
<a name="l00905"></a>00905    <span class="keywordflow">if</span> (!path)
<a name="l00906"></a>00906    {
<a name="l00907"></a>00907       dls = &amp;<a class="code" href="dlfcn_8c.html#86560ade58b777fa6f8f47ff729fee69">mainStatus</a>;
<a name="l00908"></a>00908       <span class="keywordflow">goto</span> dlopenok;
<a name="l00909"></a>00909    }
<a name="l00910"></a>00910    <span class="keywordflow">if</span> (!(sbuf = <a class="code" href="dlfcn_8c.html#5ce6066f9cbcf99b3cc6d47bc288daa8">findFile</a>(path, &amp;fullPath)))
<a name="l00911"></a>00911    {
<a name="l00912"></a>00912       <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"file \"%s\" not found"</span>, path);
<a name="l00913"></a>00913       <span class="keywordflow">goto</span> dlopenerror;
<a name="l00914"></a>00914    }
<a name="l00915"></a>00915    <span class="comment">/* Now checks that it hasn't been closed already */</span>
<a name="l00916"></a>00916    <span class="keywordflow">if</span> ((dls = <a class="code" href="dlfcn_8c.html#302bcae6e1b779aec6b07c4891b9283f">lookupStatus</a>(sbuf)) &amp;&amp; (dls-&gt;<a class="code" href="structdlstatus.html#5740713f144552f73502d802bc23dd35">refs</a> &gt; 0))
<a name="l00917"></a>00917    {
<a name="l00918"></a>00918       <span class="comment">/* debug("status found"); */</span>
<a name="l00919"></a>00919       dls = <a class="code" href="dlfcn_8c.html#f9549c9322f3ac5e9f28e0bb7552f8a1">reference</a>(dls, <a class="code" href="structdlstatus.html#15d61712450a686a7f365adf4fef581f">mode</a>);
<a name="l00920"></a>00920       <span class="keywordflow">goto</span> dlopenok;
<a name="l00921"></a>00921    }
<a name="l00922"></a>00922 <span class="preprocessor">#ifdef   RTLD_NOLOAD</span>
<a name="l00923"></a>00923 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (<a class="code" href="dlfcn_8c.html#de1ac04ff9536258d5099cd4ed3f0b84">isFlagSet</a>(<a class="code" href="structdlstatus.html#15d61712450a686a7f365adf4fef581f">mode</a>, <a class="code" href="dlfcn-compat_8h.html#cb78ca118dbf7ce21081e05f1a0e1406">RTLD_NOLOAD</a>))
<a name="l00924"></a>00924    {
<a name="l00925"></a>00925       <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"no existing handle and RTLD_NOLOAD specified"</span>);
<a name="l00926"></a>00926       <span class="keywordflow">goto</span> dlopenerror;
<a name="l00927"></a>00927    }
<a name="l00928"></a>00928 <span class="preprocessor">#endif</span>
<a name="l00929"></a>00929 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (<a class="code" href="dlfcn_8c.html#de1ac04ff9536258d5099cd4ed3f0b84">isFlagSet</a>(<a class="code" href="structdlstatus.html#15d61712450a686a7f365adf4fef581f">mode</a>, <a class="code" href="dlfcn-compat_8h.html#8884c6632ee6d253203a2d6deb4b7354">RTLD_LAZY</a>) &amp;&amp; <a class="code" href="dlfcn_8c.html#de1ac04ff9536258d5099cd4ed3f0b84">isFlagSet</a>(<a class="code" href="structdlstatus.html#15d61712450a686a7f365adf4fef581f">mode</a>, <a class="code" href="loader_8c.html#cebd9c7b300fbb075a0eb012c43879e8">RTLD_NOW</a>))
<a name="l00930"></a>00930    {
<a name="l00931"></a>00931       <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"how can I load something both RTLD_LAZY and RTLD_NOW?"</span>);
<a name="l00932"></a>00932       <span class="keywordflow">goto</span> dlopenerror;
<a name="l00933"></a>00933    }
<a name="l00934"></a>00934    dls = <a class="code" href="dlfcn_8c.html#3ccd00c1b00c0a0c2098a526ed71fe32">loadModule</a>(fullPath, sbuf, <a class="code" href="structdlstatus.html#15d61712450a686a7f365adf4fef581f">mode</a>);
<a name="l00935"></a>00935    
<a name="l00936"></a>00936   dlopenok:
<a name="l00937"></a>00937    <a class="code" href="dlfcn_8c.html#1db4dbf9ea9f28b2fb35656635a0bebe">dounlock</a>();
<a name="l00938"></a>00938    <span class="keywordflow">return</span> (<span class="keywordtype">void</span> *)dls;
<a name="l00939"></a>00939   dlopenerror:
<a name="l00940"></a>00940    <a class="code" href="dlfcn_8c.html#1db4dbf9ea9f28b2fb35656635a0bebe">dounlock</a>();
<a name="l00941"></a>00941    <span class="keywordflow">return</span> NULL;
<a name="l00942"></a>00942 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="def04fd1fe7f4abea4e0f3df9745048d"></a><!-- doxytag: member="dlfcn.c::dlsym" ref="def04fd1fe7f4abea4e0f3df9745048d" args="(void *dl_restrict handle, const char *dl_restrict symbol)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void* dlsym           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void *dl_restrict&nbsp;</td>
          <td class="mdname" nowrap> <em>handle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *dl_restrict&nbsp;</td>
          <td class="mdname" nowrap> <em>symbol</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00945">945</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="dlfcn_8c-source.html#l00560">dlsymIntern()</a>, <a class="el" href="dlfcn_8c-source.html#l00862">dolock()</a>, <a class="el" href="dlfcn_8c-source.html#l00885">dounlock()</a>, <a class="el" href="dlfcn_8c-source.html#l00196">error()</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, and <a class="el" href="astmm_8h-source.html#l00066">malloc</a>.<div class="fragment"><pre class="fragment"><a name="l00946"></a>00946 {
<a name="l00947"></a>00947    <span class="keywordtype">int</span> sym_len = strlen(symbol);
<a name="l00948"></a>00948    <span class="keywordtype">void</span> *value = NULL;
<a name="l00949"></a>00949    <span class="keywordtype">char</span> *malloc_sym = NULL;
<a name="l00950"></a>00950    <a class="code" href="dlfcn_8c.html#3173031af7d4b847c50f22264d505a2a">dolock</a>();
<a name="l00951"></a>00951    malloc_sym = <a class="code" href="astmm_8h.html#df74d22342f0da6246131193b1993a41">malloc</a>(sym_len + 2);
<a name="l00952"></a>00952    <span class="keywordflow">if</span> (malloc_sym)
<a name="l00953"></a>00953    {
<a name="l00954"></a>00954       sprintf(malloc_sym, <span class="stringliteral">"_%s"</span>, symbol);
<a name="l00955"></a>00955       value = <a class="code" href="dlfcn_8c.html#fbd7fb3690c8eff254f2690e831547b0">dlsymIntern</a>(handle, malloc_sym, 1);
<a name="l00956"></a>00956       <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(malloc_sym);
<a name="l00957"></a>00957    }
<a name="l00958"></a>00958    <span class="keywordflow">else</span>
<a name="l00959"></a>00959    {
<a name="l00960"></a>00960       <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"Unable to allocate memory"</span>);
<a name="l00961"></a>00961       <span class="keywordflow">goto</span> dlsymerror;
<a name="l00962"></a>00962    }
<a name="l00963"></a>00963    <a class="code" href="dlfcn_8c.html#1db4dbf9ea9f28b2fb35656635a0bebe">dounlock</a>();
<a name="l00964"></a>00964    <span class="keywordflow">return</span> value;
<a name="l00965"></a>00965   dlsymerror:
<a name="l00966"></a>00966    <a class="code" href="dlfcn_8c.html#1db4dbf9ea9f28b2fb35656635a0bebe">dounlock</a>();
<a name="l00967"></a>00967    <span class="keywordflow">return</span> NULL;
<a name="l00968"></a>00968 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="fbd7fb3690c8eff254f2690e831547b0"></a><!-- doxytag: member="dlfcn.c::dlsymIntern" ref="fbd7fb3690c8eff254f2690e831547b0" args="(struct dlstatus *dls, const char *symbol, int canSetError)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void * dlsymIntern           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structdlstatus.html">dlstatus</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>dls</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>symbol</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>canSetError</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00560">560</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="app__rpt_8c-source.html#l00288">debug</a>, <a class="el" href="dlfcn_8c-source.html#l00544">dyld_error_str()</a>, <a class="el" href="dlfcn_8c-source.html#l00081">dyld_NSIsSymbolNameDefinedInImage</a>, <a class="el" href="dlfcn_8c-source.html#l00083">dyld_NSLookupSymbolInImage</a>, <a class="el" href="dlfcn_8c-source.html#l00196">error()</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="dlfcn_8c-source.html#l00251">get_mach_header_from_NSModule()</a>, <a class="el" href="dlfcn_8c-source.html#l01135">image_for_address()</a>, <a class="el" href="dlfcn_8c-source.html#l00383">isValidStatus()</a>, <a class="el" href="dlfcn_8c-source.html#l00124">dlstatus::lib</a>, <a class="el" href="dlfcn_8c-source.html#l00099">MAGIC_DYLIB_MOD</a>, <a class="el" href="astmm_8h-source.html#l00066">malloc</a>, <a class="el" href="dlfcn_8c-source.html#l00123">dlstatus::module</a>, <a class="el" href="dlfcn_8c-source.html#l00074">NSLOOKUPSYMBOLINIMAGE_OPTION_BIND</a>, <a class="el" href="dlfcn_8c-source.html#l00077">NSLOOKUPSYMBOLINIMAGE_OPTION_RETURN_ON_ERROR</a>, <a class="el" href="dlfcn_8c-source.html#l00846">resetdlerror()</a>, <a class="el" href="dlfcn-compat_8h-source.html#l00082">RTLD_DEFAULT</a>, <a class="el" href="dlfcn-compat_8h-source.html#l00081">RTLD_NEXT</a>, <a class="el" href="dlfcn_8c.html#a4a62b2b396a125e09b721c4b48d19e9">RTLD_SELF</a>, and <a class="el" href="dlfcn_8c-source.html#l00506">search_linked_libs()</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l01167">dladdr()</a>, <a class="el" href="dlfcn_8c-source.html#l01041">dlclose()</a>, <a class="el" href="dlfcn_8c-source.html#l00945">dlsym()</a>, and <a class="el" href="dlfcn_8c-source.html#l00685">loadModule()</a>.<div class="fragment"><pre class="fragment"><a name="l00561"></a>00561 {
<a name="l00562"></a>00562    NSSymbol *nssym = 0;
<a name="l00563"></a>00563    <span class="keywordtype">void</span> *caller = __builtin_return_address(1);  <span class="comment">/* Be *very* careful about inlining */</span>
<a name="l00564"></a>00564    <span class="keyword">const</span> <span class="keyword">struct </span>mach_header *caller_mh = 0;
<a name="l00565"></a>00565    <span class="keyword">const</span> <span class="keywordtype">char</span>* savedErrorStr = NULL;
<a name="l00566"></a>00566    <a class="code" href="dlfcn_8c.html#f79dfe72a8a68fc21a7a43fdebe8771e">resetdlerror</a>();
<a name="l00567"></a>00567 <span class="preprocessor">#ifndef RTLD_SELF</span>
<a name="l00568"></a>00568 <span class="preprocessor"></span><span class="preprocessor">#define  RTLD_SELF      ((void *) -3)</span>
<a name="l00569"></a>00569 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00570"></a>00570 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (NULL == dls)
<a name="l00571"></a>00571       dls = <a class="code" href="dlfcn_8c.html#a4a62b2b396a125e09b721c4b48d19e9">RTLD_SELF</a>;
<a name="l00572"></a>00572    <span class="keywordflow">if</span> ((<a class="code" href="dlfcn-compat_8h.html#b5f76bc27279e5ac633f9109f8fa9de2">RTLD_NEXT</a> == dls) || (RTLD_SELF == dls))
<a name="l00573"></a>00573    {
<a name="l00574"></a>00574       <span class="keywordflow">if</span> (<a class="code" href="dlfcn_8c.html#8efc76b493fa04cbcff731ebe67cb41f">dyld_NSIsSymbolNameDefinedInImage</a> &amp;&amp; <a class="code" href="dlfcn_8c.html#9fc4abd8c5aaaa341566cf1cac760b38">dyld_NSLookupSymbolInImage</a>)
<a name="l00575"></a>00575       {
<a name="l00576"></a>00576          caller_mh = <a class="code" href="dlfcn_8c.html#edd4c3613a03834168b85d9192559af3">image_for_address</a>(caller);
<a name="l00577"></a>00577          <span class="keywordflow">if</span> (RTLD_SELF == dls)
<a name="l00578"></a>00578          {
<a name="l00579"></a>00579             <span class="comment">/* FIXME: We should be using the NSModule api, if SELF is an MH_BUNDLE</span>
<a name="l00580"></a>00580 <span class="comment">             * But it appears to work anyway, and looking at the code in dyld_libfuncs.c</span>
<a name="l00581"></a>00581 <span class="comment">             * this is acceptable.</span>
<a name="l00582"></a>00582 <span class="comment">             */</span>
<a name="l00583"></a>00583             <span class="keywordflow">if</span> (<a class="code" href="dlfcn_8c.html#8efc76b493fa04cbcff731ebe67cb41f">dyld_NSIsSymbolNameDefinedInImage</a>(caller_mh, symbol))
<a name="l00584"></a>00584             {
<a name="l00585"></a>00585                nssym = <a class="code" href="dlfcn_8c.html#9fc4abd8c5aaaa341566cf1cac760b38">dyld_NSLookupSymbolInImage</a>(caller_mh,
<a name="l00586"></a>00586                                           symbol,
<a name="l00587"></a>00587                                           <a class="code" href="dlfcn_8c.html#cc050e8021ee1d5275232968a4c8e381">NSLOOKUPSYMBOLINIMAGE_OPTION_BIND</a> |
<a name="l00588"></a>00588                                           <a class="code" href="dlfcn_8c.html#093a56fc66d422a12e681349f7fc31ee">NSLOOKUPSYMBOLINIMAGE_OPTION_RETURN_ON_ERROR</a>);
<a name="l00589"></a>00589             }
<a name="l00590"></a>00590          }
<a name="l00591"></a>00591          <span class="keywordflow">if</span> (!nssym)
<a name="l00592"></a>00592          {
<a name="l00593"></a>00593             <span class="keywordflow">if</span> (RTLD_SELF == dls)
<a name="l00594"></a>00594                savedErrorStr = <a class="code" href="dlfcn_8c.html#c19c49edbff5e86e5280ee9f4c132344">dyld_error_str</a>();
<a name="l00595"></a>00595             nssym = <a class="code" href="dlfcn_8c.html#998125cc2be835ee34124f5221bdafce">search_linked_libs</a>(caller_mh, symbol);
<a name="l00596"></a>00596          }
<a name="l00597"></a>00597       }
<a name="l00598"></a>00598       <span class="keywordflow">else</span>
<a name="l00599"></a>00599       {
<a name="l00600"></a>00600          <span class="keywordflow">if</span> (canSetError)
<a name="l00601"></a>00601             <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"RTLD_SELF and RTLD_NEXT are not supported"</span>);
<a name="l00602"></a>00602          <span class="keywordflow">return</span> NULL;
<a name="l00603"></a>00603       }
<a name="l00604"></a>00604    }
<a name="l00605"></a>00605    <span class="keywordflow">if</span> (!nssym)
<a name="l00606"></a>00606    {
<a name="l00607"></a>00607 
<a name="l00608"></a>00608       <span class="keywordflow">if</span> (<a class="code" href="dlfcn-compat_8h.html#12a180c322ab561ff75b996c242fa84a">RTLD_DEFAULT</a> == dls)
<a name="l00609"></a>00609       {
<a name="l00610"></a>00610          dls = &amp;<a class="code" href="dlfcn_8c.html#86560ade58b777fa6f8f47ff729fee69">mainStatus</a>;
<a name="l00611"></a>00611       }
<a name="l00612"></a>00612       <span class="keywordflow">if</span> (!<a class="code" href="dlfcn_8c.html#94cc9569b7b9d1547f14f2ce0e5512cd">isValidStatus</a>(dls))
<a name="l00613"></a>00613          <span class="keywordflow">return</span> NULL;
<a name="l00614"></a>00614 
<a name="l00615"></a>00615       <span class="keywordflow">if</span> (dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a> != <a class="code" href="dlfcn_8c.html#7a6b0bdbbd9df80fd3f1044b33625543">MAGIC_DYLIB_MOD</a>)
<a name="l00616"></a>00616       {
<a name="l00617"></a>00617          nssym = NSLookupSymbolInModule(dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a>, symbol);
<a name="l00618"></a>00618          <span class="keywordflow">if</span> (!nssym &amp;&amp; NSIsSymbolNameDefined(symbol))
<a name="l00619"></a>00619          {
<a name="l00620"></a>00620             <a class="code" href="app__rpt_8c.html#ad42f6697b035b7580e4fef93be20b4d">debug</a>(<span class="stringliteral">"Searching dependencies"</span>);
<a name="l00621"></a>00621             savedErrorStr = <a class="code" href="dlfcn_8c.html#c19c49edbff5e86e5280ee9f4c132344">dyld_error_str</a>();
<a name="l00622"></a>00622             nssym = <a class="code" href="dlfcn_8c.html#998125cc2be835ee34124f5221bdafce">search_linked_libs</a>(<a class="code" href="dlfcn_8c.html#980566f5f6d3ca4e4f01c5d3cced8327">get_mach_header_from_NSModule</a>(dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a>), symbol);
<a name="l00623"></a>00623          }
<a name="l00624"></a>00624       }
<a name="l00625"></a>00625       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dls-&gt;<a class="code" href="structdlstatus.html#e8acc63b1e238f3255c900eed37254b8">lib</a> &amp;&amp; <a class="code" href="dlfcn_8c.html#8efc76b493fa04cbcff731ebe67cb41f">dyld_NSIsSymbolNameDefinedInImage</a> &amp;&amp; <a class="code" href="dlfcn_8c.html#9fc4abd8c5aaaa341566cf1cac760b38">dyld_NSLookupSymbolInImage</a>)
<a name="l00626"></a>00626       {
<a name="l00627"></a>00627          <span class="keywordflow">if</span> (<a class="code" href="dlfcn_8c.html#8efc76b493fa04cbcff731ebe67cb41f">dyld_NSIsSymbolNameDefinedInImage</a>(dls-&gt;<a class="code" href="structdlstatus.html#e8acc63b1e238f3255c900eed37254b8">lib</a>, symbol))
<a name="l00628"></a>00628          {
<a name="l00629"></a>00629             nssym = <a class="code" href="dlfcn_8c.html#9fc4abd8c5aaaa341566cf1cac760b38">dyld_NSLookupSymbolInImage</a>(dls-&gt;<a class="code" href="structdlstatus.html#e8acc63b1e238f3255c900eed37254b8">lib</a>,
<a name="l00630"></a>00630                                        symbol,
<a name="l00631"></a>00631                                        <a class="code" href="dlfcn_8c.html#cc050e8021ee1d5275232968a4c8e381">NSLOOKUPSYMBOLINIMAGE_OPTION_BIND</a> |
<a name="l00632"></a>00632                                        <a class="code" href="dlfcn_8c.html#093a56fc66d422a12e681349f7fc31ee">NSLOOKUPSYMBOLINIMAGE_OPTION_RETURN_ON_ERROR</a>);
<a name="l00633"></a>00633          }
<a name="l00634"></a>00634          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NSIsSymbolNameDefined(symbol))
<a name="l00635"></a>00635          {
<a name="l00636"></a>00636             <a class="code" href="app__rpt_8c.html#ad42f6697b035b7580e4fef93be20b4d">debug</a>(<span class="stringliteral">"Searching dependencies"</span>);
<a name="l00637"></a>00637             savedErrorStr = <a class="code" href="dlfcn_8c.html#c19c49edbff5e86e5280ee9f4c132344">dyld_error_str</a>();
<a name="l00638"></a>00638             nssym = <a class="code" href="dlfcn_8c.html#998125cc2be835ee34124f5221bdafce">search_linked_libs</a>(dls-&gt;<a class="code" href="structdlstatus.html#e8acc63b1e238f3255c900eed37254b8">lib</a>, symbol);
<a name="l00639"></a>00639          }
<a name="l00640"></a>00640       }
<a name="l00641"></a>00641       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a> == <a class="code" href="dlfcn_8c.html#7a6b0bdbbd9df80fd3f1044b33625543">MAGIC_DYLIB_MOD</a>)
<a name="l00642"></a>00642       {
<a name="l00643"></a>00643          <span class="comment">/* Global context, use NSLookupAndBindSymbol */</span>
<a name="l00644"></a>00644          <span class="keywordflow">if</span> (NSIsSymbolNameDefined(symbol))
<a name="l00645"></a>00645          {
<a name="l00646"></a>00646             <span class="comment">/* There doesn't seem to be a return on error option for this call???</span>
<a name="l00647"></a>00647 <span class="comment">               this is potentially broken, if binding fails, it will improperly</span>
<a name="l00648"></a>00648 <span class="comment">               exit the application. */</span>
<a name="l00649"></a>00649             nssym = NSLookupAndBindSymbol(symbol);
<a name="l00650"></a>00650          }
<a name="l00651"></a>00651          <span class="keywordflow">else</span>
<a name="l00652"></a>00652          {
<a name="l00653"></a>00653             <span class="keywordflow">if</span> (savedErrorStr)
<a name="l00654"></a>00654                <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>((<span class="keywordtype">char</span>*)savedErrorStr);         
<a name="l00655"></a>00655             savedErrorStr = <a class="code" href="astmm_8h.html#df74d22342f0da6246131193b1993a41">malloc</a>(256);
<a name="l00656"></a>00656             snprintf((<span class="keywordtype">char</span>*)savedErrorStr, 256, <span class="stringliteral">"Symbol \"%s\" not in global context"</span>,symbol);  
<a name="l00657"></a>00657          }
<a name="l00658"></a>00658       }
<a name="l00659"></a>00659    }
<a name="l00660"></a>00660    <span class="comment">/* Error reporting */</span>
<a name="l00661"></a>00661    <span class="keywordflow">if</span> (!nssym)
<a name="l00662"></a>00662    {
<a name="l00663"></a>00663       <span class="keywordflow">if</span> (!savedErrorStr || !strlen(savedErrorStr))
<a name="l00664"></a>00664       {
<a name="l00665"></a>00665          <span class="keywordflow">if</span> (savedErrorStr)
<a name="l00666"></a>00666             <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>((<span class="keywordtype">char</span>*)savedErrorStr);
<a name="l00667"></a>00667          savedErrorStr = <a class="code" href="astmm_8h.html#df74d22342f0da6246131193b1993a41">malloc</a>(256);
<a name="l00668"></a>00668          snprintf((<span class="keywordtype">char</span>*)savedErrorStr, 256,<span class="stringliteral">"Symbol \"%s\" not found"</span>,symbol);
<a name="l00669"></a>00669       }
<a name="l00670"></a>00670       <span class="keywordflow">if</span> (canSetError)
<a name="l00671"></a>00671       {
<a name="l00672"></a>00672          <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(savedErrorStr);
<a name="l00673"></a>00673       }
<a name="l00674"></a>00674       <span class="keywordflow">else</span>
<a name="l00675"></a>00675       {
<a name="l00676"></a>00676          <a class="code" href="app__rpt_8c.html#ad42f6697b035b7580e4fef93be20b4d">debug</a>(savedErrorStr);
<a name="l00677"></a>00677       }
<a name="l00678"></a>00678       <span class="keywordflow">if</span> (savedErrorStr)
<a name="l00679"></a>00679          <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>((<span class="keywordtype">char</span>*)savedErrorStr);
<a name="l00680"></a>00680       <span class="keywordflow">return</span> NULL;
<a name="l00681"></a>00681    }
<a name="l00682"></a>00682    <span class="keywordflow">return</span> NSAddressOfSymbol(nssym);
<a name="l00683"></a>00683 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="3173031af7d4b847c50f22264d505a2a"></a><!-- doxytag: member="dlfcn.c::dolock" ref="3173031af7d4b847c50f22264d505a2a" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void dolock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline, static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00862">862</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="dlfcn_8c-source.html#l00113">dlthread::errset</a>, <a class="el" href="dlfcn_8c-source.html#l00112">dlthread::lockcnt</a>, <a class="el" href="astmm_8h-source.html#l00066">malloc</a>, and <a class="el" href="lock_8h-source.html#l00594">pthread_mutex_lock</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l01167">dladdr()</a>, <a class="el" href="dlfcn_8c-source.html#l01041">dlclose()</a>, <a class="el" href="dlfcn_8c-source.html#l00897">dlopen()</a>, and <a class="el" href="dlfcn_8c-source.html#l00945">dlsym()</a>.<div class="fragment"><pre class="fragment"><a name="l00863"></a>00863 {
<a name="l00864"></a>00864    <span class="keywordtype">int</span> err = 0;
<a name="l00865"></a>00865    <span class="keyword">struct </span><a class="code" href="structdlthread.html">dlthread</a> *tss;
<a name="l00866"></a>00866    tss = pthread_getspecific(<a class="code" href="dlfcn_8c.html#446c9e2cac70c4a3977923451eea13da">dlerror_key</a>);
<a name="l00867"></a>00867    <span class="keywordflow">if</span> (!tss)
<a name="l00868"></a>00868    {
<a name="l00869"></a>00869       tss = <a class="code" href="astmm_8h.html#df74d22342f0da6246131193b1993a41">malloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structdlthread.html">dlthread</a>));
<a name="l00870"></a>00870       tss-&gt;<a class="code" href="structdlthread.html#bd85d310fd6d0c567721fcfae6a5b559">lockcnt</a> = 0;
<a name="l00871"></a>00871       tss-&gt;<a class="code" href="structdlthread.html#1d0e9ad7d1908eaf205e819f3255f92c">errset</a> = 0;
<a name="l00872"></a>00872       <span class="keywordflow">if</span> (pthread_setspecific(<a class="code" href="dlfcn_8c.html#446c9e2cac70c4a3977923451eea13da">dlerror_key</a>, tss))
<a name="l00873"></a>00873       {
<a name="l00874"></a>00874          fprintf(stderr,<span class="stringliteral">"dlcompat: pthread_setspecific failed\n"</span>);
<a name="l00875"></a>00875          exit(1);
<a name="l00876"></a>00876       }
<a name="l00877"></a>00877    }
<a name="l00878"></a>00878    <span class="keywordflow">if</span> (!tss-&gt;<a class="code" href="structdlthread.html#bd85d310fd6d0c567721fcfae6a5b559">lockcnt</a>)
<a name="l00879"></a>00879       err = <a class="code" href="lock_8h.html#bfd7b8e018ae42daf1c03f52e64e036a">pthread_mutex_lock</a>(&amp;<a class="code" href="dlfcn_8c.html#35bc2d3415a9f63bc5686e02a0f03883">dlcompat_mutex</a>);
<a name="l00880"></a>00880    tss-&gt;<a class="code" href="structdlthread.html#bd85d310fd6d0c567721fcfae6a5b559">lockcnt</a> = tss-&gt;<a class="code" href="structdlthread.html#bd85d310fd6d0c567721fcfae6a5b559">lockcnt</a> +1;  
<a name="l00881"></a>00881    <span class="keywordflow">if</span> (err)
<a name="l00882"></a>00882       exit(err);
<a name="l00883"></a>00883 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="1db4dbf9ea9f28b2fb35656635a0bebe"></a><!-- doxytag: member="dlfcn.c::dounlock" ref="1db4dbf9ea9f28b2fb35656635a0bebe" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void dounlock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline, static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00885">885</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="dlfcn_8c-source.html#l00112">dlthread::lockcnt</a>, and <a class="el" href="lock_8h-source.html#l00595">pthread_mutex_unlock</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l01167">dladdr()</a>, <a class="el" href="dlfcn_8c-source.html#l01041">dlclose()</a>, <a class="el" href="dlfcn_8c-source.html#l00897">dlopen()</a>, and <a class="el" href="dlfcn_8c-source.html#l00945">dlsym()</a>.<div class="fragment"><pre class="fragment"><a name="l00886"></a>00886 {
<a name="l00887"></a>00887    <span class="keywordtype">int</span> err = 0;
<a name="l00888"></a>00888    <span class="keyword">struct </span><a class="code" href="structdlthread.html">dlthread</a> *tss;
<a name="l00889"></a>00889    tss = pthread_getspecific(<a class="code" href="dlfcn_8c.html#446c9e2cac70c4a3977923451eea13da">dlerror_key</a>);
<a name="l00890"></a>00890    tss-&gt;<a class="code" href="structdlthread.html#bd85d310fd6d0c567721fcfae6a5b559">lockcnt</a> = tss-&gt;<a class="code" href="structdlthread.html#bd85d310fd6d0c567721fcfae6a5b559">lockcnt</a> -1;
<a name="l00891"></a>00891    <span class="keywordflow">if</span> (!tss-&gt;<a class="code" href="structdlthread.html#bd85d310fd6d0c567721fcfae6a5b559">lockcnt</a>)
<a name="l00892"></a>00892       err = <a class="code" href="lock_8h.html#ed02ace186d080ebc5159344e5732300">pthread_mutex_unlock</a>(&amp;<a class="code" href="dlfcn_8c.html#35bc2d3415a9f63bc5686e02a0f03883">dlcompat_mutex</a>);
<a name="l00893"></a>00893    <span class="keywordflow">if</span> (err)
<a name="l00894"></a>00894       exit(err);
<a name="l00895"></a>00895 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="c19c49edbff5e86e5280ee9f4c132344"></a><!-- doxytag: member="dlfcn.c::dyld_error_str" ref="c19c49edbff5e86e5280ee9f4c132344" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static const char * dyld_error_str           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline, static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00544">544</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="astmm_8h-source.html#l00066">malloc</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00560">dlsymIntern()</a>.<div class="fragment"><pre class="fragment"><a name="l00545"></a>00545 {
<a name="l00546"></a>00546    NSLinkEditErrors dylder;
<a name="l00547"></a>00547    <span class="keywordtype">int</span> dylderno;
<a name="l00548"></a>00548    <span class="keyword">const</span> <span class="keywordtype">char</span> *dylderrstr;
<a name="l00549"></a>00549    <span class="keyword">const</span> <span class="keywordtype">char</span> *dyldfile;
<a name="l00550"></a>00550    <span class="keyword">const</span> <span class="keywordtype">char</span>* retStr = NULL;
<a name="l00551"></a>00551    NSLinkEditError(&amp;dylder, &amp;dylderno, &amp;dyldfile, &amp;dylderrstr);
<a name="l00552"></a>00552    <span class="keywordflow">if</span> (dylderrstr &amp;&amp; strlen(dylderrstr))
<a name="l00553"></a>00553    {
<a name="l00554"></a>00554       retStr = <a class="code" href="astmm_8h.html#df74d22342f0da6246131193b1993a41">malloc</a>(strlen(dylderrstr) +1);
<a name="l00555"></a>00555       strcpy((<span class="keywordtype">char</span>*)retStr,dylderrstr);
<a name="l00556"></a>00556    }
<a name="l00557"></a>00557    <span class="keywordflow">return</span> retStr;
<a name="l00558"></a>00558 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="9989047f9754c69a45ea752cb417ca79"></a><!-- doxytag: member="dlfcn.c::error" ref="9989047f9754c69a45ea752cb417ca79" args="(const char *str,...)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void error           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>str</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>&nbsp;</td>
          <td class="mdname" nowrap> <em>...</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00196">196</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="app__rpt_8c-source.html#l00288">debug</a>, <a class="el" href="dlfcn_8c-source.html#l00092">ERR_STR_LEN</a>, <a class="el" href="dlfcn_8c-source.html#l00113">dlthread::errset</a>, and <a class="el" href="dlfcn_8c-source.html#l00114">dlthread::errstr</a>.
<p>
Referenced by <a class="el" href="pbx_8c-source.html#l02250">__ast_pbx_run()</a>, <a class="el" href="res__jabber_8c-source.html#l00716">aji_register_query_handler()</a>, <a class="el" href="cdr__csv_8c-source.html#l00152">append_string()</a>, <a class="el" href="app__minivm_8c-source.html#l02404">apply_general_options()</a>, <a class="el" href="loader_8c-source.html#l00431">ast_unload_resource()</a>, <a class="el" href="manager_8c-source.html#l00903">authenticate()</a>, <a class="el" href="chan__sip_8c-source.html#l16894">build_peer()</a>, <a class="el" href="chan__sip_8c-source.html#l16717">build_user()</a>, <a class="el" href="res__config__sqlite_8c-source.html#l00671">cdr_handler()</a>, <a class="el" href="res__config__sqlite_8c-source.html#l00744">config_handler()</a>, <a class="el" href="dlfcn_8c-source.html#l01167">dladdr()</a>, <a class="el" href="dlfcn_8c-source.html#l01041">dlclose()</a>, <a class="el" href="dlfcn_8c-source.html#l00897">dlopen()</a>, <a class="el" href="dlfcn_8c-source.html#l00945">dlsym()</a>, <a class="el" href="dlfcn_8c-source.html#l00560">dlsymIntern()</a>, <a class="el" href="res__astum_8c-source.html#l00665">func_aumuser_read()</a>, <a class="el" href="chan__gtalk_8c-source.html#l00569">gtalk_response()</a>, <a class="el" href="chan__sip_8c-source.html#l15588">handle_request()</a>, <a class="el" href="chan__sip_8c-source.html#l14098">handle_request_invite()</a>, <a class="el" href="chan__iax2_8c-source.html#l03093">iax2_hangup()</a>, <a class="el" href="chan__iax2_8c-source.html#l04672">iax2_write()</a>, <a class="el" href="dlfcn_8c-source.html#l00383">isValidStatus()</a>, <a class="el" href="chan__jingle_8c-source.html#l00455">jingle_response()</a>, <a class="el" href="app__minivm_8c-source.html#l02462">load_config()</a>, <a class="el" href="res__config__sqlite_8c-source.html#l01229">load_module()</a>, <a class="el" href="dlfcn_8c-source.html#l00685">loadModule()</a>, <a class="el" href="app__minivm_8c-source.html#l00497">message_template_build()</a>, <a class="el" href="chan__mgcp_8c-source.html#l01336">mgcp_devicestate()</a>, <a class="el" href="app__minivm_8c-source.html#l02065">minivm_accmess_exec()</a>, <a class="el" href="app__osplookup_8c-source.html#l00618">osp_check_destination()</a>, <a class="el" href="app__osplookup_8c-source.html#l00187">osp_create_provider()</a>, <a class="el" href="app__osplookup_8c-source.html#l00462">osp_create_transaction()</a>, <a class="el" href="app__osplookup_8c-source.html#l01246">osp_finish()</a>, <a class="el" href="app__osplookup_8c-source.html#l01942">osp_load()</a>, <a class="el" href="app__osplookup_8c-source.html#l00894">osp_lookup()</a>, <a class="el" href="app__osplookup_8c-source.html#l01122">osp_next()</a>, <a class="el" href="app__osplookup_8c-source.html#l00530">osp_validate_token()</a>, <a class="el" href="chan__sip_8c-source.html#l02489">parse_uri()</a>, <a class="el" href="res__config__sqlite_8c-source.html#l00852">realtime_handler()</a>, <a class="el" href="res__config__sqlite_8c-source.html#l00990">realtime_multi_handler()</a>, <a class="el" href="res__config__sqlite_8c-source.html#l01108">realtime_update_handler()</a>, <a class="el" href="dlfcn_8c-source.html#l00451">reference()</a>, <a class="el" href="chan__sip_8c-source.html#l17179">reload_config()</a>, <a class="el" href="chan__iax2_8c-source.html#l01730">send_packet()</a>, <a class="el" href="http_8c-source.html#l00987">server_start()</a>, and <a class="el" href="chan__oss_8c-source.html#l01489">store_config()</a>.<div class="fragment"><pre class="fragment"><a name="l00197"></a>00197 {
<a name="l00198"></a>00198    va_list arg;
<a name="l00199"></a>00199    <span class="keyword">struct </span><a class="code" href="structdlthread.html">dlthread</a>  *tss;
<a name="l00200"></a>00200    <span class="keywordtype">char</span> * err_str;
<a name="l00201"></a>00201    va_start(arg, str);
<a name="l00202"></a>00202    tss = pthread_getspecific(<a class="code" href="dlfcn_8c.html#446c9e2cac70c4a3977923451eea13da">dlerror_key</a>);
<a name="l00203"></a>00203    err_str = tss-&gt;<a class="code" href="structdlthread.html#ac8ef2b34ca04ea40d46ffb53ef323f8">errstr</a>;
<a name="l00204"></a>00204    strncpy(err_str, <span class="stringliteral">"dlcompat: "</span>, <a class="code" href="dlfcn_8c.html#13e7fe79d8e74ad50d94f63a2555d768">ERR_STR_LEN</a>);
<a name="l00205"></a>00205    vsnprintf(err_str + 10, <a class="code" href="dlfcn_8c.html#13e7fe79d8e74ad50d94f63a2555d768">ERR_STR_LEN</a> - 10, str, arg);
<a name="l00206"></a>00206    va_end(arg);
<a name="l00207"></a>00207    <a class="code" href="app__rpt_8c.html#ad42f6697b035b7580e4fef93be20b4d">debug</a>(<span class="stringliteral">"ERROR: %s\n"</span>, err_str);
<a name="l00208"></a>00208    tss-&gt;<a class="code" href="structdlthread.html#1d0e9ad7d1908eaf205e819f3255f92c">errset</a> = 1;
<a name="l00209"></a>00209 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="5ce6066f9cbcf99b3cc6d47bc288daa8"></a><!-- doxytag: member="dlfcn.c::findFile" ref="5ce6066f9cbcf99b3cc6d47bc288daa8" args="(const char *file, const char **fullPath)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static const struct stat * findFile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>file</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char **&nbsp;</td>
          <td class="mdname" nowrap> <em>fullPath</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00359">359</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="app__rpt_8c-source.html#l00288">debug</a>, and <a class="el" href="dlfcn_8c-source.html#l00344">getFullPath()</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00897">dlopen()</a>.<div class="fragment"><pre class="fragment"><a name="l00360"></a>00360 {
<a name="l00361"></a>00361    <span class="keywordtype">int</span> i = 0;
<a name="l00362"></a>00362    <span class="keyword">static</span> <span class="keyword">struct </span>stat sbuf;
<a name="l00363"></a>00363    <span class="keywordtype">char</span> *fileName;
<a name="l00364"></a>00364    <a class="code" href="app__rpt_8c.html#ad42f6697b035b7580e4fef93be20b4d">debug</a>(<span class="stringliteral">"finding file %s"</span>, <a class="code" href="manager_8h.html#8c7dd922ad47494fc02c388e12c00eac">file</a>);
<a name="l00365"></a>00365    *fullPath = <a class="code" href="manager_8h.html#8c7dd922ad47494fc02c388e12c00eac">file</a>;
<a name="l00366"></a>00366    <span class="keywordflow">if</span> (0 == stat(<a class="code" href="manager_8h.html#8c7dd922ad47494fc02c388e12c00eac">file</a>, &amp;sbuf))
<a name="l00367"></a>00367       <span class="keywordflow">return</span> &amp;sbuf;
<a name="l00368"></a>00368    <span class="keywordflow">if</span> (strchr(<a class="code" href="manager_8h.html#8c7dd922ad47494fc02c388e12c00eac">file</a>, <span class="charliteral">'/'</span>))
<a name="l00369"></a>00369       <span class="keywordflow">return</span> 0;            <span class="comment">/* If the path had a / we don't look in env var places */</span>
<a name="l00370"></a>00370    fileName = NULL;
<a name="l00371"></a>00371    <span class="keywordflow">if</span> (!fileName)
<a name="l00372"></a>00372       fileName = (<span class="keywordtype">char</span> *)<a class="code" href="manager_8h.html#8c7dd922ad47494fc02c388e12c00eac">file</a>;
<a name="l00373"></a>00373    <span class="keywordflow">while</span> ((*fullPath = <a class="code" href="dlfcn_8c.html#b0b1ae2c747ce1724f672c6b823a6e80">getFullPath</a>(i++, fileName)))
<a name="l00374"></a>00374    {
<a name="l00375"></a>00375       <span class="keywordflow">if</span> (0 == stat(*fullPath, &amp;sbuf))
<a name="l00376"></a>00376          <span class="keywordflow">return</span> &amp;sbuf;
<a name="l00377"></a>00377    }
<a name="l00378"></a>00378    ;
<a name="l00379"></a>00379    <span class="keywordflow">return</span> 0;
<a name="l00380"></a>00380 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="0b7d7a9f21dd25d6dc50d712552f343a"></a><!-- doxytag: member="dlfcn.c::get_lib_name" ref="0b7d7a9f21dd25d6dc50d712552f343a" args="(const struct mach_header *mh)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static const char * get_lib_name           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const struct mach_header *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>mh</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00228">228</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l01041">dlclose()</a>.<div class="fragment"><pre class="fragment"><a name="l00229"></a>00229 {
<a name="l00230"></a>00230    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> count = _dyld_image_count();
<a name="l00231"></a>00231    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i;
<a name="l00232"></a>00232    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structval.html">val</a> = NULL;
<a name="l00233"></a>00233    <span class="keywordflow">if</span> (mh)
<a name="l00234"></a>00234    {
<a name="l00235"></a>00235       <span class="keywordflow">for</span> (i = 0; i &lt; count; i++)
<a name="l00236"></a>00236       {
<a name="l00237"></a>00237          <span class="keywordflow">if</span> (mh == _dyld_get_image_header(i))
<a name="l00238"></a>00238          {
<a name="l00239"></a>00239             val = _dyld_get_image_name(i);
<a name="l00240"></a>00240             <span class="keywordflow">break</span>;
<a name="l00241"></a>00241          }
<a name="l00242"></a>00242       }
<a name="l00243"></a>00243    }
<a name="l00244"></a>00244    <span class="keywordflow">return</span> val;
<a name="l00245"></a>00245 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="980566f5f6d3ca4e4f01c5d3cced8327"></a><!-- doxytag: member="dlfcn.c::get_mach_header_from_NSModule" ref="980566f5f6d3ca4e4f01c5d3cced8327" args="(NSModule *mod)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static const struct mach_header * get_mach_header_from_NSModule           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">NSModule *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>mod</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00251">251</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="app__rpt_8c-source.html#l00288">debug</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l01041">dlclose()</a>, <a class="el" href="dlfcn_8c-source.html#l00560">dlsymIntern()</a>, and <a class="el" href="dlfcn_8c-source.html#l00685">loadModule()</a>.<div class="fragment"><pre class="fragment"><a name="l00252"></a>00252 {
<a name="l00253"></a>00253    <span class="keyword">const</span> <span class="keywordtype">char</span> *mod_name = NSNameOfModule(mod);
<a name="l00254"></a>00254    <span class="keyword">struct </span>mach_header *mh = NULL;
<a name="l00255"></a>00255    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> count = _dyld_image_count();
<a name="l00256"></a>00256    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i;
<a name="l00257"></a>00257    <a class="code" href="app__rpt_8c.html#ad42f6697b035b7580e4fef93be20b4d">debug</a>(<span class="stringliteral">"Module name: %s"</span>, mod_name);
<a name="l00258"></a>00258    <span class="keywordflow">for</span> (i = 0; i &lt; count; i++)
<a name="l00259"></a>00259    {
<a name="l00260"></a>00260       <span class="keywordflow">if</span> (!strcmp(mod_name, _dyld_get_image_name(i)))
<a name="l00261"></a>00261       {
<a name="l00262"></a>00262          mh = _dyld_get_image_header(i);
<a name="l00263"></a>00263          <span class="keywordflow">break</span>;
<a name="l00264"></a>00264       }
<a name="l00265"></a>00265    }
<a name="l00266"></a>00266    <span class="keywordflow">return</span> mh;
<a name="l00267"></a>00267 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0b1ae2c747ce1724f672c6b823a6e80"></a><!-- doxytag: member="dlfcn.c::getFullPath" ref="b0b1ae2c747ce1724f672c6b823a6e80" args="(int i, const char *file)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static const char * getFullPath           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>i</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>file</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00344">344</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="adsistub_8c-source.html#l00065">buf</a>, and <a class="el" href="dlfcn_8c-source.html#l00298">getSearchPath()</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00359">findFile()</a>.<div class="fragment"><pre class="fragment"><a name="l00345"></a>00345 {
<a name="l00346"></a>00346    <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>[PATH_MAX];
<a name="l00347"></a>00347    <span class="keyword">const</span> <span class="keywordtype">char</span> *path = <a class="code" href="dlfcn_8c.html#d51feb8815c9b0ac6afdcc317a0feded">getSearchPath</a>(i);
<a name="l00348"></a>00348    <span class="keywordflow">if</span> (path)
<a name="l00349"></a>00349    {
<a name="l00350"></a>00350       snprintf(buf, PATH_MAX, <span class="stringliteral">"%s/%s"</span>, path, <a class="code" href="manager_8h.html#8c7dd922ad47494fc02c388e12c00eac">file</a>);
<a name="l00351"></a>00351    }
<a name="l00352"></a>00352    <span class="keywordflow">return</span> path ? buf : 0;
<a name="l00353"></a>00353 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d51feb8815c9b0ac6afdcc317a0feded"></a><!-- doxytag: member="dlfcn.c::getSearchPath" ref="d51feb8815c9b0ac6afdcc317a0feded" args="(int i)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static const char * getSearchPath           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>i</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00298">298</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="astmm_8h-source.html#l00060">calloc</a>, <a class="el" href="app__rpt_8c-source.html#l00288">debug</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="dlfcn_8c-source.html#l00095">MAX_SEARCH_PATHS</a>, <a class="el" href="dlfcn_8c-source.html#l00278">searchList()</a>, and <a class="el" href="strcompat_8c-source.html#l00035">strsep()</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00824">dlcompat_cleanup()</a>, and <a class="el" href="dlfcn_8c-source.html#l00344">getFullPath()</a>.<div class="fragment"><pre class="fragment"><a name="l00299"></a>00299 {
<a name="l00300"></a>00300    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *list = 0;
<a name="l00301"></a>00301    <span class="keyword">static</span> <span class="keywordtype">char</span> **path = (<span class="keywordtype">char</span> **)0;
<a name="l00302"></a>00302    <span class="keyword">static</span> <span class="keywordtype">int</span> end = 0;
<a name="l00303"></a>00303    <span class="keyword">static</span> <span class="keywordtype">int</span> numsize = <a class="code" href="dlfcn_8c.html#2de067226d09024de7279a081ca98e05">MAX_SEARCH_PATHS</a>;
<a name="l00304"></a>00304    <span class="keyword">static</span> <span class="keywordtype">char</span> **tmp;
<a name="l00305"></a>00305    <span class="comment">/* So we can call free() in the "destructor" we use i=-1 to return the alloc'd array */</span>
<a name="l00306"></a>00306    <span class="keywordflow">if</span> (i == -1)
<a name="l00307"></a>00307    {
<a name="l00308"></a>00308       <span class="keywordflow">return</span> (<span class="keyword">const</span> <span class="keywordtype">char</span>*)path;
<a name="l00309"></a>00309    }
<a name="l00310"></a>00310    <span class="keywordflow">if</span> (!path)
<a name="l00311"></a>00311    {
<a name="l00312"></a>00312       path = (<span class="keywordtype">char</span> **)<a class="code" href="astmm_8h.html#b9d011ff8b105f2850962f2003da06d9">calloc</a>(<a class="code" href="dlfcn_8c.html#2de067226d09024de7279a081ca98e05">MAX_SEARCH_PATHS</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span> **));
<a name="l00313"></a>00313    }
<a name="l00314"></a>00314    <span class="keywordflow">if</span> (!list &amp;&amp; !end)
<a name="l00315"></a>00315       list = <a class="code" href="dlfcn_8c.html#e3b786dcfbda95c5708dc4e648cb3fd8">searchList</a>();
<a name="l00316"></a>00316    <span class="keywordflow">if</span> (i &gt;= (numsize))
<a name="l00317"></a>00317    {
<a name="l00318"></a>00318       <a class="code" href="app__rpt_8c.html#ad42f6697b035b7580e4fef93be20b4d">debug</a>(<span class="stringliteral">"Increasing size for long PATH"</span>);
<a name="l00319"></a>00319       tmp = (<span class="keywordtype">char</span> **)<a class="code" href="astmm_8h.html#b9d011ff8b105f2850962f2003da06d9">calloc</a>((<a class="code" href="dlfcn_8c.html#2de067226d09024de7279a081ca98e05">MAX_SEARCH_PATHS</a> + numsize), <span class="keyword">sizeof</span>(<span class="keywordtype">char</span> **));
<a name="l00320"></a>00320       <span class="keywordflow">if</span> (tmp)
<a name="l00321"></a>00321       {
<a name="l00322"></a>00322          memcpy(tmp, path, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span> **) * numsize);
<a name="l00323"></a>00323          <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(path);
<a name="l00324"></a>00324          path = tmp;
<a name="l00325"></a>00325          numsize += <a class="code" href="dlfcn_8c.html#2de067226d09024de7279a081ca98e05">MAX_SEARCH_PATHS</a>;
<a name="l00326"></a>00326       }
<a name="l00327"></a>00327       <span class="keywordflow">else</span>
<a name="l00328"></a>00328       {
<a name="l00329"></a>00329          <span class="keywordflow">return</span> 0;
<a name="l00330"></a>00330       }
<a name="l00331"></a>00331    }
<a name="l00332"></a>00332 
<a name="l00333"></a>00333    <span class="keywordflow">while</span> (!path[i] &amp;&amp; !end)
<a name="l00334"></a>00334    {
<a name="l00335"></a>00335       path[i] = <a class="code" href="strcompat_8c.html#a541370456ac872bdb4bdcc462fc6a6e">strsep</a>((<span class="keywordtype">char</span> **)&amp;list, <span class="stringliteral">":"</span>);
<a name="l00336"></a>00336 
<a name="l00337"></a>00337       <span class="keywordflow">if</span> (path[i][0] == 0)
<a name="l00338"></a>00338          path[i] = 0;
<a name="l00339"></a>00339       end = (list == 0);
<a name="l00340"></a>00340    }
<a name="l00341"></a>00341    <span class="keywordflow">return</span> path[i];
<a name="l00342"></a>00342 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="edd4c3613a03834168b85d9192559af3"></a><!-- doxytag: member="dlfcn.c::image_for_address" ref="edd4c3613a03834168b85d9192559af3" args="(const void *address)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const struct mach_header * image_for_address           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const void *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>address</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l01135">1135</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00560">dlsymIntern()</a>.<div class="fragment"><pre class="fragment"><a name="l01136"></a>01136 {
<a name="l01137"></a>01137    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i;
<a name="l01138"></a>01138    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> j;
<a name="l01139"></a>01139    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> count = _dyld_image_count();
<a name="l01140"></a>01140    <span class="keyword">struct </span>mach_header *mh = 0;
<a name="l01141"></a>01141    <span class="keyword">struct </span>load_command *lc = 0;
<a name="l01142"></a>01142    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> addr = NULL;
<a name="l01143"></a>01143    <span class="keywordflow">for</span> (i = 0; i &lt; count; i++)
<a name="l01144"></a>01144    {
<a name="l01145"></a>01145       addr = (<span class="keywordtype">unsigned</span> long)address - _dyld_get_image_vmaddr_slide(i);
<a name="l01146"></a>01146       mh = _dyld_get_image_header(i);
<a name="l01147"></a>01147       <span class="keywordflow">if</span> (mh)
<a name="l01148"></a>01148       {
<a name="l01149"></a>01149          lc = (<span class="keyword">struct </span>load_command *)((<span class="keywordtype">char</span> *)mh + <span class="keyword">sizeof</span>(<span class="keyword">struct</span> mach_header));
<a name="l01150"></a>01150          <span class="keywordflow">for</span> (j = 0; j &lt; mh-&gt;ncmds; j++, lc = (<span class="keyword">struct</span> load_command *)((<span class="keywordtype">char</span> *)lc + lc-&gt;cmdsize))
<a name="l01151"></a>01151          {
<a name="l01152"></a>01152             <span class="keywordflow">if</span> (LC_SEGMENT == lc-&gt;cmd &amp;&amp;
<a name="l01153"></a>01153                addr &gt;= ((<span class="keyword">struct</span> segment_command *)lc)-&gt;vmaddr &amp;&amp;
<a name="l01154"></a>01154                addr &lt;
<a name="l01155"></a>01155                ((<span class="keyword">struct</span> segment_command *)lc)-&gt;vmaddr + ((<span class="keyword">struct</span> segment_command *)lc)-&gt;vmsize)
<a name="l01156"></a>01156             {
<a name="l01157"></a>01157                <span class="keywordflow">goto</span> image_found;
<a name="l01158"></a>01158             }
<a name="l01159"></a>01159          }
<a name="l01160"></a>01160       }
<a name="l01161"></a>01161       mh = 0;
<a name="l01162"></a>01162    }
<a name="l01163"></a>01163   image_found:
<a name="l01164"></a>01164    <span class="keywordflow">return</span> mh;
<a name="l01165"></a>01165 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="873dbb061fe03446f7abde7d232472c5"></a><!-- doxytag: member="dlfcn.c::insertStatus" ref="873dbb061fe03446f7abde7d232472c5" args="(struct dlstatus *dls, const struct stat *sbuf)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void insertStatus           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structdlstatus.html">dlstatus</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>dls</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct stat *&nbsp;</td>
          <td class="mdname" nowrap> <em>sbuf</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00413">413</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="app__rpt_8c-source.html#l00288">debug</a>, <a class="el" href="dlfcn_8c-source.html#l00127">dlstatus::device</a>, <a class="el" href="dlfcn_8c-source.html#l00102">DL_IN_LIST</a>, <a class="el" href="dlfcn_8c-source.html#l00129">dlstatus::flags</a>, <a class="el" href="dlfcn_8c-source.html#l00128">dlstatus::inode</a>, <a class="el" href="dlfcn_8c-source.html#l00126">dlstatus::mode</a>, <a class="el" href="dlfcn_8c-source.html#l00122">dlstatus::next</a>, and <a class="el" href="dlfcn_8c-source.html#l00125">dlstatus::refs</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00685">loadModule()</a>.<div class="fragment"><pre class="fragment"><a name="l00414"></a>00414 {
<a name="l00415"></a>00415    <a class="code" href="app__rpt_8c.html#ad42f6697b035b7580e4fef93be20b4d">debug</a>(<span class="stringliteral">"inserting status"</span>);
<a name="l00416"></a>00416    dls-&gt;<a class="code" href="structdlstatus.html#9103befcd86a4d5623156d9a3044d3eb">inode</a> = sbuf-&gt;st_ino;
<a name="l00417"></a>00417    dls-&gt;<a class="code" href="structdlstatus.html#913f9c49dcb544e2087cee284f4a00b7">device</a> = sbuf-&gt;st_dev;
<a name="l00418"></a>00418    dls-&gt;<a class="code" href="structdlstatus.html#5740713f144552f73502d802bc23dd35">refs</a> = 0;
<a name="l00419"></a>00419    dls-&gt;<a class="code" href="structdlstatus.html#15d61712450a686a7f365adf4fef581f">mode</a> = 0;
<a name="l00420"></a>00420    <span class="keywordflow">if</span> ((dls-&gt;<a class="code" href="structdlstatus.html#4e5868d676cb634aa75b125a0f741abf">flags</a> &amp; <a class="code" href="dlfcn_8c.html#623f5284ca0d69050730d335ec3322c8">DL_IN_LIST</a>) == 0)
<a name="l00421"></a>00421    {
<a name="l00422"></a>00422       dls-&gt;<a class="code" href="structdlstatus.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a> = <a class="code" href="dlfcn_8c.html#263ae105fbf479a73d0cacf0db8538dd">stqueue</a>;
<a name="l00423"></a>00423       <a class="code" href="dlfcn_8c.html#263ae105fbf479a73d0cacf0db8538dd">stqueue</a> = dls;
<a name="l00424"></a>00424       dls-&gt;<a class="code" href="structdlstatus.html#4e5868d676cb634aa75b125a0f741abf">flags</a> |= <a class="code" href="dlfcn_8c.html#623f5284ca0d69050730d335ec3322c8">DL_IN_LIST</a>;
<a name="l00425"></a>00425    }
<a name="l00426"></a>00426 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="de1ac04ff9536258d5099cd4ed3f0b84"></a><!-- doxytag: member="dlfcn.c::isFlagSet" ref="de1ac04ff9536258d5099cd4ed3f0b84" args="(int mode, int flag)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int isFlagSet           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>flag</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [inline, static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00398">398</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l01041">dlclose()</a>, <a class="el" href="dlfcn_8c-source.html#l00897">dlopen()</a>, <a class="el" href="dlfcn_8c-source.html#l00685">loadModule()</a>, and <a class="el" href="dlfcn_8c-source.html#l00451">reference()</a>.<div class="fragment"><pre class="fragment"><a name="l00399"></a>00399 {
<a name="l00400"></a>00400    <span class="keywordflow">return</span> (mode &amp; flag) == flag;
<a name="l00401"></a>00401 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="94cc9569b7b9d1547f14f2ce0e5512cd"></a><!-- doxytag: member="dlfcn.c::isValidStatus" ref="94cc9569b7b9d1547f14f2ce0e5512cd" args="(struct dlstatus *status)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int isValidStatus           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structdlstatus.html">dlstatus</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>status</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00383">383</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="dlfcn_8c-source.html#l00196">error()</a>, <a class="el" href="plc_8c-source.html#l00045">FALSE</a>, <a class="el" href="dlfcn_8c-source.html#l00123">dlstatus::module</a>, <a class="el" href="dlfcn_8c-source.html#l00122">dlstatus::next</a>, <a class="el" href="dlfcn_8c-source.html#l00125">dlstatus::refs</a>, and <a class="el" href="plc_8c-source.html#l00048">TRUE</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l01041">dlclose()</a>, and <a class="el" href="dlfcn_8c-source.html#l00560">dlsymIntern()</a>.<div class="fragment"><pre class="fragment"><a name="l00384"></a>00384 {
<a name="l00385"></a>00385    <span class="comment">/* Walk the list to verify status is contained in it */</span>
<a name="l00386"></a>00386    <span class="keyword">struct </span><a class="code" href="structdlstatus.html">dlstatus</a> *dls = <a class="code" href="dlfcn_8c.html#263ae105fbf479a73d0cacf0db8538dd">stqueue</a>;
<a name="l00387"></a>00387    <span class="keywordflow">while</span> (dls &amp;&amp; status != dls)
<a name="l00388"></a>00388       dls = dls-&gt;<a class="code" href="structdlstatus.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>;
<a name="l00389"></a>00389    <span class="keywordflow">if</span> (dls == 0)
<a name="l00390"></a>00390       <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"invalid handle"</span>);
<a name="l00391"></a>00391    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a> == 0) || (dls-&gt;<a class="code" href="structdlstatus.html#5740713f144552f73502d802bc23dd35">refs</a> == 0))
<a name="l00392"></a>00392       <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"handle to closed library"</span>);
<a name="l00393"></a>00393    <span class="keywordflow">else</span>
<a name="l00394"></a>00394       <span class="keywordflow">return</span> <a class="code" href="plc_8c.html#c0d83f0b82a6b30de8811e69e6d95c61">TRUE</a>;
<a name="l00395"></a>00395    <span class="keywordflow">return</span> <a class="code" href="plc_8c.html#946003f97ccc52d5d3b54ac0ec31bbfc">FALSE</a>;
<a name="l00396"></a>00396 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="3ccd00c1b00c0a0c2098a526ed71fe32"></a><!-- doxytag: member="dlfcn.c::loadModule" ref="3ccd00c1b00c0a0c2098a526ed71fe32" args="(const char *path, const struct stat *sbuf, int mode)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static struct <a class="el" href="structdlstatus.html">dlstatus</a> * loadModule           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>path</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct stat *&nbsp;</td>
          <td class="mdname" nowrap> <em>sbuf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00685">685</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="dlfcn_8c-source.html#l00428">allocStatus()</a>, <a class="el" href="app__rpt_8c-source.html#l00288">debug</a>, <a class="el" href="dlfcn_8c-source.html#l00102">DL_IN_LIST</a>, <a class="el" href="dlfcn_8c-source.html#l00560">dlsymIntern()</a>, <a class="el" href="dlfcn_8c-source.html#l00080">dyld_NSAddImage</a>, <a class="el" href="dlfcn_8c-source.html#l00196">error()</a>, <a class="el" href="dlfcn_8c-source.html#l00129">dlstatus::flags</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="dlfcn_8c-source.html#l00251">get_mach_header_from_NSModule()</a>, <a class="el" href="dlfcn_8c-source.html#l00413">insertStatus()</a>, <a class="el" href="dlfcn_8c-source.html#l00398">isFlagSet()</a>, <a class="el" href="dlfcn_8c-source.html#l00124">dlstatus::lib</a>, <a class="el" href="dlfcn_8c-source.html#l00403">lookupStatus()</a>, <a class="el" href="dlfcn_8c-source.html#l00099">MAGIC_DYLIB_MOD</a>, <a class="el" href="dlfcn_8c-source.html#l00098">MAGIC_DYLIB_OFI</a>, <a class="el" href="dlfcn_8c-source.html#l00123">dlstatus::module</a>, <a class="el" href="dlfcn_8c-source.html#l00071">NSADDIMAGE_OPTION_RETURN_ON_ERROR</a>, <a class="el" href="dlfcn_8c-source.html#l00451">reference()</a>, <a class="el" href="dlfcn-compat_8h-source.html#l00074">RTLD_GLOBAL</a>, <a class="el" href="loader_8c-source.html#l00065">RTLD_NOW</a>, and <a class="el" href="dlfcn_8c-source.html#l00211">warning()</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00897">dlopen()</a>.<div class="fragment"><pre class="fragment"><a name="l00686"></a>00686 {
<a name="l00687"></a>00687    NSObjectFileImage ofi = 0;
<a name="l00688"></a>00688    NSObjectFileImageReturnCode ofirc;
<a name="l00689"></a>00689    <span class="keyword">struct </span><a class="code" href="structdlstatus.html">dlstatus</a> *dls;
<a name="l00690"></a>00690    NSLinkEditErrors ler;
<a name="l00691"></a>00691    <span class="keywordtype">int</span> lerno;
<a name="l00692"></a>00692    <span class="keyword">const</span> <span class="keywordtype">char</span> *errstr;
<a name="l00693"></a>00693    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="manager_8h.html#8c7dd922ad47494fc02c388e12c00eac">file</a>;
<a name="l00694"></a>00694    void (*init) (void);
<a name="l00695"></a>00695    ofirc = NSCreateObjectFileImageFromFile(path, &amp;ofi);
<a name="l00696"></a>00696    <span class="keywordflow">switch</span> (ofirc)
<a name="l00697"></a>00697    {
<a name="l00698"></a>00698       <span class="keywordflow">case</span> NSObjectFileImageSuccess:
<a name="l00699"></a>00699          <span class="keywordflow">break</span>;
<a name="l00700"></a>00700       <span class="keywordflow">case</span> NSObjectFileImageInappropriateFile:
<a name="l00701"></a>00701          <span class="keywordflow">if</span> (<a class="code" href="dlfcn_8c.html#83168d8db5a85df2b3e7898c1230942f">dyld_NSAddImage</a> &amp;&amp; <a class="code" href="dlfcn_8c.html#8efc76b493fa04cbcff731ebe67cb41f">dyld_NSIsSymbolNameDefinedInImage</a> &amp;&amp; <a class="code" href="dlfcn_8c.html#9fc4abd8c5aaaa341566cf1cac760b38">dyld_NSLookupSymbolInImage</a>)
<a name="l00702"></a>00702          {
<a name="l00703"></a>00703             <span class="keywordflow">if</span> (!<a class="code" href="dlfcn_8c.html#de1ac04ff9536258d5099cd4ed3f0b84">isFlagSet</a>(<a class="code" href="structdlstatus.html#15d61712450a686a7f365adf4fef581f">mode</a>, <a class="code" href="dlfcn-compat_8h.html#d565d5d83850e65f4dc43e403df7a3db">RTLD_GLOBAL</a>))
<a name="l00704"></a>00704             {
<a name="l00705"></a>00705                <a class="code" href="dlfcn_8c.html#a0054ad56afd71085b56813f21a1544c">warning</a>(<span class="stringliteral">"trying to open a .dylib with RTLD_LOCAL"</span>);
<a name="l00706"></a>00706                <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"unable to open this file with RTLD_LOCAL"</span>);
<a name="l00707"></a>00707                <span class="keywordflow">return</span> NULL;
<a name="l00708"></a>00708             }
<a name="l00709"></a>00709          }
<a name="l00710"></a>00710          <span class="keywordflow">else</span>
<a name="l00711"></a>00711          {
<a name="l00712"></a>00712             <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"opening this file is unsupported on this system"</span>);
<a name="l00713"></a>00713             <span class="keywordflow">return</span> NULL;
<a name="l00714"></a>00714          }
<a name="l00715"></a>00715          <span class="keywordflow">break</span>;
<a name="l00716"></a>00716       <span class="keywordflow">case</span> NSObjectFileImageFailure:
<a name="l00717"></a>00717          <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"object file setup failure"</span>);
<a name="l00718"></a>00718          <span class="keywordflow">return</span> NULL;
<a name="l00719"></a>00719       <span class="keywordflow">case</span> NSObjectFileImageArch:
<a name="l00720"></a>00720          <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"no object for this architecture"</span>);
<a name="l00721"></a>00721          <span class="keywordflow">return</span> NULL;
<a name="l00722"></a>00722       <span class="keywordflow">case</span> NSObjectFileImageFormat:
<a name="l00723"></a>00723          <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"bad object file format"</span>);
<a name="l00724"></a>00724          <span class="keywordflow">return</span> NULL;
<a name="l00725"></a>00725       <span class="keywordflow">case</span> NSObjectFileImageAccess:
<a name="l00726"></a>00726          <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"can't read object file"</span>);
<a name="l00727"></a>00727          <span class="keywordflow">return</span> NULL;
<a name="l00728"></a>00728       <span class="keywordflow">default</span>:
<a name="l00729"></a>00729          <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"unknown error from NSCreateObjectFileImageFromFile()"</span>);
<a name="l00730"></a>00730          <span class="keywordflow">return</span> NULL;
<a name="l00731"></a>00731    }
<a name="l00732"></a>00732    dls = <a class="code" href="dlfcn_8c.html#302bcae6e1b779aec6b07c4891b9283f">lookupStatus</a>(sbuf);
<a name="l00733"></a>00733    <span class="keywordflow">if</span> (!dls)
<a name="l00734"></a>00734    {
<a name="l00735"></a>00735       dls = <a class="code" href="dlfcn_8c.html#f9967e34823d8729bf12f0fad36a885d">allocStatus</a>();
<a name="l00736"></a>00736    }
<a name="l00737"></a>00737    <span class="keywordflow">if</span> (!dls)
<a name="l00738"></a>00738    {
<a name="l00739"></a>00739       <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"unable to allocate memory"</span>);
<a name="l00740"></a>00740       <span class="keywordflow">return</span> NULL;
<a name="l00741"></a>00741    }
<a name="l00742"></a>00742    dls-&gt;<a class="code" href="structdlstatus.html#e8acc63b1e238f3255c900eed37254b8">lib</a> = 0;
<a name="l00743"></a>00743    <span class="keywordflow">if</span> (ofirc == NSObjectFileImageInappropriateFile)
<a name="l00744"></a>00744    {
<a name="l00745"></a>00745       <span class="keywordflow">if</span> ((dls-&gt;<a class="code" href="structdlstatus.html#e8acc63b1e238f3255c900eed37254b8">lib</a> = <a class="code" href="dlfcn_8c.html#83168d8db5a85df2b3e7898c1230942f">dyld_NSAddImage</a>(path, <a class="code" href="dlfcn_8c.html#8bef999e98f5b17a42537ade68c2db1d">NSADDIMAGE_OPTION_RETURN_ON_ERROR</a>)))
<a name="l00746"></a>00746       {
<a name="l00747"></a>00747          <a class="code" href="app__rpt_8c.html#ad42f6697b035b7580e4fef93be20b4d">debug</a>(<span class="stringliteral">"Dynamic lib loaded at %ld"</span>, dls-&gt;<a class="code" href="structdlstatus.html#e8acc63b1e238f3255c900eed37254b8">lib</a>);
<a name="l00748"></a>00748          ofi = <a class="code" href="dlfcn_8c.html#833480468fa097cbd87d801ddbb89555">MAGIC_DYLIB_OFI</a>;
<a name="l00749"></a>00749          dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a> = <a class="code" href="dlfcn_8c.html#7a6b0bdbbd9df80fd3f1044b33625543">MAGIC_DYLIB_MOD</a>;
<a name="l00750"></a>00750          ofirc = NSObjectFileImageSuccess;
<a name="l00751"></a>00751          <span class="comment">/* Although it is possible with a bit of work to modify this so it works and</span>
<a name="l00752"></a>00752 <span class="comment">            functions with RTLD_NOW, I don't deem it necessary at the moment */</span>
<a name="l00753"></a>00753       }
<a name="l00754"></a>00754       <span class="keywordflow">if</span> (!(dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a>))
<a name="l00755"></a>00755       {
<a name="l00756"></a>00756          NSLinkEditError(&amp;ler, &amp;lerno, &amp;file, &amp;errstr);
<a name="l00757"></a>00757          <span class="keywordflow">if</span> (!errstr || (!strlen(errstr)))
<a name="l00758"></a>00758             <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"Can't open this file type"</span>);
<a name="l00759"></a>00759          <span class="keywordflow">else</span>
<a name="l00760"></a>00760             <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(errstr);
<a name="l00761"></a>00761          <span class="keywordflow">if</span> ((dls-&gt;<a class="code" href="structdlstatus.html#4e5868d676cb634aa75b125a0f741abf">flags</a> &amp; <a class="code" href="dlfcn_8c.html#623f5284ca0d69050730d335ec3322c8">DL_IN_LIST</a>) == 0)
<a name="l00762"></a>00762          {
<a name="l00763"></a>00763             <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(dls);
<a name="l00764"></a>00764          }
<a name="l00765"></a>00765          <span class="keywordflow">return</span> NULL;
<a name="l00766"></a>00766       }
<a name="l00767"></a>00767    }
<a name="l00768"></a>00768    <span class="keywordflow">else</span>
<a name="l00769"></a>00769    {
<a name="l00770"></a>00770       dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a> = NSLinkModule(ofi, path,
<a name="l00771"></a>00771                            NSLINKMODULE_OPTION_RETURN_ON_ERROR |
<a name="l00772"></a>00772                            NSLINKMODULE_OPTION_PRIVATE |
<a name="l00773"></a>00773                            (<a class="code" href="dlfcn_8c.html#de1ac04ff9536258d5099cd4ed3f0b84">isFlagSet</a>(<a class="code" href="structdlstatus.html#15d61712450a686a7f365adf4fef581f">mode</a>, <a class="code" href="loader_8c.html#cebd9c7b300fbb075a0eb012c43879e8">RTLD_NOW</a>) ? NSLINKMODULE_OPTION_BINDNOW : 0));
<a name="l00774"></a>00774       NSDestroyObjectFileImage(ofi);
<a name="l00775"></a>00775       <span class="keywordflow">if</span> (dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a>)
<a name="l00776"></a>00776       {
<a name="l00777"></a>00777          dls-&gt;<a class="code" href="structdlstatus.html#e8acc63b1e238f3255c900eed37254b8">lib</a> = <a class="code" href="dlfcn_8c.html#980566f5f6d3ca4e4f01c5d3cced8327">get_mach_header_from_NSModule</a>(dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a>);
<a name="l00778"></a>00778       }
<a name="l00779"></a>00779    }
<a name="l00780"></a>00780    <span class="keywordflow">if</span> (!dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a>)
<a name="l00781"></a>00781    {
<a name="l00782"></a>00782       NSLinkEditError(&amp;ler, &amp;lerno, &amp;file, &amp;errstr);
<a name="l00783"></a>00783       <span class="keywordflow">if</span> ((dls-&gt;<a class="code" href="structdlstatus.html#4e5868d676cb634aa75b125a0f741abf">flags</a> &amp; <a class="code" href="dlfcn_8c.html#623f5284ca0d69050730d335ec3322c8">DL_IN_LIST</a>) == 0)
<a name="l00784"></a>00784       {
<a name="l00785"></a>00785          <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(dls);
<a name="l00786"></a>00786       }
<a name="l00787"></a>00787       <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(errstr);
<a name="l00788"></a>00788       <span class="keywordflow">return</span> NULL;
<a name="l00789"></a>00789    }
<a name="l00790"></a>00790 
<a name="l00791"></a>00791    <a class="code" href="dlfcn_8c.html#873dbb061fe03446f7abde7d232472c5">insertStatus</a>(dls, sbuf);
<a name="l00792"></a>00792    dls = <a class="code" href="dlfcn_8c.html#f9549c9322f3ac5e9f28e0bb7552f8a1">reference</a>(dls, <a class="code" href="structdlstatus.html#15d61712450a686a7f365adf4fef581f">mode</a>);
<a name="l00793"></a>00793    <span class="keywordflow">if</span> ((init = <a class="code" href="dlfcn_8c.html#fbd7fb3690c8eff254f2690e831547b0">dlsymIntern</a>(dls, <span class="stringliteral">"__init"</span>, 0)))
<a name="l00794"></a>00794    {
<a name="l00795"></a>00795       <a class="code" href="app__rpt_8c.html#ad42f6697b035b7580e4fef93be20b4d">debug</a>(<span class="stringliteral">"calling _init()"</span>);
<a name="l00796"></a>00796       init();
<a name="l00797"></a>00797    }
<a name="l00798"></a>00798    <span class="keywordflow">return</span> dls;
<a name="l00799"></a>00799 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="302bcae6e1b779aec6b07c4891b9283f"></a><!-- doxytag: member="dlfcn.c::lookupStatus" ref="302bcae6e1b779aec6b07c4891b9283f" args="(const struct stat *sbuf)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static struct <a class="el" href="structdlstatus.html">dlstatus</a> * lookupStatus           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const struct stat *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>sbuf</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00403">403</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="app__rpt_8c-source.html#l00288">debug</a>, <a class="el" href="dlfcn_8c-source.html#l00127">dlstatus::device</a>, <a class="el" href="dlfcn_8c-source.html#l00128">dlstatus::inode</a>, and <a class="el" href="dlfcn_8c-source.html#l00122">dlstatus::next</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00897">dlopen()</a>, and <a class="el" href="dlfcn_8c-source.html#l00685">loadModule()</a>.<div class="fragment"><pre class="fragment"><a name="l00404"></a>00404 {
<a name="l00405"></a>00405    <span class="keyword">struct </span><a class="code" href="structdlstatus.html">dlstatus</a> *dls = <a class="code" href="dlfcn_8c.html#263ae105fbf479a73d0cacf0db8538dd">stqueue</a>;
<a name="l00406"></a>00406    <a class="code" href="app__rpt_8c.html#ad42f6697b035b7580e4fef93be20b4d">debug</a>(<span class="stringliteral">"looking for status"</span>);
<a name="l00407"></a>00407    <span class="keywordflow">while</span> (dls &amp;&amp; ( <span class="comment">/* isFlagSet(dls-&gt;mode, RTLD_UNSHARED) */</span> 0
<a name="l00408"></a>00408                || sbuf-&gt;st_dev != dls-&gt;<a class="code" href="structdlstatus.html#913f9c49dcb544e2087cee284f4a00b7">device</a> || sbuf-&gt;st_ino != dls-&gt;<a class="code" href="structdlstatus.html#9103befcd86a4d5623156d9a3044d3eb">inode</a>))
<a name="l00409"></a>00409       dls = dls-&gt;<a class="code" href="structdlstatus.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>;
<a name="l00410"></a>00410    <span class="keywordflow">return</span> dls;
<a name="l00411"></a>00411 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="34ff4ec7602f0ad36f2c5c5429ded9d0"></a><!-- doxytag: member="dlfcn.c::my_find_image" ref="34ff4ec7602f0ad36f2c5c5429ded9d0" args="(const char *name)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static const struct mach_header * my_find_image           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>name</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00476">476</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="dlfcn_8c-source.html#l00080">dyld_NSAddImage</a>, <a class="el" href="dlfcn_8c-source.html#l00071">NSADDIMAGE_OPTION_RETURN_ON_ERROR</a>, and <a class="el" href="dlfcn_8c-source.html#l00068">NSADDIMAGE_OPTION_RETURN_ONLY_IF_LOADED</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00506">search_linked_libs()</a>.<div class="fragment"><pre class="fragment"><a name="l00477"></a>00477 {
<a name="l00478"></a>00478    <span class="keyword">const</span> <span class="keyword">struct </span>mach_header *mh = 0;
<a name="l00479"></a>00479    <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span> = NULL;
<a name="l00480"></a>00480    <span class="keywordtype">int</span> i = _dyld_image_count();
<a name="l00481"></a>00481    <span class="keywordtype">int</span> j;
<a name="l00482"></a>00482    mh = (<span class="keyword">struct </span>mach_header *)
<a name="l00483"></a>00483       <a class="code" href="dlfcn_8c.html#83168d8db5a85df2b3e7898c1230942f">dyld_NSAddImage</a>(<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>, <a class="code" href="dlfcn_8c.html#87a157769830554a61b43585b3f66e05">NSADDIMAGE_OPTION_RETURN_ONLY_IF_LOADED</a> |
<a name="l00484"></a>00484                   <a class="code" href="dlfcn_8c.html#8bef999e98f5b17a42537ade68c2db1d">NSADDIMAGE_OPTION_RETURN_ON_ERROR</a>);
<a name="l00485"></a>00485    <span class="keywordflow">if</span> (!mh)
<a name="l00486"></a>00486    {
<a name="l00487"></a>00487       <span class="keywordflow">for</span> (j = 0; j &lt; i; j++)
<a name="l00488"></a>00488       {
<a name="l00489"></a>00489          <span class="keywordtype">id</span> = _dyld_get_image_name(j);
<a name="l00490"></a>00490          <span class="keywordflow">if</span> (!strcmp(<span class="keywordtype">id</span>, <a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>))
<a name="l00491"></a>00491          {
<a name="l00492"></a>00492             mh = _dyld_get_image_header(j);
<a name="l00493"></a>00493             <span class="keywordflow">break</span>;
<a name="l00494"></a>00494          }
<a name="l00495"></a>00495       }
<a name="l00496"></a>00496    }
<a name="l00497"></a>00497    <span class="keywordflow">return</span> mh;
<a name="l00498"></a>00498 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="55fad2fd5c7e0789f8c4b9d5e7ff4ffc"></a><!-- doxytag: member="dlfcn.c::promoteLocalToGlobal" ref="55fad2fd5c7e0789f8c4b9d5e7ff4ffc" args="(struct dlstatus *dls)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int promoteLocalToGlobal           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structdlstatus.html">dlstatus</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>dls</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00442">442</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="app__rpt_8c-source.html#l00288">debug</a>, <a class="el" href="dlfcn_8c-source.html#l00099">MAGIC_DYLIB_MOD</a>, and <a class="el" href="dlfcn_8c-source.html#l00123">dlstatus::module</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00451">reference()</a>.<div class="fragment"><pre class="fragment"><a name="l00443"></a>00443 {
<a name="l00444"></a>00444    <span class="keyword">static</span> int (*p) (NSModule module) = 0;
<a name="l00445"></a>00445    <a class="code" href="app__rpt_8c.html#ad42f6697b035b7580e4fef93be20b4d">debug</a>(<span class="stringliteral">"promoting"</span>);
<a name="l00446"></a>00446    <span class="keywordflow">if</span> (!p)
<a name="l00447"></a>00447       _dyld_func_lookup(<span class="stringliteral">"__dyld_NSMakePrivateModulePublic"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *)&amp;p);
<a name="l00448"></a>00448    <span class="keywordflow">return</span> (dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a> == <a class="code" href="dlfcn_8c.html#7a6b0bdbbd9df80fd3f1044b33625543">MAGIC_DYLIB_MOD</a>) || (p &amp;&amp; p(dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a>));
<a name="l00449"></a>00449 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="f9549c9322f3ac5e9f28e0bb7552f8a1"></a><!-- doxytag: member="dlfcn.c::reference" ref="f9549c9322f3ac5e9f28e0bb7552f8a1" args="(struct dlstatus *dls, int mode)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void * reference           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structdlstatus.html">dlstatus</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>dls</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00451">451</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="app__rpt_8c-source.html#l00288">debug</a>, <a class="el" href="dlfcn_8c-source.html#l00196">error()</a>, <a class="el" href="dlfcn_8c-source.html#l00398">isFlagSet()</a>, <a class="el" href="dlfcn_8c-source.html#l00099">MAGIC_DYLIB_MOD</a>, <a class="el" href="dlfcn_8c-source.html#l00442">promoteLocalToGlobal()</a>, <a class="el" href="dlfcn-compat_8h-source.html#l00074">RTLD_GLOBAL</a>, and <a class="el" href="dlfcn_8c-source.html#l00211">warning()</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00897">dlopen()</a>, <a class="el" href="chan__skinny_8c-source.html#l03920">handle_soft_key_event_message()</a>, and <a class="el" href="dlfcn_8c-source.html#l00685">loadModule()</a>.<div class="fragment"><pre class="fragment"><a name="l00452"></a>00452 {
<a name="l00453"></a>00453    <span class="keywordflow">if</span> (dls)
<a name="l00454"></a>00454    {
<a name="l00455"></a>00455       <span class="keywordflow">if</span> (dls-&gt;module == <a class="code" href="dlfcn_8c.html#7a6b0bdbbd9df80fd3f1044b33625543">MAGIC_DYLIB_MOD</a> &amp;&amp; !<a class="code" href="dlfcn_8c.html#de1ac04ff9536258d5099cd4ed3f0b84">isFlagSet</a>(mode, <a class="code" href="dlfcn-compat_8h.html#d565d5d83850e65f4dc43e403df7a3db">RTLD_GLOBAL</a>))
<a name="l00456"></a>00456       {
<a name="l00457"></a>00457          <a class="code" href="dlfcn_8c.html#a0054ad56afd71085b56813f21a1544c">warning</a>(<span class="stringliteral">"trying to open a .dylib with RTLD_LOCAL"</span>);
<a name="l00458"></a>00458          <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"unable to open a .dylib with RTLD_LOCAL"</span>);
<a name="l00459"></a>00459          <span class="keywordflow">return</span> NULL;
<a name="l00460"></a>00460       }
<a name="l00461"></a>00461       <span class="keywordflow">if</span> (<a class="code" href="dlfcn_8c.html#de1ac04ff9536258d5099cd4ed3f0b84">isFlagSet</a>(mode, <a class="code" href="dlfcn-compat_8h.html#d565d5d83850e65f4dc43e403df7a3db">RTLD_GLOBAL</a>) &amp;&amp;
<a name="l00462"></a>00462          !<a class="code" href="dlfcn_8c.html#de1ac04ff9536258d5099cd4ed3f0b84">isFlagSet</a>(dls-&gt;mode, <a class="code" href="dlfcn-compat_8h.html#d565d5d83850e65f4dc43e403df7a3db">RTLD_GLOBAL</a>) &amp;&amp; !<a class="code" href="dlfcn_8c.html#55fad2fd5c7e0789f8c4b9d5e7ff4ffc">promoteLocalToGlobal</a>(dls))
<a name="l00463"></a>00463       {
<a name="l00464"></a>00464          <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"unable to promote local module to global"</span>);
<a name="l00465"></a>00465          <span class="keywordflow">return</span> NULL;
<a name="l00466"></a>00466       }
<a name="l00467"></a>00467       dls-&gt;mode |= mode;
<a name="l00468"></a>00468       dls-&gt;refs++;
<a name="l00469"></a>00469    }
<a name="l00470"></a>00470    <span class="keywordflow">else</span>
<a name="l00471"></a>00471       <a class="code" href="app__rpt_8c.html#ad42f6697b035b7580e4fef93be20b4d">debug</a>(<span class="stringliteral">"reference called with NULL argument"</span>);
<a name="l00472"></a>00472 
<a name="l00473"></a>00473    <span class="keywordflow">return</span> dls;
<a name="l00474"></a>00474 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="f79dfe72a8a68fc21a7a43fdebe8771e"></a><!-- doxytag: member="dlfcn.c::resetdlerror" ref="f79dfe72a8a68fc21a7a43fdebe8771e" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void resetdlerror           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00846">846</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="dlfcn_8c-source.html#l00113">dlthread::errset</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l01167">dladdr()</a>, <a class="el" href="dlfcn_8c-source.html#l01041">dlclose()</a>, <a class="el" href="dlfcn_8c-source.html#l00897">dlopen()</a>, and <a class="el" href="dlfcn_8c-source.html#l00560">dlsymIntern()</a>.<div class="fragment"><pre class="fragment"><a name="l00847"></a>00847 {
<a name="l00848"></a>00848    <span class="keyword">struct </span><a class="code" href="structdlthread.html">dlthread</a> *tss;
<a name="l00849"></a>00849    tss = pthread_getspecific(<a class="code" href="dlfcn_8c.html#446c9e2cac70c4a3977923451eea13da">dlerror_key</a>);
<a name="l00850"></a>00850    tss-&gt;<a class="code" href="structdlthread.html#1d0e9ad7d1908eaf205e819f3255f92c">errset</a> = 0;
<a name="l00851"></a>00851 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="9ca53afb0b5ad93c065fa8cd9608020e"></a><!-- doxytag: member="dlfcn.c::safegetenv" ref="9ca53afb0b5ad93c065fa8cd9608020e" args="(const char *s)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static const char * safegetenv           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>s</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00218">218</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00278">searchList()</a>.<div class="fragment"><pre class="fragment"><a name="l00219"></a>00219 {
<a name="l00220"></a>00220    <span class="keyword">const</span> <span class="keywordtype">char</span> *ss = getenv(<a class="code" href="aesopt_8h.html#8d6242bc80162ac99dd4d368eabe77cc">s</a>);
<a name="l00221"></a>00221    <span class="keywordflow">return</span> ss ? ss : <span class="stringliteral">""</span>;
<a name="l00222"></a>00222 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="998125cc2be835ee34124f5221bdafce"></a><!-- doxytag: member="dlfcn.c::search_linked_libs" ref="998125cc2be835ee34124f5221bdafce" args="(const struct mach_header *mh, const char *symbol)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">NSSymbol * search_linked_libs           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const struct mach_header *&nbsp;</td>
          <td class="mdname" nowrap> <em>mh</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>symbol</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00506">506</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="app__rpt_8c-source.html#l00288">debug</a>, <a class="el" href="dlfcn_8c-source.html#l00080">dyld_NSAddImage</a>, <a class="el" href="dlfcn_8c-source.html#l00081">dyld_NSIsSymbolNameDefinedInImage</a>, <a class="el" href="dlfcn_8c-source.html#l00083">dyld_NSLookupSymbolInImage</a>, <a class="el" href="dlfcn_8c-source.html#l00058">LC_LOAD_WEAK_DYLIB</a>, <a class="el" href="dlfcn_8c-source.html#l00476">my_find_image()</a>, <a class="el" href="dlfcn_8c-source.html#l00074">NSLOOKUPSYMBOLINIMAGE_OPTION_BIND</a>, and <a class="el" href="dlfcn_8c-source.html#l00077">NSLOOKUPSYMBOLINIMAGE_OPTION_RETURN_ON_ERROR</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00560">dlsymIntern()</a>.<div class="fragment"><pre class="fragment"><a name="l00507"></a>00507 {
<a name="l00508"></a>00508    <span class="keywordtype">int</span> n;
<a name="l00509"></a>00509    <span class="keyword">struct </span>load_command *lc = 0;
<a name="l00510"></a>00510    <span class="keyword">struct </span>mach_header *wh;
<a name="l00511"></a>00511    NSSymbol *nssym = 0;
<a name="l00512"></a>00512    <span class="keywordflow">if</span> (<a class="code" href="dlfcn_8c.html#83168d8db5a85df2b3e7898c1230942f">dyld_NSAddImage</a> &amp;&amp; <a class="code" href="dlfcn_8c.html#8efc76b493fa04cbcff731ebe67cb41f">dyld_NSIsSymbolNameDefinedInImage</a> &amp;&amp; <a class="code" href="dlfcn_8c.html#9fc4abd8c5aaaa341566cf1cac760b38">dyld_NSLookupSymbolInImage</a>)
<a name="l00513"></a>00513    {
<a name="l00514"></a>00514       lc = (<span class="keyword">struct </span>load_command *)((<span class="keywordtype">char</span> *)mh + <span class="keyword">sizeof</span>(<span class="keyword">struct</span> mach_header));
<a name="l00515"></a>00515       <span class="keywordflow">for</span> (n = 0; n &lt; mh-&gt;ncmds; n++, lc = (<span class="keyword">struct</span> load_command *)((<span class="keywordtype">char</span> *)lc + lc-&gt;cmdsize))
<a name="l00516"></a>00516       {
<a name="l00517"></a>00517          <span class="keywordflow">if</span> ((LC_LOAD_DYLIB == lc-&gt;cmd) || (<a class="code" href="dlfcn_8c.html#fa155e16fdd5262004d5e3f58b998545">LC_LOAD_WEAK_DYLIB</a> == lc-&gt;cmd))
<a name="l00518"></a>00518          {
<a name="l00519"></a>00519             <span class="keywordflow">if</span> ((wh = (<span class="keyword">struct</span> mach_header *)
<a name="l00520"></a>00520                 <a class="code" href="dlfcn_8c.html#34ff4ec7602f0ad36f2c5c5429ded9d0">my_find_image</a>((<span class="keywordtype">char</span> *)(((<span class="keyword">struct</span> dylib_command *)lc)-&gt;dylib.name.offset +
<a name="l00521"></a>00521                                  (<span class="keywordtype">char</span> *)lc))))
<a name="l00522"></a>00522             {
<a name="l00523"></a>00523                <span class="keywordflow">if</span> (<a class="code" href="dlfcn_8c.html#8efc76b493fa04cbcff731ebe67cb41f">dyld_NSIsSymbolNameDefinedInImage</a>(wh, symbol))
<a name="l00524"></a>00524                {
<a name="l00525"></a>00525                   nssym = <a class="code" href="dlfcn_8c.html#9fc4abd8c5aaaa341566cf1cac760b38">dyld_NSLookupSymbolInImage</a>(wh,
<a name="l00526"></a>00526                                              symbol,
<a name="l00527"></a>00527                                              <a class="code" href="dlfcn_8c.html#cc050e8021ee1d5275232968a4c8e381">NSLOOKUPSYMBOLINIMAGE_OPTION_BIND</a> |
<a name="l00528"></a>00528                                              <a class="code" href="dlfcn_8c.html#093a56fc66d422a12e681349f7fc31ee">NSLOOKUPSYMBOLINIMAGE_OPTION_RETURN_ON_ERROR</a>);
<a name="l00529"></a>00529                   <span class="keywordflow">break</span>;
<a name="l00530"></a>00530                }
<a name="l00531"></a>00531             }
<a name="l00532"></a>00532          }
<a name="l00533"></a>00533       }
<a name="l00534"></a>00534       <span class="keywordflow">if</span> ((!nssym) &amp;&amp; NSIsSymbolNameDefined(symbol))
<a name="l00535"></a>00535       {
<a name="l00536"></a>00536          <span class="comment">/* I've never seen this debug message...*/</span>
<a name="l00537"></a>00537          <a class="code" href="app__rpt_8c.html#ad42f6697b035b7580e4fef93be20b4d">debug</a>(<span class="stringliteral">"Symbol \"%s\" is defined but was not found"</span>, symbol);
<a name="l00538"></a>00538       }
<a name="l00539"></a>00539    }
<a name="l00540"></a>00540    <span class="keywordflow">return</span> nssym;
<a name="l00541"></a>00541 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="e3b786dcfbda95c5708dc4e648cb3fd8"></a><!-- doxytag: member="dlfcn.c::searchList" ref="e3b786dcfbda95c5708dc4e648cb3fd8" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static const char * searchList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00278">278</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="adsistub_8c-source.html#l00065">buf</a>, <a class="el" href="astmm_8h-source.html#l00066">malloc</a>, and <a class="el" href="dlfcn_8c-source.html#l00218">safegetenv()</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00824">dlcompat_cleanup()</a>, and <a class="el" href="dlfcn_8c-source.html#l00298">getSearchPath()</a>.<div class="fragment"><pre class="fragment"><a name="l00279"></a>00279 {
<a name="l00280"></a>00280    size_t buf_size;
<a name="l00281"></a>00281    <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>=NULL;
<a name="l00282"></a>00282    <span class="keyword">const</span> <span class="keywordtype">char</span> *ldlp = <a class="code" href="dlfcn_8c.html#9ca53afb0b5ad93c065fa8cd9608020e">safegetenv</a>(<span class="stringliteral">"LD_LIBRARY_PATH"</span>);
<a name="l00283"></a>00283    <span class="keyword">const</span> <span class="keywordtype">char</span> *dyldlp = <a class="code" href="dlfcn_8c.html#9ca53afb0b5ad93c065fa8cd9608020e">safegetenv</a>(<span class="stringliteral">"DYLD_LIBRARY_PATH"</span>);
<a name="l00284"></a>00284    <span class="keyword">const</span> <span class="keywordtype">char</span> *stdpath = getenv(<span class="stringliteral">"DYLD_FALLBACK_LIBRARY_PATH"</span>);
<a name="l00285"></a>00285    <span class="keywordflow">if</span> (!stdpath)
<a name="l00286"></a>00286       stdpath = <span class="stringliteral">"/usr/local/lib:/lib:/usr/lib"</span>;
<a name="l00287"></a>00287    <span class="keywordflow">if</span> (!buf)
<a name="l00288"></a>00288    {  
<a name="l00289"></a>00289       buf_size = strlen(ldlp) + strlen(dyldlp) + strlen(stdpath) + 4;
<a name="l00290"></a>00290       buf = <a class="code" href="astmm_8h.html#df74d22342f0da6246131193b1993a41">malloc</a>(buf_size);
<a name="l00291"></a>00291       snprintf(buf, buf_size, <span class="stringliteral">"%s%s%s%s%s%c"</span>, dyldlp, (dyldlp[0] ? <span class="stringliteral">":"</span> : <span class="stringliteral">""</span>), ldlp, (ldlp[0] ? <span class="stringliteral">":"</span> : <span class="stringliteral">""</span>),
<a name="l00292"></a>00292              stdpath, <span class="charliteral">'\0'</span>);
<a name="l00293"></a>00293    }
<a name="l00294"></a>00294    <span class="keywordflow">return</span> buf;
<a name="l00295"></a>00295 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a0054ad56afd71085b56813f21a1544c"></a><!-- doxytag: member="dlfcn.c::warning" ref="a0054ad56afd71085b56813f21a1544c" args="(const char *str)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void warning           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>str</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00211">211</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l01041">dlclose()</a>, <a class="el" href="dlfcn_8c-source.html#l00685">loadModule()</a>, and <a class="el" href="dlfcn_8c-source.html#l00451">reference()</a>.<div class="fragment"><pre class="fragment"><a name="l00212"></a>00212 {
<a name="l00213"></a>00213 <span class="preprocessor">#if DEBUG &gt; 0</span>
<a name="l00214"></a>00214 <span class="preprocessor"></span>   fprintf(stderr, <span class="stringliteral">"WARNING: dlcompat: %s\n"</span>, str);
<a name="l00215"></a>00215 <span class="preprocessor">#endif</span>
<a name="l00216"></a>00216 <span class="preprocessor"></span>}
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="35bc2d3415a9f63bc5686e02a0f03883"></a><!-- doxytag: member="dlfcn.c::dlcompat_mutex" ref="35bc2d3415a9f63bc5686e02a0f03883" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">pthread_mutex_t <a class="el" href="dlfcn_8c.html#35bc2d3415a9f63bc5686e02a0f03883">dlcompat_mutex</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00105">105</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="446c9e2cac70c4a3977923451eea13da"></a><!-- doxytag: member="dlfcn.c::dlerror_key" ref="446c9e2cac70c4a3977923451eea13da" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">pthread_key_t <a class="el" href="dlfcn_8c.html#446c9e2cac70c4a3977923451eea13da">dlerror_key</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00108">108</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="83168d8db5a85df2b3e7898c1230942f"></a><!-- doxytag: member="dlfcn.c::dyld_NSAddImage" ref="83168d8db5a85df2b3e7898c1230942f" args=")(const char *, unsigned long)=0" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const struct mach_header*(* <a class="el" href="dlfcn_8c.html#83168d8db5a85df2b3e7898c1230942f">dyld_NSAddImage</a>)(const char *, unsigned long)=0<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00080">80</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00801">dlcompat_init_func()</a>, <a class="el" href="dlfcn_8c-source.html#l00685">loadModule()</a>, <a class="el" href="dlfcn_8c-source.html#l00476">my_find_image()</a>, and <a class="el" href="dlfcn_8c-source.html#l00506">search_linked_libs()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="8efc76b493fa04cbcff731ebe67cb41f"></a><!-- doxytag: member="dlfcn.c::dyld_NSIsSymbolNameDefinedInImage" ref="8efc76b493fa04cbcff731ebe67cb41f" args=")(const struct mach_header *, const char *)=0" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int(* <a class="el" href="dlfcn_8c.html#8efc76b493fa04cbcff731ebe67cb41f">dyld_NSIsSymbolNameDefinedInImage</a>)(const struct mach_header *, const char *)=0<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00081">81</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00560">dlsymIntern()</a>, and <a class="el" href="dlfcn_8c-source.html#l00506">search_linked_libs()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="9fc4abd8c5aaaa341566cf1cac760b38"></a><!-- doxytag: member="dlfcn.c::dyld_NSLookupSymbolInImage" ref="9fc4abd8c5aaaa341566cf1cac760b38" args=")(const struct mach_header *, const char *, unsigned long)=0" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">NSSymbol(* <a class="el" href="dlfcn_8c.html#9fc4abd8c5aaaa341566cf1cac760b38">dyld_NSLookupSymbolInImage</a>)(const struct mach_header *, const char *, unsigned long)=0<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00083">83</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00560">dlsymIntern()</a>, and <a class="el" href="dlfcn_8c-source.html#l00506">search_linked_libs()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="86560ade58b777fa6f8f47ff729fee69"></a><!-- doxytag: member="dlfcn.c::mainStatus" ref="86560ade58b777fa6f8f47ff729fee69" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structdlstatus.html">dlstatus</a> <a class="el" href="dlfcn_8c.html#86560ade58b777fa6f8f47ff729fee69">mainStatus</a> = { 0, MAGIC_DYLIB_MOD, NULL, -1, RTLD_GLOBAL, 0, 0, 0 }<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00133">133</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="263ae105fbf479a73d0cacf0db8538dd"></a><!-- doxytag: member="dlfcn.c::stqueue" ref="263ae105fbf479a73d0cacf0db8538dd" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structdlstatus.html">dlstatus</a>* <a class="el" href="dlfcn_8c.html#263ae105fbf479a73d0cacf0db8538dd">stqueue</a> = &amp;<a class="el" href="dlfcn_8c.html#86560ade58b777fa6f8f47ff729fee69">mainStatus</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00134">134</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu May 24 22:27:26 2007 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.5 </small></address>
</body>
</html>
