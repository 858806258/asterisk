<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (24 May 2007)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Thu May 24 22:26:44 2007</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Finclude_2F.html">include</a></div>
<h1>jitterbuf.h</h1><a href="jitterbuf_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * jitterbuf: an application-independent jitterbuffer</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyrights:</span>
<a name="l00005"></a>00005 <span class="comment"> * Copyright (C) 2004-2005, Horizon Wimba, Inc.</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * Contributors:</span>
<a name="l00008"></a>00008 <span class="comment"> * Steve Kann &lt;stevek@stevek.com&gt;</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * This program is free software, distributed under the terms of</span>
<a name="l00011"></a>00011 <span class="comment"> * the GNU Lesser (Library) General Public License</span>
<a name="l00012"></a>00012 <span class="comment"> *</span>
<a name="l00013"></a>00013 <span class="comment"> * Copyright on this file is disclaimed to Digium for inclusion in Asterisk</span>
<a name="l00014"></a>00014 <span class="comment"> */</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="preprocessor">#ifndef _JITTERBUF_H_</span>
<a name="l00017"></a>00017 <span class="preprocessor"></span><span class="preprocessor">#define _JITTERBUF_H_</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span>
<a name="l00019"></a>00019 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
<a name="l00021"></a>00021 <span class="preprocessor">#endif</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span>
<a name="l00023"></a>00023 <span class="comment">/* configuration constants */</span>
<a name="l00024"></a>00024    <span class="comment">/* Number of historical timestamps to use in calculating jitter and drift */</span>
<a name="l00025"></a><a class="code" href="jitterbuf_8h.html#32579fc7a7f2e59f4fd08e3bfb208335">00025</a> <span class="preprocessor">#define JB_HISTORY_SZ      500   </span>
<a name="l00026"></a>00026 <span class="preprocessor"></span>   <span class="comment">/* what percentage of timestamps should we drop from the history when we examine it;</span>
<a name="l00027"></a>00027 <span class="comment">    * this might eventually be something made configurable */</span>
<a name="l00028"></a><a class="code" href="jitterbuf_8h.html#1b96aa25b2a4ab7491e19acbda3f6d56">00028</a> <span class="preprocessor">#define JB_HISTORY_DROPPCT 3</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span>   <span class="comment">/* the maximum droppct we can handle (say it was configurable). */</span>
<a name="l00030"></a><a class="code" href="jitterbuf_8h.html#f80888f93ea36a934323097eda5278e0">00030</a> <span class="preprocessor">#define JB_HISTORY_DROPPCT_MAX   4</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span>   <span class="comment">/* the size of the buffer we use to keep the top and botton timestamps for dropping */</span>
<a name="l00032"></a><a class="code" href="jitterbuf_8h.html#b3065d3ee899c97f43621e77cbee2e71">00032</a> <span class="preprocessor">#define JB_HISTORY_MAXBUF_SZ  JB_HISTORY_SZ * JB_HISTORY_DROPPCT_MAX / 100 </span>
<a name="l00033"></a>00033 <span class="preprocessor"></span>   <span class="comment">/* amount of additional jitterbuffer adjustment  */</span>
<a name="l00034"></a><a class="code" href="jitterbuf_8h.html#50964e0d9ad11cc7ae3f99d7715d49ec">00034</a> <span class="preprocessor">#define JB_TARGET_EXTRA 40</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span>   <span class="comment">/* ms between growing and shrinking; may not be honored if jitterbuffer runs out of space */</span>
<a name="l00036"></a><a class="code" href="jitterbuf_8h.html#4101aa44fa91c14af62fc4ba7675088a">00036</a> <span class="preprocessor">#define JB_ADJUST_DELAY 40</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span>
<a name="l00038"></a><a class="code" href="jitterbuf_8h.html#8213605ca06c98c3dd8bb2b834fb5518">00038</a> <span class="keyword">enum</span> <a class="code" href="jitterbuf_8h.html#8213605ca06c98c3dd8bb2b834fb5518">jb_return_code</a> {
<a name="l00039"></a>00039    <span class="comment">/* return codes */</span>
<a name="l00040"></a>00040    <a class="code" href="jitterbuf_8h.html#8213605ca06c98c3dd8bb2b834fb551827712cf5a0152fe8ead0017476296d58">JB_OK</a>,            <span class="comment">/* 0 */</span>
<a name="l00041"></a>00041    <a class="code" href="jitterbuf_8h.html#8213605ca06c98c3dd8bb2b834fb5518a00fb860c79a4e01c5174f56cff24e9a">JB_EMPTY</a>,         <span class="comment">/* 1 */</span>
<a name="l00042"></a>00042    <a class="code" href="jitterbuf_8h.html#8213605ca06c98c3dd8bb2b834fb551801c1ac379471c5f7c62009b7a2d032db">JB_NOFRAME</a>,       <span class="comment">/* 2 */</span>
<a name="l00043"></a>00043    <a class="code" href="jitterbuf_8h.html#8213605ca06c98c3dd8bb2b834fb5518f7955f9e95d05f185e2837903cf15655">JB_INTERP</a>,        <span class="comment">/* 3 */</span>
<a name="l00044"></a>00044    <a class="code" href="jitterbuf_8h.html#8213605ca06c98c3dd8bb2b834fb551800a8a8d71e91c2ae944c387508497141">JB_DROP</a>,          <span class="comment">/* 4 */</span>
<a name="l00045"></a>00045    <a class="code" href="jitterbuf_8h.html#8213605ca06c98c3dd8bb2b834fb5518462d22d95fea20d0092502a75adf418c">JB_SCHED</a>          <span class="comment">/* 5 */</span>
<a name="l00046"></a>00046 };
<a name="l00047"></a>00047 
<a name="l00048"></a><a class="code" href="jitterbuf_8h.html#c5605e62bb981e98a342b8f9fe7f1f23">00048</a> <span class="keyword">enum</span> <a class="code" href="jitterbuf_8h.html#c5605e62bb981e98a342b8f9fe7f1f23">jb_frame_type</a> {
<a name="l00049"></a>00049    <span class="comment">/* frame types */</span>
<a name="l00050"></a>00050    <a class="code" href="jitterbuf_8h.html#c5605e62bb981e98a342b8f9fe7f1f2395e353ac90393540b321f815c6c4c473">JB_TYPE_CONTROL</a>,  <span class="comment">/* 0            */</span>
<a name="l00051"></a>00051    <a class="code" href="jitterbuf_8h.html#c5605e62bb981e98a342b8f9fe7f1f23fba690e11a4437569af666ce76f03d9e">JB_TYPE_VOICE</a>,    <span class="comment">/* 1            */</span>
<a name="l00052"></a>00052    <a class="code" href="jitterbuf_8h.html#c5605e62bb981e98a342b8f9fe7f1f23963a37d179023a918b828aff9750b52e">JB_TYPE_VIDEO</a>,    <span class="comment">/* 2 - reserved */</span>
<a name="l00053"></a>00053    <a class="code" href="jitterbuf_8h.html#c5605e62bb981e98a342b8f9fe7f1f234ff9d1c5b7582cac287b665d9178591d">JB_TYPE_SILENCE</a>   <span class="comment">/* 3            */</span>
<a name="l00054"></a>00054 };
<a name="l00055"></a>00055 
<a name="l00056"></a><a class="code" href="structjb__conf.html">00056</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structjb__conf.html">jb_conf</a> {
<a name="l00057"></a>00057    <span class="comment">/* settings */</span>
<a name="l00058"></a><a class="code" href="structjb__conf.html#2900c3dcf33f27aab1a7dedd7e6880a0">00058</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__conf.html#2900c3dcf33f27aab1a7dedd7e6880a0">max_jitterbuf</a>;  <span class="comment">/* defines a hard clamp to use in setting the jitter buffer delay */</span>
<a name="l00059"></a><a class="code" href="structjb__conf.html#d97eebcde281eba2855bbe1308ef0944">00059</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__conf.html#d97eebcde281eba2855bbe1308ef0944">resync_threshold</a>;  <span class="comment">/* the jb will resync when delay increases to (2 * jitter) + this param */</span>
<a name="l00060"></a><a class="code" href="structjb__conf.html#0f7ad522ab5d92ca98aadc2965b1ee47">00060</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__conf.html#0f7ad522ab5d92ca98aadc2965b1ee47">max_contig_interp</a>; <span class="comment">/* the max interp frames to return in a row */</span>
<a name="l00061"></a><a class="code" href="structjb__conf.html#716dae26bc454cd685ee806387f30489">00061</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__conf.html#716dae26bc454cd685ee806387f30489">target_extra</a> ;      <span class="comment">/* amount of additional jitterbuffer adjustment, overrides JB_TARGET_EXTRA */</span>
<a name="l00062"></a>00062 } <a class="code" href="structjb__conf.html">jb_conf</a>;
<a name="l00063"></a>00063 
<a name="l00064"></a><a class="code" href="structjb__info.html">00064</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structjb__info.html">jb_info</a> {
<a name="l00065"></a><a class="code" href="structjb__info.html#3a8e4c06e471595f6eb262bb9b5582d9">00065</a>    <a class="code" href="structjb__conf.html">jb_conf</a> <a class="code" href="structjb__info.html#3a8e4c06e471595f6eb262bb9b5582d9">conf</a>;
<a name="l00066"></a>00066 
<a name="l00067"></a>00067    <span class="comment">/* statistics */</span>
<a name="l00068"></a><a class="code" href="structjb__info.html#e53de58e8b061bf4d0af964693a2a34d">00068</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#e53de58e8b061bf4d0af964693a2a34d">frames_in</a>;   <span class="comment">/* number of frames input to the jitterbuffer.*/</span>
<a name="l00069"></a><a class="code" href="structjb__info.html#7d0ab5de6af6e2265418aa1108874e25">00069</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#7d0ab5de6af6e2265418aa1108874e25">frames_out</a>;     <span class="comment">/* number of frames output from the jitterbuffer.*/</span>
<a name="l00070"></a><a class="code" href="structjb__info.html#e30b7620c833088475cbbc2e8637ef68">00070</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#e30b7620c833088475cbbc2e8637ef68">frames_late</a>;    <span class="comment">/* number of frames which were too late, and dropped.*/</span>
<a name="l00071"></a><a class="code" href="structjb__info.html#f230bd6d73cc5e9616ee7c9bef635073">00071</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#f230bd6d73cc5e9616ee7c9bef635073">frames_lost</a>;    <span class="comment">/* number of missing frames.*/</span>
<a name="l00072"></a><a class="code" href="structjb__info.html#4a0ac9f977eb911d03ff25d7d776f273">00072</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#4a0ac9f977eb911d03ff25d7d776f273">frames_dropped</a>;    <span class="comment">/* number of frames dropped (shrinkage) */</span>
<a name="l00073"></a><a class="code" href="structjb__info.html#28943abc857c34dc0d558386cf6ab909">00073</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#28943abc857c34dc0d558386cf6ab909">frames_ooo</a>;  <span class="comment">/* number of frames received out-of-order */</span>
<a name="l00074"></a><a class="code" href="structjb__info.html#e798668360d4a72f2a1324dee449383c">00074</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#e798668360d4a72f2a1324dee449383c">frames_cur</a>;  <span class="comment">/* number of frames presently in jb, awaiting delivery.*/</span>
<a name="l00075"></a><a class="code" href="structjb__info.html#b51d93138978e7c4b09d03b83a4df1de">00075</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#b51d93138978e7c4b09d03b83a4df1de">jitter</a>;      <span class="comment">/* jitter measured within current history interval*/</span>
<a name="l00076"></a><a class="code" href="structjb__info.html#d8bd79cc131920d5de426f914d17405a">00076</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#d8bd79cc131920d5de426f914d17405a">min</a>;      <span class="comment">/* minimum lateness within current history interval */</span>
<a name="l00077"></a><a class="code" href="structjb__info.html#43b5c9175984c071f30b873fdce0a000">00077</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#43b5c9175984c071f30b873fdce0a000">current</a>;     <span class="comment">/* the present jitterbuffer adjustment */</span>
<a name="l00078"></a><a class="code" href="structjb__info.html#42aefbae01d2dfd981f7da7d823d689e">00078</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#42aefbae01d2dfd981f7da7d823d689e">target</a>;      <span class="comment">/* the target jitterbuffer adjustment */</span>
<a name="l00079"></a><a class="code" href="structjb__info.html#34573206cf8bf4378c202fd1025aea56">00079</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#34573206cf8bf4378c202fd1025aea56">losspct</a>;     <span class="comment">/* recent lost frame percentage (* 1000) */</span>
<a name="l00080"></a><a class="code" href="structjb__info.html#da8a6e6cb528f0cc066a4372983036be">00080</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#da8a6e6cb528f0cc066a4372983036be">next_voice_ts</a>;  <span class="comment">/* the ts of the next frame to be read from the jb - in receiver's time */</span>
<a name="l00081"></a><a class="code" href="structjb__info.html#aa94a13e415e2513bfbc72e4e5b7a31c">00081</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#aa94a13e415e2513bfbc72e4e5b7a31c">last_voice_ms</a>;  <span class="comment">/* the duration of the last voice frame */</span>
<a name="l00082"></a><a class="code" href="structjb__info.html#db9afe3ebe75e3f33c4e8ec92a7827a5">00082</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#db9afe3ebe75e3f33c4e8ec92a7827a5">silence_begin_ts</a>;  <span class="comment">/* the time of the last CNG frame, when in silence */</span>
<a name="l00083"></a><a class="code" href="structjb__info.html#a1f9376923e9b7b107bbdab7d54d23bd">00083</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#a1f9376923e9b7b107bbdab7d54d23bd">last_adjustment</a>;   <span class="comment">/* the time of the last adjustment */</span>
<a name="l00084"></a><a class="code" href="structjb__info.html#34e0bba4cff2984a13a1bf9e8ecd3afe">00084</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#34e0bba4cff2984a13a1bf9e8ecd3afe">last_delay</a>;        <span class="comment">/* the last now added to history */</span>
<a name="l00085"></a><a class="code" href="structjb__info.html#4e292b2b6d6ca9342e09aa3d84182110">00085</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#4e292b2b6d6ca9342e09aa3d84182110">cnt_delay_discont</a>; <span class="comment">/* the count of discontinuous delays */</span>
<a name="l00086"></a><a class="code" href="structjb__info.html#82c723c00b7d120ce58024e96ea11fcc">00086</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#82c723c00b7d120ce58024e96ea11fcc">resync_offset</a>;     <span class="comment">/* the amount to offset ts to support resyncs */</span>
<a name="l00087"></a><a class="code" href="structjb__info.html#893e085a6d23d54fdd3e637f6758f044">00087</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#893e085a6d23d54fdd3e637f6758f044">cnt_contig_interp</a>; <span class="comment">/* the number of contiguous interp frames returned */</span>
<a name="l00088"></a>00088 } <a class="code" href="structjb__info.html">jb_info</a>;
<a name="l00089"></a>00089 
<a name="l00090"></a><a class="code" href="structjb__frame.html">00090</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structjb__frame.html">jb_frame</a> {
<a name="l00091"></a><a class="code" href="structjb__frame.html#8d777f385d3dfec8815d20f7496026dc">00091</a>    <span class="keywordtype">void</span> *<a class="code" href="structjb__frame.html#8d777f385d3dfec8815d20f7496026dc">data</a>;               <span class="comment">/* the frame data */</span>
<a name="l00092"></a><a class="code" href="structjb__frame.html#4d682ec4eed27c53849758bc13b6e179">00092</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__frame.html#4d682ec4eed27c53849758bc13b6e179">ts</a>;                  <span class="comment">/* the relative delivery time expected */</span>
<a name="l00093"></a><a class="code" href="structjb__frame.html#ee33e909372d935d190f4fcb2a92d542">00093</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__frame.html#ee33e909372d935d190f4fcb2a92d542">ms</a>;                  <span class="comment">/* the time covered by this frame, in sec/8000 */</span>
<a name="l00094"></a><a class="code" href="structjb__frame.html#599dcce2998a6b40b1e38e8c6006cb0a">00094</a>    <span class="keyword">enum</span> <a class="code" href="jitterbuf_8h.html#c5605e62bb981e98a342b8f9fe7f1f23">jb_frame_type</a> <a class="code" href="structjb__frame.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>;  <span class="comment">/* the type of frame */</span>
<a name="l00095"></a><a class="code" href="structjb__frame.html#fcb08b164ac83e09964deb24f2d2e80b">00095</a>    <span class="keyword">struct </span><a class="code" href="structjb__frame.html">jb_frame</a> *<a class="code" href="structjb__frame.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>, *<a class="code" href="structjb__frame.html#fcb08b164ac83e09964deb24f2d2e80b">prev</a>;
<a name="l00096"></a>00096 } <a class="code" href="structjb__frame.html">jb_frame</a>;
<a name="l00097"></a>00097 
<a name="l00098"></a><a class="code" href="structjitterbuf.html">00098</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structjitterbuf.html">jitterbuf</a> {
<a name="l00099"></a><a class="code" href="structjitterbuf.html#caf9b6b99962bf5c2264824231d7a40c">00099</a>    <a class="code" href="structjb__info.html">jb_info</a> <a class="code" href="structjitterbuf.html#caf9b6b99962bf5c2264824231d7a40c">info</a>;
<a name="l00100"></a>00100 
<a name="l00101"></a>00101    <span class="comment">/* history */</span>
<a name="l00102"></a><a class="code" href="structjitterbuf.html#dd7a44f7df9819a4d65ccbf0096727ea">00102</a>    <span class="keywordtype">long</span> <a class="code" href="structjitterbuf.html#dd7a44f7df9819a4d65ccbf0096727ea">history</a>[<a class="code" href="jitterbuf_8h.html#32579fc7a7f2e59f4fd08e3bfb208335">JB_HISTORY_SZ</a>];        <span class="comment">/* history */</span>
<a name="l00103"></a><a class="code" href="structjitterbuf.html#1009267c4ef72e2aba90f881e90c13e1">00103</a>    <span class="keywordtype">int</span>  <a class="code" href="structjitterbuf.html#1009267c4ef72e2aba90f881e90c13e1">hist_ptr</a>;          <span class="comment">/* points to index in history for next entry */</span>
<a name="l00104"></a><a class="code" href="structjitterbuf.html#fe16f256afc7962a00a0125cbcb5fe66">00104</a>    <span class="keywordtype">long</span> <a class="code" href="structjitterbuf.html#fe16f256afc7962a00a0125cbcb5fe66">hist_maxbuf</a>[<a class="code" href="jitterbuf_8h.html#b3065d3ee899c97f43621e77cbee2e71">JB_HISTORY_MAXBUF_SZ</a>];   <span class="comment">/* a sorted buffer of the max delays (highest first) */</span>
<a name="l00105"></a><a class="code" href="structjitterbuf.html#c21ed31cf12cdbb4069e04f931bb47ba">00105</a>    <span class="keywordtype">long</span> <a class="code" href="structjitterbuf.html#c21ed31cf12cdbb4069e04f931bb47ba">hist_minbuf</a>[<a class="code" href="jitterbuf_8h.html#b3065d3ee899c97f43621e77cbee2e71">JB_HISTORY_MAXBUF_SZ</a>];   <span class="comment">/* a sorted buffer of the min delays (lowest first) */</span>
<a name="l00106"></a><a class="code" href="structjitterbuf.html#ef12e16cf0bbedb6769d29463149c858">00106</a>    <span class="keywordtype">int</span>  <a class="code" href="structjitterbuf.html#ef12e16cf0bbedb6769d29463149c858">hist_maxbuf_valid</a>;       <span class="comment">/* are the "maxbuf"/minbuf valid? */</span>
<a name="l00107"></a><a class="code" href="structjitterbuf.html#63c1ef18d044de3fb86f920103fe37a1">00107</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structjitterbuf.html#63c1ef18d044de3fb86f920103fe37a1">dropem</a>:1;                  <span class="comment">/* flag to indicate dropping frames (overload) */</span>
<a name="l00108"></a>00108 
<a name="l00109"></a><a class="code" href="structjitterbuf.html#dcdc1ac079a91d513a5a759b0fb9c1dc">00109</a>    <a class="code" href="structjb__frame.html">jb_frame</a> *<a class="code" href="structjitterbuf.html#dcdc1ac079a91d513a5a759b0fb9c1dc">frames</a>;       <span class="comment">/* queued frames */</span>
<a name="l00110"></a><a class="code" href="structjitterbuf.html#aa2d6e4f578eb0cfaba23beef76c2194">00110</a>    <a class="code" href="structjb__frame.html">jb_frame</a> *<a class="code" href="structjitterbuf.html#aa2d6e4f578eb0cfaba23beef76c2194">free</a>;      <span class="comment">/* free frames (avoid malloc?) */</span>
<a name="l00111"></a>00111 } <a class="code" href="structjitterbuf.html">jitterbuf</a>;
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 <span class="comment">/* new jitterbuf */</span>
<a name="l00115"></a>00115 <a class="code" href="structjitterbuf.html">jitterbuf</a> *    <a class="code" href="jitterbuf_8c.html#442330556f64870f68ff52541c306a2f">jb_new</a>(<span class="keywordtype">void</span>);
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 <span class="comment">/* destroy jitterbuf */</span>
<a name="l00118"></a>00118 <span class="keywordtype">void</span>        <a class="code" href="jitterbuf_8c.html#e06a29c5463655025c826a363bb92ec8">jb_destroy</a>(<a class="code" href="structjitterbuf.html">jitterbuf</a> *jb);
<a name="l00119"></a>00119 
<a name="l00120"></a>00120 <span class="comment">/* reset jitterbuf */</span>
<a name="l00121"></a>00121 <span class="comment">/* NOTE:  The jitterbuffer should be empty before you call this, otherwise</span>
<a name="l00122"></a>00122 <span class="comment"> * you will leak queued frames, and some internal structures */</span>
<a name="l00123"></a>00123 <span class="keywordtype">void</span>        <a class="code" href="jitterbuf_8c.html#778d562bc6407ff0d62b78766d55c801">jb_reset</a>(<a class="code" href="structjitterbuf.html">jitterbuf</a> *jb);
<a name="l00124"></a>00124 
<a name="l00125"></a>00125 <span class="comment">/* queue a frame data=frame data, timings (in ms): ms=length of frame (for voice), ts=ts (sender's time) </span>
<a name="l00126"></a>00126 <span class="comment"> * now=now (in receiver's time) return value is one of </span>
<a name="l00127"></a>00127 <span class="comment"> * JB_OK: Frame added. Last call to jb_next() still valid</span>
<a name="l00128"></a>00128 <span class="comment"> * JB_DROP: Drop this frame immediately</span>
<a name="l00129"></a>00129 <span class="comment"> * JB_SCHED: Frame added. Call jb_next() to get a new time for the next frame</span>
<a name="l00130"></a>00130 <span class="comment"> */</span>
<a name="l00131"></a>00131 <span class="keyword">enum</span> <a class="code" href="jitterbuf_8h.html#8213605ca06c98c3dd8bb2b834fb5518">jb_return_code</a> <a class="code" href="jitterbuf_8c.html#218b07dc639e9850a05a81d8d334f07a">jb_put</a>(<a class="code" href="structjitterbuf.html">jitterbuf</a> *jb, <span class="keywordtype">void</span> *data, <span class="keyword">const</span> <span class="keyword">enum</span> <a class="code" href="jitterbuf_8h.html#c5605e62bb981e98a342b8f9fe7f1f23">jb_frame_type</a> <a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>, <span class="keywordtype">long</span> ms, <span class="keywordtype">long</span> ts, <span class="keywordtype">long</span> now);
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 <span class="comment">/* get a frame for time now (receiver's time)  return value is one of</span>
<a name="l00134"></a>00134 <span class="comment"> * JB_OK:  You've got frame!</span>
<a name="l00135"></a>00135 <span class="comment"> * JB_DROP: Here's an audio frame you should just drop.  Ask me again for this time..</span>
<a name="l00136"></a>00136 <span class="comment"> * JB_NOFRAME: There's no frame scheduled for this time.</span>
<a name="l00137"></a>00137 <span class="comment"> * JB_INTERP: Please interpolate an interpl-length frame for this time (either we need to grow, or there was a lost frame) </span>
<a name="l00138"></a>00138 <span class="comment"> * JB_EMPTY: The jb is empty.</span>
<a name="l00139"></a>00139 <span class="comment"> */</span>
<a name="l00140"></a>00140 <span class="keyword">enum</span> <a class="code" href="jitterbuf_8h.html#8213605ca06c98c3dd8bb2b834fb5518">jb_return_code</a> <a class="code" href="jitterbuf_8c.html#8b0b4e5e0294978ea073142efe6b02e8">jb_get</a>(<a class="code" href="structjitterbuf.html">jitterbuf</a> *jb, <a class="code" href="structjb__frame.html">jb_frame</a> *frame, <span class="keywordtype">long</span> now, <span class="keywordtype">long</span> interpl);
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 <span class="comment">/* unconditionally get frames from jitterbuf until empty */</span>
<a name="l00143"></a>00143 <span class="keyword">enum</span> <a class="code" href="jitterbuf_8h.html#8213605ca06c98c3dd8bb2b834fb5518">jb_return_code</a> <a class="code" href="jitterbuf_8c.html#b9a275a51047f5bff6a4887c4c89cae3">jb_getall</a>(<a class="code" href="structjitterbuf.html">jitterbuf</a> *jb, <a class="code" href="structjb__frame.html">jb_frame</a> *frameout);
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 <span class="comment">/* when is the next frame due out, in receiver's time (0=EMPTY) </span>
<a name="l00146"></a>00146 <span class="comment"> * This value may change as frames are added (esp non-audio frames) */</span>
<a name="l00147"></a>00147 <span class="keywordtype">long</span>        <a class="code" href="jitterbuf_8c.html#af5594d9cfe17c618ad8bb155b6d129b">jb_next</a>(<a class="code" href="structjitterbuf.html">jitterbuf</a> *jb);
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 <span class="comment">/* get jitterbuf info: only "statistics" may be valid */</span>
<a name="l00150"></a>00150 <span class="keyword">enum</span> <a class="code" href="jitterbuf_8h.html#8213605ca06c98c3dd8bb2b834fb5518">jb_return_code</a> <a class="code" href="jitterbuf_8c.html#9fe864d53499a53e770c4fffb5d126bc">jb_getinfo</a>(<a class="code" href="structjitterbuf.html">jitterbuf</a> *jb, <a class="code" href="structjb__info.html">jb_info</a> *stats);
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 <span class="comment">/* set jitterbuf conf */</span>
<a name="l00153"></a>00153 <span class="keyword">enum</span> <a class="code" href="jitterbuf_8h.html#8213605ca06c98c3dd8bb2b834fb5518">jb_return_code</a> <a class="code" href="jitterbuf_8c.html#3b89e4b511067f91c9198c34e45e2ab4">jb_setconf</a>(<a class="code" href="structjitterbuf.html">jitterbuf</a> *jb, <a class="code" href="structjb__conf.html">jb_conf</a> *conf);
<a name="l00154"></a>00154 
<a name="l00155"></a><a class="code" href="jitterbuf_8h.html#2150de1cc3db6db97212911fce0e7a64">00155</a> <span class="keyword">typedef</span>     void (*<a class="code" href="jitterbuf_8h.html#2150de1cc3db6db97212911fce0e7a64">jb_output_function_t</a>)(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="manager_8h.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>, ...);
<a name="l00156"></a>00156 <span class="keywordtype">void</span>        <a class="code" href="jitterbuf_8c.html#1de484cce44942102e966e5fc1738fd7">jb_setoutput</a>(<a class="code" href="jitterbuf_8h.html#2150de1cc3db6db97212911fce0e7a64">jb_output_function_t</a> err, <a class="code" href="jitterbuf_8h.html#2150de1cc3db6db97212911fce0e7a64">jb_output_function_t</a> warn, <a class="code" href="jitterbuf_8h.html#2150de1cc3db6db97212911fce0e7a64">jb_output_function_t</a> dbg);
<a name="l00157"></a>00157 
<a name="l00158"></a>00158 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00159"></a>00159 <span class="preprocessor"></span>}
<a name="l00160"></a>00160 <span class="preprocessor">#endif</span>
<a name="l00161"></a>00161 <span class="preprocessor"></span>
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu May 24 22:26:44 2007 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.5 </small></address>
</body>
</html>
