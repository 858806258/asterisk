<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (24 May 2007)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Thu May 24 22:27:04 2007</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Fmain_2F.html">main</a></div>
<h1>callerid.c File Reference</h1>CallerID Generation support. <a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="asterisk_8h-source.html">asterisk.h</a>&quot;</code><br>
<code>#include &lt;<a class="el" href="time_8h-source.html">time.h</a>&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;unistd.h&gt;</code><br>
<code>#include &lt;math.h&gt;</code><br>
<code>#include &lt;ctype.h&gt;</code><br>
<code>#include &quot;<a class="el" href="ulaw_8h-source.html">asterisk/ulaw.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="alaw_8h-source.html">asterisk/alaw.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="frame_8h-source.html">asterisk/frame.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="channel_8h-source.html">asterisk/channel.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="callerid_8h-source.html">asterisk/callerid.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="logger_8h-source.html">asterisk/logger.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="fskmodem_8h-source.html">asterisk/fskmodem.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="options_8h-source.html">asterisk/options.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="utils_8h-source.html">asterisk/utils.h</a>&quot;</code><br>

<p>
<a href="callerid_8c-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcallerid__state.html">callerid_state</a></td></tr>

<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#f2c732a05bb7e99bab241f65a594ce0f">AST_CALLERID_UNKNOWN</a>&nbsp;&nbsp;&nbsp;&quot;&lt;unknown&gt;&quot;</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#28110f8586b749713342da2cecdfab2f">CALLERID_MARK</a>&nbsp;&nbsp;&nbsp;1200.0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a3410c6ef512349e1f355f42a05d9b65">CALLERID_SPACE</a>&nbsp;&nbsp;&nbsp;2200.0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#810f37cd8d8644dc2f616181be35221d">CAS_FREQ1</a>&nbsp;&nbsp;&nbsp;2130.0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#b2508dc98ce6a08cb60f1be240c24201">CAS_FREQ2</a>&nbsp;&nbsp;&nbsp;2750.0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#003c316eedf90b55997bed8de2f592d1">SAS_FREQ</a>&nbsp;&nbsp;&nbsp;440.0</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#01d752ae6cdb9111ef1812f4569ae65d">__ast_callerid_generate</a> (unsigned char *<a class="el" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>, const char *<a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>, const char *<a class="el" href="structnumber.html">number</a>, int <a class="el" href="chan__skinny_8c.html#9127a4950ee5e071d3683ff9d7ba9148">callwaiting</a>, int codec)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#d94c53b12507014d3f904208a9ec62ea">ast_callerid_callwaiting_generate</a> (unsigned char *<a class="el" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>, const char *<a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>, const char *<a class="el" href="structnumber.html">number</a>, int codec)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Generate Caller-ID spill but in a format suitable for Call Waiting(tm)'s Caller*ID(tm) See <a class="el" href="callerid_8c.html#608b6d55cc8f38675e758e94ca585bdc">ast_callerid_generate()</a> for other details.  <a href="#d94c53b12507014d3f904208a9ec62ea"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#608b6d55cc8f38675e758e94ca585bdc">ast_callerid_generate</a> (unsigned char *<a class="el" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>, const char *<a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>, const char *<a class="el" href="structnumber.html">number</a>, int codec)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Generate Caller-ID spill from the "callerid" field of asterisk (in e-mail address like format).  <a href="#608b6d55cc8f38675e758e94ca585bdc"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#9e1786c316d57a4fa234e0e0f8b115dd">ast_callerid_merge</a> (char *<a class="el" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>, int bufsiz, const char *<a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>, const char *<a class="el" href="adsistub_8c.html#0fc3cfbc27e91ea60a787de13dae3e3c">num</a>, const char *unknown)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#914d0eb3b42ed9d3547306d24d2e67a0">ast_callerid_parse</a> (char *instr, char **<a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>, char **location)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Destructively parse inbuf into name and location (or number) Parses callerid stream from inbuf and changes into useable form, outputed in name and location.  <a href="#914d0eb3b42ed9d3547306d24d2e67a0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#48f42015459db6f4f29d079bda4a6034">ast_callerid_split</a> (const char *<a class="el" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>, char *<a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>, int namelen, char *<a class="el" href="adsistub_8c.html#0fc3cfbc27e91ea60a787de13dae3e3c">num</a>, int numlen)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#b5dfc57cf569e2ba434a743b1d53af4f">ast_describe_caller_presentation</a> (int data)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert caller ID pres value to explanatory string.  <a href="#b5dfc57cf569e2ba434a743b1d53af4f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#650489920c146454c38d0fc56d5e2771">ast_gen_cas</a> (unsigned char *outbuf, int sendsas, int len, int codec)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#bc66e4db3a33f1d6808d92ab9677dace">ast_is_shrinkable_phonenumber</a> (const char *<a class="el" href="chan__alsa_8c.html#5aedfeaeaac21e5e5f297360633ea9a3">exten</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check if a string consists only of digits and and + # ( ) - . (meaning it can be cleaned with ast_shrink_phone_number).  <a href="#bc66e4db3a33f1d6808d92ab9677dace"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#c29073ea46cb584ba6736955293a694f">ast_is_valid_string</a> (const char *<a class="el" href="chan__alsa_8c.html#5aedfeaeaac21e5e5f297360633ea9a3">exten</a>, const char *valid)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks if phone number consists of valid characters.  <a href="#c29073ea46cb584ba6736955293a694f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#9a4bff80dfc1e99d6c0edc9a808b1495">ast_isphonenumber</a> (const char *n)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check if a string consists only of digits and + #.  <a href="#9a4bff80dfc1e99d6c0edc9a808b1495"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#f7d5a5df502a243ff7c0829b69b4a7a3">ast_named_caller_presentation</a> (int data)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert caller ID pres value to text code.  <a href="#f7d5a5df502a243ff7c0829b69b4a7a3"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#760c5dbb16d6c44dca8aaba3e5611165">ast_parse_caller_presentation</a> (const char *data)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert caller ID text code to value used in config file parsing.  <a href="#760c5dbb16d6c44dca8aaba3e5611165"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#472e6c01db8037ff1904969285f4e91c">ast_shrink_phone_number</a> (char *n)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Shrink a phone number in place to just digits (more accurately it just removes ()'s, .'s, and -'s...  <a href="#472e6c01db8037ff1904969285f4e91c"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static unsigned short&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#bbc2bac160508ff33fe80e066bcca0ee">calc_crc</a> (unsigned short crc, unsigned char data)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#ddba256565333385f123e551ea5ba516">callerid_feed</a> (struct <a class="el" href="structcallerid__state.html">callerid_state</a> *cid, unsigned char *ubuf, int len, int codec)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read samples into the state machine.  <a href="#ddba256565333385f123e551ea5ba516"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#33b24654dc443ae070e4c5598a01e47b">callerid_feed_jp</a> (struct <a class="el" href="structcallerid__state.html">callerid_state</a> *cid, unsigned char *ubuf, int len, int codec)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read samples into the state machine.  <a href="#33b24654dc443ae070e4c5598a01e47b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#deb8687df148e1a6dfbe0bec57093781">callerid_free</a> (struct <a class="el" href="structcallerid__state.html">callerid_state</a> *cid)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free a callerID state.  <a href="#deb8687df148e1a6dfbe0bec57093781"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#1d65bfd593c05fbc8a022082e8ec4129">callerid_generate</a> (unsigned char *<a class="el" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>, const char *<a class="el" href="structnumber.html">number</a>, const char *<a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>, int flags, int <a class="el" href="chan__skinny_8c.html#9127a4950ee5e071d3683ff9d7ba9148">callwaiting</a>, int codec)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Generates a CallerID FSK stream in ulaw format suitable for transmission.  <a href="#1d65bfd593c05fbc8a022082e8ec4129"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#b548bf641c356128d38e3fea7ed6b09e">callerid_genmsg</a> (char *<a class="el" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>, int size, const char *<a class="el" href="structnumber.html">number</a>, const char *<a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>, int flags)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#b14e7cd98202576513db6f74ad84e283">callerid_get</a> (struct <a class="el" href="structcallerid__state.html">callerid_state</a> *cid, char **<a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>, char **<a class="el" href="structnumber.html">number</a>, int *flags)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Extract info out of callerID state machine. Flags are listed above.  <a href="#b14e7cd98202576513db6f74ad84e283"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#c82cccec22b0d6aeffaa50dbc4a9f345">callerid_get_dtmf</a> (char *cidstring, char *<a class="el" href="structnumber.html">number</a>, int *flags)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#deaaf05132ea5b1141b7865526092b2f">callerid_init</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">CallerID Initialization.  <a href="#deaaf05132ea5b1141b7865526092b2f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structcallerid__state.html">callerid_state</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#c6a93a3aeb2ff49fd89cd9f6ce540777">callerid_new</a> (int cid_signalling)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a callerID state machine.  <a href="#c6a93a3aeb2ff49fd89cd9f6ce540777"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#fe4762bd415833e703ed7c5628981442">gen_tone</a> (unsigned char *<a class="el" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>, int len, int codec, float ddr1, float ddi1, float *cr1, float *ci1)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#e0115cf07e6d6aa87d569f827539a18d">gen_tones</a> (unsigned char *<a class="el" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>, int len, int codec, float ddr1, float ddi1, float ddr2, float ddi2, float *cr1, float *ci1, float *cr2, float *ci2)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#78f84543225433f6828cfb5c29ef5f4a">vmwi_generate</a> (unsigned char *<a class="el" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>, int active, int mdmf, int codec)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Generate message waiting indicator (stutter tone).  <a href="#78f84543225433f6828cfb5c29ef5f4a"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#90d6a3bc8680ee4620edc2daeb282f44">casdi1</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#d8e4e693a731406fa7e422253d2f4541">casdi2</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#7eaf53134cd316c146eaa048915d2307">casdr1</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#acf15319786676679be18fb14ac83243">casdr2</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#11465b1391e4e98af0d7e9c7726d0640">cid_di</a> [4]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#1a505e53ba3c76e1fda2320bcc03a1f1">cid_dr</a> [4]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#de6d74b561de2c7ea01a291c08a45672">clidsb</a> = 8000.0 / 1200.0</td></tr>

<tr><td class="memItemLeft" nowrap>struct {</td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;int&nbsp;&nbsp;&nbsp;<a class="el" href="chan__zap_8c.html#6486b4e98228b83d4b13d54febe5f170">alarm</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;<a class="el" href="lock_8h.html#c514af1097ce92209d8aac256b1c5850">ast_cond_t</a>&nbsp;&nbsp;&nbsp;<a class="el" href="event_8c.html#26542fb18a8b14c9775aa475f23c909f">cond</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;const char *&nbsp;&nbsp;&nbsp;<a class="el" href="callerid_8c.html#67daf92c833c41c95db874e18fcb2786">description</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;unsigned int&nbsp;&nbsp;&nbsp;<a class="el" href="logger_8c.html#c2860ae0aa7ac89c509bf7db6bb3324a">event_log</a>:1</td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;const char *&nbsp;&nbsp;&nbsp;<a class="el" href="http_8c.html#abf77184f55403d75b9d51d79162a7ca">ext</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;<a class="el" href="lock_8h.html#55c65f4d641fac96608dabb20791a062">ast_mutex_t</a>&nbsp;&nbsp;&nbsp;<a class="el" href="event_8c.html#dce7c4174ce9323904a934a486c41288">lock</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;const char *&nbsp;&nbsp;&nbsp;<a class="el" href="http_8c.html#455dce211ad602923d28acab07568023">mtype</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;char *&nbsp;&nbsp;&nbsp;<a class="el" href="chan__zap_8c.html#b068931cc450442b63f5b3d276ea4297">name</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;const char *&nbsp;&nbsp;&nbsp;<a class="el" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;unsigned int&nbsp;&nbsp;&nbsp;<a class="el" href="asterisk_8c.html#3759b3f8edb8c22ba8bfd5773258363a">need_quit</a>:1</td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;unsigned int&nbsp;&nbsp;&nbsp;<a class="el" href="asterisk_8c.html#4c2ec178ea7f0e2958118f3dfffb30f3">need_reload</a>:1</td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;<a class="el" href="structrtpPayloadType.html">rtpPayloadType</a>&nbsp;&nbsp;&nbsp;<a class="el" href="rtp_8c.html#081a816b6f16771bb202331725419f93">payloadType</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;unsigned int&nbsp;&nbsp;&nbsp;<a class="el" href="logger_8c.html#b882e02796c8b48d987f6d45f8a7fc04">queue_log</a>:1</td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;char *&nbsp;&nbsp;&nbsp;<a class="el" href="rtp_8c.html#2e282b0d23d6ec55185caeb87b41c0e0">subtype</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;char *&nbsp;&nbsp;&nbsp;<a class="el" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;int&nbsp;&nbsp;&nbsp;<a class="el" href="callerid_8c.html#3a6d0284e743dc4a9b86f97d6dd1a3bf">val</a></td></tr>

<tr><td class="memItemLeft" nowrap valign="top">}&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#3b3c127fc5cb25c830c2bad91960b939">pres_types</a> []</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Translation table for Caller ID Presentation settings.  <a href="#3b3c127fc5cb25c830c2bad91960b939"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#8fc41584745fdcd8c3674ec89bc163e7">sasdi</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#50b1aa87a68c1a34694381be4560cac7">sasdr</a></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
CallerID Generation support. 
<p>
<dl compact><dt><b>Author:</b></dt><dd>Mark Spencer &lt;<a href="mailto:markster@digium.com">markster@digium.com</a>&gt; </dd></dl>

<p>
Definition in file <a class="el" href="callerid_8c-source.html">callerid.c</a>.<hr><h2>Define Documentation</h2>
<a class="anchor" name="f2c732a05bb7e99bab241f65a594ce0f"></a><!-- doxytag: member="callerid.c::AST_CALLERID_UNKNOWN" ref="f2c732a05bb7e99bab241f65a594ce0f" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define AST_CALLERID_UNKNOWN&nbsp;&nbsp;&nbsp;&quot;&lt;unknown&gt;&quot;          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00078">78</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="28110f8586b749713342da2cecdfab2f"></a><!-- doxytag: member="callerid.c::CALLERID_MARK" ref="28110f8586b749713342da2cecdfab2f" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define CALLERID_MARK&nbsp;&nbsp;&nbsp;1200.0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
1200 hz for "1" 
<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00073">73</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
Referenced by <a class="el" href="callerid_8c-source.html#l00118">callerid_init()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3410c6ef512349e1f355f42a05d9b65"></a><!-- doxytag: member="callerid.c::CALLERID_SPACE" ref="a3410c6ef512349e1f355f42a05d9b65" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define CALLERID_SPACE&nbsp;&nbsp;&nbsp;2200.0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
2200 hz for "0" 
<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00072">72</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
Referenced by <a class="el" href="callerid_8c-source.html#l00118">callerid_init()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="810f37cd8d8644dc2f616181be35221d"></a><!-- doxytag: member="callerid.c::CAS_FREQ1" ref="810f37cd8d8644dc2f616181be35221d" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define CAS_FREQ1&nbsp;&nbsp;&nbsp;2130.0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00075">75</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
Referenced by <a class="el" href="callerid_8c-source.html#l00118">callerid_init()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="b2508dc98ce6a08cb60f1be240c24201"></a><!-- doxytag: member="callerid.c::CAS_FREQ2" ref="b2508dc98ce6a08cb60f1be240c24201" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define CAS_FREQ2&nbsp;&nbsp;&nbsp;2750.0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00076">76</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
Referenced by <a class="el" href="callerid_8c-source.html#l00118">callerid_init()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="003c316eedf90b55997bed8de2f592d1"></a><!-- doxytag: member="callerid.c::SAS_FREQ" ref="003c316eedf90b55997bed8de2f592d1" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define SAS_FREQ&nbsp;&nbsp;&nbsp;440.0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00074">74</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
Referenced by <a class="el" href="callerid_8c-source.html#l00118">callerid_init()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="01d752ae6cdb9111ef1812f4569ae65d"></a><!-- doxytag: member="callerid.c::__ast_callerid_generate" ref="01d752ae6cdb9111ef1812f4569ae65d" args="(unsigned char *buf, const char *name, const char *number, int callwaiting, int codec)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int __ast_callerid_generate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned char *&nbsp;</td>
          <td class="mdname" nowrap> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>number</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>callwaiting</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>codec</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00987">987</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, and <a class="el" href="callerid_8c-source.html#l00824">callerid_generate()</a>.
<p>
Referenced by <a class="el" href="callerid_8c-source.html#l01001">ast_callerid_callwaiting_generate()</a>, and <a class="el" href="callerid_8c-source.html#l00996">ast_callerid_generate()</a>.<div class="fragment"><pre class="fragment"><a name="l00988"></a>00988 {
<a name="l00989"></a>00989    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>))
<a name="l00990"></a>00990       name = NULL;
<a name="l00991"></a>00991    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(<a class="code" href="structnumber.html">number</a>))
<a name="l00992"></a>00992       <a class="code" href="structnumber.html">number</a> = NULL;
<a name="l00993"></a>00993    <span class="keywordflow">return</span> <a class="code" href="callerid_8c.html#1d65bfd593c05fbc8a022082e8ec4129">callerid_generate</a>(<a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>, <a class="code" href="structnumber.html">number</a>, name, 0, <a class="code" href="chan__mgcp_8c.html#9127a4950ee5e071d3683ff9d7ba9148">callwaiting</a>, codec);
<a name="l00994"></a>00994 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d94c53b12507014d3f904208a9ec62ea"></a><!-- doxytag: member="callerid.c::ast_callerid_callwaiting_generate" ref="d94c53b12507014d3f904208a9ec62ea" args="(unsigned char *buf, const char *name, const char *number, int codec)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_callerid_callwaiting_generate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned char *&nbsp;</td>
          <td class="mdname" nowrap> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>number</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>codec</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Generate Caller-ID spill but in a format suitable for Call Waiting(tm)'s Caller*ID(tm) See <a class="el" href="callerid_8c.html#608b6d55cc8f38675e758e94ca585bdc">ast_callerid_generate()</a> for other details. 
<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l01001">1001</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="callerid_8c-source.html#l00987">__ast_callerid_generate()</a>.
<p>
Referenced by <a class="el" href="chan__zap_8c-source.html#l01827">send_cwcidspill()</a>.<div class="fragment"><pre class="fragment"><a name="l01002"></a>01002 {
<a name="l01003"></a>01003    <span class="keywordflow">return</span> <a class="code" href="callerid_8c.html#01d752ae6cdb9111ef1812f4569ae65d">__ast_callerid_generate</a>(<a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>, <a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>, <a class="code" href="structnumber.html">number</a>, 1, codec);
<a name="l01004"></a>01004 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="608b6d55cc8f38675e758e94ca585bdc"></a><!-- doxytag: member="callerid.c::ast_callerid_generate" ref="608b6d55cc8f38675e758e94ca585bdc" args="(unsigned char *buf, const char *name, const char *number, int codec)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_callerid_generate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned char *&nbsp;</td>
          <td class="mdname" nowrap> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>number</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>codec</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Generate Caller-ID spill from the "callerid" field of asterisk (in e-mail address like format). 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>buffer for output samples. See <a class="el" href="callerid_8c.html#1d65bfd593c05fbc8a022082e8ec4129">callerid_generate()</a> for details regarding buffer. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>Caller-ID Name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>number</em>&nbsp;</td><td>Caller-ID Number </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>codec</em>&nbsp;</td><td>Asterisk codec (either AST_FORMAT_ALAW or AST_FORMAT_ULAW)</td></tr>
  </table>
</dl>
Acts like callerid_generate except uses an asterisk format callerid string. 
<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00996">996</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="callerid_8c-source.html#l00987">__ast_callerid_generate()</a>.
<p>
Referenced by <a class="el" href="chan__zap_8c-source.html#l01923">zt_call()</a>.<div class="fragment"><pre class="fragment"><a name="l00997"></a>00997 {
<a name="l00998"></a>00998    <span class="keywordflow">return</span> <a class="code" href="callerid_8c.html#01d752ae6cdb9111ef1812f4569ae65d">__ast_callerid_generate</a>(<a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>, <a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>, <a class="code" href="structnumber.html">number</a>, 0, codec);
<a name="l00999"></a>00999 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="9e1786c316d57a4fa234e0e0f8b115dd"></a><!-- doxytag: member="callerid.c::ast_callerid_merge" ref="9e1786c316d57a4fa234e0e0f8b115dd" args="(char *buf, int bufsiz, const char *name, const char *num, const char *unknown)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char* ast_callerid_merge           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>bufsiz</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>num</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>unknown</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l01006">1006</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
Referenced by <a class="el" href="chan__sip_8c-source.html#l10808">_sip_show_peer()</a>, <a class="el" href="chan__iax2_8c-source.html#l02087">iax2_show_peer()</a>, <a class="el" href="app__minivm_8c-source.html#l01501">leave_voicemail()</a>, <a class="el" href="app__minivm_8c-source.html#l00738">prep_email_sub_vars()</a>, and <a class="el" href="chan__sip_8c-source.html#l11026">sip_show_user()</a>.<div class="fragment"><pre class="fragment"><a name="l01007"></a>01007 {
<a name="l01008"></a>01008    <span class="keywordflow">if</span> (!unknown)
<a name="l01009"></a>01009       unknown = <span class="stringliteral">"&lt;unknown&gt;"</span>;
<a name="l01010"></a>01010    <span class="keywordflow">if</span> (<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a> &amp;&amp; <a class="code" href="adsistub_8c.html#0fc3cfbc27e91ea60a787de13dae3e3c">num</a>)
<a name="l01011"></a>01011       snprintf(<a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>, bufsiz, <span class="stringliteral">"\"%s\" &lt;%s&gt;"</span>, <a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>, <a class="code" href="adsistub_8c.html#0fc3cfbc27e91ea60a787de13dae3e3c">num</a>);
<a name="l01012"></a>01012    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>) 
<a name="l01013"></a>01013       ast_copy_string(<a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>, <a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>, bufsiz);
<a name="l01014"></a>01014    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="adsistub_8c.html#0fc3cfbc27e91ea60a787de13dae3e3c">num</a>)
<a name="l01015"></a>01015       ast_copy_string(<a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>, <a class="code" href="adsistub_8c.html#0fc3cfbc27e91ea60a787de13dae3e3c">num</a>, bufsiz);
<a name="l01016"></a>01016    <span class="keywordflow">else</span>
<a name="l01017"></a>01017       ast_copy_string(<a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>, unknown, bufsiz);
<a name="l01018"></a>01018    <span class="keywordflow">return</span> <a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>;
<a name="l01019"></a>01019 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="914d0eb3b42ed9d3547306d24d2e67a0"></a><!-- doxytag: member="callerid.c::ast_callerid_parse" ref="914d0eb3b42ed9d3547306d24d2e67a0" args="(char *instr, char **name, char **location)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_callerid_parse           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>instr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char **&nbsp;</td>
          <td class="mdname" nowrap> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char **&nbsp;</td>
          <td class="mdname" nowrap> <em>location</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Destructively parse inbuf into name and location (or number) Parses callerid stream from inbuf and changes into useable form, outputed in name and location. 
<p>
<dl compact><dt><b>Returns:</b></dt><dd>always returns 0, as the code always returns something. XXX note that 'name' is not parsed consistently e.g. we have</dd></dl>
input location name " foo bar " &lt;123&gt; 123 ' foo bar ' (with spaces around) " foo bar " NULL 'foo bar' (without spaces around) " foo bar  &lt;123&gt;" 123 '" foo bar' The parsing of leading and trailing space/quotes should be more consistent. 
<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00949">949</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="callerid_8c-source.html#l00924">ast_isphonenumber()</a>, and <a class="el" href="callerid_8c-source.html#l00871">ast_shrink_phone_number()</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l01912">action_originate()</a>, <a class="el" href="app__voicemail_8c-source.html#l03665">adsi_message()</a>, <a class="el" href="app__voicemail_8c-source.html#l08189">advanced_options()</a>, <a class="el" href="callerid_8c-source.html#l01021">ast_callerid_split()</a>, <a class="el" href="privacy_8c-source.html#l00051">ast_privacy_check()</a>, <a class="el" href="privacy_8c-source.html#l00087">ast_privacy_set()</a>, <a class="el" href="res__agi_8c-source.html#l01134">handle_setcallerid()</a>, <a class="el" href="chan__misdn_8c-source.html#l03238">misdn_new()</a>, <a class="el" href="app__voicemail_8c-source.html#l04466">play_message_callerid()</a>, <a class="el" href="app__rpt_8c-source.html#l02483">rpt_call()</a>, and <a class="el" href="app__alarmreceiver_8c-source.html#l00308">write_metadata()</a>.<div class="fragment"><pre class="fragment"><a name="l00950"></a>00950 {
<a name="l00951"></a>00951    <span class="keywordtype">char</span> *ns, *ne, *ls, *le;
<a name="l00952"></a>00952 
<a name="l00953"></a>00953    <span class="comment">/* Try "name" &lt;location&gt; format or name &lt;location&gt; format */</span>
<a name="l00954"></a>00954    <span class="keywordflow">if</span> ((ls = strchr(instr, <span class="charliteral">'&lt;'</span>)) &amp;&amp; (le = strchr(ls, <span class="charliteral">'&gt;'</span>))) {
<a name="l00955"></a>00955       *ls = *le = <span class="charliteral">'\0'</span>; <span class="comment">/* location found, trim off the brackets */</span>
<a name="l00956"></a>00956       *location = ls + 1;  <span class="comment">/* and this is the result */</span>
<a name="l00957"></a>00957       <span class="keywordflow">if</span> ((ns = strchr(instr, <span class="charliteral">'"'</span>)) &amp;&amp; (ne = strchr(ns + 1, <span class="charliteral">'"'</span>))) {
<a name="l00958"></a>00958          *ns = *ne = <span class="charliteral">'\0'</span>; <span class="comment">/* trim off the quotes */</span>
<a name="l00959"></a>00959          *<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a> = ns + 1;      <span class="comment">/* and this is the name */</span>
<a name="l00960"></a>00960       } <span class="keywordflow">else</span> { <span class="comment">/* no quotes, trim off leading and trailing spaces */</span>
<a name="l00961"></a>00961          *<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a> = ast_skip_blanks(instr);
<a name="l00962"></a>00962          ast_trim_blanks(*<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>);
<a name="l00963"></a>00963       }
<a name="l00964"></a>00964    } <span class="keywordflow">else</span> { <span class="comment">/* no valid brackets */</span>
<a name="l00965"></a>00965       <span class="keywordtype">char</span> tmp[256];
<a name="l00966"></a>00966 
<a name="l00967"></a>00967       ast_copy_string(tmp, instr, <span class="keyword">sizeof</span>(tmp));
<a name="l00968"></a>00968       <a class="code" href="callerid_8c.html#472e6c01db8037ff1904969285f4e91c">ast_shrink_phone_number</a>(tmp);
<a name="l00969"></a>00969       <span class="keywordflow">if</span> (<a class="code" href="callerid_8c.html#9a4bff80dfc1e99d6c0edc9a808b1495">ast_isphonenumber</a>(tmp)) { <span class="comment">/* Assume it's just a location */</span>
<a name="l00970"></a>00970          *<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a> = NULL;
<a name="l00971"></a>00971          strcpy(instr, tmp); <span class="comment">/* safe, because tmp will always be the same size or smaller than instr */</span>
<a name="l00972"></a>00972          *location = instr;
<a name="l00973"></a>00973       } <span class="keywordflow">else</span> { <span class="comment">/* Assume it's just a name. */</span>
<a name="l00974"></a>00974          *location = NULL;
<a name="l00975"></a>00975          <span class="keywordflow">if</span> ((ns = strchr(instr, <span class="charliteral">'"'</span>)) &amp;&amp; (ne = strchr(ns + 1, <span class="charliteral">'"'</span>))) {
<a name="l00976"></a>00976             *ns = *ne = <span class="charliteral">'\0'</span>; <span class="comment">/* trim off the quotes */</span>
<a name="l00977"></a>00977             *<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a> = ns + 1;      <span class="comment">/* and this is the name */</span>
<a name="l00978"></a>00978          } <span class="keywordflow">else</span> { <span class="comment">/* no quotes, trim off leading and trailing spaces */</span>
<a name="l00979"></a>00979             *<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a> = ast_skip_blanks(instr);
<a name="l00980"></a>00980             ast_trim_blanks(*<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>);
<a name="l00981"></a>00981          }
<a name="l00982"></a>00982       }
<a name="l00983"></a>00983    }
<a name="l00984"></a>00984    <span class="keywordflow">return</span> 0;
<a name="l00985"></a>00985 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="48f42015459db6f4f29d079bda4a6034"></a><!-- doxytag: member="callerid.c::ast_callerid_split" ref="48f42015459db6f4f29d079bda4a6034" args="(const char *buf, char *name, int namelen, char *num, int numlen)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_callerid_split           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>namelen</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>num</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>numlen</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l01021">1021</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="callerid_8c-source.html#l00949">ast_callerid_parse()</a>, <a class="el" href="callerid_8c-source.html#l00871">ast_shrink_phone_number()</a>, and <a class="el" href="utils_8h.html#b38bbfc0f090d7e013ad805ff172a7d2">ast_strdupa</a>.
<p>
Referenced by <a class="el" href="pbx__spool_8c-source.html#l00126">apply_outgoing()</a>, <a class="el" href="res__astum_8c-source.html#l01229">aum_build_user()</a>, <a class="el" href="chan__skinny_8c-source.html#l02102">build_device()</a>, <a class="el" href="chan__mgcp_8c-source.html#l03593">build_gateway()</a>, <a class="el" href="chan__iax2_8c-source.html#l08607">build_peer()</a>, <a class="el" href="chan__sip_8c-source.html#l16717">build_user()</a>, <a class="el" href="func__callerid_8c-source.html#l00058">callerid_read()</a>, <a class="el" href="func__callerid_8c-source.html#l00118">callerid_write()</a>, <a class="el" href="chan__phone_8c-source.html#l01364">load_module()</a>, <a class="el" href="chan__zap_8c-source.html#l11882">process_zap()</a>, <a class="el" href="chan__oss_8c-source.html#l01481">store_callerid()</a>, and <a class="el" href="chan__h323_8c-source.html#l01263">update_common_options()</a>.<div class="fragment"><pre class="fragment"><a name="l01022"></a>01022 {
<a name="l01023"></a>01023    <span class="keywordtype">char</span> *tmp;
<a name="l01024"></a>01024    <span class="keywordtype">char</span> *l = NULL, *n = NULL;
<a name="l01025"></a>01025 
<a name="l01026"></a>01026    tmp = <a class="code" href="utils_8h.html#b38bbfc0f090d7e013ad805ff172a7d2">ast_strdupa</a>(<a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>);
<a name="l01027"></a>01027    <a class="code" href="callerid_8c.html#914d0eb3b42ed9d3547306d24d2e67a0">ast_callerid_parse</a>(tmp, &amp;n, &amp;l);
<a name="l01028"></a>01028    <span class="keywordflow">if</span> (n)
<a name="l01029"></a>01029       ast_copy_string(<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>, n, namelen);
<a name="l01030"></a>01030    <span class="keywordflow">else</span>
<a name="l01031"></a>01031       <a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>[0] = <span class="charliteral">'\0'</span>;
<a name="l01032"></a>01032    <span class="keywordflow">if</span> (l) {
<a name="l01033"></a>01033       <a class="code" href="callerid_8c.html#472e6c01db8037ff1904969285f4e91c">ast_shrink_phone_number</a>(l);
<a name="l01034"></a>01034       ast_copy_string(<a class="code" href="adsistub_8c.html#0fc3cfbc27e91ea60a787de13dae3e3c">num</a>, l, numlen);
<a name="l01035"></a>01035    } <span class="keywordflow">else</span>
<a name="l01036"></a>01036       <a class="code" href="adsistub_8c.html#0fc3cfbc27e91ea60a787de13dae3e3c">num</a>[0] = <span class="charliteral">'\0'</span>;
<a name="l01037"></a>01037    <span class="keywordflow">return</span> 0;
<a name="l01038"></a>01038 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b5dfc57cf569e2ba434a743b1d53af4f"></a><!-- doxytag: member="callerid.c::ast_describe_caller_presentation" ref="b5dfc57cf569e2ba434a743b1d53af4f" args="(int data)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char* ast_describe_caller_presentation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>data</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Convert caller ID pres value to explanatory string. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>value (see <a class="el" href="callerid_8h.html">callerid.h</a> AST_PRES_ ) </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>string for human presentation </dd></dl>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l01078">1078</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="callerid_8c.html#3b3c127fc5cb25c830c2bad91960b939">pres_types</a>.
<p>
Referenced by <a class="el" href="chan__sip_8c-source.html#l10808">_sip_show_peer()</a>, <a class="el" href="channel_8c-source.html#l03694">ast_set_callerid()</a>, and <a class="el" href="chan__sip_8c-source.html#l11026">sip_show_user()</a>.<div class="fragment"><pre class="fragment"><a name="l01079"></a>01079 {
<a name="l01080"></a>01080    <span class="keywordtype">int</span> i;
<a name="l01081"></a>01081 
<a name="l01082"></a>01082    <span class="keywordflow">for</span> (i = 0; i &lt; ((<span class="keyword">sizeof</span>(<a class="code" href="callerid_8c.html#3b3c127fc5cb25c830c2bad91960b939">pres_types</a>) / <span class="keyword">sizeof</span>(pres_types[0]))); i++) {
<a name="l01083"></a>01083       <span class="keywordflow">if</span> (pres_types[i].<a class="code" href="structval.html">val</a> == <a class="code" href="structast__frame.html#8d777f385d3dfec8815d20f7496026dc">data</a>)
<a name="l01084"></a>01084          <span class="keywordflow">return</span> pres_types[i].description;
<a name="l01085"></a>01085    }
<a name="l01086"></a>01086 
<a name="l01087"></a>01087    <span class="keywordflow">return</span> <span class="stringliteral">"unknown"</span>;
<a name="l01088"></a>01088 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="650489920c146454c38d0fc56d5e2771"></a><!-- doxytag: member="callerid.c::ast_gen_cas" ref="650489920c146454c38d0fc56d5e2771" args="(unsigned char *outbuf, int sendsas, int len, int codec)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_gen_cas           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned char *&nbsp;</td>
          <td class="mdname" nowrap> <em>outbuf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>sas</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>codec</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>outbuf</em>&nbsp;</td><td>Allocated buffer for data. Must be at least 2400 bytes unless no SAS is desired </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sas</em>&nbsp;</td><td>Non-zero if CAS should be preceeded by SAS </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>How many samples to generate. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>codec</em>&nbsp;</td><td>Which codec (AST_FORMAT_ALAW or AST_FORMAT_ULAW) </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Returns -1 on error (if len is less than 2400), 0 on success. </dd></dl>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00235">235</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="callerid_8c-source.html#l00070">casdi1</a>, <a class="el" href="callerid_8c-source.html#l00070">casdi2</a>, <a class="el" href="callerid_8c-source.html#l00070">casdr1</a>, <a class="el" href="callerid_8c-source.html#l00070">casdr2</a>, <a class="el" href="callerid_8c-source.html#l00102">gen_tone()</a>, <a class="el" href="callerid_8c-source.html#l00080">gen_tones()</a>, <a class="el" href="callerid_8c-source.html#l00053">callerid_state::pos</a>, <a class="el" href="callerid_8c-source.html#l00069">sasdi</a>, and <a class="el" href="callerid_8c-source.html#l00069">sasdr</a>.
<p>
Referenced by <a class="el" href="res__adsi_8c-source.html#l00198">__adsi_transmit_messages()</a>, and <a class="el" href="chan__zap_8c-source.html#l01895">zt_callwait()</a>.<div class="fragment"><pre class="fragment"><a name="l00236"></a>00236 {
<a name="l00237"></a>00237    <span class="keywordtype">int</span> pos = 0;
<a name="l00238"></a>00238    <span class="keywordtype">int</span> saslen = 2400;
<a name="l00239"></a>00239    <span class="keywordtype">float</span> cr1 = 1.0;
<a name="l00240"></a>00240    <span class="keywordtype">float</span> ci1 = 0.0;
<a name="l00241"></a>00241    <span class="keywordtype">float</span> cr2 = 1.0;
<a name="l00242"></a>00242    <span class="keywordtype">float</span> ci2 = 0.0;
<a name="l00243"></a>00243 
<a name="l00244"></a>00244    <span class="keywordflow">if</span> (sendsas) {
<a name="l00245"></a>00245       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a> &lt; saslen)
<a name="l00246"></a>00246          <span class="keywordflow">return</span> -1;
<a name="l00247"></a>00247       <a class="code" href="callerid_8c.html#fe4762bd415833e703ed7c5628981442">gen_tone</a>(outbuf, saslen, codec, <a class="code" href="callerid_8c.html#50b1aa87a68c1a34694381be4560cac7">sasdr</a>, <a class="code" href="callerid_8c.html#8fc41584745fdcd8c3674ec89bc163e7">sasdi</a>, &amp;cr1, &amp;ci1);
<a name="l00248"></a>00248       <a class="code" href="utils_8h.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a> -= saslen;
<a name="l00249"></a>00249       pos += saslen;
<a name="l00250"></a>00250       cr2 = cr1;
<a name="l00251"></a>00251       ci2 = ci1;
<a name="l00252"></a>00252    }
<a name="l00253"></a>00253    <a class="code" href="callerid_8c.html#e0115cf07e6d6aa87d569f827539a18d">gen_tones</a>(outbuf + pos, <a class="code" href="utils_8h.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a>, codec, <a class="code" href="callerid_8c.html#7eaf53134cd316c146eaa048915d2307">casdr1</a>, <a class="code" href="callerid_8c.html#90d6a3bc8680ee4620edc2daeb282f44">casdi1</a>, <a class="code" href="callerid_8c.html#acf15319786676679be18fb14ac83243">casdr2</a>, <a class="code" href="callerid_8c.html#d8e4e693a731406fa7e422253d2f4541">casdi2</a>, &amp;cr1, &amp;ci1, &amp;cr2, &amp;ci2);
<a name="l00254"></a>00254    <span class="keywordflow">return</span> 0;
<a name="l00255"></a>00255 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="bc66e4db3a33f1d6808d92ab9677dace"></a><!-- doxytag: member="callerid.c::ast_is_shrinkable_phonenumber" ref="bc66e4db3a33f1d6808d92ab9677dace" args="(const char *exten)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_is_shrinkable_phonenumber           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>exten</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Check if a string consists only of digits and and + # ( ) - . (meaning it can be cleaned with ast_shrink_phone_number). 
<p>
<dl compact><dt><b>Returns:</b></dt><dd>1 if string is valid AST shrinkable phone number <p>
0 if not </dd></dl>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00934">934</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="callerid_8c-source.html#l00908">ast_is_valid_string()</a>.
<p>
Referenced by <a class="el" href="chan__sip_8c-source.html#l09851">check_peer_ok()</a>, <a class="el" href="chan__sip_8c-source.html#l09982">check_user_full()</a>, <a class="el" href="chan__sip_8c-source.html#l09745">check_user_ok()</a>, and <a class="el" href="chan__sip_8c-source.html#l09731">replace_cid()</a>.<div class="fragment"><pre class="fragment"><a name="l00935"></a>00935 {
<a name="l00936"></a>00936    <span class="keywordflow">return</span> <a class="code" href="callerid_8c.html#c29073ea46cb584ba6736955293a694f">ast_is_valid_string</a>(<a class="code" href="chan__alsa_8c.html#5aedfeaeaac21e5e5f297360633ea9a3">exten</a>, <span class="stringliteral">"0123456789*#+()-."</span>);
<a name="l00937"></a>00937 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="c29073ea46cb584ba6736955293a694f"></a><!-- doxytag: member="callerid.c::ast_is_valid_string" ref="c29073ea46cb584ba6736955293a694f" args="(const char *exten, const char *valid)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int ast_is_valid_string           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>valid</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Checks if phone number consists of valid characters. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>exten</em>&nbsp;</td><td>String that needs to be checked </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>valid</em>&nbsp;</td><td>Valid characters in string </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>1 if valid string, 0 if string contains invalid characters </dd></dl>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00908">908</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>.
<p>
Referenced by <a class="el" href="callerid_8c-source.html#l00934">ast_is_shrinkable_phonenumber()</a>, and <a class="el" href="callerid_8c-source.html#l00924">ast_isphonenumber()</a>.<div class="fragment"><pre class="fragment"><a name="l00909"></a>00909 {
<a name="l00910"></a>00910    <span class="keywordtype">int</span> x;
<a name="l00911"></a>00911 
<a name="l00912"></a>00912    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(<a class="code" href="chan__alsa_8c.html#5aedfeaeaac21e5e5f297360633ea9a3">exten</a>))
<a name="l00913"></a>00913       <span class="keywordflow">return</span> 0;
<a name="l00914"></a>00914    <span class="keywordflow">for</span> (x = 0; <a class="code" href="chan__alsa_8c.html#5aedfeaeaac21e5e5f297360633ea9a3">exten</a>[x]; x++)
<a name="l00915"></a>00915       <span class="keywordflow">if</span> (!strchr(valid, <a class="code" href="chan__alsa_8c.html#5aedfeaeaac21e5e5f297360633ea9a3">exten</a>[x]))
<a name="l00916"></a>00916          <span class="keywordflow">return</span> 0;
<a name="l00917"></a>00917    <span class="keywordflow">return</span> 1;
<a name="l00918"></a>00918 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="9a4bff80dfc1e99d6c0edc9a808b1495"></a><!-- doxytag: member="callerid.c::ast_isphonenumber" ref="9a4bff80dfc1e99d6c0edc9a808b1495" args="(const char *n)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_isphonenumber           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>n</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Check if a string consists only of digits and + #. 
<p>
<dl compact><dt><b>Returns:</b></dt><dd>1 if string is valid AST phone number <p>
0 if not </dd></dl>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00924">924</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="callerid_8c-source.html#l00908">ast_is_valid_string()</a>.
<p>
Referenced by <a class="el" href="callerid_8c-source.html#l00949">ast_callerid_parse()</a>.<div class="fragment"><pre class="fragment"><a name="l00925"></a>00925 {
<a name="l00926"></a>00926    <span class="keywordflow">return</span> <a class="code" href="callerid_8c.html#c29073ea46cb584ba6736955293a694f">ast_is_valid_string</a>(n, <span class="stringliteral">"0123456789*#+"</span>);
<a name="l00927"></a>00927 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="f7d5a5df502a243ff7c0829b69b4a7a3"></a><!-- doxytag: member="callerid.c::ast_named_caller_presentation" ref="f7d5a5df502a243ff7c0829b69b4a7a3" args="(int data)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char* ast_named_caller_presentation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>data</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Convert caller ID pres value to text code. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>text string </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>string for config file </dd></dl>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l01094">1094</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="callerid_8c.html#3b3c127fc5cb25c830c2bad91960b939">pres_types</a>.
<p>
Referenced by <a class="el" href="func__callerid_8c-source.html#l00058">callerid_read()</a>, and <a class="el" href="func__callerid_8c-source.html#l00042">callerpres_read()</a>.<div class="fragment"><pre class="fragment"><a name="l01095"></a>01095 {
<a name="l01096"></a>01096    <span class="keywordtype">int</span> i;
<a name="l01097"></a>01097 
<a name="l01098"></a>01098    <span class="keywordflow">for</span> (i = 0; i &lt; ((<span class="keyword">sizeof</span>(<a class="code" href="callerid_8c.html#3b3c127fc5cb25c830c2bad91960b939">pres_types</a>) / <span class="keyword">sizeof</span>(pres_types[0]))); i++) {
<a name="l01099"></a>01099       <span class="keywordflow">if</span> (pres_types[i].<a class="code" href="structval.html">val</a> == <a class="code" href="structast__frame.html#8d777f385d3dfec8815d20f7496026dc">data</a>)
<a name="l01100"></a>01100          <span class="keywordflow">return</span> pres_types[i].name;
<a name="l01101"></a>01101    }
<a name="l01102"></a>01102 
<a name="l01103"></a>01103    <span class="keywordflow">return</span> <span class="stringliteral">"unknown"</span>;
<a name="l01104"></a>01104 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="760c5dbb16d6c44dca8aaba3e5611165"></a><!-- doxytag: member="callerid.c::ast_parse_caller_presentation" ref="760c5dbb16d6c44dca8aaba3e5611165" args="(const char *data)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_parse_caller_presentation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>data</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Convert caller ID text code to value used in config file parsing. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>text string </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>value AST_PRES_ from <a class="el" href="callerid_8h.html">callerid.h</a> </dd></dl>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l01062">1062</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="callerid_8c-source.html#l01043">name</a>, and <a class="el" href="callerid_8c.html#3b3c127fc5cb25c830c2bad91960b939">pres_types</a>.
<p>
Referenced by <a class="el" href="res__astum_8c-source.html#l01229">aum_build_user()</a>, <a class="el" href="chan__sip_8c-source.html#l16894">build_peer()</a>, <a class="el" href="chan__sip_8c-source.html#l16717">build_user()</a>, <a class="el" href="func__callerid_8c-source.html#l00118">callerid_write()</a>, <a class="el" href="func__callerid_8c-source.html#l00048">callerpres_write()</a>, and <a class="el" href="app__setcallerid_8c-source.html#l00067">setcallerid_pres_exec()</a>.<div class="fragment"><pre class="fragment"><a name="l01063"></a>01063 {
<a name="l01064"></a>01064    <span class="keywordtype">int</span> i;
<a name="l01065"></a>01065 
<a name="l01066"></a>01066    <span class="keywordflow">for</span> (i = 0; i &lt; ((<span class="keyword">sizeof</span>(<a class="code" href="callerid_8c.html#3b3c127fc5cb25c830c2bad91960b939">pres_types</a>) / <span class="keyword">sizeof</span>(pres_types[0]))); i++) {
<a name="l01067"></a>01067       <span class="keywordflow">if</span> (!strcasecmp(pres_types[i].<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>, <a class="code" href="structast__frame.html#8d777f385d3dfec8815d20f7496026dc">data</a>))
<a name="l01068"></a>01068          <span class="keywordflow">return</span> pres_types[i].val;
<a name="l01069"></a>01069    }
<a name="l01070"></a>01070 
<a name="l01071"></a>01071    <span class="keywordflow">return</span> -1;
<a name="l01072"></a>01072 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="472e6c01db8037ff1904969285f4e91c"></a><!-- doxytag: member="callerid.c::ast_shrink_phone_number" ref="472e6c01db8037ff1904969285f4e91c" args="(char *n)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_shrink_phone_number           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>n</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Shrink a phone number in place to just digits (more accurately it just removes ()'s, .'s, and -'s... 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>n</em>&nbsp;</td><td>The number to be stripped/shrunk </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Returns nothing important </dd></dl>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00871">871</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l01912">action_originate()</a>, <a class="el" href="callerid_8c-source.html#l00949">ast_callerid_parse()</a>, <a class="el" href="callerid_8c-source.html#l01021">ast_callerid_split()</a>, <a class="el" href="privacy_8c-source.html#l00051">ast_privacy_check()</a>, <a class="el" href="privacy_8c-source.html#l00087">ast_privacy_set()</a>, <a class="el" href="chan__iax2_8c-source.html#l04758">check_access()</a>, <a class="el" href="chan__sip_8c-source.html#l09851">check_peer_ok()</a>, <a class="el" href="chan__sip_8c-source.html#l09982">check_user_full()</a>, <a class="el" href="chan__sip_8c-source.html#l09745">check_user_ok()</a>, <a class="el" href="res__agi_8c-source.html#l01134">handle_setcallerid()</a>, <a class="el" href="pbx__config_8c-source.html#l01332">pbx_load_config()</a>, <a class="el" href="chan__sip_8c-source.html#l09731">replace_cid()</a>, <a class="el" href="app__dial_8c-source.html#l01073">setup_privacy_args()</a>, <a class="el" href="chan__zap_8c-source.html#l05744">ss_thread()</a>, and <a class="el" href="app__alarmreceiver_8c-source.html#l00308">write_metadata()</a>.<div class="fragment"><pre class="fragment"><a name="l00872"></a>00872 {
<a name="l00873"></a>00873    <span class="keywordtype">int</span> x, y=0;
<a name="l00874"></a>00874    <span class="keywordtype">int</span> bracketed = 0;
<a name="l00875"></a>00875 
<a name="l00876"></a>00876    <span class="keywordflow">for</span> (x = 0; n[x]; x++) {
<a name="l00877"></a>00877       <span class="keywordflow">switch</span> (n[x]) {
<a name="l00878"></a>00878       <span class="keywordflow">case</span> <span class="charliteral">'['</span>:
<a name="l00879"></a>00879          bracketed++;
<a name="l00880"></a>00880          n[y++] = n[x];
<a name="l00881"></a>00881          <span class="keywordflow">break</span>;
<a name="l00882"></a>00882       <span class="keywordflow">case</span> <span class="charliteral">']'</span>:
<a name="l00883"></a>00883          bracketed--;
<a name="l00884"></a>00884          n[y++] = n[x];
<a name="l00885"></a>00885          <span class="keywordflow">break</span>;
<a name="l00886"></a>00886       <span class="keywordflow">case</span> <span class="charliteral">'-'</span>:
<a name="l00887"></a>00887          <span class="keywordflow">if</span> (bracketed)
<a name="l00888"></a>00888             n[y++] = n[x];
<a name="l00889"></a>00889          <span class="keywordflow">break</span>;
<a name="l00890"></a>00890       <span class="keywordflow">case</span> <span class="charliteral">'.'</span>:
<a name="l00891"></a>00891          <span class="keywordflow">if</span> (!n[x+1])
<a name="l00892"></a>00892             n[y++] = n[x];
<a name="l00893"></a>00893          <span class="keywordflow">break</span>;
<a name="l00894"></a>00894       <span class="keywordflow">default</span>:
<a name="l00895"></a>00895          <span class="comment">/* ignore parenthesis and whitespace */</span>
<a name="l00896"></a>00896          <span class="keywordflow">if</span> (!strchr(<span class="stringliteral">"( )"</span>, n[x]))
<a name="l00897"></a>00897             n[y++] = n[x];
<a name="l00898"></a>00898       }
<a name="l00899"></a>00899    }
<a name="l00900"></a>00900    n[y] = <span class="charliteral">'\0'</span>;
<a name="l00901"></a>00901 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="bbc2bac160508ff33fe80e066bcca0ee"></a><!-- doxytag: member="callerid.c::calc_crc" ref="bbc2bac160508ff33fe80e066bcca0ee" args="(unsigned short crc, unsigned char data)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static unsigned short calc_crc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned short&nbsp;</td>
          <td class="mdname" nowrap> <em>crc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned char&nbsp;</td>
          <td class="mdname" nowrap> <em>data</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00257">257</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="pbx__dundi_8c-source.html#l00127">org</a>.
<p>
Referenced by <a class="el" href="callerid_8c-source.html#l00280">callerid_feed_jp()</a>.<div class="fragment"><pre class="fragment"><a name="l00258"></a>00258 {
<a name="l00259"></a>00259    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, j, <a class="code" href="pbx__dundi_8c.html#05938e50ebb54c2fc032379861e418dd">org</a>, dst;
<a name="l00260"></a>00260    org = <a class="code" href="structast__frame.html#8d777f385d3dfec8815d20f7496026dc">data</a>;
<a name="l00261"></a>00261    dst = 0;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263    <span class="keywordflow">for</span> (i = 0; i &lt; CHAR_BIT; i++) {
<a name="l00264"></a>00264       org &lt;&lt;= 1;
<a name="l00265"></a>00265       dst &gt;&gt;= 1;
<a name="l00266"></a>00266       <span class="keywordflow">if</span> (org &amp; 0x100) 
<a name="l00267"></a>00267          dst |= 0x80;
<a name="l00268"></a>00268    }
<a name="l00269"></a>00269    <a class="code" href="structast__frame.html#8d777f385d3dfec8815d20f7496026dc">data</a> = (<span class="keywordtype">unsigned</span> char) dst;
<a name="l00270"></a>00270    crc ^= (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) <a class="code" href="structast__frame.html#8d777f385d3dfec8815d20f7496026dc">data</a> &lt;&lt; (16 - CHAR_BIT);
<a name="l00271"></a>00271    <span class="keywordflow">for</span> (j = 0; j &lt; CHAR_BIT; j++) {
<a name="l00272"></a>00272       <span class="keywordflow">if</span> (crc &amp; 0x8000U)
<a name="l00273"></a>00273          crc = (crc &lt;&lt; 1) ^ 0x1021U ;
<a name="l00274"></a>00274       <span class="keywordflow">else</span>
<a name="l00275"></a>00275          crc &lt;&lt;= 1 ;
<a name="l00276"></a>00276    }
<a name="l00277"></a>00277       <span class="keywordflow">return</span> crc;
<a name="l00278"></a>00278 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="ddba256565333385f123e551ea5ba516"></a><!-- doxytag: member="callerid.c::callerid_feed" ref="ddba256565333385f123e551ea5ba516" args="(struct callerid_state *cid, unsigned char *ubuf, int len, int codec)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int callerid_feed           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structcallerid__state.html">callerid_state</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>cid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned char *&nbsp;</td>
          <td class="mdname" nowrap> <em>ubuf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>samples</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>codec</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Read samples into the state machine. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cid</em>&nbsp;</td><td>Which state machine to act upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ubuf</em>&nbsp;</td><td>containing your samples </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>samples</em>&nbsp;</td><td>number of samples contained within the buffer. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>codec</em>&nbsp;</td><td>which codec (AST_FORMAT_ALAW or AST_FORMAT_ULAW)</td></tr>
  </table>
</dl>
Send received audio to the Caller*ID demodulator. <dl compact><dt><b>Returns:</b></dt><dd>Returns -1 on error, 0 for "needs more samples", and 1 if the CallerID spill reception is complete. </dd></dl>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00523">523</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="callerid_8h-source.html#l00064">AST_XLAW</a>, <a class="el" href="adsistub_8c-source.html#l00065">buf</a>, <a class="el" href="callerid_8h-source.html#l00048">CID_PRIVATE_NAME</a>, <a class="el" href="callerid_8h-source.html#l00049">CID_PRIVATE_NUMBER</a>, <a class="el" href="callerid_8h-source.html#l00050">CID_UNKNOWN_NAME</a>, <a class="el" href="callerid_8h-source.html#l00051">CID_UNKNOWN_NUMBER</a>, <a class="el" href="callerid_8c-source.html#l00055">callerid_state::cksum</a>, <a class="el" href="callerid_8c-source.html#l00058">callerid_state::flags</a>, <a class="el" href="fskmodem_8c-source.html#l00222">fsk_serial()</a>, <a class="el" href="callerid_8c-source.html#l00049">callerid_state::fskd</a>, <a class="el" href="callerid_8c-source.html#l00060">callerid_state::len</a>, <a class="el" href="logger_8h-source.html#l00118">LOG_ERROR</a>, <a class="el" href="logger_8h-source.html#l00106">LOG_NOTICE</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="callerid_8c-source.html#l00056">callerid_state::name</a>, <a class="el" href="callerid_8c-source.html#l00057">callerid_state::number</a>, <a class="el" href="callerid_8c-source.html#l00052">callerid_state::oldlen</a>, <a class="el" href="callerid_8c-source.html#l00051">callerid_state::oldstuff</a>, <a class="el" href="callerid_8c-source.html#l00053">callerid_state::pos</a>, <a class="el" href="callerid_8c-source.html#l00050">callerid_state::rawdata</a>, <a class="el" href="callerid_8c-source.html#l00059">callerid_state::sawflag</a>, and <a class="el" href="callerid_8c-source.html#l00054">callerid_state::type</a>.
<p>
Referenced by <a class="el" href="chan__zap_8c-source.html#l05744">ss_thread()</a>.<div class="fragment"><pre class="fragment"><a name="l00524"></a>00524 {
<a name="l00525"></a>00525    <span class="keywordtype">int</span> mylen = <a class="code" href="utils_8h.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a>;
<a name="l00526"></a>00526    <span class="keywordtype">int</span> olen;
<a name="l00527"></a>00527    <span class="keywordtype">int</span> b = <span class="charliteral">'X'</span>;
<a name="l00528"></a>00528    <span class="keywordtype">int</span> res;
<a name="l00529"></a>00529    <span class="keywordtype">int</span> x;
<a name="l00530"></a>00530    <span class="keywordtype">short</span> *<a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>;
<a name="l00531"></a>00531 
<a name="l00532"></a>00532    buf = alloca(2 * <a class="code" href="utils_8h.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a> + cid-&gt;<a class="code" href="structcallerid__state.html#d6b817146e45d00c0bd73642bf1cba72">oldlen</a>);
<a name="l00533"></a>00533 
<a name="l00534"></a>00534    memcpy(buf, cid-&gt;<a class="code" href="structcallerid__state.html#38fa166dfb1fe584c84f5513612926de">oldstuff</a>, cid-&gt;<a class="code" href="structcallerid__state.html#d6b817146e45d00c0bd73642bf1cba72">oldlen</a>);
<a name="l00535"></a>00535    mylen += cid-&gt;<a class="code" href="structcallerid__state.html#d6b817146e45d00c0bd73642bf1cba72">oldlen</a>/2;
<a name="l00536"></a>00536 
<a name="l00537"></a>00537    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="utils_8h.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a>; x++) 
<a name="l00538"></a>00538       buf[x+cid-&gt;<a class="code" href="structcallerid__state.html#d6b817146e45d00c0bd73642bf1cba72">oldlen</a>/2] = <a class="code" href="callerid_8h.html#822ff9241612072983832652a42f4ae2">AST_XLAW</a>(ubuf[x]);
<a name="l00539"></a>00539    <span class="keywordflow">while</span> (mylen &gt;= 160) {
<a name="l00540"></a>00540       olen = mylen;
<a name="l00541"></a>00541       res = <a class="code" href="fskmodem_8c.html#64979a619b5b351568ce5b2c91f18df1">fsk_serial</a>(&amp;cid-&gt;<a class="code" href="structcallerid__state.html#d8e2c20684b44da85dd15ff343ca1713">fskd</a>, buf, &amp;mylen, &amp;b);
<a name="l00542"></a>00542       <span class="keywordflow">if</span> (mylen &lt; 0) {
<a name="l00543"></a>00543          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#4490aa3d29644e716440fada68f54032">LOG_ERROR</a>, <span class="stringliteral">"fsk_serial made mylen &lt; 0 (%d)\n"</span>, mylen);
<a name="l00544"></a>00544          <span class="keywordflow">return</span> -1;
<a name="l00545"></a>00545       }
<a name="l00546"></a>00546       buf += (olen - mylen);
<a name="l00547"></a>00547       <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l00548"></a>00548          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#bbf95aad74d847cd4bcb129604f798cd">LOG_NOTICE</a>, <span class="stringliteral">"fsk_serial failed\n"</span>);
<a name="l00549"></a>00549          <span class="keywordflow">return</span> -1;
<a name="l00550"></a>00550       }
<a name="l00551"></a>00551       <span class="keywordflow">if</span> (res == 1) {
<a name="l00552"></a>00552          <span class="comment">/* Ignore invalid bytes */</span>
<a name="l00553"></a>00553          <span class="keywordflow">if</span> (b &gt; 0xff)
<a name="l00554"></a>00554             <span class="keywordflow">continue</span>;
<a name="l00555"></a>00555          <span class="keywordflow">switch</span> (cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a>) {
<a name="l00556"></a>00556          <span class="keywordflow">case</span> 0: <span class="comment">/* Look for flag */</span>
<a name="l00557"></a>00557             <span class="keywordflow">if</span> (b == <span class="charliteral">'U'</span>)
<a name="l00558"></a>00558                cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a> = 2;
<a name="l00559"></a>00559             <span class="keywordflow">break</span>;
<a name="l00560"></a>00560          <span class="keywordflow">case</span> 2: <span class="comment">/* Get lead-in */</span>
<a name="l00561"></a>00561             <span class="keywordflow">if</span> ((b == 0x04) || (b == 0x80)) {
<a name="l00562"></a>00562                cid-&gt;<a class="code" href="structcallerid__state.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a> = b;
<a name="l00563"></a>00563                cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a> = 3;
<a name="l00564"></a>00564                cid-&gt;<a class="code" href="structcallerid__state.html#a00c618b4425c10cc20adc56886a7512">cksum</a> = b;
<a name="l00565"></a>00565             }
<a name="l00566"></a>00566             <span class="keywordflow">break</span>;
<a name="l00567"></a>00567          <span class="keywordflow">case</span> 3:  <span class="comment">/* Get length */</span>
<a name="l00568"></a>00568             <span class="comment">/* Not a lead in.  We're ready  */</span>
<a name="l00569"></a>00569             cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a> = 4;
<a name="l00570"></a>00570             cid-&gt;<a class="code" href="structcallerid__state.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a> = b;
<a name="l00571"></a>00571             cid-&gt;<a class="code" href="structcallerid__state.html#5e0bdcbddccca4d66d74ba8c1cee1a68">pos</a> = 0;
<a name="l00572"></a>00572             cid-&gt;<a class="code" href="structcallerid__state.html#a00c618b4425c10cc20adc56886a7512">cksum</a> += b;
<a name="l00573"></a>00573             <span class="keywordflow">break</span>;
<a name="l00574"></a>00574          <span class="keywordflow">case</span> 4: <span class="comment">/* Retrieve message */</span>
<a name="l00575"></a>00575             <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structcallerid__state.html#5e0bdcbddccca4d66d74ba8c1cee1a68">pos</a> &gt;= 128) {
<a name="l00576"></a>00576                <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Caller ID too long???\n"</span>);
<a name="l00577"></a>00577                <span class="keywordflow">return</span> -1;
<a name="l00578"></a>00578             }
<a name="l00579"></a>00579             cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[cid-&gt;<a class="code" href="structcallerid__state.html#5e0bdcbddccca4d66d74ba8c1cee1a68">pos</a>++] = b;
<a name="l00580"></a>00580             cid-&gt;<a class="code" href="structcallerid__state.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a>--;
<a name="l00581"></a>00581             cid-&gt;<a class="code" href="structcallerid__state.html#a00c618b4425c10cc20adc56886a7512">cksum</a> += b;
<a name="l00582"></a>00582             <span class="keywordflow">if</span> (!cid-&gt;<a class="code" href="structcallerid__state.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a>) {
<a name="l00583"></a>00583                cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[cid-&gt;<a class="code" href="structcallerid__state.html#5e0bdcbddccca4d66d74ba8c1cee1a68">pos</a>] = <span class="charliteral">'\0'</span>;
<a name="l00584"></a>00584                cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a> = 5;
<a name="l00585"></a>00585             }
<a name="l00586"></a>00586             <span class="keywordflow">break</span>;
<a name="l00587"></a>00587          <span class="keywordflow">case</span> 5: <span class="comment">/* Check checksum */</span>
<a name="l00588"></a>00588             <span class="keywordflow">if</span> (b != (256 - (cid-&gt;<a class="code" href="structcallerid__state.html#a00c618b4425c10cc20adc56886a7512">cksum</a> &amp; 0xff))) {
<a name="l00589"></a>00589                <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#bbf95aad74d847cd4bcb129604f798cd">LOG_NOTICE</a>, <span class="stringliteral">"Caller*ID failed checksum\n"</span>);
<a name="l00590"></a>00590                <span class="comment">/* Try again */</span>
<a name="l00591"></a>00591                cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a> = 0;
<a name="l00592"></a>00592                <span class="keywordflow">break</span>;
<a name="l00593"></a>00593             }
<a name="l00594"></a>00594       
<a name="l00595"></a>00595             cid-&gt;<a class="code" href="structcallerid__state.html#6637d404fc35915f0682f7f9135fa832">number</a>[0] = <span class="charliteral">'\0'</span>;
<a name="l00596"></a>00596             cid-&gt;<a class="code" href="structcallerid__state.html#275f6727040426992bb1c8e247d38cde">name</a>[0] = <span class="charliteral">'\0'</span>;
<a name="l00597"></a>00597             <span class="comment">/* If we get this far we're fine.  */</span>
<a name="l00598"></a>00598             <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structcallerid__state.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a> == 0x80) {
<a name="l00599"></a>00599                <span class="comment">/* MDMF */</span>
<a name="l00600"></a>00600                <span class="comment">/* Go through each element and process */</span>
<a name="l00601"></a>00601                <span class="keywordflow">for</span> (x = 0; x &lt; cid-&gt;pos;) {
<a name="l00602"></a>00602                   <span class="keywordflow">switch</span> (cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x++]) {
<a name="l00603"></a>00603                   <span class="keywordflow">case</span> 1:
<a name="l00604"></a>00604                      <span class="comment">/* Date */</span>
<a name="l00605"></a>00605                      <span class="keywordflow">break</span>;
<a name="l00606"></a>00606                   <span class="keywordflow">case</span> 2: <span class="comment">/* Number */</span>
<a name="l00607"></a>00607                   <span class="keywordflow">case</span> 3: <span class="comment">/* Number (for Zebble) */</span>
<a name="l00608"></a>00608                   <span class="keywordflow">case</span> 4: <span class="comment">/* Number */</span>
<a name="l00609"></a>00609                      res = cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x];
<a name="l00610"></a>00610                      <span class="keywordflow">if</span> (res &gt; 32) {
<a name="l00611"></a>00611                         <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#bbf95aad74d847cd4bcb129604f798cd">LOG_NOTICE</a>, <span class="stringliteral">"Truncating long caller ID number from %d bytes to 32\n"</span>, cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x]);
<a name="l00612"></a>00612                         res = 32; 
<a name="l00613"></a>00613                      }
<a name="l00614"></a>00614                      <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(cid-&gt;<a class="code" href="structcallerid__state.html#6637d404fc35915f0682f7f9135fa832">number</a>)) {
<a name="l00615"></a>00615                         memcpy(cid-&gt;<a class="code" href="structcallerid__state.html#6637d404fc35915f0682f7f9135fa832">number</a>, cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a> + x + 1, res);
<a name="l00616"></a>00616                         <span class="comment">/* Null terminate */</span>
<a name="l00617"></a>00617                         cid-&gt;<a class="code" href="structcallerid__state.html#6637d404fc35915f0682f7f9135fa832">number</a>[res] = <span class="charliteral">'\0'</span>;
<a name="l00618"></a>00618                      }
<a name="l00619"></a>00619                      <span class="keywordflow">break</span>;
<a name="l00620"></a>00620                   <span class="keywordflow">case</span> 6: <span class="comment">/* Stentor Call Qualifier (ie. Long Distance call) */</span>
<a name="l00621"></a>00621                      <span class="keywordflow">break</span>;
<a name="l00622"></a>00622                   <span class="keywordflow">case</span> 7: <span class="comment">/* Name */</span>
<a name="l00623"></a>00623                   <span class="keywordflow">case</span> 8: <span class="comment">/* Name */</span>
<a name="l00624"></a>00624                      res = cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x];
<a name="l00625"></a>00625                      <span class="keywordflow">if</span> (res &gt; 32) {
<a name="l00626"></a>00626                         <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#bbf95aad74d847cd4bcb129604f798cd">LOG_NOTICE</a>, <span class="stringliteral">"Truncating long caller ID name from %d bytes to 32\n"</span>, cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x]);
<a name="l00627"></a>00627                         res = 32; 
<a name="l00628"></a>00628                      }
<a name="l00629"></a>00629                      memcpy(cid-&gt;<a class="code" href="structcallerid__state.html#275f6727040426992bb1c8e247d38cde">name</a>, cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a> + x + 1, res);
<a name="l00630"></a>00630                      cid-&gt;<a class="code" href="structcallerid__state.html#275f6727040426992bb1c8e247d38cde">name</a>[res] = <span class="charliteral">'\0'</span>;
<a name="l00631"></a>00631                      <span class="keywordflow">break</span>;
<a name="l00632"></a>00632                   <span class="keywordflow">case</span> 17: <span class="comment">/* UK: Call type, 1=Voice Call, 2=Ringback when free, 129=Message waiting  */</span>
<a name="l00633"></a>00633                   <span class="keywordflow">case</span> 19: <span class="comment">/* UK: Network message system status (Number of messages waiting) */</span>
<a name="l00634"></a>00634                   <span class="keywordflow">case</span> 22: <span class="comment">/* Something French */</span>
<a name="l00635"></a>00635                      <span class="keywordflow">break</span>;
<a name="l00636"></a>00636                   <span class="keywordflow">default</span>:
<a name="l00637"></a>00637                      <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#bbf95aad74d847cd4bcb129604f798cd">LOG_NOTICE</a>, <span class="stringliteral">"Unknown IE %d\n"</span>, cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x - 1]);
<a name="l00638"></a>00638                   }
<a name="l00639"></a>00639                   <span class="keywordflow">if</span>(0 &gt; cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x]){   <span class="comment">/* Negative offset in the CID Spill */</span>
<a name="l00640"></a>00640                      <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#bbf95aad74d847cd4bcb129604f798cd">LOG_NOTICE</a>, <span class="stringliteral">"IE %d has bad field length of %d at offset %d\n"</span>, cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x-1], cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x], x);
<a name="l00641"></a>00641                      <span class="comment">/* Try again */</span>
<a name="l00642"></a>00642                      cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a> = 0;
<a name="l00643"></a>00643                      <span class="keywordflow">break</span>;   <span class="comment">/* Exit the loop */</span>
<a name="l00644"></a>00644                   }
<a name="l00645"></a>00645                   x += cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x];
<a name="l00646"></a>00646                   x++;
<a name="l00647"></a>00647                }
<a name="l00648"></a>00648             } <span class="keywordflow">else</span> {
<a name="l00649"></a>00649                <span class="comment">/* SDMF */</span>
<a name="l00650"></a>00650                ast_copy_string(cid-&gt;<a class="code" href="structcallerid__state.html#6637d404fc35915f0682f7f9135fa832">number</a>, cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a> + 8, <span class="keyword">sizeof</span>(cid-&gt;<a class="code" href="structcallerid__state.html#6637d404fc35915f0682f7f9135fa832">number</a>));
<a name="l00651"></a>00651             }
<a name="l00652"></a>00652             <span class="comment">/* Update flags */</span>
<a name="l00653"></a>00653             cid-&gt;<a class="code" href="structcallerid__state.html#4e5868d676cb634aa75b125a0f741abf">flags</a> = 0;
<a name="l00654"></a>00654             <span class="keywordflow">if</span> (!strcmp(cid-&gt;<a class="code" href="structcallerid__state.html#6637d404fc35915f0682f7f9135fa832">number</a>, <span class="stringliteral">"P"</span>)) {
<a name="l00655"></a>00655                strcpy(cid-&gt;<a class="code" href="structcallerid__state.html#6637d404fc35915f0682f7f9135fa832">number</a>, <span class="stringliteral">""</span>);
<a name="l00656"></a>00656                cid-&gt;<a class="code" href="structcallerid__state.html#4e5868d676cb634aa75b125a0f741abf">flags</a> |= <a class="code" href="callerid_8h.html#00fd589a9ffae3b6d6c7da30890daa0a">CID_PRIVATE_NUMBER</a>;
<a name="l00657"></a>00657             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(cid-&gt;<a class="code" href="structcallerid__state.html#6637d404fc35915f0682f7f9135fa832">number</a>, <span class="stringliteral">"O"</span>) || <a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(cid-&gt;<a class="code" href="structcallerid__state.html#6637d404fc35915f0682f7f9135fa832">number</a>)) {
<a name="l00658"></a>00658                strcpy(cid-&gt;<a class="code" href="structcallerid__state.html#6637d404fc35915f0682f7f9135fa832">number</a>, <span class="stringliteral">""</span>);
<a name="l00659"></a>00659                cid-&gt;<a class="code" href="structcallerid__state.html#4e5868d676cb634aa75b125a0f741abf">flags</a> |= <a class="code" href="callerid_8h.html#78c6c6c6f4a6c300fe02c103cef4f3ae">CID_UNKNOWN_NUMBER</a>;
<a name="l00660"></a>00660             }
<a name="l00661"></a>00661             <span class="keywordflow">if</span> (!strcmp(cid-&gt;<a class="code" href="structcallerid__state.html#275f6727040426992bb1c8e247d38cde">name</a>, <span class="stringliteral">"P"</span>)) {
<a name="l00662"></a>00662                strcpy(cid-&gt;<a class="code" href="structcallerid__state.html#275f6727040426992bb1c8e247d38cde">name</a>, <span class="stringliteral">""</span>);
<a name="l00663"></a>00663                cid-&gt;<a class="code" href="structcallerid__state.html#4e5868d676cb634aa75b125a0f741abf">flags</a> |= <a class="code" href="callerid_8h.html#48a924990175b05c158aa6290b338339">CID_PRIVATE_NAME</a>;
<a name="l00664"></a>00664             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(cid-&gt;<a class="code" href="structcallerid__state.html#275f6727040426992bb1c8e247d38cde">name</a>, <span class="stringliteral">"O"</span>) || <a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(cid-&gt;<a class="code" href="structcallerid__state.html#275f6727040426992bb1c8e247d38cde">name</a>)) {
<a name="l00665"></a>00665                strcpy(cid-&gt;<a class="code" href="structcallerid__state.html#275f6727040426992bb1c8e247d38cde">name</a>, <span class="stringliteral">""</span>);
<a name="l00666"></a>00666                cid-&gt;<a class="code" href="structcallerid__state.html#4e5868d676cb634aa75b125a0f741abf">flags</a> |= <a class="code" href="callerid_8h.html#2c2ab622708c2cc279b0f58b2a6fed6d">CID_UNKNOWN_NAME</a>;
<a name="l00667"></a>00667             }
<a name="l00668"></a>00668             <span class="keywordflow">return</span> 1;
<a name="l00669"></a>00669             <span class="keywordflow">break</span>;
<a name="l00670"></a>00670          <span class="keywordflow">default</span>:
<a name="l00671"></a>00671             <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#4490aa3d29644e716440fada68f54032">LOG_ERROR</a>, <span class="stringliteral">"Dunno what to do with a digit in sawflag %d\n"</span>, cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a>);
<a name="l00672"></a>00672          }
<a name="l00673"></a>00673       }
<a name="l00674"></a>00674    }
<a name="l00675"></a>00675    <span class="keywordflow">if</span> (mylen) {
<a name="l00676"></a>00676       memcpy(cid-&gt;<a class="code" href="structcallerid__state.html#38fa166dfb1fe584c84f5513612926de">oldstuff</a>, buf, mylen * 2);
<a name="l00677"></a>00677       cid-&gt;<a class="code" href="structcallerid__state.html#d6b817146e45d00c0bd73642bf1cba72">oldlen</a> = mylen * 2;
<a name="l00678"></a>00678    } <span class="keywordflow">else</span>
<a name="l00679"></a>00679       cid-&gt;<a class="code" href="structcallerid__state.html#d6b817146e45d00c0bd73642bf1cba72">oldlen</a> = 0;
<a name="l00680"></a>00680 
<a name="l00681"></a>00681    <span class="keywordflow">return</span> 0;
<a name="l00682"></a>00682 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="33b24654dc443ae070e4c5598a01e47b"></a><!-- doxytag: member="callerid.c::callerid_feed_jp" ref="33b24654dc443ae070e4c5598a01e47b" args="(struct callerid_state *cid, unsigned char *ubuf, int len, int codec)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int callerid_feed_jp           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structcallerid__state.html">callerid_state</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>cid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned char *&nbsp;</td>
          <td class="mdname" nowrap> <em>ubuf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>samples</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>codec</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Read samples into the state machine. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cid</em>&nbsp;</td><td>Which state machine to act upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ubuf</em>&nbsp;</td><td>containing your samples </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>samples</em>&nbsp;</td><td>number of samples contained within the buffer. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>codec</em>&nbsp;</td><td>which codec (AST_FORMAT_ALAW or AST_FORMAT_ULAW)</td></tr>
  </table>
</dl>
Send received audio to the Caller*ID demodulator (for japanese style lines). <dl compact><dt><b>Returns:</b></dt><dd>Returns -1 on error, 0 for "needs more samples", and 1 if the CallerID spill reception is complete. </dd></dl>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00280">280</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="callerid_8h-source.html#l00064">AST_XLAW</a>, <a class="el" href="adsistub_8c-source.html#l00065">buf</a>, <a class="el" href="callerid_8c-source.html#l00257">calc_crc()</a>, <a class="el" href="callerid_8h-source.html#l00051">CID_UNKNOWN_NUMBER</a>, <a class="el" href="fskmodem_8c-source.html#l00222">fsk_serial()</a>, <a class="el" href="logger_8h-source.html#l00094">LOG_DEBUG</a>, <a class="el" href="logger_8h-source.html#l00118">LOG_ERROR</a>, <a class="el" href="logger_8h-source.html#l00106">LOG_NOTICE</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="asterisk_8c-source.html#l00164">option_debug</a>, and <a class="el" href="callerid_8c-source.html#l00053">callerid_state::pos</a>.
<p>
Referenced by <a class="el" href="chan__zap_8c-source.html#l05744">ss_thread()</a>.<div class="fragment"><pre class="fragment"><a name="l00281"></a>00281 {
<a name="l00282"></a>00282    <span class="keywordtype">int</span> mylen = <a class="code" href="utils_8h.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a>;
<a name="l00283"></a>00283    <span class="keywordtype">int</span> olen;
<a name="l00284"></a>00284    <span class="keywordtype">int</span> b = <span class="charliteral">'X'</span>;
<a name="l00285"></a>00285    <span class="keywordtype">int</span> b2;
<a name="l00286"></a>00286    <span class="keywordtype">int</span> res;
<a name="l00287"></a>00287    <span class="keywordtype">int</span> x;
<a name="l00288"></a>00288    <span class="keywordtype">short</span> *<a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>;
<a name="l00289"></a>00289 
<a name="l00290"></a>00290    buf = alloca(2 * <a class="code" href="utils_8h.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a> + cid-&gt;<a class="code" href="structcallerid__state.html#d6b817146e45d00c0bd73642bf1cba72">oldlen</a>);
<a name="l00291"></a>00291 
<a name="l00292"></a>00292    memcpy(buf, cid-&gt;<a class="code" href="structcallerid__state.html#38fa166dfb1fe584c84f5513612926de">oldstuff</a>, cid-&gt;<a class="code" href="structcallerid__state.html#d6b817146e45d00c0bd73642bf1cba72">oldlen</a>);
<a name="l00293"></a>00293    mylen += cid-&gt;<a class="code" href="structcallerid__state.html#d6b817146e45d00c0bd73642bf1cba72">oldlen</a> / 2;
<a name="l00294"></a>00294 
<a name="l00295"></a>00295    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="utils_8h.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a>; x++) 
<a name="l00296"></a>00296       buf[x+cid-&gt;<a class="code" href="structcallerid__state.html#d6b817146e45d00c0bd73642bf1cba72">oldlen</a>/2] = <a class="code" href="callerid_8h.html#822ff9241612072983832652a42f4ae2">AST_XLAW</a>(ubuf[x]);
<a name="l00297"></a>00297 
<a name="l00298"></a>00298    <span class="keywordflow">while</span> (mylen &gt;= 160) {
<a name="l00299"></a>00299       b = b2 = 0;
<a name="l00300"></a>00300       olen = mylen;
<a name="l00301"></a>00301       res = <a class="code" href="fskmodem_8c.html#64979a619b5b351568ce5b2c91f18df1">fsk_serial</a>(&amp;cid-&gt;<a class="code" href="structcallerid__state.html#d8e2c20684b44da85dd15ff343ca1713">fskd</a>, buf, &amp;mylen, &amp;b);
<a name="l00302"></a>00302 
<a name="l00303"></a>00303       <span class="keywordflow">if</span> (mylen &lt; 0) {
<a name="l00304"></a>00304          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#4490aa3d29644e716440fada68f54032">LOG_ERROR</a>, <span class="stringliteral">"fsk_serial made mylen &lt; 0 (%d)\n"</span>, mylen);
<a name="l00305"></a>00305          <span class="keywordflow">return</span> -1;
<a name="l00306"></a>00306       }
<a name="l00307"></a>00307 
<a name="l00308"></a>00308       buf += (olen - mylen);
<a name="l00309"></a>00309 
<a name="l00310"></a>00310       <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l00311"></a>00311          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#bbf95aad74d847cd4bcb129604f798cd">LOG_NOTICE</a>, <span class="stringliteral">"fsk_serial failed\n"</span>);
<a name="l00312"></a>00312          <span class="keywordflow">return</span> -1;
<a name="l00313"></a>00313       }
<a name="l00314"></a>00314 
<a name="l00315"></a>00315       <span class="keywordflow">if</span> (res == 1) {
<a name="l00316"></a>00316          b2 = b;
<a name="l00317"></a>00317          b  &amp;= 0x7f;
<a name="l00318"></a>00318 
<a name="l00319"></a>00319          <span class="comment">/* crc checksum calculation */</span>
<a name="l00320"></a>00320          <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a> &gt; 1)
<a name="l00321"></a>00321             cid-&gt;<a class="code" href="structcallerid__state.html#f5ad59c5401fea3f2df0703d958fdc97">crc</a> = <a class="code" href="callerid_8c.html#bbc2bac160508ff33fe80e066bcca0ee">calc_crc</a>(cid-&gt;<a class="code" href="structcallerid__state.html#f5ad59c5401fea3f2df0703d958fdc97">crc</a>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>) b2);
<a name="l00322"></a>00322 
<a name="l00323"></a>00323          <span class="comment">/* Ignore invalid bytes */</span>
<a name="l00324"></a>00324          <span class="keywordflow">if</span> (b &gt; 0xff)
<a name="l00325"></a>00325             <span class="keywordflow">continue</span>;
<a name="l00326"></a>00326 
<a name="l00327"></a>00327          <span class="comment">/* skip DLE if needed */</span>
<a name="l00328"></a>00328          <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a> &gt; 0) {
<a name="l00329"></a>00329             <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a> != 5 &amp;&amp; cid-&gt;<a class="code" href="structcallerid__state.html#b89db86002c76f7da5d2618b71742582">skipflag</a> == 0 &amp;&amp; b == 0x10) {
<a name="l00330"></a>00330                cid-&gt;<a class="code" href="structcallerid__state.html#b89db86002c76f7da5d2618b71742582">skipflag</a> = 1 ;
<a name="l00331"></a>00331                continue ;
<a name="l00332"></a>00332             }
<a name="l00333"></a>00333          }
<a name="l00334"></a>00334          <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structcallerid__state.html#b89db86002c76f7da5d2618b71742582">skipflag</a> == 1)
<a name="l00335"></a>00335             cid-&gt;<a class="code" href="structcallerid__state.html#b89db86002c76f7da5d2618b71742582">skipflag</a> = 0 ;
<a name="l00336"></a>00336 
<a name="l00337"></a>00337          <span class="comment">/* caller id retrieval */</span>
<a name="l00338"></a>00338          <span class="keywordflow">switch</span> (cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a>) {
<a name="l00339"></a>00339          <span class="keywordflow">case</span> 0: <span class="comment">/* DLE */</span>
<a name="l00340"></a>00340             <span class="keywordflow">if</span> (b == 0x10) {
<a name="l00341"></a>00341                cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a> = 1;
<a name="l00342"></a>00342                cid-&gt;<a class="code" href="structcallerid__state.html#b89db86002c76f7da5d2618b71742582">skipflag</a> = 0;
<a name="l00343"></a>00343                cid-&gt;<a class="code" href="structcallerid__state.html#f5ad59c5401fea3f2df0703d958fdc97">crc</a> = 0;
<a name="l00344"></a>00344             }
<a name="l00345"></a>00345             <span class="keywordflow">break</span>;
<a name="l00346"></a>00346          <span class="keywordflow">case</span> 1: <span class="comment">/* SOH */</span>
<a name="l00347"></a>00347             <span class="keywordflow">if</span> (b == 0x01) 
<a name="l00348"></a>00348                cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a> = 2;
<a name="l00349"></a>00349             break ;
<a name="l00350"></a>00350          <span class="keywordflow">case</span> 2: <span class="comment">/* HEADER */</span>
<a name="l00351"></a>00351             <span class="keywordflow">if</span> (b == 0x07) 
<a name="l00352"></a>00352                cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a> = 3;
<a name="l00353"></a>00353             <span class="keywordflow">break</span>;
<a name="l00354"></a>00354          <span class="keywordflow">case</span> 3: <span class="comment">/* STX */</span>
<a name="l00355"></a>00355             <span class="keywordflow">if</span> (b == 0x02) 
<a name="l00356"></a>00356                cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a> = 4;
<a name="l00357"></a>00357             <span class="keywordflow">break</span>;
<a name="l00358"></a>00358          <span class="keywordflow">case</span> 4: <span class="comment">/* SERVICE TYPE */</span>
<a name="l00359"></a>00359             <span class="keywordflow">if</span> (b == 0x40) 
<a name="l00360"></a>00360                cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a> = 5;
<a name="l00361"></a>00361             <span class="keywordflow">break</span>;
<a name="l00362"></a>00362          <span class="keywordflow">case</span> 5: <span class="comment">/* Frame Length */</span>
<a name="l00363"></a>00363             cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a> = 6;
<a name="l00364"></a>00364             <span class="keywordflow">break</span>;   
<a name="l00365"></a>00365          <span class="keywordflow">case</span> 6: <span class="comment">/* NUMBER TYPE */</span>
<a name="l00366"></a>00366             cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a> = 7;
<a name="l00367"></a>00367             cid-&gt;<a class="code" href="structcallerid__state.html#5e0bdcbddccca4d66d74ba8c1cee1a68">pos</a> = 0;
<a name="l00368"></a>00368             cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[cid-&gt;<a class="code" href="structcallerid__state.html#5e0bdcbddccca4d66d74ba8c1cee1a68">pos</a>++] = b;
<a name="l00369"></a>00369             <span class="keywordflow">break</span>;
<a name="l00370"></a>00370          <span class="keywordflow">case</span> 7:  <span class="comment">/* NUMBER LENGTH */</span>
<a name="l00371"></a>00371             cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a> = 8;
<a name="l00372"></a>00372             cid-&gt;<a class="code" href="structcallerid__state.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a> = b;
<a name="l00373"></a>00373             <span class="keywordflow">if</span> ((cid-&gt;<a class="code" href="structcallerid__state.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a>+2) &gt;= <span class="keyword">sizeof</span>(cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>)) {
<a name="l00374"></a>00374                <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"too long caller id string\n"</span>) ;
<a name="l00375"></a>00375                <span class="keywordflow">return</span> -1;
<a name="l00376"></a>00376             }
<a name="l00377"></a>00377             cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[cid-&gt;<a class="code" href="structcallerid__state.html#5e0bdcbddccca4d66d74ba8c1cee1a68">pos</a>++] = b;
<a name="l00378"></a>00378             <span class="keywordflow">break</span>;
<a name="l00379"></a>00379          <span class="keywordflow">case</span> 8:  <span class="comment">/* Retrieve message */</span>
<a name="l00380"></a>00380             cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[cid-&gt;<a class="code" href="structcallerid__state.html#5e0bdcbddccca4d66d74ba8c1cee1a68">pos</a>++] = b;
<a name="l00381"></a>00381             cid-&gt;<a class="code" href="structcallerid__state.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a>--;
<a name="l00382"></a>00382             <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structcallerid__state.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a>&lt;=0) {
<a name="l00383"></a>00383                cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[cid-&gt;<a class="code" href="structcallerid__state.html#5e0bdcbddccca4d66d74ba8c1cee1a68">pos</a>] = <span class="charliteral">'\0'</span>;
<a name="l00384"></a>00384                cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a> = 9;
<a name="l00385"></a>00385             }
<a name="l00386"></a>00386             <span class="keywordflow">break</span>;
<a name="l00387"></a>00387          <span class="keywordflow">case</span> 9:  <span class="comment">/* ETX */</span>
<a name="l00388"></a>00388             cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a> = 10;
<a name="l00389"></a>00389             <span class="keywordflow">break</span>;
<a name="l00390"></a>00390          <span class="keywordflow">case</span> 10: <span class="comment">/* CRC Checksum 1 */</span>
<a name="l00391"></a>00391             cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a> = 11;
<a name="l00392"></a>00392             <span class="keywordflow">break</span>;
<a name="l00393"></a>00393          <span class="keywordflow">case</span> 11: <span class="comment">/* CRC Checksum 2 */</span>
<a name="l00394"></a>00394             cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a> = 12;
<a name="l00395"></a>00395             <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structcallerid__state.html#f5ad59c5401fea3f2df0703d958fdc97">crc</a> != 0) {
<a name="l00396"></a>00396                <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"crc checksum error\n"</span>) ;
<a name="l00397"></a>00397                <span class="keywordflow">return</span> -1;
<a name="l00398"></a>00398             } 
<a name="l00399"></a>00399             <span class="comment">/* extract caller id data */</span>
<a name="l00400"></a>00400             <span class="keywordflow">for</span> (x = 0; x &lt; cid-&gt;pos;) {
<a name="l00401"></a>00401                <span class="keywordflow">switch</span> (cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x++]) {
<a name="l00402"></a>00402                <span class="keywordflow">case</span> 0x02: <span class="comment">/* caller id  number */</span>
<a name="l00403"></a>00403                   cid-&gt;<a class="code" href="structcallerid__state.html#6637d404fc35915f0682f7f9135fa832">number</a>[0] = <span class="charliteral">'\0'</span>;
<a name="l00404"></a>00404                   cid-&gt;<a class="code" href="structcallerid__state.html#275f6727040426992bb1c8e247d38cde">name</a>[0] = <span class="charliteral">'\0'</span>;
<a name="l00405"></a>00405                   cid-&gt;<a class="code" href="structcallerid__state.html#4e5868d676cb634aa75b125a0f741abf">flags</a> = 0;
<a name="l00406"></a>00406                   res = cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x++];
<a name="l00407"></a>00407                   ast_copy_string(cid-&gt;<a class="code" href="structcallerid__state.html#6637d404fc35915f0682f7f9135fa832">number</a>, &amp;cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x], res+1);
<a name="l00408"></a>00408                   x += res;
<a name="l00409"></a>00409                   <span class="keywordflow">break</span>;
<a name="l00410"></a>00410                <span class="keywordflow">case</span> 0x21: <span class="comment">/* additional information */</span>
<a name="l00411"></a>00411                   <span class="comment">/* length */</span>
<a name="l00412"></a>00412                   x++; 
<a name="l00413"></a>00413                   <span class="comment">/* number type */</span>
<a name="l00414"></a>00414                                     <span class="keywordflow">switch</span> (cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x]) { 
<a name="l00415"></a>00415                   <span class="keywordflow">case</span> 0x00: <span class="comment">/* unknown */</span>
<a name="l00416"></a>00416                   <span class="keywordflow">case</span> 0x01: <span class="comment">/* international number */</span>
<a name="l00417"></a>00417                   <span class="keywordflow">case</span> 0x02: <span class="comment">/* domestic number */</span>
<a name="l00418"></a>00418                   <span class="keywordflow">case</span> 0x03: <span class="comment">/* network */</span>
<a name="l00419"></a>00419                   <span class="keywordflow">case</span> 0x04: <span class="comment">/* local call */</span>
<a name="l00420"></a>00420                   <span class="keywordflow">case</span> 0x06: <span class="comment">/* short dial number */</span>
<a name="l00421"></a>00421                   <span class="keywordflow">case</span> 0x07: <span class="comment">/* reserved */</span>
<a name="l00422"></a>00422                   <span class="keywordflow">default</span>:   <span class="comment">/* reserved */</span>
<a name="l00423"></a>00423                      <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a> &gt; 1)
<a name="l00424"></a>00424                         <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"cid info:#1=%X\n"</span>, cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x]);
<a name="l00425"></a>00425                      break ;
<a name="l00426"></a>00426                   }
<a name="l00427"></a>00427                   x++; 
<a name="l00428"></a>00428                   <span class="comment">/* numbering plan octed 4 */</span>
<a name="l00429"></a>00429                   x++; 
<a name="l00430"></a>00430                   <span class="comment">/* numbering plan octed 5 */</span>
<a name="l00431"></a>00431                   <span class="keywordflow">switch</span> (cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x]) { 
<a name="l00432"></a>00432                   <span class="keywordflow">case</span> 0x00: <span class="comment">/* unknown */</span>
<a name="l00433"></a>00433                   <span class="keywordflow">case</span> 0x01: <span class="comment">/* recommendation E.164 ISDN */</span>
<a name="l00434"></a>00434                   <span class="keywordflow">case</span> 0x03: <span class="comment">/* recommendation X.121 */</span>
<a name="l00435"></a>00435                   <span class="keywordflow">case</span> 0x04: <span class="comment">/* telex dial plan */</span>
<a name="l00436"></a>00436                   <span class="keywordflow">case</span> 0x08: <span class="comment">/* domestic dial plan */</span>
<a name="l00437"></a>00437                   <span class="keywordflow">case</span> 0x09: <span class="comment">/* private dial plan */</span>
<a name="l00438"></a>00438                   <span class="keywordflow">case</span> 0x05: <span class="comment">/* reserved */</span>
<a name="l00439"></a>00439                   <span class="keywordflow">default</span>:   <span class="comment">/* reserved */</span>
<a name="l00440"></a>00440                      <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a> &gt; 1)
<a name="l00441"></a>00441                         <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"cid info:#2=%X\n"</span>, cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x]);
<a name="l00442"></a>00442                      break ;
<a name="l00443"></a>00443                   }
<a name="l00444"></a>00444                   x++; 
<a name="l00445"></a>00445                   break ;
<a name="l00446"></a>00446                <span class="keywordflow">case</span> 0x04: <span class="comment">/* no callerid reason */</span>
<a name="l00447"></a>00447                   <span class="comment">/* length */</span>
<a name="l00448"></a>00448                   x++; 
<a name="l00449"></a>00449                   <span class="comment">/* no callerid reason code */</span>
<a name="l00450"></a>00450                   <span class="keywordflow">switch</span> (cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x]) {
<a name="l00451"></a>00451                   <span class="keywordflow">case</span> <span class="charliteral">'P'</span>: <span class="comment">/* caller id denied by user */</span>
<a name="l00452"></a>00452                   <span class="keywordflow">case</span> <span class="charliteral">'O'</span>: <span class="comment">/* service not available */</span>
<a name="l00453"></a>00453                   <span class="keywordflow">case</span> <span class="charliteral">'C'</span>: <span class="comment">/* pay phone */</span>
<a name="l00454"></a>00454                   <span class="keywordflow">case</span> <span class="charliteral">'S'</span>: <span class="comment">/* service congested */</span>
<a name="l00455"></a>00455                                     cid-&gt;<a class="code" href="structcallerid__state.html#4e5868d676cb634aa75b125a0f741abf">flags</a> |= <a class="code" href="callerid_8h.html#78c6c6c6f4a6c300fe02c103cef4f3ae">CID_UNKNOWN_NUMBER</a>;
<a name="l00456"></a>00456                      <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a> &gt; 1)
<a name="l00457"></a>00457                         <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"no cid reason:%c\n"</span>,cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x]);
<a name="l00458"></a>00458                      break ;
<a name="l00459"></a>00459                   }
<a name="l00460"></a>00460                   x++; 
<a name="l00461"></a>00461                   break ;
<a name="l00462"></a>00462                <span class="keywordflow">case</span> 0x09: <span class="comment">/* dialed number */</span>
<a name="l00463"></a>00463                   <span class="comment">/* length */</span>
<a name="l00464"></a>00464                   res = cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x++];
<a name="l00465"></a>00465                   <span class="comment">/* dialed number */</span>
<a name="l00466"></a>00466                   x += res;
<a name="l00467"></a>00467                   break ;
<a name="l00468"></a>00468                <span class="keywordflow">case</span> 0x22: <span class="comment">/* dialed number additional information */</span>
<a name="l00469"></a>00469                   <span class="comment">/* length */</span>
<a name="l00470"></a>00470                   x++;
<a name="l00471"></a>00471                   <span class="comment">/* number type */</span>
<a name="l00472"></a>00472                   <span class="keywordflow">switch</span> (cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x]) {
<a name="l00473"></a>00473                   <span class="keywordflow">case</span> 0x00: <span class="comment">/* unknown */</span>
<a name="l00474"></a>00474                   <span class="keywordflow">case</span> 0x01: <span class="comment">/* international number */</span>
<a name="l00475"></a>00475                   <span class="keywordflow">case</span> 0x02: <span class="comment">/* domestic number */</span>
<a name="l00476"></a>00476                   <span class="keywordflow">case</span> 0x03: <span class="comment">/* network */</span>
<a name="l00477"></a>00477                   <span class="keywordflow">case</span> 0x04: <span class="comment">/* local call */</span>
<a name="l00478"></a>00478                   <span class="keywordflow">case</span> 0x06: <span class="comment">/* short dial number */</span>
<a name="l00479"></a>00479                   <span class="keywordflow">case</span> 0x07: <span class="comment">/* reserved */</span>
<a name="l00480"></a>00480                   <span class="keywordflow">default</span>:   <span class="comment">/* reserved */</span>
<a name="l00481"></a>00481                      <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a> &gt; 1)
<a name="l00482"></a>00482                         <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#bbf95aad74d847cd4bcb129604f798cd">LOG_NOTICE</a>, <span class="stringliteral">"did info:#1=%X\n"</span>, cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x]);
<a name="l00483"></a>00483                      break ;
<a name="l00484"></a>00484                   }
<a name="l00485"></a>00485                   x++;
<a name="l00486"></a>00486                   <span class="comment">/* numbering plan octed 4 */</span>
<a name="l00487"></a>00487                   x++;
<a name="l00488"></a>00488                                        <span class="comment">/* numbering plan octed 5 */</span>
<a name="l00489"></a>00489                   <span class="keywordflow">switch</span> (cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x]) {
<a name="l00490"></a>00490                   <span class="keywordflow">case</span> 0x00: <span class="comment">/* unknown */</span>
<a name="l00491"></a>00491                   <span class="keywordflow">case</span> 0x01: <span class="comment">/* recommendation E.164 ISDN */</span>
<a name="l00492"></a>00492                   <span class="keywordflow">case</span> 0x03: <span class="comment">/* recommendation X.121 */</span>
<a name="l00493"></a>00493                   <span class="keywordflow">case</span> 0x04: <span class="comment">/* telex dial plan */</span>
<a name="l00494"></a>00494                   <span class="keywordflow">case</span> 0x08: <span class="comment">/* domestic dial plan */</span>
<a name="l00495"></a>00495                   <span class="keywordflow">case</span> 0x09: <span class="comment">/* private dial plan */</span>
<a name="l00496"></a>00496                   <span class="keywordflow">case</span> 0x05: <span class="comment">/* reserved */</span>
<a name="l00497"></a>00497                   <span class="keywordflow">default</span>:   <span class="comment">/* reserved */</span>
<a name="l00498"></a>00498                      <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a> &gt; 1)
<a name="l00499"></a>00499                         <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"did info:#2=%X\n"</span>, cid-&gt;<a class="code" href="structcallerid__state.html#d3cd69f966f3ecdf985ddf6ff1284c90">rawdata</a>[x]);
<a name="l00500"></a>00500                      break ;
<a name="l00501"></a>00501                   }
<a name="l00502"></a>00502                   x++;
<a name="l00503"></a>00503                   break ;
<a name="l00504"></a>00504                }
<a name="l00505"></a>00505             }
<a name="l00506"></a>00506             <span class="keywordflow">return</span> 1;
<a name="l00507"></a>00507             <span class="keywordflow">break</span>;
<a name="l00508"></a>00508          <span class="keywordflow">default</span>:
<a name="l00509"></a>00509             <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#4490aa3d29644e716440fada68f54032">LOG_ERROR</a>, <span class="stringliteral">"invalid value in sawflag %d\n"</span>, cid-&gt;<a class="code" href="structcallerid__state.html#c0bb1262946695451480f1bebf34d9a2">sawflag</a>);
<a name="l00510"></a>00510          }
<a name="l00511"></a>00511       }
<a name="l00512"></a>00512    }
<a name="l00513"></a>00513    <span class="keywordflow">if</span> (mylen) {
<a name="l00514"></a>00514       memcpy(cid-&gt;<a class="code" href="structcallerid__state.html#38fa166dfb1fe584c84f5513612926de">oldstuff</a>, buf, mylen * 2);
<a name="l00515"></a>00515       cid-&gt;<a class="code" href="structcallerid__state.html#d6b817146e45d00c0bd73642bf1cba72">oldlen</a> = mylen * 2;
<a name="l00516"></a>00516    } <span class="keywordflow">else</span>
<a name="l00517"></a>00517       cid-&gt;<a class="code" href="structcallerid__state.html#d6b817146e45d00c0bd73642bf1cba72">oldlen</a> = 0;
<a name="l00518"></a>00518    
<a name="l00519"></a>00519    <span class="keywordflow">return</span> 0;
<a name="l00520"></a>00520 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="deb8687df148e1a6dfbe0bec57093781"></a><!-- doxytag: member="callerid.c::callerid_free" ref="deb8687df148e1a6dfbe0bec57093781" args="(struct callerid_state *cid)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void callerid_free           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structcallerid__state.html">callerid_state</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>cid</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Free a callerID state. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cid</em>&nbsp;</td><td>This is the <a class="el" href="structcallerid__state.html">callerid_state</a> state machine to free This function frees <a class="el" href="structcallerid__state.html">callerid_state</a> cid. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00684">684</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="astmm_8h-source.html#l00069">free</a>.
<p>
Referenced by <a class="el" href="chan__zap_8c-source.html#l05744">ss_thread()</a>.<div class="fragment"><pre class="fragment"><a name="l00685"></a>00685 {
<a name="l00686"></a>00686    <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(cid);
<a name="l00687"></a>00687 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="1d65bfd593c05fbc8a022082e8ec4129"></a><!-- doxytag: member="callerid.c::callerid_generate" ref="1d65bfd593c05fbc8a022082e8ec4129" args="(unsigned char *buf, const char *number, const char *name, int flags, int callwaiting, int codec)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int callerid_generate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned char *&nbsp;</td>
          <td class="mdname" nowrap> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>number</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>callwaiting</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>codec</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Generates a CallerID FSK stream in ulaw format suitable for transmission. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>Buffer to use. If "buf" is supplied, it will use that buffer instead of allocating its own. "buf" must be at least 32000 bytes in size of you want to be sure you don't have an overrun. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>number</em>&nbsp;</td><td>Use NULL for no number or "P" for "private" </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>name to be used </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flags</em>&nbsp;</td><td>passed flags </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callwaiting</em>&nbsp;</td><td>callwaiting flag </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>codec</em>&nbsp;</td><td>-- either AST_FORMAT_ULAW or AST_FORMAT_ALAW This function creates a stream of callerid (a callerid spill) data in ulaw format. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>It returns the size (in bytes) of the data (if it returns a size of 0, there is probably an error) </dd></dl>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00824">824</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="callerid_8c-source.html#l00689">callerid_genmsg()</a>, <a class="el" href="adsistub_8c-source.html#l00061">msg</a>, <a class="el" href="tdd_8c-source.html#l00215">PUT_BYTE</a>, <a class="el" href="callerid_8h-source.html#l00260">PUT_CLID</a>, and <a class="el" href="callerid_8h-source.html#l00245">PUT_CLID_MARKMS</a>.
<p>
Referenced by <a class="el" href="callerid_8c-source.html#l00987">__ast_callerid_generate()</a>.<div class="fragment"><pre class="fragment"><a name="l00825"></a>00825 {
<a name="l00826"></a>00826    <span class="keywordtype">int</span> bytes=0;
<a name="l00827"></a>00827    <span class="keywordtype">int</span> x, sum;
<a name="l00828"></a>00828    <span class="keywordtype">int</span> <a class="code" href="utils_8h.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a>;
<a name="l00829"></a>00829 
<a name="l00830"></a>00830    <span class="comment">/* Initial carriers (real/imaginary) */</span>
<a name="l00831"></a>00831    <span class="keywordtype">float</span> cr = 1.0;
<a name="l00832"></a>00832    <span class="keywordtype">float</span> ci = 0.0;
<a name="l00833"></a>00833    <span class="keywordtype">float</span> scont = 0.0;
<a name="l00834"></a>00834    <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>[256];
<a name="l00835"></a>00835    len = <a class="code" href="callerid_8c.html#b548bf641c356128d38e3fea7ed6b09e">callerid_genmsg</a>(msg, <span class="keyword">sizeof</span>(msg), <a class="code" href="structnumber.html">number</a>, <a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>, flags);
<a name="l00836"></a>00836    <span class="keywordflow">if</span> (!<a class="code" href="chan__mgcp_8c.html#9127a4950ee5e071d3683ff9d7ba9148">callwaiting</a>) {
<a name="l00837"></a>00837       <span class="comment">/* Wait a half a second */</span>
<a name="l00838"></a>00838       <span class="keywordflow">for</span> (x = 0; x &lt; 4000; x++)
<a name="l00839"></a>00839          <a class="code" href="tdd_8c.html#ff20fbac5dd67c2bde3f51891f3068dd">PUT_BYTE</a>(0x7f);
<a name="l00840"></a>00840       <span class="comment">/* Transmit 30 0x55's (looks like a square wave) for channel seizure */</span>
<a name="l00841"></a>00841       <span class="keywordflow">for</span> (x = 0; x &lt; 30; x++)
<a name="l00842"></a>00842          <a class="code" href="callerid_8h.html#e8be13cde80709083b4ea8ab655611a9">PUT_CLID</a>(0x55);
<a name="l00843"></a>00843    }
<a name="l00844"></a>00844    <span class="comment">/* Send 150ms of callerid marks */</span>
<a name="l00845"></a>00845    <span class="keywordflow">for</span> (x = 0; x &lt; 150; x++)
<a name="l00846"></a>00846       <a class="code" href="callerid_8h.html#c7d9a0aeae66e15307d9e8af1f444867">PUT_CLID_MARKMS</a>;
<a name="l00847"></a>00847    <span class="comment">/* Send 0x80 indicating MDMF format */</span>
<a name="l00848"></a>00848    <a class="code" href="callerid_8h.html#e8be13cde80709083b4ea8ab655611a9">PUT_CLID</a>(0x80);
<a name="l00849"></a>00849    <span class="comment">/* Put length of whole message */</span>
<a name="l00850"></a>00850    <a class="code" href="callerid_8h.html#e8be13cde80709083b4ea8ab655611a9">PUT_CLID</a>(len);
<a name="l00851"></a>00851    sum = 0x80 + strlen(msg);
<a name="l00852"></a>00852    <span class="comment">/* Put each character of message and update checksum */</span>
<a name="l00853"></a>00853    <span class="keywordflow">for</span> (x = 0; x &lt; len; x++) {
<a name="l00854"></a>00854       <a class="code" href="callerid_8h.html#e8be13cde80709083b4ea8ab655611a9">PUT_CLID</a>(msg[x]);
<a name="l00855"></a>00855       sum += msg[x];
<a name="l00856"></a>00856    }
<a name="l00857"></a>00857    <span class="comment">/* Send 2's compliment of sum */</span>
<a name="l00858"></a>00858    <a class="code" href="callerid_8h.html#e8be13cde80709083b4ea8ab655611a9">PUT_CLID</a>(256 - (sum &amp; 255));
<a name="l00859"></a>00859 
<a name="l00860"></a>00860    <span class="comment">/* Send 50 more ms of marks */</span>
<a name="l00861"></a>00861    <span class="keywordflow">for</span> (x = 0; x &lt; 50; x++)
<a name="l00862"></a>00862       <a class="code" href="callerid_8h.html#c7d9a0aeae66e15307d9e8af1f444867">PUT_CLID_MARKMS</a>;
<a name="l00863"></a>00863    
<a name="l00864"></a>00864    <span class="keywordflow">return</span> bytes;
<a name="l00865"></a>00865 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b548bf641c356128d38e3fea7ed6b09e"></a><!-- doxytag: member="callerid.c::callerid_genmsg" ref="b548bf641c356128d38e3fea7ed6b09e" args="(char *msg, int size, const char *number, const char *name, int flags)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int callerid_genmsg           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>number</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>flags</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00689">689</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="callerid_8h-source.html#l00048">CID_PRIVATE_NAME</a>, <a class="el" href="callerid_8h-source.html#l00049">CID_PRIVATE_NUMBER</a>, <a class="el" href="callerid_8h-source.html#l00050">CID_UNKNOWN_NAME</a>, and <a class="el" href="callerid_8h-source.html#l00051">CID_UNKNOWN_NUMBER</a>.
<p>
Referenced by <a class="el" href="callerid_8c-source.html#l00824">callerid_generate()</a>.<div class="fragment"><pre class="fragment"><a name="l00690"></a>00690 {
<a name="l00691"></a>00691    time_t t;
<a name="l00692"></a>00692    <span class="keyword">struct </span>tm tm;
<a name="l00693"></a>00693    <span class="keywordtype">char</span> *ptr;
<a name="l00694"></a>00694    <span class="keywordtype">int</span> res;
<a name="l00695"></a>00695    <span class="keywordtype">int</span> i, x;
<a name="l00696"></a>00696 
<a name="l00697"></a>00697    <span class="comment">/* Get the time */</span>
<a name="l00698"></a>00698    time(&amp;t);
<a name="l00699"></a>00699    localtime_r(&amp;t,&amp;tm);
<a name="l00700"></a>00700    
<a name="l00701"></a>00701    ptr = <a class="code" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>;
<a name="l00702"></a>00702    
<a name="l00703"></a>00703    <span class="comment">/* Format time and message header */</span>
<a name="l00704"></a>00704    res = snprintf(ptr, size, <span class="stringliteral">"\001\010%02d%02d%02d%02d"</span>, tm.tm_mon + 1,
<a name="l00705"></a>00705             tm.tm_mday, tm.tm_hour, tm.tm_min);
<a name="l00706"></a>00706    size -= res;
<a name="l00707"></a>00707    ptr += res;
<a name="l00708"></a>00708    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(<a class="code" href="structnumber.html">number</a>) || (flags &amp; <a class="code" href="callerid_8h.html#78c6c6c6f4a6c300fe02c103cef4f3ae">CID_UNKNOWN_NUMBER</a>)) {
<a name="l00709"></a>00709       <span class="comment">/* Indicate number not known */</span>
<a name="l00710"></a>00710       res = snprintf(ptr, size, <span class="stringliteral">"\004\001O"</span>);
<a name="l00711"></a>00711       size -= res;
<a name="l00712"></a>00712       ptr += res;
<a name="l00713"></a>00713    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flags &amp; <a class="code" href="callerid_8h.html#00fd589a9ffae3b6d6c7da30890daa0a">CID_PRIVATE_NUMBER</a>) {
<a name="l00714"></a>00714       <span class="comment">/* Indicate number is private */</span>
<a name="l00715"></a>00715       res = snprintf(ptr, size, <span class="stringliteral">"\004\001P"</span>);
<a name="l00716"></a>00716       size -= res;
<a name="l00717"></a>00717       ptr += res;
<a name="l00718"></a>00718    } <span class="keywordflow">else</span> {
<a name="l00719"></a>00719       <span class="comment">/* Send up to 16 digits of number MAX */</span>
<a name="l00720"></a>00720       i = strlen(<a class="code" href="structnumber.html">number</a>);
<a name="l00721"></a>00721       <span class="keywordflow">if</span> (i &gt; 16)
<a name="l00722"></a>00722          i = 16;
<a name="l00723"></a>00723       res = snprintf(ptr, size, <span class="stringliteral">"\002%c"</span>, i);
<a name="l00724"></a>00724       size -= res;
<a name="l00725"></a>00725       ptr += res;
<a name="l00726"></a>00726       <span class="keywordflow">for</span> (x = 0; x &lt; i; x++)
<a name="l00727"></a>00727          ptr[x] = <a class="code" href="structnumber.html">number</a>[x];
<a name="l00728"></a>00728       ptr[i] = <span class="charliteral">'\0'</span>;
<a name="l00729"></a>00729       ptr += i;
<a name="l00730"></a>00730       size -= i;
<a name="l00731"></a>00731    }
<a name="l00732"></a>00732 
<a name="l00733"></a>00733    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>) || (flags &amp; <a class="code" href="callerid_8h.html#2c2ab622708c2cc279b0f58b2a6fed6d">CID_UNKNOWN_NAME</a>)) {
<a name="l00734"></a>00734       <span class="comment">/* Indicate name not known */</span>
<a name="l00735"></a>00735       res = snprintf(ptr, size, <span class="stringliteral">"\010\001O"</span>);
<a name="l00736"></a>00736       size -= res;
<a name="l00737"></a>00737       ptr += res;
<a name="l00738"></a>00738    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flags &amp; <a class="code" href="callerid_8h.html#48a924990175b05c158aa6290b338339">CID_PRIVATE_NAME</a>) {
<a name="l00739"></a>00739       <span class="comment">/* Indicate name is private */</span>
<a name="l00740"></a>00740       res = snprintf(ptr, size, <span class="stringliteral">"\010\001P"</span>);
<a name="l00741"></a>00741       size -= res;
<a name="l00742"></a>00742       ptr += res;
<a name="l00743"></a>00743    } <span class="keywordflow">else</span> {
<a name="l00744"></a>00744       <span class="comment">/* Send up to 16 digits of name MAX */</span>
<a name="l00745"></a>00745       i = strlen(<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>);
<a name="l00746"></a>00746       <span class="keywordflow">if</span> (i &gt; 16)
<a name="l00747"></a>00747          i = 16;
<a name="l00748"></a>00748       res = snprintf(ptr, size, <span class="stringliteral">"\007%c"</span>, i);
<a name="l00749"></a>00749       size -= res;
<a name="l00750"></a>00750       ptr += res;
<a name="l00751"></a>00751       <span class="keywordflow">for</span> (x = 0; x &lt; i; x++)
<a name="l00752"></a>00752          ptr[x] = <a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>[x];
<a name="l00753"></a>00753       ptr[i] = <span class="charliteral">'\0'</span>;
<a name="l00754"></a>00754       ptr += i;
<a name="l00755"></a>00755       size -= i;
<a name="l00756"></a>00756    }
<a name="l00757"></a>00757    <span class="keywordflow">return</span> (ptr - <a class="code" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>);
<a name="l00758"></a>00758    
<a name="l00759"></a>00759 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b14e7cd98202576513db6f74ad84e283"></a><!-- doxytag: member="callerid.c::callerid_get" ref="b14e7cd98202576513db6f74ad84e283" args="(struct callerid_state *cid, char **name, char **number, int *flags)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void callerid_get           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structcallerid__state.html">callerid_state</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>cid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char **&nbsp;</td>
          <td class="mdname" nowrap> <em>number</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char **&nbsp;</td>
          <td class="mdname" nowrap> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>flags</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Extract info out of callerID state machine. Flags are listed above. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cid</em>&nbsp;</td><td>Callerid state machine to act upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>number</em>&nbsp;</td><td>Pass the address of a pointer-to-char (will contain the phone number) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>Pass the address of a pointer-to-char (will contain the name) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flags</em>&nbsp;</td><td>Pass the address of an int variable(will contain the various callerid flags)</td></tr>
  </table>
</dl>
This function extracts a callerid string out of a <a class="el" href="structcallerid__state.html">callerid_state</a> state machine. If no number is found, *number will be set to NULL. Likewise for the name. Flags can contain any of the following:<p>
<dl compact><dt><b>Returns:</b></dt><dd>Returns nothing. </dd></dl>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00161">161</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="callerid_8h-source.html#l00048">CID_PRIVATE_NAME</a>, <a class="el" href="callerid_8h-source.html#l00049">CID_PRIVATE_NUMBER</a>, <a class="el" href="callerid_8h-source.html#l00050">CID_UNKNOWN_NAME</a>, <a class="el" href="callerid_8h-source.html#l00051">CID_UNKNOWN_NUMBER</a>, <a class="el" href="callerid_8c-source.html#l00058">callerid_state::flags</a>, <a class="el" href="callerid_8c-source.html#l00056">callerid_state::name</a>, and <a class="el" href="callerid_8c-source.html#l00057">callerid_state::number</a>.
<p>
Referenced by <a class="el" href="chan__zap_8c-source.html#l05744">ss_thread()</a>.<div class="fragment"><pre class="fragment"><a name="l00162"></a>00162 {
<a name="l00163"></a>00163    *flags = cid-&gt;<a class="code" href="structcallerid__state.html#4e5868d676cb634aa75b125a0f741abf">flags</a>;
<a name="l00164"></a>00164    <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structcallerid__state.html#4e5868d676cb634aa75b125a0f741abf">flags</a> &amp; (<a class="code" href="callerid_8h.html#2c2ab622708c2cc279b0f58b2a6fed6d">CID_UNKNOWN_NAME</a> | <a class="code" href="callerid_8h.html#48a924990175b05c158aa6290b338339">CID_PRIVATE_NAME</a>))
<a name="l00165"></a>00165       *<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a> = NULL;
<a name="l00166"></a>00166    <span class="keywordflow">else</span>
<a name="l00167"></a>00167       *<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a> = cid-&gt;<a class="code" href="structcallerid__state.html#275f6727040426992bb1c8e247d38cde">name</a>;
<a name="l00168"></a>00168    <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structcallerid__state.html#4e5868d676cb634aa75b125a0f741abf">flags</a> &amp; (<a class="code" href="callerid_8h.html#78c6c6c6f4a6c300fe02c103cef4f3ae">CID_UNKNOWN_NUMBER</a> | <a class="code" href="callerid_8h.html#00fd589a9ffae3b6d6c7da30890daa0a">CID_PRIVATE_NUMBER</a>))
<a name="l00169"></a>00169       *<a class="code" href="structnumber.html">number</a> = NULL;
<a name="l00170"></a>00170    <span class="keywordflow">else</span>
<a name="l00171"></a>00171       *<a class="code" href="structnumber.html">number</a> = cid-&gt;<a class="code" href="structcallerid__state.html#6637d404fc35915f0682f7f9135fa832">number</a>;
<a name="l00172"></a>00172 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="c82cccec22b0d6aeffaa50dbc4a9f345"></a><!-- doxytag: member="callerid.c::callerid_get_dtmf" ref="c82cccec22b0d6aeffaa50dbc4a9f345" args="(char *cidstring, char *number, int *flags)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void callerid_get_dtmf           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>cidstring</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>number</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>flags</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cidstring</em>&nbsp;</td><td>The actual transmitted string. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>number</em>&nbsp;</td><td>The cid number is returned here. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flags</em>&nbsp;</td><td>The cid flags are returned here. This function parses DTMF callerid. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00174">174</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="callerid_8h-source.html#l00049">CID_PRIVATE_NUMBER</a>, <a class="el" href="callerid_8h-source.html#l00051">CID_UNKNOWN_NUMBER</a>, <a class="el" href="logger_8h-source.html#l00094">LOG_DEBUG</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, and <a class="el" href="asterisk_8c-source.html#l00164">option_debug</a>.
<p>
Referenced by <a class="el" href="chan__zap_8c-source.html#l05744">ss_thread()</a>.<div class="fragment"><pre class="fragment"><a name="l00175"></a>00175 {
<a name="l00176"></a>00176    <span class="keywordtype">int</span> i;
<a name="l00177"></a>00177    <span class="keywordtype">int</span> code;
<a name="l00178"></a>00178 
<a name="l00179"></a>00179    <span class="comment">/* "Clear" the number-buffer. */</span>
<a name="l00180"></a>00180    <a class="code" href="structnumber.html">number</a>[0] = 0;
<a name="l00181"></a>00181 
<a name="l00182"></a>00182    <span class="keywordflow">if</span> (strlen(cidstring) &lt; 2) {
<a name="l00183"></a>00183       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"No cid detected\n"</span>);
<a name="l00184"></a>00184       *flags = <a class="code" href="callerid_8h.html#78c6c6c6f4a6c300fe02c103cef4f3ae">CID_UNKNOWN_NUMBER</a>;
<a name="l00185"></a>00185       <span class="keywordflow">return</span>;
<a name="l00186"></a>00186    }
<a name="l00187"></a>00187    
<a name="l00188"></a>00188    <span class="comment">/* Detect protocol and special types */</span>
<a name="l00189"></a>00189    <span class="keywordflow">if</span> (cidstring[0] == <span class="charliteral">'B'</span>) {
<a name="l00190"></a>00190       <span class="comment">/* Handle special codes */</span>
<a name="l00191"></a>00191       code = atoi(&amp;cidstring[1]);
<a name="l00192"></a>00192       <span class="keywordflow">if</span> (code == 0)
<a name="l00193"></a>00193          *flags = <a class="code" href="callerid_8h.html#78c6c6c6f4a6c300fe02c103cef4f3ae">CID_UNKNOWN_NUMBER</a>;
<a name="l00194"></a>00194       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (code == 10) 
<a name="l00195"></a>00195          *flags = <a class="code" href="callerid_8h.html#00fd589a9ffae3b6d6c7da30890daa0a">CID_PRIVATE_NUMBER</a>;
<a name="l00196"></a>00196       <span class="keywordflow">else</span>
<a name="l00197"></a>00197          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"Unknown DTMF code %d\n"</span>, code);
<a name="l00198"></a>00198    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cidstring[0] == <span class="charliteral">'D'</span> &amp;&amp; cidstring[2] == <span class="charliteral">'#'</span>) {
<a name="l00199"></a>00199       <span class="comment">/* .DK special code */</span>
<a name="l00200"></a>00200       <span class="keywordflow">if</span> (cidstring[1] == <span class="charliteral">'1'</span>)
<a name="l00201"></a>00201          *flags = <a class="code" href="callerid_8h.html#00fd589a9ffae3b6d6c7da30890daa0a">CID_PRIVATE_NUMBER</a>;
<a name="l00202"></a>00202       <span class="keywordflow">if</span> (cidstring[1] == <span class="charliteral">'2'</span> || cidstring[1] == <span class="charliteral">'3'</span>)
<a name="l00203"></a>00203          *flags = <a class="code" href="callerid_8h.html#78c6c6c6f4a6c300fe02c103cef4f3ae">CID_UNKNOWN_NUMBER</a>;
<a name="l00204"></a>00204    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cidstring[0] == <span class="charliteral">'D'</span> || cidstring[0] == <span class="charliteral">'A'</span>) {
<a name="l00205"></a>00205       <span class="comment">/* "Standard" callerid */</span>
<a name="l00206"></a>00206       <span class="keywordflow">for</span> (i = 1; i &lt; strlen(cidstring); i++) {
<a name="l00207"></a>00207          <span class="keywordflow">if</span> (cidstring[i] == <span class="charliteral">'C'</span> || cidstring[i] == <span class="charliteral">'#'</span>)
<a name="l00208"></a>00208             <span class="keywordflow">break</span>;
<a name="l00209"></a>00209          <span class="keywordflow">if</span> (isdigit(cidstring[i]))
<a name="l00210"></a>00210             <a class="code" href="structnumber.html">number</a>[i-1] = cidstring[i];
<a name="l00211"></a>00211          <span class="keywordflow">else</span>
<a name="l00212"></a>00212             <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"Unknown CID digit '%c'\n"</span>,
<a name="l00213"></a>00213                cidstring[i]);
<a name="l00214"></a>00214       }
<a name="l00215"></a>00215       <a class="code" href="structnumber.html">number</a>[i-1] = 0;
<a name="l00216"></a>00216    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isdigit(cidstring[0])) {
<a name="l00217"></a>00217       <span class="comment">/* It begins with a digit, so we parse it as a number and hope</span>
<a name="l00218"></a>00218 <span class="comment">       * for the best */</span>
<a name="l00219"></a>00219       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Couldn't detect start-character. CID "</span>
<a name="l00220"></a>00220          <span class="stringliteral">"parsing might be unreliable\n"</span>);
<a name="l00221"></a>00221       <span class="keywordflow">for</span> (i = 0; i &lt; strlen(cidstring); i++) {
<a name="l00222"></a>00222          <span class="keywordflow">if</span> (isdigit(cidstring[i]))
<a name="l00223"></a>00223             <a class="code" href="structnumber.html">number</a>[i] = cidstring[i];
<a name="l00224"></a>00224          <span class="keywordflow">else</span>
<a name="l00225"></a>00225             <span class="keywordflow">break</span>;
<a name="l00226"></a>00226       }
<a name="l00227"></a>00227       <a class="code" href="structnumber.html">number</a>[i] = 0;
<a name="l00228"></a>00228    } <span class="keywordflow">else</span> {
<a name="l00229"></a>00229       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a>)
<a name="l00230"></a>00230          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"Unknown CID protocol, start digit '%c'\n"</span>, cidstring[0]);
<a name="l00231"></a>00231       *flags = <a class="code" href="callerid_8h.html#78c6c6c6f4a6c300fe02c103cef4f3ae">CID_UNKNOWN_NUMBER</a>;
<a name="l00232"></a>00232    }
<a name="l00233"></a>00233 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="deaaf05132ea5b1141b7865526092b2f"></a><!-- doxytag: member="callerid.c::callerid_init" ref="deaaf05132ea5b1141b7865526092b2f" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void callerid_init           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
CallerID Initialization. 
<p>
<dl compact><dt><b></b></dt><dd>Initializes the callerid system. Mostly stuff for inverse FFT </dd></dl>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00118">118</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="callerid_8c-source.html#l00073">CALLERID_MARK</a>, <a class="el" href="callerid_8c-source.html#l00072">CALLERID_SPACE</a>, <a class="el" href="callerid_8c-source.html#l00075">CAS_FREQ1</a>, <a class="el" href="callerid_8c-source.html#l00076">CAS_FREQ2</a>, <a class="el" href="callerid_8c-source.html#l00070">casdi1</a>, <a class="el" href="callerid_8c-source.html#l00070">casdi2</a>, <a class="el" href="callerid_8c-source.html#l00070">casdr1</a>, <a class="el" href="callerid_8c-source.html#l00070">casdr2</a>, <a class="el" href="callerid_8c-source.html#l00067">cid_di</a>, <a class="el" href="callerid_8c-source.html#l00067">cid_dr</a>, <a class="el" href="chan__h323_8c-source.html#l00153">cos</a>, <a class="el" href="callerid_8c-source.html#l00074">SAS_FREQ</a>, <a class="el" href="callerid_8c-source.html#l00069">sasdi</a>, and <a class="el" href="callerid_8c-source.html#l00069">sasdr</a>.
<p>
Referenced by <a class="el" href="asterisk_8c-source.html#l02570">main()</a>.<div class="fragment"><pre class="fragment"><a name="l00119"></a>00119 {
<a name="l00120"></a>00120    <a class="code" href="callerid_8c.html#1a505e53ba3c76e1fda2320bcc03a1f1">cid_dr</a>[0] = <a class="code" href="chan__h323_8c.html#4d00d79b6733c9cc066584a02ed03410">cos</a>(<a class="code" href="callerid_8c.html#a3410c6ef512349e1f355f42a05d9b65">CALLERID_SPACE</a> * 2.0 * M_PI / 8000.0);
<a name="l00121"></a>00121    <a class="code" href="callerid_8c.html#11465b1391e4e98af0d7e9c7726d0640">cid_di</a>[0] = sin(<a class="code" href="callerid_8c.html#a3410c6ef512349e1f355f42a05d9b65">CALLERID_SPACE</a> * 2.0 * M_PI / 8000.0);
<a name="l00122"></a>00122    <a class="code" href="callerid_8c.html#1a505e53ba3c76e1fda2320bcc03a1f1">cid_dr</a>[1] = <a class="code" href="chan__h323_8c.html#4d00d79b6733c9cc066584a02ed03410">cos</a>(<a class="code" href="callerid_8c.html#28110f8586b749713342da2cecdfab2f">CALLERID_MARK</a> * 2.0 * M_PI / 8000.0);
<a name="l00123"></a>00123    <a class="code" href="callerid_8c.html#11465b1391e4e98af0d7e9c7726d0640">cid_di</a>[1] = sin(<a class="code" href="callerid_8c.html#28110f8586b749713342da2cecdfab2f">CALLERID_MARK</a> * 2.0 * M_PI / 8000.0);
<a name="l00124"></a>00124    <a class="code" href="callerid_8c.html#50b1aa87a68c1a34694381be4560cac7">sasdr</a> = <a class="code" href="chan__h323_8c.html#4d00d79b6733c9cc066584a02ed03410">cos</a>(<a class="code" href="callerid_8c.html#003c316eedf90b55997bed8de2f592d1">SAS_FREQ</a> * 2.0 * M_PI / 8000.0);
<a name="l00125"></a>00125    <a class="code" href="callerid_8c.html#8fc41584745fdcd8c3674ec89bc163e7">sasdi</a> = sin(<a class="code" href="callerid_8c.html#003c316eedf90b55997bed8de2f592d1">SAS_FREQ</a> * 2.0 * M_PI / 8000.0);
<a name="l00126"></a>00126    <a class="code" href="callerid_8c.html#7eaf53134cd316c146eaa048915d2307">casdr1</a> = <a class="code" href="chan__h323_8c.html#4d00d79b6733c9cc066584a02ed03410">cos</a>(<a class="code" href="callerid_8c.html#810f37cd8d8644dc2f616181be35221d">CAS_FREQ1</a> * 2.0 * M_PI / 8000.0);
<a name="l00127"></a>00127    <a class="code" href="callerid_8c.html#90d6a3bc8680ee4620edc2daeb282f44">casdi1</a> = sin(<a class="code" href="callerid_8c.html#810f37cd8d8644dc2f616181be35221d">CAS_FREQ1</a> * 2.0 * M_PI / 8000.0);
<a name="l00128"></a>00128    <a class="code" href="callerid_8c.html#acf15319786676679be18fb14ac83243">casdr2</a> = <a class="code" href="chan__h323_8c.html#4d00d79b6733c9cc066584a02ed03410">cos</a>(<a class="code" href="callerid_8c.html#b2508dc98ce6a08cb60f1be240c24201">CAS_FREQ2</a> * 2.0 * M_PI / 8000.0);
<a name="l00129"></a>00129    <a class="code" href="callerid_8c.html#d8e4e693a731406fa7e422253d2f4541">casdi2</a> = sin(<a class="code" href="callerid_8c.html#b2508dc98ce6a08cb60f1be240c24201">CAS_FREQ2</a> * 2.0 * M_PI / 8000.0);
<a name="l00130"></a>00130 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="c6a93a3aeb2ff49fd89cd9f6ce540777"></a><!-- doxytag: member="callerid.c::callerid_new" ref="c6a93a3aeb2ff49fd89cd9f6ce540777" args="(int cid_signalling)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structcallerid__state.html">callerid_state</a>* callerid_new           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>cid_signalling</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Create a callerID state machine. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cid_signalling</em>&nbsp;</td><td>Type of signalling in use</td></tr>
  </table>
</dl>
This function returns a malloc'd instance of the <a class="el" href="structcallerid__state.html">callerid_state</a> data structure. <dl compact><dt><b>Returns:</b></dt><dd>Returns a pointer to a malloc'd <a class="el" href="structcallerid__state.html">callerid_state</a> structure, or NULL on error. </dd></dl>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00132">132</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>, <a class="el" href="callerid_8h-source.html#l00050">CID_UNKNOWN_NAME</a>, <a class="el" href="callerid_8h-source.html#l00051">CID_UNKNOWN_NUMBER</a>, <a class="el" href="callerid_8c-source.html#l00049">callerid_state::fskd</a>, and <a class="el" href="fskmodem_8h-source.html#l00035">fsk_data::spb</a>.
<p>
Referenced by <a class="el" href="chan__zap_8c-source.html#l05744">ss_thread()</a>.<div class="fragment"><pre class="fragment"><a name="l00133"></a>00133 {
<a name="l00134"></a>00134    <span class="keyword">struct </span><a class="code" href="structcallerid__state.html">callerid_state</a> *cid;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136    <span class="keywordflow">if</span> ((cid = <a class="code" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*cid)))) {
<a name="l00137"></a>00137       cid-&gt;fskd.spb = 7.0;             <span class="comment">/* 1200 baud */</span>
<a name="l00138"></a>00138       <span class="comment">/* cid-&gt;fskd.hdlc = 0; */</span>        <span class="comment">/* Async */</span>
<a name="l00139"></a>00139       cid-&gt;fskd.nbit = 8;              <span class="comment">/* 8 bits */</span>
<a name="l00140"></a>00140       cid-&gt;fskd.nstop = 1.0;           <span class="comment">/* 1 stop bit */</span>
<a name="l00141"></a>00141       <span class="comment">/* cid-&gt;fskd.paridad = 0; */</span>     <span class="comment">/* No parity */</span>
<a name="l00142"></a>00142       cid-&gt;fskd.bw = 1;                <span class="comment">/* Filter 800 Hz */</span>
<a name="l00143"></a>00143       <span class="keywordflow">if</span> (cid_signalling == 2) {       <span class="comment">/* v23 signalling */</span>
<a name="l00144"></a>00144          cid-&gt;fskd.f_mark_idx =  4; <span class="comment">/* 1300 Hz */</span>
<a name="l00145"></a>00145          cid-&gt;fskd.f_space_idx = 5; <span class="comment">/* 2100 Hz */</span>
<a name="l00146"></a>00146       } <span class="keywordflow">else</span> {                         <span class="comment">/* Bell 202 signalling as default */</span>
<a name="l00147"></a>00147          cid-&gt;fskd.f_mark_idx =  2; <span class="comment">/* 1200 Hz */</span>
<a name="l00148"></a>00148          cid-&gt;fskd.f_space_idx = 3; <span class="comment">/* 2200 Hz */</span>
<a name="l00149"></a>00149       }
<a name="l00150"></a>00150       <span class="comment">/* cid-&gt;fskd.pcola = 0; */</span>       <span class="comment">/* No clue */</span>
<a name="l00151"></a>00151       <span class="comment">/* cid-&gt;fskd.cont = 0.0; */</span>      <span class="comment">/* Digital PLL reset */</span>
<a name="l00152"></a>00152       <span class="comment">/* cid-&gt;fskd.x0 = 0.0; */</span>
<a name="l00153"></a>00153       <span class="comment">/* cid-&gt;fskd.state = 0; */</span>
<a name="l00154"></a>00154       cid-&gt;flags = <a class="code" href="callerid_8h.html#2c2ab622708c2cc279b0f58b2a6fed6d">CID_UNKNOWN_NAME</a> | <a class="code" href="callerid_8h.html#78c6c6c6f4a6c300fe02c103cef4f3ae">CID_UNKNOWN_NUMBER</a>;
<a name="l00155"></a>00155       <span class="comment">/* cid-&gt;pos = 0; */</span>
<a name="l00156"></a>00156    }
<a name="l00157"></a>00157 
<a name="l00158"></a>00158    <span class="keywordflow">return</span> cid;
<a name="l00159"></a>00159 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="fe4762bd415833e703ed7c5628981442"></a><!-- doxytag: member="callerid.c::gen_tone" ref="fe4762bd415833e703ed7c5628981442" args="(unsigned char *buf, int len, int codec, float ddr1, float ddi1, float *cr1, float *ci1)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void gen_tone           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned char *&nbsp;</td>
          <td class="mdname" nowrap> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>codec</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>float&nbsp;</td>
          <td class="mdname" nowrap> <em>ddr1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>float&nbsp;</td>
          <td class="mdname" nowrap> <em>ddi1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>float *&nbsp;</td>
          <td class="mdname" nowrap> <em>cr1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>float *&nbsp;</td>
          <td class="mdname" nowrap> <em>ci1</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [inline, static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00102">102</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="callerid_8h-source.html#l00063">AST_LIN2X</a>.
<p>
Referenced by <a class="el" href="callerid_8c-source.html#l00235">ast_gen_cas()</a>.<div class="fragment"><pre class="fragment"><a name="l00103"></a>00103 {
<a name="l00104"></a>00104    <span class="keywordtype">int</span> x;
<a name="l00105"></a>00105    <span class="keywordtype">float</span> t;
<a name="l00106"></a>00106    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="utils_8h.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a>; x++) {
<a name="l00107"></a>00107       t = *cr1 * ddr1 - *ci1 * ddi1;
<a name="l00108"></a>00108       *ci1 = *cr1 * ddi1 + *ci1 * ddr1;
<a name="l00109"></a>00109       *cr1 = t;
<a name="l00110"></a>00110       t = 2.0 - (*cr1 * *cr1 + *ci1 * *ci1);
<a name="l00111"></a>00111       *cr1 *= t;
<a name="l00112"></a>00112       *ci1 *= t;  
<a name="l00113"></a>00113       <a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>[x] = <a class="code" href="callerid_8h.html#98f7fadf0d6fa76845e84beae9d6017d">AST_LIN2X</a>(*cr1 * 8192.0);
<a name="l00114"></a>00114    }
<a name="l00115"></a>00115 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="e0115cf07e6d6aa87d569f827539a18d"></a><!-- doxytag: member="callerid.c::gen_tones" ref="e0115cf07e6d6aa87d569f827539a18d" args="(unsigned char *buf, int len, int codec, float ddr1, float ddi1, float ddr2, float ddi2, float *cr1, float *ci1, float *cr2, float *ci2)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void gen_tones           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned char *&nbsp;</td>
          <td class="mdname" nowrap> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>codec</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>float&nbsp;</td>
          <td class="mdname" nowrap> <em>ddr1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>float&nbsp;</td>
          <td class="mdname" nowrap> <em>ddi1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>float&nbsp;</td>
          <td class="mdname" nowrap> <em>ddr2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>float&nbsp;</td>
          <td class="mdname" nowrap> <em>ddi2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>float *&nbsp;</td>
          <td class="mdname" nowrap> <em>cr1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>float *&nbsp;</td>
          <td class="mdname" nowrap> <em>ci1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>float *&nbsp;</td>
          <td class="mdname" nowrap> <em>cr2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>float *&nbsp;</td>
          <td class="mdname" nowrap> <em>ci2</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [inline, static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00080">80</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="callerid_8h-source.html#l00063">AST_LIN2X</a>.
<p>
Referenced by <a class="el" href="callerid_8c-source.html#l00235">ast_gen_cas()</a>.<div class="fragment"><pre class="fragment"><a name="l00081"></a>00081 {
<a name="l00082"></a>00082    <span class="keywordtype">int</span> x;
<a name="l00083"></a>00083    <span class="keywordtype">float</span> t;
<a name="l00084"></a>00084    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="utils_8h.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a>; x++) {
<a name="l00085"></a>00085       t = *cr1 * ddr1 - *ci1 * ddi1;
<a name="l00086"></a>00086       *ci1 = *cr1 * ddi1 + *ci1 * ddr1;
<a name="l00087"></a>00087       *cr1 = t;
<a name="l00088"></a>00088       t = 2.0 - (*cr1 * *cr1 + *ci1 * *ci1);
<a name="l00089"></a>00089       *cr1 *= t;
<a name="l00090"></a>00090       *ci1 *= t;  
<a name="l00091"></a>00091 
<a name="l00092"></a>00092       t = *cr2 * ddr2 - *ci2 * ddi2;
<a name="l00093"></a>00093       *ci2 = *cr2 * ddi2 + *ci2 * ddr2;
<a name="l00094"></a>00094       *cr2 = t;
<a name="l00095"></a>00095       t = 2.0 - (*cr2 * *cr2 + *ci2 * *ci2);
<a name="l00096"></a>00096       *cr2 *= t;
<a name="l00097"></a>00097       *ci2 *= t;  
<a name="l00098"></a>00098       <a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>[x] = <a class="code" href="callerid_8h.html#98f7fadf0d6fa76845e84beae9d6017d">AST_LIN2X</a>((*cr1 + *cr2) * 2048.0);
<a name="l00099"></a>00099    }
<a name="l00100"></a>00100 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="78f84543225433f6828cfb5c29ef5f4a"></a><!-- doxytag: member="callerid.c::vmwi_generate" ref="78f84543225433f6828cfb5c29ef5f4a" args="(unsigned char *buf, int active, int mdmf, int codec)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int vmwi_generate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">unsigned char *&nbsp;</td>
          <td class="mdname" nowrap> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>active</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>mdmf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>codec</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Generate message waiting indicator (stutter tone). 
<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00761">761</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
References <a class="el" href="adsistub_8c-source.html#l00061">msg</a>, <a class="el" href="tdd_8c-source.html#l00215">PUT_BYTE</a>, <a class="el" href="callerid_8h-source.html#l00260">PUT_CLID</a>, and <a class="el" href="callerid_8h-source.html#l00245">PUT_CLID_MARKMS</a>.
<p>
Referenced by <a class="el" href="chan__zap_8c-source.html#l07134">do_monitor()</a>.<div class="fragment"><pre class="fragment"><a name="l00762"></a>00762 {
<a name="l00763"></a>00763    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>[256];
<a name="l00764"></a>00764    <span class="keywordtype">int</span> <a class="code" href="utils_8h.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a>=0;
<a name="l00765"></a>00765    <span class="keywordtype">int</span> sum;
<a name="l00766"></a>00766    <span class="keywordtype">int</span> x;
<a name="l00767"></a>00767    <span class="keywordtype">int</span> bytes = 0;
<a name="l00768"></a>00768    <span class="keywordtype">float</span> cr = 1.0;
<a name="l00769"></a>00769    <span class="keywordtype">float</span> ci = 0.0;
<a name="l00770"></a>00770    <span class="keywordtype">float</span> scont = 0.0;
<a name="l00771"></a>00771 
<a name="l00772"></a>00772    <span class="keywordflow">if</span> (mdmf) {
<a name="l00773"></a>00773       <span class="comment">/* MDMF Message waiting */</span>
<a name="l00774"></a>00774       msg[len++] = 0x82;
<a name="l00775"></a>00775       <span class="comment">/* Length is 3 */</span>
<a name="l00776"></a>00776       msg[len++] = 3;
<a name="l00777"></a>00777       <span class="comment">/* IE is "Message Waiting Parameter" */</span>
<a name="l00778"></a>00778       msg[len++] = 0xb;
<a name="l00779"></a>00779       <span class="comment">/* Length of IE is one */</span>
<a name="l00780"></a>00780       msg[len++] = 1;
<a name="l00781"></a>00781       <span class="comment">/* Active or not */</span>
<a name="l00782"></a>00782       <span class="keywordflow">if</span> (active)
<a name="l00783"></a>00783          msg[len++] = 0xff;
<a name="l00784"></a>00784       <span class="keywordflow">else</span>
<a name="l00785"></a>00785          msg[len++] = 0x00;
<a name="l00786"></a>00786    } <span class="keywordflow">else</span> {
<a name="l00787"></a>00787       <span class="comment">/* SDMF Message waiting */</span>
<a name="l00788"></a>00788       msg[len++] = 0x6;
<a name="l00789"></a>00789       <span class="comment">/* Length is 3 */</span>
<a name="l00790"></a>00790       msg[len++] = 3;
<a name="l00791"></a>00791       <span class="keywordflow">if</span> (active) {
<a name="l00792"></a>00792          msg[len++] = 0x42;
<a name="l00793"></a>00793          msg[len++] = 0x42;
<a name="l00794"></a>00794          msg[len++] = 0x42;
<a name="l00795"></a>00795       } <span class="keywordflow">else</span> {
<a name="l00796"></a>00796          msg[len++] = 0x6f;
<a name="l00797"></a>00797          msg[len++] = 0x6f;
<a name="l00798"></a>00798          msg[len++] = 0x6f;
<a name="l00799"></a>00799       }
<a name="l00800"></a>00800    }
<a name="l00801"></a>00801    sum = 0;
<a name="l00802"></a>00802    <span class="keywordflow">for</span> (x = 0; x &lt; len; x++)
<a name="l00803"></a>00803       sum += msg[x];
<a name="l00804"></a>00804    sum = (256 - (sum &amp; 255));
<a name="l00805"></a>00805    msg[len++] = sum;
<a name="l00806"></a>00806    <span class="comment">/* Wait a half a second */</span>
<a name="l00807"></a>00807    <span class="keywordflow">for</span> (x = 0; x &lt; 4000; x++)
<a name="l00808"></a>00808       <a class="code" href="tdd_8c.html#ff20fbac5dd67c2bde3f51891f3068dd">PUT_BYTE</a>(0x7f);
<a name="l00809"></a>00809    <span class="comment">/* Transmit 30 0x55's (looks like a square wave) for channel seizure */</span>
<a name="l00810"></a>00810    <span class="keywordflow">for</span> (x = 0; x &lt; 30; x++)
<a name="l00811"></a>00811       <a class="code" href="callerid_8h.html#e8be13cde80709083b4ea8ab655611a9">PUT_CLID</a>(0x55);
<a name="l00812"></a>00812    <span class="comment">/* Send 170ms of callerid marks */</span>
<a name="l00813"></a>00813    <span class="keywordflow">for</span> (x = 0; x &lt; 170; x++)
<a name="l00814"></a>00814       <a class="code" href="callerid_8h.html#c7d9a0aeae66e15307d9e8af1f444867">PUT_CLID_MARKMS</a>;
<a name="l00815"></a>00815    <span class="keywordflow">for</span> (x = 0; x &lt; len; x++) {
<a name="l00816"></a>00816       <a class="code" href="callerid_8h.html#e8be13cde80709083b4ea8ab655611a9">PUT_CLID</a>(msg[x]);
<a name="l00817"></a>00817    }
<a name="l00818"></a>00818    <span class="comment">/* Send 50 more ms of marks */</span>
<a name="l00819"></a>00819    <span class="keywordflow">for</span> (x = 0; x &lt; 50; x++)
<a name="l00820"></a>00820       <a class="code" href="callerid_8h.html#c7d9a0aeae66e15307d9e8af1f444867">PUT_CLID_MARKMS</a>;
<a name="l00821"></a>00821    <span class="keywordflow">return</span> bytes;
<a name="l00822"></a>00822 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="90d6a3bc8680ee4620edc2daeb282f44"></a><!-- doxytag: member="callerid.c::casdi1" ref="90d6a3bc8680ee4620edc2daeb282f44" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">float <a class="el" href="callerid_8c.html#90d6a3bc8680ee4620edc2daeb282f44">casdi1</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00070">70</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
Referenced by <a class="el" href="callerid_8c-source.html#l00235">ast_gen_cas()</a>, and <a class="el" href="callerid_8c-source.html#l00118">callerid_init()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="d8e4e693a731406fa7e422253d2f4541"></a><!-- doxytag: member="callerid.c::casdi2" ref="d8e4e693a731406fa7e422253d2f4541" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">float <a class="el" href="callerid_8c.html#d8e4e693a731406fa7e422253d2f4541">casdi2</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00070">70</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
Referenced by <a class="el" href="callerid_8c-source.html#l00235">ast_gen_cas()</a>, and <a class="el" href="callerid_8c-source.html#l00118">callerid_init()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="7eaf53134cd316c146eaa048915d2307"></a><!-- doxytag: member="callerid.c::casdr1" ref="7eaf53134cd316c146eaa048915d2307" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">float <a class="el" href="callerid_8c.html#7eaf53134cd316c146eaa048915d2307">casdr1</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00070">70</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
Referenced by <a class="el" href="callerid_8c-source.html#l00235">ast_gen_cas()</a>, and <a class="el" href="callerid_8c-source.html#l00118">callerid_init()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="acf15319786676679be18fb14ac83243"></a><!-- doxytag: member="callerid.c::casdr2" ref="acf15319786676679be18fb14ac83243" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">float <a class="el" href="callerid_8c.html#acf15319786676679be18fb14ac83243">casdr2</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00070">70</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
Referenced by <a class="el" href="callerid_8c-source.html#l00235">ast_gen_cas()</a>, and <a class="el" href="callerid_8c-source.html#l00118">callerid_init()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="11465b1391e4e98af0d7e9c7726d0640"></a><!-- doxytag: member="callerid.c::cid_di" ref="11465b1391e4e98af0d7e9c7726d0640" args="[4]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">float <a class="el" href="callerid_8h.html#11465b1391e4e98af0d7e9c7726d0640">cid_di</a>[4]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00067">67</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
Referenced by <a class="el" href="callerid_8h-source.html#l00220">callerid_getcarrier()</a>, and <a class="el" href="callerid_8c-source.html#l00118">callerid_init()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="1a505e53ba3c76e1fda2320bcc03a1f1"></a><!-- doxytag: member="callerid.c::cid_dr" ref="1a505e53ba3c76e1fda2320bcc03a1f1" args="[4]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">float <a class="el" href="callerid_8h.html#1a505e53ba3c76e1fda2320bcc03a1f1">cid_dr</a>[4]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00067">67</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
Referenced by <a class="el" href="callerid_8h-source.html#l00220">callerid_getcarrier()</a>, and <a class="el" href="callerid_8c-source.html#l00118">callerid_init()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="de6d74b561de2c7ea01a291c08a45672"></a><!-- doxytag: member="callerid.c::clidsb" ref="de6d74b561de2c7ea01a291c08a45672" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">float <a class="el" href="callerid_8h.html#de6d74b561de2c7ea01a291c08a45672">clidsb</a> = 8000.0 / 1200.0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00068">68</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="67daf92c833c41c95db874e18fcb2786"></a><!-- doxytag: member="callerid.c::description" ref="67daf92c833c41c95db874e18fcb2786" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char* description          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l01044">1044</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
Referenced by <a class="el" href="pbx_8c-source.html#l03021">handle_show_application()</a>, <a class="el" href="pbx_8c-source.html#l01269">handle_show_function()</a>, and <a class="el" href="pbx_8c-source.html#l06035">load_pbx()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="b068931cc450442b63f5b3d276ea4297"></a><!-- doxytag: member="callerid.c::name" ref="b068931cc450442b63f5b3d276ea4297" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char* <a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l01043">1043</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
Referenced by <a class="el" href="chan__sip_8c-source.html#l10356">_sip_show_peers()</a>, <a class="el" href="manager_8c-source.html#l01548">action_getvar()</a>, <a class="el" href="manager_8c-source.html#l01480">action_hangup()</a>, <a class="el" href="manager_8c-source.html#l01912">action_originate()</a>, <a class="el" href="manager_8c-source.html#l01726">action_redirect()</a>, <a class="el" href="manager_8c-source.html#l01681">action_sendtext()</a>, <a class="el" href="manager_8c-source.html#l01506">action_setvar()</a>, <a class="el" href="manager_8c-source.html#l01587">action_status()</a>, <a class="el" href="manager_8c-source.html#l02116">action_timeout()</a>, <a class="el" href="res__adsi_8c-source.html#l01084">adsi_load()</a>, <a class="el" href="app__voicemail_8c-source.html#l03665">adsi_message()</a>, <a class="el" href="res__jabber_8c-source.html#l02002">aji_test()</a>, <a class="el" href="channel_8c-source.html#l03335">ast_change_name()</a>, <a class="el" href="channel_8c-source.html#l00632">ast_channel_alloc()</a>, <a class="el" href="channel_8c-source.html#l01069">ast_channel_free()</a>, <a class="el" href="channel_8c-source.html#l03406">ast_do_masquerade()</a>, <a class="el" href="dsp_8c-source.html#l01749">ast_dsp_set_call_progress_zone()</a>, <a class="el" href="frame_8c-source.html#l00545">ast_getformatname_multiple()</a>, <a class="el" href="abstract__jb_8c-source.html#l00567">ast_jb_read_conf()</a>, <a class="el" href="loader_8c-source.html#l00490">ast_module_helper()</a>, <a class="el" href="res__monitor_8c-source.html#l00358">ast_monitor_change_fname()</a>, <a class="el" href="res__monitor_8c-source.html#l00127">ast_monitor_start()</a>, <a class="el" href="res__monitor_8c-source.html#l00254">ast_monitor_stop()</a>, <a class="el" href="callerid_8c-source.html#l01062">ast_parse_caller_presentation()</a>, <a class="el" href="rtp_8c-source.html#l01869">ast_rtp_lookup_mime_multiple()</a>, <a class="el" href="acl_8c-source.html#l00295">ast_str2tos()</a>, <a class="el" href="chanvars_8c-source.html#l00062">ast_var_name()</a>, <a class="el" href="func__callerid_8c-source.html#l00058">callerid_read()</a>, <a class="el" href="func__callerid_8c-source.html#l00118">callerid_write()</a>, <a class="el" href="res__monitor_8c-source.html#l00566">change_monitor_action()</a>, <a class="el" href="app__chanspy_8c-source.html#l00266">channel_spy()</a>, <a class="el" href="chan__agent_8c-source.html#l01589">complete_agent_logoff_cmd()</a>, <a class="el" href="dlfcn_8c-source.html#l01041">dlclose()</a>, <a class="el" href="res__monitor_8c-source.html#l00606">do_pause_or_unpause()</a>, <a class="el" href="iax2-parser_8c-source.html#l00353">dump_ies()</a>, <a class="el" href="chan__sip_8c-source.html#l02851">find_peer()</a>, <a class="el" href="app__zapscan_8c-source.html#l00074">get_zap_channel_locked()</a>, <a class="el" href="chan__skinny_8c-source.html#l02984">handle_register_message()</a>, <a class="el" href="cli_8c-source.html#l00770">handle_showchan()</a>, <a class="el" href="http_8c-source.html#l00756">httpd_helper_thread()</a>, <a class="el" href="iax2-provision_8c-source.html#l00091">iax_provflags2str()</a>, <a class="el" href="iax2-provision_8c-source.html#l00115">iax_str2flags()</a>, <a class="el" href="cdr__custom_8c-source.html#l00067">load_config()</a>, <a class="el" href="cdr__csv_8c-source.html#l00324">load_module()</a>, <a class="el" href="app__rpt_8c-source.html#l00904">load_rpt_vars()</a>, <a class="el" href="chan__mgcp_8c-source.html#l01457">mgcp_new()</a>, <a class="el" href="misdn__config_8c-source.html#l00719">misdn_cfg_get_config_string()</a>, <a class="el" href="misdn__config_8c-source.html#l00571">misdn_cfg_get_name()</a>, <a class="el" href="cdr__pgsql_8c-source.html#l00182">my_unload_module()</a>, <a class="el" href="cdr__odbc_8c-source.html#l00244">odbc_load_module()</a>, <a class="el" href="cdr__odbc_8c-source.html#l00209">odbc_unload_module()</a>, <a class="el" href="chan__oss_8c-source.html#l00804">oss_call()</a>, <a class="el" href="chan__oss_8c-source.html#l01061">oss_request()</a>, <a class="el" href="chan__sip_8c-source.html#l02489">parse_uri()</a>, <a class="el" href="chan__phone_8c-source.html#l01240">phone_request()</a>, <a class="el" href="cdr__pgsql_8c-source.html#l00202">process_my_load_module()</a>, <a class="el" href="chan__sip_8c-source.html#l08956">register_verify()</a>, <a class="el" href="chan__sip_8c-source.html#l17179">reload_config()</a>, <a class="el" href="app__rpt_8c-source.html#l02483">rpt_call()</a>, <a class="el" href="app__rpt_8c-source.html#l01131">rpt_do_dump()</a>, <a class="el" href="app__rpt_8c-source.html#l01329">rpt_do_lstats()</a>, <a class="el" href="app__rpt_8c-source.html#l01151">rpt_do_stats()</a>, <a class="el" href="app__rpt_8c-source.html#l06656">rpt_master()</a>, <a class="el" href="chan__misdn_8c-source.html#l00881">show_config_description()</a>, <a class="el" href="chan__sip_8c-source.html#l10572">sip_prune_realtime()</a>, <a class="el" href="app__meetme_8c-source.html#l04605">sla_add_trunk_to_station()</a>, <a class="el" href="app__meetme_8c-source.html#l04662">sla_build_station()</a>, <a class="el" href="app__meetme_8c-source.html#l04527">sla_build_trunk()</a>, <a class="el" href="app__softhangup_8c-source.html#l00056">softhangup_exec()</a>, <a class="el" href="app__speech__utils_8c-source.html#l00379">speech_load()</a>, <a class="el" href="cdr__sqlite3__custom_8c-source.html#l00151">sqlite3_log()</a>, <a class="el" href="chan__zap_8c-source.html#l05744">ss_thread()</a>, <a class="el" href="res__monitor_8c-source.html#l00481">start_monitor_action()</a>, <a class="el" href="res__monitor_8c-source.html#l00534">stop_monitor_action()</a>, <a class="el" href="cdr__tds_8c-source.html#l00427">tds_load_module()</a>, <a class="el" href="cdr__tds_8c-source.html#l00410">tds_unload_module()</a>, <a class="el" href="app__rpt_8c-source.html#l07381">unload_module()</a>, <a class="el" href="chan__sip_8c-source.html#l03404">update_call_counter()</a>, and <a class="el" href="chan__misdn_8c-source.html#l03221">update_name()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="3b3c127fc5cb25c830c2bad91960b939"></a><!-- doxytag: member="callerid.c::pres_types" ref="3b3c127fc5cb25c830c2bad91960b939" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct { ... }   <a class="el" href="callerid_8c.html#3b3c127fc5cb25c830c2bad91960b939">pres_types</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Translation table for Caller ID Presentation settings. 
<p>

<p>
Referenced by <a class="el" href="callerid_8c-source.html#l01078">ast_describe_caller_presentation()</a>, <a class="el" href="callerid_8c-source.html#l01094">ast_named_caller_presentation()</a>, and <a class="el" href="callerid_8c-source.html#l01062">ast_parse_caller_presentation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="8fc41584745fdcd8c3674ec89bc163e7"></a><!-- doxytag: member="callerid.c::sasdi" ref="8fc41584745fdcd8c3674ec89bc163e7" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">float <a class="el" href="callerid_8c.html#8fc41584745fdcd8c3674ec89bc163e7">sasdi</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00069">69</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
Referenced by <a class="el" href="callerid_8c-source.html#l00235">ast_gen_cas()</a>, and <a class="el" href="callerid_8c-source.html#l00118">callerid_init()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="50b1aa87a68c1a34694381be4560cac7"></a><!-- doxytag: member="callerid.c::sasdr" ref="50b1aa87a68c1a34694381be4560cac7" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">float <a class="el" href="callerid_8c.html#50b1aa87a68c1a34694381be4560cac7">sasdr</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l00069">69</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.
<p>
Referenced by <a class="el" href="callerid_8c-source.html#l00235">ast_gen_cas()</a>, and <a class="el" href="callerid_8c-source.html#l00118">callerid_init()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="3a6d0284e743dc4a9b86f97d6dd1a3bf"></a><!-- doxytag: member="callerid.c::val" ref="3a6d0284e743dc4a9b86f97d6dd1a3bf" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="structval.html">val</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="callerid_8c-source.html#l01042">1042</a> of file <a class="el" href="callerid_8c-source.html">callerid.c</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu May 24 22:27:04 2007 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.5 </small></address>
</body>
</html>
