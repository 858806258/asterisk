<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (24 May 2007)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Thu May 24 22:27:57 2007</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<h1>AMI functions</h1>callback to display queues status in manager  
<a href="#_details">More...</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__manager__user.html">ast_manager_user</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">user descriptor, as read from the config file.  <a href="structast__manager__user.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structeventqent.html">eventqent</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfast__originate__helper.html">fast_originate_helper</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmansession.html">mansession</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpermalias.html">permalias</a></td></tr>

<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gf9f69200540a7ff01b9714a361ccf60b">ASTMAN_APPEND_BUF_INITSIZE</a>&nbsp;&nbsp;&nbsp;256</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g9ee41aa642997459a48320201907d377">MANAGER_EVENT_BUF_INITSIZE</a>&nbsp;&nbsp;&nbsp;256</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g707bedc997e8781f153bcc7a5d1a944a">MSG_MOREDATA</a>&nbsp;&nbsp;&nbsp;((char *)astman_send_response)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">send a response with an optional message, and terminate it with an empty line. m is used only to grab the 'ActionID' field.  <a href="#g707bedc997e8781f153bcc7a5d1a944a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gf074edf91f83d1f06f7e1bb384bb050a">NEW_EVENT</a>(m)&nbsp;&nbsp;&nbsp;(AST_LIST_NEXT(m-&gt;last_ev, eq_next))</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gfdfb08c15e19a1826e7fe3599e4563f6">__manager_event</a> (int category, const char *<a class="el" href="manager_8h.html#4119639092e62c55ea8be348e4d9260d">event</a>, const char *<a class="el" href="utils_8h.html#8c7dd922ad47494fc02c388e12c00eac">file</a>, int <a class="el" href="manager_8h.html#6438c669e0d0de98e6929c2cc0fac474">line</a>, const char *<a class="el" href="utils_8h.html#7df4935f4a5a2865191ef74f64df8754">func</a>, const char *<a class="el" href="strings_8h.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>,...)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">manager_event: Send AMI event to client  <a href="#gfdfb08c15e19a1826e7fe3599e4563f6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g9ba77c553c77f8cd95e812fc9a3cbf38">action_challenge</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g6c71a4a16dd2e3115f1235a25a8fdb70">action_command</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Manager command "command" - execute CLI command.  <a href="#g6c71a4a16dd2e3115f1235a25a8fdb70"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g4572bba9501a379251e6d7712a077035">action_coresettings</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Show PBX core settings information.  <a href="#g4572bba9501a379251e6d7712a077035"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g48f94483856e54f9d016fd4e00963a5c">action_corestatus</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Show PBX core status information.  <a href="#g48f94483856e54f9d016fd4e00963a5c"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g77d280f8038dfa2bb4b1ea13569c07df">action_events</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g58e43ceaccf852d6a41133bc5cfadc13">action_extensionstate</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#geeb75cf41619f536caffbbef71e3f730">action_getconfig</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g51d0d48508ddb1374a9b28d95b5702d6">action_getconfigjson</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gdb0963bfde8071d731420ac8def41f9e">action_getvar</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gcee30e0477fbe6f85ac98e124a25289d">action_hangup</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gc47a6ddacfc4e36cfb9ab30e2baf7de0">action_listcommands</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gbd3f1f5c2f6fa1c0db6646c765751566">action_login</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g655a6b9be76687e4d0887bffacd41b3d">action_logoff</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g86017430079df84ea69c923aa234bdcd">action_mailboxcount</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g44d5b6b832d95db5bfb983d39e56ee21">action_mailboxstatus</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gd8bc04cda5ffb147cb7c5542d3f8c1ea">action_originate</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gbd5ac0feea5a76122c4bb7950f72dba9">action_ping</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g0076609fb6806996b6584b7a37870927">action_redirect</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">action_redirect: The redirect manager command  <a href="#g0076609fb6806996b6584b7a37870927"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g250e20c09ed384cd90623cfd01f8b551">action_sendtext</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gff61c40432e7043889c37096ac0560c7">action_setvar</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g6a023aadcdeed0f3c8db7756f06a85fe">action_status</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Manager "status" command to show channels.  <a href="#g6a023aadcdeed0f3c8db7756f06a85fe"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#ga8bc516739f567719fd6e75177f08f27">action_timeout</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g2543b90f06c6700af2c68d854b6b4558">action_updateconfig</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g81297609484dc4a21d32483e91c8b11d">action_userevent</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g8c03c9dc4ab8279645aa28d8ec5d7290">action_waitevent</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g38726448f966fa5ad7aaa3141ba16235">append_event</a> (const char *str, int category)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g5084ba51108af1062dd03070916e4990">ast_instring</a> (const char *bigstr, const char *smallstr, const char delim)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g27dd5ddaaf167c42db67c0ca97effe80">AST_LIST_HEAD_STATIC</a> (users, <a class="el" href="structast__manager__user.html">ast_manager_user</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">list of users found in the config file  <a href="#g27dd5ddaaf167c42db67c0ca97effe80"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g2c7cd483b33dbd5909699ec9fead5820">AST_LIST_HEAD_STATIC</a> (<a class="el" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>, <a class="el" href="structmansession.html">mansession</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g43f98ff67535a3a333db98cd235b847b">AST_LIST_HEAD_STATIC</a> (all_events, <a class="el" href="structeventqent.html">eventqent</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g84a70f66019d4cf74b8e203011d22431">ast_manager_register2</a> (const char *action, int auth, int(*<a class="el" href="utils_8h.html#7df4935f4a5a2865191ef74f64df8754">func</a>)(struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m), const char *<a class="el" href="res__features_8c.html#512fbb4e7b617c04031f58b631f2b05d">synopsis</a>, const char *description)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">register a new command with manager, including online help. This is the preferred way to register a manager command  <a href="#g84a70f66019d4cf74b8e203011d22431"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g6c0dd33a0e93b1a38be809f2e99980e4">ast_manager_register_hook</a> (struct <a class="el" href="structmanager__custom__hook.html">manager_custom_hook</a> *hook)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a custom hook to be called when an event is fired.  <a href="#g6c0dd33a0e93b1a38be809f2e99980e4"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g1c56b6ed4b387e1facec1c969283ad56">ast_manager_register_struct</a> (struct <a class="el" href="structmanager__action.html">manager_action</a> *act)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g2ec5f3830dfb4a55fdf0ad8e78bc0db6">ast_manager_unregister</a> (char *action)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g146f09ab1ed1df560f0ffe8113b3a88d">ast_manager_unregister_hook</a> (struct <a class="el" href="structmanager__custom__hook.html">manager_custom_hook</a> *hook)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Delete a custom hook to be called when an event is fired.  <a href="#g146f09ab1ed1df560f0ffe8113b3a88d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gdbef91cfd3f735bb23131f3ba504e92c">AST_RWLIST_HEAD_STATIC</a> (manager_hooks, <a class="el" href="structmanager__custom__hook.html">manager_custom_hook</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g65d58d1cf1ff44fff0b3a95a45ab8ce4">AST_RWLOCK_DEFINE_STATIC</a> (actionlock)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gc8eeff4c44733611adbabf832d757bcc">AST_THREADSTORAGE</a> (manager_event_buf)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g4512bf7f1ec9d9c1e5a77990fe18ea5f">AST_THREADSTORAGE</a> (astman_append_buf)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const char *<a class="el" href="strings_8h.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>,...)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a> (const struct <a class="el" href="structmessage.html">message</a> *m, char *var)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gf6be899da040cd416bb8317db016c1ff">astman_get_variables</a> (const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g0c64878b307241bfe01cea67e09f49e2">astman_send_ack</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m, char *<a class="el" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m, char *error)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#ga868a0aada874f97606fcc3119bad3da">astman_send_listack</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m, char *<a class="el" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>, char *listflag)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g005978ca7456f4c36c0cd89907d68fdb">astman_send_response</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m, char *resp, char *<a class="el" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g653336d14301d38a863c7b20ccec8a1c">astman_send_response_full</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m, char *resp, char *<a class="el" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>, char *listflag)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gbbca0d5619931eef0a531fe18c27416a">astman_start_ack</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g0c601c39a357acbe91e4070d54d89001">authenticate</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g7a74ba6c31130ec1d434b549ec0bd523">authority_to_str</a> (int authority, struct <a class="el" href="structast__str.html">ast_str</a> **res)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert authority code to a list of options.  <a href="#g7a74ba6c31130ec1d434b549ec0bd523"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gd45bb050dddb40e1768551d6be08c1ad">check_manager_enabled</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check if AMI is enabled.  <a href="#gd45bb050dddb40e1768551d6be08c1ad"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g1889b1316d12271fa30e9f302c0da675">check_manager_session_inuse</a> (const char *<a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g6fcd08c8c073e9da6c6f96d6663d69d9">check_webmanager_enabled</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check if AMI/HTTP is enabled.  <a href="#g6fcd08c8c073e9da6c6f96d6663d69d9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g4602d648ab671d826260eb839d90ab26">complete_show_mancmd</a> (const char *<a class="el" href="manager_8h.html#6438c669e0d0de98e6929c2cc0fac474">line</a>, const char *word, int pos, int <a class="el" href="structstate.html">state</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g2748014a620509eb30d57cd01d0218ce">destroy_session</a> (struct <a class="el" href="structmansession.html">mansession</a> *s)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g9af7cd1eddf73300ec737507cdaee283">do_message</a> (struct <a class="el" href="structmansession.html">mansession</a> *s)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g07edcd94b098b94138489a2a65ce84f8">fast_originate</a> (void *data)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g1ea5536cdcef90f22613b5db2ee59b0d">free_session</a> (struct <a class="el" href="structmansession.html">mansession</a> *s)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gf6b259125b17075ea07ee9939d7fdbf5">get_input</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, char *output)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structast__manager__user.html">ast_manager_user</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gcf9022296a6e52672bd7bf89e570c7e0">get_manager_by_name_locked</a> (const char *<a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g6bfcdc2d3a50cfc5be0ca0b6dbc622ea">get_perm</a> (const char *instr)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structeventqent.html">eventqent</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g3bc926ccadf91a299fff3f875979895f">grab_last</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g92af1877a38de15bb9ee5483d0f277f7">handle_mandebug</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gdcf525aba75386762df1e64fa94431fd">handle_showmanager</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g26d7d1506f2ef8110c9c01f335f07911">handle_showmanagers</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#ge553b01c2e0c4bf2d135796bb81c4826">handle_showmancmd</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gb93d1c6d033baab667f87c2ec9ff671c">handle_showmancmds</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">CLI command manager list commands.  <a href="#gb93d1c6d033baab667f87c2ec9ff671c"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gb88212ea47b4627cdab59b899f6fb328">handle_showmanconn</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">CLI command manager list connected.  <a href="#gb88212ea47b4627cdab59b899f6fb328"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g6a11926a741d1c7d51260d13fbc4c74c">handle_showmaneventq</a> (int fd, int argc, char *argv[])</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">CLI command manager list eventq.  <a href="#g6a11926a741d1c7d51260d13fbc4c74c"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g745d3d4809316e9124d216a6e3ce93d3">handle_updates</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m, struct <a class="el" href="structast__config.html">ast_config</a> *cfg)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#ge5f94d60aa1b0c445a48748f89b2a78d">json_escape</a> (char *out, const char *in)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gff6bb88658011308f835d9278cf7f4b5">manager_state_cb</a> (char *<a class="el" href="cdr__tds_8c.html#5c18ef72771564b7f43c497dc507aeab">context</a>, char *<a class="el" href="chan__alsa_8c.html#5aedfeaeaac21e5e5f297360633ea9a3">exten</a>, int <a class="el" href="structstate.html">state</a>, void *data)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g83b7cdf115b0fd94f4417d71e9f3abe2">process_events</a> (struct <a class="el" href="structmansession.html">mansession</a> *s)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g4b975e0463cced020259b711bb8481e2">process_message</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g50cd338ac6ba658c88ad6a7752b556e8">purge_events</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g4051b884ed44c7d2b8b79ed1ffb0cd26">purge_sessions</a> (int n_max)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">remove at most n_max stale session from the list.  <a href="#g4051b884ed44c7d2b8b79ed1ffb0cd26"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#ga640283e96a4cdde5b36633464a1318a">ref_event</a> (struct <a class="el" href="structeventqent.html">eventqent</a> *e)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g28148bd9372a54210c67afe221c2141a">send_string</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, char *string)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g5014c646ffd1bd67b43210a9a22c136a">session_do</a> (void *data)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The body of the individual manager session. Call <a class="el" href="group__Group__AMI.html#gf6b259125b17075ea07ee9939d7fdbf5">get_input()</a> to read one line at a time (or be woken up on new events), collect the lines in a message until found an empty line, and execute the request. In any case, deliver events asynchronously through <a class="el" href="group__Group__AMI.html#g83b7cdf115b0fd94f4417d71e9f3abe2">process_events()</a> (called from here if no line is available, or at the end of <a class="el" href="group__Group__AMI.html#g4b975e0463cced020259b711bb8481e2">process_message()</a>. ).  <a href="#g5014c646ffd1bd67b43210a9a22c136a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gca4968afc65b84cc5b3781d465536b32">set_eventmask</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const char *eventmask)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Rather than braindead on,off this now can also accept a specific int mask value or a ',' delim list of mask strings (the same as manager.conf) -anthm.  <a href="#gca4968afc65b84cc5b3781d465536b32"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g84442272098545210b360ac4f131f10f">strings_to_mask</a> (const char *string)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structeventqent.html">eventqent</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gfb5ee4f215d8a2bd0f91355e21f53df5">unref_event</a> (struct <a class="el" href="structeventqent.html">eventqent</a> *e)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g96f294e808841cbd886011c9d0192687">allowmultiplelogin</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g58780e565b16019054545fbf6ba26a24">block_sockets</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gc63528124b8cf02a55bec42906b204ca">cli_manager</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g7c3e6bc8d40097fbec8dfa709b99eee1">command_blacklist</a> []</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Descriptor for a manager session, either on the AMI socket or over HTTP.  <a href="#g7c3e6bc8d40097fbec8dfa709b99eee1"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#ga3b408e54a36d8024f4861b84f8648fb">displayconnects</a> = 1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structmanager__action.html">manager_action</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gb9fdf2c32a9e1ffe8bea294eb2132fe6">first_action</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">list of actions registered  <a href="#gb9fdf2c32a9e1ffe8bea294eb2132fe6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gff966934ba065051f34a94a400e43b17">httptimeout</a> = 60</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g065d88d3234671acf0f5980f9228b827">manager_debug</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g7fa4f9f44eb840da897cd6df25e71ea4">manager_enabled</a> = 0</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g7ef45bd71ec09dcb2c7e6b8d6e48e57f">mandescr_command</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#ge402cc29f5a0d8a9001d5071152b1281">mandescr_coresettings</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g54e903fbbc11dec18a6971c0b9f89df1">mandescr_corestatus</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gadfa58476f08d0f14e4209140d4ddf57">mandescr_events</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gc23a0e40c449c0ff093ebb890078ccd7">mandescr_extensionstate</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g47ba7bebfd930c7ba1797e460b0c261b">mandescr_getconfig</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gd3137ad18fefbbb17e1e3848b7423d16">mandescr_getconfigjson</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g7e44f6255d335a2c07e5a08424d9ab47">mandescr_getvar</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gcd3c210737ab7a7dea258825b16345a4">mandescr_hangup</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g8ff25cb8fe76a131a2401ce3e51ee07e">mandescr_listcommands</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g4eb25b527bf76f2c94ee7f6a1727706c">mandescr_logoff</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g4c3b52b7ac90a43027758d2aaf218202">mandescr_mailboxcount</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gfbeefe3f5b56dfe8f2379f93f8699b13">mandescr_mailboxstatus</a> []</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Help text for manager command mailboxstatus.  <a href="#gfbeefe3f5b56dfe8f2379f93f8699b13"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gb8d0d86508e429319171f702da06978f">mandescr_originate</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gd19fc2f4e2bf2f2b6e916f370a345957">mandescr_ping</a> []</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Manager PING.  <a href="#gd19fc2f4e2bf2f2b6e916f370a345957"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gac91809519e0b430f42ce4cfdf5c5a2a">mandescr_redirect</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g718ec14078a25254e40cb5ea875d4955">mandescr_sendtext</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g011be8a601adfe631d2040fd2b3e347d">mandescr_setvar</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gd5b2a1a9f5c7c824e21d0345f08ad0d4">mandescr_timeout</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gb327aa5c1fa62b6a6ea1eff221976639">mandescr_updateconfig</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g6c5c4b2a4fc6e25aac2fbc21cbbe12e4">mandescr_userevent</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g5ac7170aaf87a7b17bc4b85f93facd3a">mandescr_waitevent</a> []</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Manager WAITEVENT.  <a href="#g5ac7170aaf87a7b17bc4b85f93facd3a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g16d027da9851b664ff9336caf28769e8">num_sessions</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static struct <a class="el" href="structpermalias.html">permalias</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g94a45625d6a1e46563105bbad0c894f9">perms</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gea495796afbed327cab82112a7b06e91">showmanager_help</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g6629e3faec13dd829b44497132cd264c">showmanagers_help</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g293b0679af0df6d889fa669b0c0cbdf2">showmancmd_help</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g9547e3c81ba49eaa71b260516bf756f2">showmancmds_help</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g14d45ff06ab8d3edb8c57d75dd7cd939">showmanconn_help</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#gcafda953885f99fc273e3097cdc36867">showmaneventq_help</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#g846e7158f3a1a166b993bbea7e34c1e0">timestampevents</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Group__AMI.html#ge48c16ca333fc1529958ca58131fd875">webmanager_enabled</a> = 0</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
callback to display queues status in manager 
<p>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="gf9f69200540a7ff01b9714a361ccf60b"></a><!-- doxytag: member="manager.c::ASTMAN_APPEND_BUF_INITSIZE" ref="gf9f69200540a7ff01b9714a361ccf60b" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define ASTMAN_APPEND_BUF_INITSIZE&nbsp;&nbsp;&nbsp;256          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00797">797</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l00802">astman_append()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g9ee41aa642997459a48320201907d377"></a><!-- doxytag: member="manager.c::MANAGER_EVENT_BUF_INITSIZE" ref="g9ee41aa642997459a48320201907d377" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define MANAGER_EVENT_BUF_INITSIZE&nbsp;&nbsp;&nbsp;256          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02560">2560</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l02563">__manager_event()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g707bedc997e8781f153bcc7a5d1a944a"></a><!-- doxytag: member="manager.c::MSG_MOREDATA" ref="g707bedc997e8781f153bcc7a5d1a944a" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define MSG_MOREDATA&nbsp;&nbsp;&nbsp;((char *)astman_send_response)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
send a response with an optional message, and terminate it with an empty line. m is used only to grab the 'ActionID' field. 
<p>
Use the explicit constant MSG_MOREDATA to remove the empty line. XXX MSG_MOREDATA should go to a header file. 
<p>
Definition at line <a class="el" href="manager_8c-source.html#l00836">836</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l00837">astman_send_response_full()</a>, and <a class="el" href="manager_8c-source.html#l00869">astman_start_ack()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="gf074edf91f83d1f06f7e1bb384bb050a"></a><!-- doxytag: member="manager.c::NEW_EVENT" ref="gf074edf91f83d1f06f7e1bb384bb050a" args="(m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define NEW_EVENT          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">m&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(AST_LIST_NEXT(m-&gt;last_ev, eq_next))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00165">165</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l01291">action_waitevent()</a>, and <a class="el" href="manager_8c-source.html#l02146">process_events()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="gfdfb08c15e19a1826e7fe3599e4563f6"></a><!-- doxytag: member="manager.c::__manager_event" ref="gfdfb08c15e19a1826e7fe3599e4563f6" args="(int category, const char *event, const char *file, int line, const char *func, const char *fmt,...)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int __manager_event           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>category</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>file</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>line</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>func</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>&nbsp;</td>
          <td class="mdname" nowrap> <em>...</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
manager_event: Send AMI event to client 
<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02563">2563</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00141">mansession::__lock</a>, <a class="el" href="manager_8c-source.html#l02536">append_event()</a>, <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00453">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="lock_8h-source.html#l00074">AST_PTHREADT_NULL</a>, <a class="el" href="linkedlists_8h-source.html#l00415">AST_RWLIST_EMPTY</a>, <a class="el" href="linkedlists_8h-source.html#l00060">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00456">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h-source.html#l00115">AST_RWLIST_UNLOCK</a>, <a class="el" href="strings_8h.html#15892382538fcffb4bd4216c8956c428">ast_str_alloca</a>, <a class="el" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append()</a>, <a class="el" href="strings_8h-source.html#l00568">ast_str_append_va</a>, <a class="el" href="manager_8c-source.html#l00325">authority_to_str()</a>, <a class="el" href="adsistub_8c-source.html#l00065">buf</a>, <a class="el" href="manager_8h-source.html#l00072">manager_custom_hook::helper</a>, <a class="el" href="manager_8c-source.html#l00123">manager_debug</a>, <a class="el" href="manager_8c-source.html#l02560">MANAGER_EVENT_BUF_INITSIZE</a>, <a class="el" href="manager_8c-source.html#l00121">num_sessions</a>, <a class="el" href="aesopt_8h-source.html#l00399">s</a>, <a class="el" href="manager_8c-source.html#l00106">eventqent::seq</a>, <a class="el" href="strings_8h-source.html#l00319">ast_str::str</a>, <a class="el" href="manager_8c-source.html#l00115">timestampevents</a>, and <a class="el" href="manager_8c-source.html#l00148">mansession::waiting_thread</a>.<div class="fragment"><pre class="fragment"><a name="l02565"></a>02565 {
<a name="l02566"></a>02566    <span class="keyword">struct </span><a class="code" href="structmansession.html">mansession</a> *<a class="code" href="aesopt_8h.html#8d6242bc80162ac99dd4d368eabe77cc">s</a>;
<a name="l02567"></a>02567    <span class="keyword">struct </span><a class="code" href="structmanager__custom__hook.html">manager_custom_hook</a> *hook;
<a name="l02568"></a>02568    <span class="keyword">struct </span><a class="code" href="structast__str.html">ast_str</a> *auth = <a class="code" href="strings_8h.html#15892382538fcffb4bd4216c8956c428">ast_str_alloca</a>(80);
<a name="l02569"></a>02569    <span class="keyword">const</span> <span class="keywordtype">char</span> *cat_str;
<a name="l02570"></a>02570    va_list ap;
<a name="l02571"></a>02571    <span class="keyword">struct </span>timeval now;
<a name="l02572"></a>02572    <span class="keyword">struct </span><a class="code" href="structast__str.html">ast_str</a> *<a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>;
<a name="l02573"></a>02573 
<a name="l02574"></a>02574    <span class="comment">/* Abort if there aren't any manager sessions */</span>
<a name="l02575"></a>02575    <span class="keywordflow">if</span> (!<a class="code" href="group__Group__AMI.html#g16d027da9851b664ff9336caf28769e8">num_sessions</a>)
<a name="l02576"></a>02576       <span class="keywordflow">return</span> 0;
<a name="l02577"></a>02577 
<a name="l02578"></a>02578    <span class="keywordflow">if</span> (!(buf = ast_str_thread_get(&amp;manager_event_buf, <a class="code" href="group__Group__AMI.html#g9ee41aa642997459a48320201907d377">MANAGER_EVENT_BUF_INITSIZE</a>)))
<a name="l02579"></a>02579       <span class="keywordflow">return</span> -1;
<a name="l02580"></a>02580 
<a name="l02581"></a>02581    cat_str = <a class="code" href="group__Group__AMI.html#g7a74ba6c31130ec1d434b549ec0bd523">authority_to_str</a>(category, &amp;auth);
<a name="l02582"></a>02582    ast_str_set(&amp;buf, 0,
<a name="l02583"></a>02583          <span class="stringliteral">"Event: %s\r\nPrivilege: %s\r\n"</span>,
<a name="l02584"></a>02584           <a class="code" href="manager_8h.html#4119639092e62c55ea8be348e4d9260d">event</a>, cat_str);
<a name="l02585"></a>02585 
<a name="l02586"></a>02586    <span class="keywordflow">if</span> (<a class="code" href="group__Group__AMI.html#g846e7158f3a1a166b993bbea7e34c1e0">timestampevents</a>) {
<a name="l02587"></a>02587       now = ast_tvnow();
<a name="l02588"></a>02588       <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(&amp;buf, 0,
<a name="l02589"></a>02589             <span class="stringliteral">"Timestamp: %ld.%06lu\r\n"</span>,
<a name="l02590"></a>02590              now.tv_sec, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) now.tv_usec);
<a name="l02591"></a>02591    }
<a name="l02592"></a>02592    <span class="keywordflow">if</span> (<a class="code" href="group__Group__AMI.html#g065d88d3234671acf0f5980f9228b827">manager_debug</a>) {
<a name="l02593"></a>02593       <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__sms_8c.html#e068c2de26d760f20cf10afc4b87ef0f">seq</a>;
<a name="l02594"></a>02594       <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(&amp;buf, 0,
<a name="l02595"></a>02595             <span class="stringliteral">"SequenceNumber: %d\r\n"</span>,
<a name="l02596"></a>02596              ast_atomic_fetchadd_int(&amp;seq, 1));
<a name="l02597"></a>02597       <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(&amp;buf, 0,
<a name="l02598"></a>02598             <span class="stringliteral">"File: %s\r\nLine: %d\r\nFunc: %s\r\n"</span>, <a class="code" href="manager_8h.html#8c7dd922ad47494fc02c388e12c00eac">file</a>, <a class="code" href="manager_8h.html#6438c669e0d0de98e6929c2cc0fac474">line</a>, <a class="code" href="manager_8h.html#7df4935f4a5a2865191ef74f64df8754">func</a>);
<a name="l02599"></a>02599    }
<a name="l02600"></a>02600 
<a name="l02601"></a>02601    va_start(ap, <a class="code" href="manager_8h.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>);
<a name="l02602"></a>02602    <a class="code" href="strings_8h.html#9e38c79af6621274e327950f48d02cae">ast_str_append_va</a>(&amp;buf, 0, <a class="code" href="manager_8h.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>, ap);
<a name="l02603"></a>02603    va_end(ap);
<a name="l02604"></a>02604 
<a name="l02605"></a>02605    <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(&amp;buf, 0, <span class="stringliteral">"\r\n"</span>);
<a name="l02606"></a>02606 
<a name="l02607"></a>02607    <a class="code" href="group__Group__AMI.html#g38726448f966fa5ad7aaa3141ba16235">append_event</a>(buf-&gt;<a class="code" href="structast__str.html#3929b4348d8e5ee862fd1e38834d0217">str</a>, category);
<a name="l02608"></a>02608 
<a name="l02609"></a>02609    <span class="comment">/* Wake up any sleeping sessions */</span>
<a name="l02610"></a>02610    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>);
<a name="l02611"></a>02611    <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>, s, list) {
<a name="l02612"></a>02612       <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02613"></a>02613       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structmansession.html#6ab67d39209330f594dbe0828ca5ac80">waiting_thread</a> != <a class="code" href="lock_8h.html#84e4b34008de83ea9d1fa44057758022">AST_PTHREADT_NULL</a>)
<a name="l02614"></a>02614          pthread_kill(s-&gt;<a class="code" href="structmansession.html#6ab67d39209330f594dbe0828ca5ac80">waiting_thread</a>, SIGURG);
<a name="l02615"></a>02615       <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02616"></a>02616    }
<a name="l02617"></a>02617    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>);
<a name="l02618"></a>02618 
<a name="l02619"></a>02619    <a class="code" href="linkedlists_8h.html#23c0c844e5abcb474854867b408e3be8">AST_RWLIST_RDLOCK</a>(&amp;manager_hooks);
<a name="l02620"></a>02620    <span class="keywordflow">if</span> (!<a class="code" href="linkedlists_8h.html#020b0bebdc89708ef3af28762efc67d6">AST_RWLIST_EMPTY</a>(&amp;manager_hooks)) {
<a name="l02621"></a>02621       <a class="code" href="linkedlists_8h.html#36b8c64a6c62cb77baa726f81dcaa7f5">AST_RWLIST_TRAVERSE</a>(&amp;manager_hooks, hook, list) {
<a name="l02622"></a>02622          hook-&gt;<a class="code" href="structmanager__custom__hook.html#fde5d67bfb6dc4b598291cc2ce35ee4a">helper</a>(category, <a class="code" href="manager_8h.html#4119639092e62c55ea8be348e4d9260d">event</a>, buf-&gt;<a class="code" href="structast__str.html#3929b4348d8e5ee862fd1e38834d0217">str</a>);
<a name="l02623"></a>02623       }
<a name="l02624"></a>02624    }
<a name="l02625"></a>02625    <a class="code" href="linkedlists_8h.html#470215c8af4ffcdb09701e5d092a9205">AST_RWLIST_UNLOCK</a>(&amp;manager_hooks);
<a name="l02626"></a>02626 
<a name="l02627"></a>02627    <span class="keywordflow">return</span> 0;
<a name="l02628"></a>02628 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g9ba77c553c77f8cd95e812fc9a3cbf38"></a><!-- doxytag: member="manager.c::action_challenge" ref="g9ba77c553c77f8cd95e812fc9a3cbf38" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_challenge           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01458">1458</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00141">mansession::__lock</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="utils_8c-source.html#l00813">ast_random()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="manager_8c-source.html#l00802">astman_append()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, <a class="el" href="manager_8c-source.html#l00869">astman_start_ack()</a>, and <a class="el" href="manager_8c-source.html#l00152">mansession::challenge</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l01459"></a>01459 {
<a name="l01460"></a>01460    <span class="keyword">const</span> <span class="keywordtype">char</span> *authtype = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"AuthType"</span>);
<a name="l01461"></a>01461 
<a name="l01462"></a>01462    <span class="keywordflow">if</span> (!strcasecmp(authtype, <span class="stringliteral">"MD5"</span>)) {
<a name="l01463"></a>01463       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(s-&gt;<a class="code" href="structmansession.html#35a1613258a052cc893255c98df3338a">challenge</a>))
<a name="l01464"></a>01464          snprintf(s-&gt;<a class="code" href="structmansession.html#35a1613258a052cc893255c98df3338a">challenge</a>, <span class="keyword">sizeof</span>(s-&gt;<a class="code" href="structmansession.html#35a1613258a052cc893255c98df3338a">challenge</a>), <span class="stringliteral">"%ld"</span>, <a class="code" href="utils_8c.html#53deb5f5670a96e205366cdb36097667">ast_random</a>());
<a name="l01465"></a>01465       <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l01466"></a>01466       <a class="code" href="group__Group__AMI.html#gbbca0d5619931eef0a531fe18c27416a">astman_start_ack</a>(s, m);
<a name="l01467"></a>01467       <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"Challenge: %s\r\n\r\n"</span>, s-&gt;<a class="code" href="structmansession.html#35a1613258a052cc893255c98df3338a">challenge</a>);
<a name="l01468"></a>01468       <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l01469"></a>01469    } <span class="keywordflow">else</span> {
<a name="l01470"></a>01470       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Must specify AuthType"</span>);
<a name="l01471"></a>01471    }
<a name="l01472"></a>01472    <span class="keywordflow">return</span> 0;
<a name="l01473"></a>01473 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g6c71a4a16dd2e3115f1235a25a8fdb70"></a><!-- doxytag: member="manager.c::action_command" ref="g6c71a4a16dd2e3115f1235a25a8fdb70" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_command           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Manager command "command" - execute CLI command. 
<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01797">1797</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="cli_8c-source.html#l01681">ast_cli_command()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="manager_8c-source.html#l00802">astman_append()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, <a class="el" href="adsistub_8c-source.html#l00065">buf</a>, <a class="el" href="manager_8c-source.html#l00134">command_blacklist</a>, and <a class="el" href="term_8c-source.html#l00232">term_strip()</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l01798"></a>01798 {
<a name="l01799"></a>01799    <span class="keyword">const</span> <span class="keywordtype">char</span> *cmd = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Command"</span>);
<a name="l01800"></a>01800    <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"ActionID"</span>);
<a name="l01801"></a>01801    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>, *final_buf;
<a name="l01802"></a>01802    <span class="keywordtype">char</span> <span class="keyword">template</span>[] = <span class="stringliteral">"/tmp/ast-ami-XXXXXX"</span>;  <span class="comment">/* template for temporary file */</span>
<a name="l01803"></a>01803    <span class="keywordtype">int</span> fd = mkstemp(<span class="keyword">template</span>), i = 0;
<a name="l01804"></a>01804    off_t l;
<a name="l01805"></a>01805 
<a name="l01806"></a>01806    <span class="keywordflow">for</span> (i = 0; i &lt; <span class="keyword">sizeof</span>(<a class="code" href="group__Group__AMI.html#g7c3e6bc8d40097fbec8dfa709b99eee1">command_blacklist</a>) / <span class="keyword">sizeof</span>(command_blacklist[0]); i++) {
<a name="l01807"></a>01807       <span class="keywordflow">if</span> (!strncmp(cmd, command_blacklist[i], strlen(command_blacklist[i]))) {
<a name="l01808"></a>01808          <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Command blacklisted"</span>);
<a name="l01809"></a>01809          <span class="keywordflow">return</span> 0;
<a name="l01810"></a>01810       }
<a name="l01811"></a>01811    }
<a name="l01812"></a>01812 
<a name="l01813"></a>01813    <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"Response: Follows\r\nPrivilege: Command\r\n"</span>);
<a name="l01814"></a>01814    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(<span class="keywordtype">id</span>))
<a name="l01815"></a>01815       <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"ActionID: %s\r\n"</span>, <span class="keywordtype">id</span>);
<a name="l01816"></a>01816    <span class="comment">/* FIXME: Wedge a ActionID response in here, waiting for later changes */</span>
<a name="l01817"></a>01817    <a class="code" href="cli_8c.html#827723f4f6d9ba0111d178d8d931b892">ast_cli_command</a>(fd, cmd);  <span class="comment">/* XXX need to change this to use a FILE * */</span>
<a name="l01818"></a>01818    l = lseek(fd, 0, SEEK_END);   <span class="comment">/* how many chars available */</span>
<a name="l01819"></a>01819    buf = alloca(l + 1);
<a name="l01820"></a>01820    final_buf = alloca(l + 1);
<a name="l01821"></a>01821    lseek(fd, 0, SEEK_SET);
<a name="l01822"></a>01822    read(fd, buf, l);
<a name="l01823"></a>01823    buf[l] = <span class="charliteral">'\0'</span>;
<a name="l01824"></a>01824    close(fd);
<a name="l01825"></a>01825    unlink(<span class="keyword">template</span>);
<a name="l01826"></a>01826    <a class="code" href="term_8c.html#cb2ba128f046c586d89f3fc2359621a1">term_strip</a>(final_buf, buf, l);
<a name="l01827"></a>01827    final_buf[l] = <span class="charliteral">'\0'</span>;
<a name="l01828"></a>01828    <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, final_buf);
<a name="l01829"></a>01829    <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"--END COMMAND--\r\n\r\n"</span>);
<a name="l01830"></a>01830    <span class="keywordflow">return</span> 0;
<a name="l01831"></a>01831 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g4572bba9501a379251e6d7712a077035"></a><!-- doxytag: member="manager.c::action_coresettings" ref="g4572bba9501a379251e6d7712a077035" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_coresettings           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Show PBX core settings information. 
<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02200">2200</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8h-source.html#l00048">AMI_VERSION</a>, <a class="el" href="asterisk_8c-source.html#l00225">ast_config_AST_RUN_GROUP</a>, <a class="el" href="asterisk_8c-source.html#l00224">ast_config_AST_RUN_USER</a>, <a class="el" href="asterisk_8c-source.html#l00230">ast_config_AST_SYSTEM_NAME</a>, <a class="el" href="config_8c-source.html#l01378">ast_realtime_enabled()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="version_8h-source.html#l00005">ASTERISK_VERSION</a>, <a class="el" href="manager_8c-source.html#l00802">astman_append()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="cdr_8c-source.html#l00104">check_cdr_enabled()</a>, <a class="el" href="manager_8c-source.html#l00262">check_webmanager_enabled()</a>, <a class="el" href="asterisk_8c-source.html#l00167">option_maxcalls</a>, <a class="el" href="asterisk_8c-source.html#l00168">option_maxfiles</a>, and <a class="el" href="asterisk_8c-source.html#l00166">option_maxload</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l02201"></a>02201 {
<a name="l02202"></a>02202    <span class="keyword">const</span> <span class="keywordtype">char</span> *actionid = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"ActionID"</span>);
<a name="l02203"></a>02203    <span class="keywordtype">char</span> idText[150];
<a name="l02204"></a>02204 
<a name="l02205"></a>02205    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(actionid))
<a name="l02206"></a>02206       snprintf(idText, <span class="keyword">sizeof</span>(idText), <span class="stringliteral">"ActionID: %s\r\n"</span>, actionid);
<a name="l02207"></a>02207 
<a name="l02208"></a>02208    <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"Response: Success\r\n"</span>
<a name="l02209"></a>02209          <span class="stringliteral">"%s"</span>
<a name="l02210"></a>02210          <span class="stringliteral">"AMIversion: %s\r\n"</span>
<a name="l02211"></a>02211          <span class="stringliteral">"AsteriskVersion: %s\r\n"</span>
<a name="l02212"></a>02212          <span class="stringliteral">"SystemName: %s\r\n"</span>
<a name="l02213"></a>02213          <span class="stringliteral">"CoreMaxCalls: %d\r\n"</span>
<a name="l02214"></a>02214          <span class="stringliteral">"CoreMaxLoadAvg: %f\r\n"</span>
<a name="l02215"></a>02215          <span class="stringliteral">"CoreRunUser: %s\r\n"</span>
<a name="l02216"></a>02216          <span class="stringliteral">"CoreRunGroup: %s\r\n"</span>
<a name="l02217"></a>02217          <span class="stringliteral">"CoreMaxFilehandles: %d\r\n"</span> 
<a name="l02218"></a>02218          <span class="stringliteral">"CoreRealTimeEnabled: %s\r\n"</span>
<a name="l02219"></a>02219          <span class="stringliteral">"CoreCDRenabled: %s\r\n"</span>
<a name="l02220"></a>02220          <span class="stringliteral">"CoreHTTPenabled: %s\r\n"</span>
<a name="l02221"></a>02221          ,
<a name="l02222"></a>02222          <a class="code" href="manager_8h.html#f3dd4f0a97fca03a8648f607708dafe5">AMI_VERSION</a>,
<a name="l02223"></a>02223          idText,
<a name="l02224"></a>02224          <a class="code" href="version_8h.html#57802148143ed0300bc59e5ab6369dc3">ASTERISK_VERSION</a>, 
<a name="l02225"></a>02225          <a class="code" href="asterisk_8c.html#0a0f8ba4c757a1da509a0cae1830025b">ast_config_AST_SYSTEM_NAME</a>,
<a name="l02226"></a>02226          <a class="code" href="group__main__options.html#g367972f6fd289cfd0361f9f8292dd597">option_maxcalls</a>,
<a name="l02227"></a>02227          <a class="code" href="group__main__options.html#g3d42ed99510dbaa405f4e83e95267503">option_maxload</a>,
<a name="l02228"></a>02228          <a class="code" href="asterisk_8c.html#64c0b497dfed5629380fe004fba12a35">ast_config_AST_RUN_USER</a>,
<a name="l02229"></a>02229          <a class="code" href="asterisk_8c.html#d09bbe8a64f8f712d59fb708101e5313">ast_config_AST_RUN_GROUP</a>,
<a name="l02230"></a>02230          <a class="code" href="group__main__options.html#g27e56faa3359cbaf3b1a83fce0a2bd9f">option_maxfiles</a>,
<a name="l02231"></a>02231          <a class="code" href="config_8c.html#4d3672929087d58a0883217b9ade0091">ast_realtime_enabled</a>() ? <span class="stringliteral">"Yes"</span> : <span class="stringliteral">"No"</span>,
<a name="l02232"></a>02232          <a class="code" href="cdr_8c.html#15b18b722702ed2b39395076d00158c2">check_cdr_enabled</a>() ? <span class="stringliteral">"Yes"</span> : <span class="stringliteral">"No"</span>,
<a name="l02233"></a>02233          <a class="code" href="group__Group__AMI.html#g6fcd08c8c073e9da6c6f96d6663d69d9">check_webmanager_enabled</a>() ? <span class="stringliteral">"Yes"</span> : <span class="stringliteral">"No"</span>
<a name="l02234"></a>02234          );
<a name="l02235"></a>02235    <span class="keywordflow">return</span> 0;
<a name="l02236"></a>02236 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g48f94483856e54f9d016fd4e00963a5c"></a><!-- doxytag: member="manager.c::action_corestatus" ref="g48f94483856e54f9d016fd4e00963a5c" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_corestatus           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Show PBX core status information. 
<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02244">2244</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="channel_8c-source.html#l00362">ast_active_channels()</a>, <a class="el" href="asterisk_8c-source.html#l00196">ast_lastreloadtime</a>, <a class="el" href="asterisk_8c-source.html#l00195">ast_startuptime</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="manager_8c-source.html#l00802">astman_append()</a>, and <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l02245"></a>02245 {
<a name="l02246"></a>02246    <span class="keyword">const</span> <span class="keywordtype">char</span> *actionid = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"ActionID"</span>);
<a name="l02247"></a>02247    <span class="keywordtype">char</span> idText[150];
<a name="l02248"></a>02248    <span class="keywordtype">char</span> startuptime[150];
<a name="l02249"></a>02249    <span class="keywordtype">char</span> reloadtime[150];
<a name="l02250"></a>02250    <span class="keyword">struct </span>tm tm;
<a name="l02251"></a>02251 
<a name="l02252"></a>02252    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(actionid))
<a name="l02253"></a>02253       snprintf(idText, <span class="keyword">sizeof</span>(idText), <span class="stringliteral">"ActionID: %s\r\n"</span>, actionid);
<a name="l02254"></a>02254 
<a name="l02255"></a>02255    localtime_r(&amp;<a class="code" href="asterisk_8c.html#023ce0372dc9226210dc61a0dbbee466">ast_startuptime</a>, &amp;tm);
<a name="l02256"></a>02256    strftime(startuptime, <span class="keyword">sizeof</span>(startuptime), <span class="stringliteral">"%H:%M:%S"</span>, &amp;tm);
<a name="l02257"></a>02257    localtime_r(&amp;<a class="code" href="asterisk_8c.html#e6ff0fa0781fd6b2cfaac6462595ff78">ast_lastreloadtime</a>, &amp;tm);
<a name="l02258"></a>02258    strftime(reloadtime, <span class="keyword">sizeof</span>(reloadtime), <span class="stringliteral">"%H:%M:%S"</span>, &amp;tm);
<a name="l02259"></a>02259 
<a name="l02260"></a>02260    <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"Response: Success\r\n"</span>
<a name="l02261"></a>02261          <span class="stringliteral">"%s"</span>
<a name="l02262"></a>02262          <span class="stringliteral">"CoreStartupTime: %s\r\n"</span>
<a name="l02263"></a>02263          <span class="stringliteral">"CoreReloadTime: %s\r\n"</span>
<a name="l02264"></a>02264          <span class="stringliteral">"CoreCurrentCalls: %d\r\n"</span>
<a name="l02265"></a>02265          <span class="stringliteral">""</span>,
<a name="l02266"></a>02266          idText,
<a name="l02267"></a>02267          startuptime,
<a name="l02268"></a>02268          reloadtime,
<a name="l02269"></a>02269          <a class="code" href="channel_8c.html#126867ace3f9eaaf4d1cf954f5907451">ast_active_channels</a>()
<a name="l02270"></a>02270          );
<a name="l02271"></a>02271    <span class="keywordflow">return</span> 0;
<a name="l02272"></a>02272 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g77d280f8038dfa2bb4b1ea13569c07df"></a><!-- doxytag: member="manager.c::action_events" ref="g77d280f8038dfa2bb4b1ea13569c07df" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_events           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01416">1416</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00854">astman_send_response()</a>, and <a class="el" href="manager_8c-source.html#l00884">set_eventmask()</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l01417"></a>01417 {
<a name="l01418"></a>01418    <span class="keyword">const</span> <span class="keywordtype">char</span> *mask = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"EventMask"</span>);
<a name="l01419"></a>01419    <span class="keywordtype">int</span> res;
<a name="l01420"></a>01420 
<a name="l01421"></a>01421    res = <a class="code" href="group__Group__AMI.html#gca4968afc65b84cc5b3781d465536b32">set_eventmask</a>(s, mask);
<a name="l01422"></a>01422    <span class="keywordflow">if</span> (res &gt; 0)
<a name="l01423"></a>01423       <a class="code" href="group__Group__AMI.html#g005978ca7456f4c36c0cd89907d68fdb">astman_send_response</a>(s, m, <span class="stringliteral">"Events On"</span>, NULL);
<a name="l01424"></a>01424    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res == 0)
<a name="l01425"></a>01425       <a class="code" href="group__Group__AMI.html#g005978ca7456f4c36c0cd89907d68fdb">astman_send_response</a>(s, m, <span class="stringliteral">"Events Off"</span>, NULL);
<a name="l01426"></a>01426 
<a name="l01427"></a>01427    <span class="keywordflow">return</span> 0;
<a name="l01428"></a>01428 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g58e43ceaccf852d6a41133bc5cfadc13"></a><!-- doxytag: member="manager.c::action_extensionstate" ref="g58e43ceaccf852d6a41133bc5cfadc13" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_extensionstate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02085">2085</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="pbx_8c-source.html#l01909">ast_extension_state()</a>, <a class="el" href="pbx_8c-source.html#l02166">ast_get_hint()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="manager_8c-source.html#l00802">astman_append()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, <a class="el" href="manager_8c-source.html#l00869">astman_start_ack()</a>, <a class="el" href="chan__alsa_8c-source.html#l00124">context</a>, and <a class="el" href="chan__alsa_8c-source.html#l00126">exten</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l02086"></a>02086 {
<a name="l02087"></a>02087    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="chan__alsa_8c.html#5aedfeaeaac21e5e5f297360633ea9a3">exten</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Exten"</span>);
<a name="l02088"></a>02088    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="chan__alsa_8c.html#c1ae8ba118483c4c23841d72b5e7ebbb">context</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Context"</span>);
<a name="l02089"></a>02089    <span class="keywordtype">char</span> hint[256] = <span class="stringliteral">""</span>;
<a name="l02090"></a>02090    <span class="keywordtype">int</span> status;
<a name="l02091"></a>02091    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(exten)) {
<a name="l02092"></a>02092       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Extension not specified"</span>);
<a name="l02093"></a>02093       <span class="keywordflow">return</span> 0;
<a name="l02094"></a>02094    }
<a name="l02095"></a>02095    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(context))
<a name="l02096"></a>02096       context = <span class="stringliteral">"default"</span>;
<a name="l02097"></a>02097    status = <a class="code" href="pbx_8c.html#16769dc669e528ae10a063594fb7f4ae">ast_extension_state</a>(NULL, context, exten);
<a name="l02098"></a>02098    <a class="code" href="pbx_8c.html#b654f3264742a57f212c38761672a6c0">ast_get_hint</a>(hint, <span class="keyword">sizeof</span>(hint) - 1, NULL, 0, NULL, context, exten);
<a name="l02099"></a>02099    <a class="code" href="group__Group__AMI.html#gbbca0d5619931eef0a531fe18c27416a">astman_start_ack</a>(s, m);
<a name="l02100"></a>02100    <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s,   <span class="stringliteral">"Message: Extension Status\r\n"</span>
<a name="l02101"></a>02101             <span class="stringliteral">"Exten: %s\r\n"</span>
<a name="l02102"></a>02102             <span class="stringliteral">"Context: %s\r\n"</span>
<a name="l02103"></a>02103             <span class="stringliteral">"Hint: %s\r\n"</span>
<a name="l02104"></a>02104             <span class="stringliteral">"Status: %d\r\n\r\n"</span>,
<a name="l02105"></a>02105             exten, context, hint, status);
<a name="l02106"></a>02106    <span class="keywordflow">return</span> 0;
<a name="l02107"></a>02107 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="geeb75cf41619f536caffbbef71e3f730"></a><!-- doxytag: member="manager.c::action_getconfig" ref="geeb75cf41619f536caffbbef71e3f730" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_getconfig           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01065">1065</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="config_8c-source.html#l00357">ast_category_browse()</a>, <a class="el" href="config_8c-source.html#l00555">ast_config_destroy()</a>, <a class="el" href="config_8c-source.html#l01294">ast_config_load_with_comments()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="config_8c-source.html#l00222">ast_variable_browse()</a>, <a class="el" href="manager_8c-source.html#l00802">astman_append()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, <a class="el" href="manager_8c-source.html#l00869">astman_start_ack()</a>, <a class="el" href="manager_8c-source.html#l00105">eventqent::category</a>, <a class="el" href="utils_8h-source.html#l00386">lineno</a>, <a class="el" href="config_8h-source.html#l00039">ast_variable::name</a>, <a class="el" href="config_8h-source.html#l00046">ast_variable::next</a>, and <a class="el" href="config_8h-source.html#l00040">ast_variable::value</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l01066"></a>01066 {
<a name="l01067"></a>01067    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg;
<a name="l01068"></a>01068    <span class="keyword">const</span> <span class="keywordtype">char</span> *fn = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Filename"</span>);
<a name="l01069"></a>01069    <span class="keywordtype">int</span> catcount = 0;
<a name="l01070"></a>01070    <span class="keywordtype">int</span> <a class="code" href="utils_8h.html#5525da36abafe9a243105119cea54be5">lineno</a> = 0;
<a name="l01071"></a>01071    <span class="keywordtype">char</span> *category=NULL;
<a name="l01072"></a>01072    <span class="keyword">struct </span><a class="code" href="structast__variable.html">ast_variable</a> *v;
<a name="l01073"></a>01073 
<a name="l01074"></a>01074    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(fn)) {
<a name="l01075"></a>01075       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Filename not specified"</span>);
<a name="l01076"></a>01076       <span class="keywordflow">return</span> 0;
<a name="l01077"></a>01077    }
<a name="l01078"></a>01078    <span class="keywordflow">if</span> (!(cfg = <a class="code" href="config_8c.html#2263d3aacd27024be95ac630a0a609dd">ast_config_load_with_comments</a>(fn))) {
<a name="l01079"></a>01079       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Config file not found"</span>);
<a name="l01080"></a>01080       <span class="keywordflow">return</span> 0;
<a name="l01081"></a>01081    }
<a name="l01082"></a>01082    <a class="code" href="group__Group__AMI.html#gbbca0d5619931eef0a531fe18c27416a">astman_start_ack</a>(s, m);
<a name="l01083"></a>01083    <span class="keywordflow">while</span> ((category = <a class="code" href="config_8c.html#38fbac9adb1c1bf165ecce251cb206a8">ast_category_browse</a>(cfg, category))) {
<a name="l01084"></a>01084       lineno = 0;
<a name="l01085"></a>01085       <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"Category-%06d: %s\r\n"</span>, catcount, category);
<a name="l01086"></a>01086       <span class="keywordflow">for</span> (v = <a class="code" href="config_8c.html#65ed813ca973e0e5dd3426804249db4f">ast_variable_browse</a>(cfg, category); v; v = v-&gt;<a class="code" href="structast__variable.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>)
<a name="l01087"></a>01087          <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"Line-%06d-%06d: %s=%s\r\n"</span>, catcount, lineno++, v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, v-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>);
<a name="l01088"></a>01088       catcount++;
<a name="l01089"></a>01089    }
<a name="l01090"></a>01090    <a class="code" href="config_8c.html#ad84c9d29ca53758c2a113d057e221a0">ast_config_destroy</a>(cfg);
<a name="l01091"></a>01091    <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"\r\n"</span>);
<a name="l01092"></a>01092 
<a name="l01093"></a>01093    <span class="keywordflow">return</span> 0;
<a name="l01094"></a>01094 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g51d0d48508ddb1374a9b28d95b5702d6"></a><!-- doxytag: member="manager.c::action_getconfigjson" ref="g51d0d48508ddb1374a9b28d95b5702d6" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_getconfigjson           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01114">1114</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="config_8c-source.html#l00357">ast_category_browse()</a>, <a class="el" href="config_8c-source.html#l00555">ast_config_destroy()</a>, <a class="el" href="config_8c-source.html#l01294">ast_config_load_with_comments()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="config_8c-source.html#l00222">ast_variable_browse()</a>, <a class="el" href="manager_8c-source.html#l00802">astman_append()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, <a class="el" href="manager_8c-source.html#l00869">astman_start_ack()</a>, <a class="el" href="adsistub_8c-source.html#l00065">buf</a>, <a class="el" href="manager_8c-source.html#l00105">eventqent::category</a>, <a class="el" href="manager_8c-source.html#l01097">json_escape()</a>, <a class="el" href="config_8h-source.html#l00039">ast_variable::name</a>, <a class="el" href="config_8h-source.html#l00046">ast_variable::next</a>, and <a class="el" href="config_8h-source.html#l00040">ast_variable::value</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l01115"></a>01115 {
<a name="l01116"></a>01116    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg;
<a name="l01117"></a>01117    <span class="keyword">const</span> <span class="keywordtype">char</span> *fn = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Filename"</span>);
<a name="l01118"></a>01118    <span class="keywordtype">char</span> *category = NULL;
<a name="l01119"></a>01119    <span class="keyword">struct </span><a class="code" href="structast__variable.html">ast_variable</a> *v;
<a name="l01120"></a>01120    <span class="keywordtype">int</span> comma1 = 0;
<a name="l01121"></a>01121    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a> = NULL;
<a name="l01122"></a>01122    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> buf_len = 0;
<a name="l01123"></a>01123 
<a name="l01124"></a>01124    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(fn)) {
<a name="l01125"></a>01125       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Filename not specified"</span>);
<a name="l01126"></a>01126       <span class="keywordflow">return</span> 0;
<a name="l01127"></a>01127    }
<a name="l01128"></a>01128 
<a name="l01129"></a>01129    <span class="keywordflow">if</span> (!(cfg = <a class="code" href="config_8c.html#2263d3aacd27024be95ac630a0a609dd">ast_config_load_with_comments</a>(fn))) {
<a name="l01130"></a>01130       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Config file not found"</span>);
<a name="l01131"></a>01131       <span class="keywordflow">return</span> 0;
<a name="l01132"></a>01132    }
<a name="l01133"></a>01133 
<a name="l01134"></a>01134    buf_len = 512;
<a name="l01135"></a>01135    buf = alloca(buf_len);
<a name="l01136"></a>01136 
<a name="l01137"></a>01137    <a class="code" href="group__Group__AMI.html#gbbca0d5619931eef0a531fe18c27416a">astman_start_ack</a>(s, m);
<a name="l01138"></a>01138    <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"JSON: {"</span>);
<a name="l01139"></a>01139    <span class="keywordflow">while</span> ((category = <a class="code" href="config_8c.html#38fbac9adb1c1bf165ecce251cb206a8">ast_category_browse</a>(cfg, category))) {
<a name="l01140"></a>01140       <span class="keywordtype">int</span> comma2 = 0;
<a name="l01141"></a>01141       <span class="keywordflow">if</span> (buf_len &lt; 2 * strlen(category) + 1) {
<a name="l01142"></a>01142          buf_len *= 2;
<a name="l01143"></a>01143          buf = alloca(buf_len);
<a name="l01144"></a>01144       }
<a name="l01145"></a>01145       <a class="code" href="group__Group__AMI.html#ge5f94d60aa1b0c445a48748f89b2a78d">json_escape</a>(buf, category);
<a name="l01146"></a>01146       <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"%s\"%s\":["</span>, comma1 ? <span class="stringliteral">","</span> : <span class="stringliteral">""</span>, buf);
<a name="l01147"></a>01147       <span class="keywordflow">if</span> (!comma1)
<a name="l01148"></a>01148          comma1 = 1;
<a name="l01149"></a>01149       <span class="keywordflow">for</span> (v = <a class="code" href="config_8c.html#65ed813ca973e0e5dd3426804249db4f">ast_variable_browse</a>(cfg, category); v; v = v-&gt;<a class="code" href="structast__variable.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>) {
<a name="l01150"></a>01150          <span class="keywordflow">if</span> (comma2)
<a name="l01151"></a>01151             <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">","</span>);
<a name="l01152"></a>01152          <span class="keywordflow">if</span> (buf_len &lt; 2 * strlen(v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>) + 1) {
<a name="l01153"></a>01153             buf_len *= 2;
<a name="l01154"></a>01154             buf = alloca(buf_len);
<a name="l01155"></a>01155          }
<a name="l01156"></a>01156          <a class="code" href="group__Group__AMI.html#ge5f94d60aa1b0c445a48748f89b2a78d">json_escape</a>(buf, v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>);
<a name="l01157"></a>01157          <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"\"%s"</span>, buf);
<a name="l01158"></a>01158          <span class="keywordflow">if</span> (buf_len &lt; 2 * strlen(v-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>) + 1) {
<a name="l01159"></a>01159             buf_len *= 2;
<a name="l01160"></a>01160             buf = alloca(buf_len);
<a name="l01161"></a>01161          }
<a name="l01162"></a>01162          <a class="code" href="group__Group__AMI.html#ge5f94d60aa1b0c445a48748f89b2a78d">json_escape</a>(buf, v-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>);
<a name="l01163"></a>01163          <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"%s\""</span>, buf);
<a name="l01164"></a>01164          <span class="keywordflow">if</span> (!comma2)
<a name="l01165"></a>01165             comma2 = 1;
<a name="l01166"></a>01166       }
<a name="l01167"></a>01167       <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"]"</span>);
<a name="l01168"></a>01168    }
<a name="l01169"></a>01169    <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"}\r\n\r\n"</span>);
<a name="l01170"></a>01170 
<a name="l01171"></a>01171    <a class="code" href="config_8c.html#ad84c9d29ca53758c2a113d057e221a0">ast_config_destroy</a>(cfg);
<a name="l01172"></a>01172 
<a name="l01173"></a>01173    <span class="keywordflow">return</span> 0;
<a name="l01174"></a>01174 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="gdb0963bfde8071d731420ac8def41f9e"></a><!-- doxytag: member="manager.c::action_getvar" ref="gdb0963bfde8071d731420ac8def41f9e" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_getvar           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01548">1548</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="lock_8h.html#a2fac4e1b143bef3b1ac807e0ab48f9f">ast_channel_unlock</a>, <a class="el" href="pbx_8c-source.html#l01437">ast_func_read()</a>, <a class="el" href="channel_8c-source.html#l00995">ast_get_channel_by_name_locked()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="manager_8c-source.html#l00802">astman_append()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, <a class="el" href="manager_8c-source.html#l00869">astman_start_ack()</a>, <a class="el" href="callerid_8c-source.html#l01043">name</a>, and <a class="el" href="pbx_8c-source.html#l01132">pbx_retrieve_variable()</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l01549"></a>01549 {
<a name="l01550"></a>01550    <span class="keyword">struct </span><a class="code" href="structast__channel.html">ast_channel</a> *c = NULL;
<a name="l01551"></a>01551    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Channel"</span>);
<a name="l01552"></a>01552    <span class="keyword">const</span> <span class="keywordtype">char</span> *varname = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Variable"</span>);
<a name="l01553"></a>01553    <span class="keywordtype">char</span> *varval;
<a name="l01554"></a>01554    <span class="keywordtype">char</span> workspace[1024] = <span class="stringliteral">""</span>;
<a name="l01555"></a>01555 
<a name="l01556"></a>01556    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(varname)) {
<a name="l01557"></a>01557       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"No variable specified"</span>);
<a name="l01558"></a>01558       <span class="keywordflow">return</span> 0;
<a name="l01559"></a>01559    }
<a name="l01560"></a>01560 
<a name="l01561"></a>01561    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(name)) {
<a name="l01562"></a>01562       c = <a class="code" href="channel_8c.html#e01fecb172f34785571d94adbc5c6558">ast_get_channel_by_name_locked</a>(name);
<a name="l01563"></a>01563       <span class="keywordflow">if</span> (!c) {
<a name="l01564"></a>01564          <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"No such channel"</span>);
<a name="l01565"></a>01565          <span class="keywordflow">return</span> 0;
<a name="l01566"></a>01566       }
<a name="l01567"></a>01567    }
<a name="l01568"></a>01568 
<a name="l01569"></a>01569    <span class="keywordflow">if</span> (varname[strlen(varname) - 1] == <span class="charliteral">')'</span>) {
<a name="l01570"></a>01570       <a class="code" href="pbx_8c.html#fc067f1890b3fdeeacbc538e92a39fbd">ast_func_read</a>(c, (<span class="keywordtype">char</span> *) varname, workspace, <span class="keyword">sizeof</span>(workspace));
<a name="l01571"></a>01571       varval = workspace;
<a name="l01572"></a>01572    } <span class="keywordflow">else</span> {
<a name="l01573"></a>01573       <a class="code" href="pbx_8c.html#2753b759766c3d305e2551f63e403677">pbx_retrieve_variable</a>(c, varname, &amp;varval, workspace, <span class="keyword">sizeof</span>(workspace), NULL);
<a name="l01574"></a>01574    }
<a name="l01575"></a>01575 
<a name="l01576"></a>01576    <span class="keywordflow">if</span> (c)
<a name="l01577"></a>01577       <a class="code" href="lock_8h.html#a2fac4e1b143bef3b1ac807e0ab48f9f">ast_channel_unlock</a>(c);
<a name="l01578"></a>01578    <a class="code" href="group__Group__AMI.html#gbbca0d5619931eef0a531fe18c27416a">astman_start_ack</a>(s, m);
<a name="l01579"></a>01579    <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"Variable: %s\r\nValue: %s\r\n\r\n"</span>, varname, varval);
<a name="l01580"></a>01580 
<a name="l01581"></a>01581    <span class="keywordflow">return</span> 0;
<a name="l01582"></a>01582 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="gcee30e0477fbe6f85ac98e124a25289d"></a><!-- doxytag: member="manager.c::action_hangup" ref="gcee30e0477fbe6f85ac98e124a25289d" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_hangup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01480">1480</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="lock_8h.html#a2fac4e1b143bef3b1ac807e0ab48f9f">ast_channel_unlock</a>, <a class="el" href="channel_8c-source.html#l00995">ast_get_channel_by_name_locked()</a>, <a class="el" href="channel_8c-source.html#l01456">ast_softhangup()</a>, <a class="el" href="channel_8h.html#a4d79cb252987ad7f099770543e601a1fe8eae384d045bee039ff9140421beb8">AST_SOFTHANGUP_EXPLICIT</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00864">astman_send_ack()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, and <a class="el" href="callerid_8c-source.html#l01043">name</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l01481"></a>01481 {
<a name="l01482"></a>01482    <span class="keyword">struct </span><a class="code" href="structast__channel.html">ast_channel</a> *c = NULL;
<a name="l01483"></a>01483    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Channel"</span>);
<a name="l01484"></a>01484    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(name)) {
<a name="l01485"></a>01485       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"No channel specified"</span>);
<a name="l01486"></a>01486       <span class="keywordflow">return</span> 0;
<a name="l01487"></a>01487    }
<a name="l01488"></a>01488    c = <a class="code" href="channel_8c.html#e01fecb172f34785571d94adbc5c6558">ast_get_channel_by_name_locked</a>(name);
<a name="l01489"></a>01489    <span class="keywordflow">if</span> (!c) {
<a name="l01490"></a>01490       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"No such channel"</span>);
<a name="l01491"></a>01491       <span class="keywordflow">return</span> 0;
<a name="l01492"></a>01492    }
<a name="l01493"></a>01493    <a class="code" href="channel_8c.html#a1a142039194e9f6dfb632b28a0c5eb5">ast_softhangup</a>(c, <a class="code" href="channel_8h.html#a4d79cb252987ad7f099770543e601a1fe8eae384d045bee039ff9140421beb8">AST_SOFTHANGUP_EXPLICIT</a>);
<a name="l01494"></a>01494    <a class="code" href="lock_8h.html#a2fac4e1b143bef3b1ac807e0ab48f9f">ast_channel_unlock</a>(c);
<a name="l01495"></a>01495    <a class="code" href="group__Group__AMI.html#g0c64878b307241bfe01cea67e09f49e2">astman_send_ack</a>(s, m, <span class="stringliteral">"Channel Hungup"</span>);
<a name="l01496"></a>01496    <span class="keywordflow">return</span> 0;
<a name="l01497"></a>01497 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="gc47a6ddacfc4e36cfb9ab30e2baf7de0"></a><!-- doxytag: member="manager.c::action_listcommands" ref="gc47a6ddacfc4e36cfb9ab30e2baf7de0" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_listcommands           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Note:</b></dt><dd>The actionlock is read-locked by the caller of this function </dd></dl>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01392">1392</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8h-source.html#l00102">manager_action::action</a>, <a class="el" href="strings_8h.html#15892382538fcffb4bd4216c8956c428">ast_str_alloca</a>, <a class="el" href="manager_8c-source.html#l00802">astman_append()</a>, <a class="el" href="manager_8c-source.html#l00869">astman_start_ack()</a>, <a class="el" href="manager_8h-source.html#l00108">manager_action::authority</a>, <a class="el" href="manager_8c-source.html#l00325">authority_to_str()</a>, <a class="el" href="manager_8c-source.html#l00191">first_action</a>, <a class="el" href="manager_8h-source.html#l00112">manager_action::next</a>, <a class="el" href="manager_8h-source.html#l00104">manager_action::synopsis</a>, and <a class="el" href="manager_8c-source.html#l00155">mansession::writeperm</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l01393"></a>01393 {
<a name="l01394"></a>01394    <span class="keyword">struct </span><a class="code" href="structmanager__action.html">manager_action</a> *cur;
<a name="l01395"></a>01395    <span class="keyword">struct </span><a class="code" href="structast__str.html">ast_str</a> *temp = <a class="code" href="strings_8h.html#15892382538fcffb4bd4216c8956c428">ast_str_alloca</a>(BUFSIZ); <span class="comment">/* XXX very large ? */</span>
<a name="l01396"></a>01396 
<a name="l01397"></a>01397    <a class="code" href="group__Group__AMI.html#gbbca0d5619931eef0a531fe18c27416a">astman_start_ack</a>(s, m);
<a name="l01398"></a>01398    <span class="keywordflow">for</span> (cur = <a class="code" href="group__Group__AMI.html#gb9fdf2c32a9e1ffe8bea294eb2132fe6">first_action</a>; cur; cur = cur-&gt;<a class="code" href="structmanager__action.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>) { <span class="comment">/* Walk the list of actions */</span>
<a name="l01399"></a>01399       <span class="keywordflow">if</span> ((s-&gt;<a class="code" href="structmansession.html#1cc72854e73b9b510a12e993d6479e86">writeperm</a> &amp; cur-&gt;<a class="code" href="structmanager__action.html#873e9c0b50183b613336eea1020f4369">authority</a>) == cur-&gt;<a class="code" href="structmanager__action.html#873e9c0b50183b613336eea1020f4369">authority</a>)
<a name="l01400"></a>01400          <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"%s: %s (Priv: %s)\r\n"</span>,
<a name="l01401"></a>01401             cur-&gt;<a class="code" href="structmanager__action.html#418c5509e2171d55b0aee5c2ea4442b5">action</a>, cur-&gt;<a class="code" href="structmanager__action.html#512fbb4e7b617c04031f58b631f2b05d">synopsis</a>, <a class="code" href="group__Group__AMI.html#g7a74ba6c31130ec1d434b549ec0bd523">authority_to_str</a>(cur-&gt;<a class="code" href="structmanager__action.html#873e9c0b50183b613336eea1020f4369">authority</a>, &amp;temp));
<a name="l01402"></a>01402    }
<a name="l01403"></a>01403    <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"\r\n"</span>);
<a name="l01404"></a>01404 
<a name="l01405"></a>01405    <span class="keywordflow">return</span> 0;
<a name="l01406"></a>01406 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="gbd3f1f5c2f6fa1c0db6646c765751566"></a><!-- doxytag: member="manager.c::action_login" ref="gbd3f1f5c2f6fa1c0db6646c765751566" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_login           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01440">1440</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="utils_8c-source.html#l00493">ast_inet_ntoa()</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="logger_8c-source.html#l00989">ast_verbose()</a>, <a class="el" href="manager_8c-source.html#l00864">astman_send_ack()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, <a class="el" href="manager_8c-source.html#l00903">authenticate()</a>, <a class="el" href="manager_8c-source.html#l00153">mansession::authenticated</a>, <a class="el" href="logger_8h-source.html#l00100">LOG_EVENT</a>, <a class="el" href="manager_8c-source.html#l00149">mansession::managerid</a>, <a class="el" href="asterisk_8c-source.html#l00163">option_verbose</a>, <a class="el" href="manager_8c-source.html#l00143">mansession::sin</a>, <a class="el" href="manager_8c-source.html#l00151">mansession::username</a>, and <a class="el" href="logger_8h-source.html#l00044">VERBOSE_PREFIX_2</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l01441"></a>01441 {
<a name="l01442"></a>01442    <span class="keywordflow">if</span> (<a class="code" href="group__Group__AMI.html#g0c601c39a357acbe91e4070d54d89001">authenticate</a>(s, m)) {
<a name="l01443"></a>01443       sleep(1);
<a name="l01444"></a>01444       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Authentication failed"</span>);
<a name="l01445"></a>01445       <span class="keywordflow">return</span> -1;
<a name="l01446"></a>01446    }
<a name="l01447"></a>01447    s-&gt;authenticated = 1;
<a name="l01448"></a>01448    <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ge36cdd7167e060bff70d00fbd82809eb">option_verbose</a> &gt; 1) {
<a name="l01449"></a>01449       <span class="keywordflow">if</span> (<a class="code" href="group__Group__AMI.html#ga3b408e54a36d8024f4861b84f8648fb">displayconnects</a>) {
<a name="l01450"></a>01450          <a class="code" href="logger_8c.html#6a1ef0a194bcc79fccfb662192954477">ast_verbose</a>(<a class="code" href="logger_8h.html#6e3640436a97291b451a8d264b5ab15d">VERBOSE_PREFIX_2</a> <span class="stringliteral">"%sManager '%s' logged on from %s\n"</span>, (s-&gt;managerid ? <span class="stringliteral">"HTTP "</span> : <span class="stringliteral">""</span>), s-&gt;username, <a class="code" href="utils_8c.html#d5490a9b672272bd2f20ee1e5b72c11e">ast_inet_ntoa</a>(s-&gt;sin.sin_addr));
<a name="l01451"></a>01451       }
<a name="l01452"></a>01452    }
<a name="l01453"></a>01453    <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#4671d62857becc386bbe4cfdc0d96fdc">LOG_EVENT</a>, <span class="stringliteral">"%sManager '%s' logged on from %s\n"</span>, (s-&gt;managerid ? <span class="stringliteral">"HTTP "</span> : <span class="stringliteral">""</span>), s-&gt;username, <a class="code" href="utils_8c.html#d5490a9b672272bd2f20ee1e5b72c11e">ast_inet_ntoa</a>(s-&gt;sin.sin_addr));
<a name="l01454"></a>01454    <a class="code" href="group__Group__AMI.html#g0c64878b307241bfe01cea67e09f49e2">astman_send_ack</a>(s, m, <span class="stringliteral">"Authentication accepted"</span>);
<a name="l01455"></a>01455    <span class="keywordflow">return</span> 0;
<a name="l01456"></a>01456 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g655a6b9be76687e4d0887bffacd41b3d"></a><!-- doxytag: member="manager.c::action_logoff" ref="g655a6b9be76687e4d0887bffacd41b3d" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_logoff           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01434">1434</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00854">astman_send_response()</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l01435"></a>01435 {
<a name="l01436"></a>01436    <a class="code" href="group__Group__AMI.html#g005978ca7456f4c36c0cd89907d68fdb">astman_send_response</a>(s, m, <span class="stringliteral">"Goodbye"</span>, <span class="stringliteral">"Thanks for all the fish."</span>);
<a name="l01437"></a>01437    <span class="keywordflow">return</span> -1;
<a name="l01438"></a>01438 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g86017430079df84ea69c923aa234bdcd"></a><!-- doxytag: member="manager.c::action_mailboxcount" ref="g86017430079df84ea69c923aa234bdcd" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_mailboxcount           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02054">2054</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="app_8c-source.html#l00204">ast_app_inboxcount()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="manager_8c-source.html#l00802">astman_append()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, <a class="el" href="manager_8c-source.html#l00869">astman_start_ack()</a>, and <a class="el" href="chan__mgcp_8c-source.html#l00192">mailbox</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l02055"></a>02055 {
<a name="l02056"></a>02056    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="chan__mgcp_8c.html#be2fc5fd64209e633c78549d39c04fb2">mailbox</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Mailbox"</span>);
<a name="l02057"></a>02057    <span class="keywordtype">int</span> newmsgs = 0, oldmsgs = 0;
<a name="l02058"></a>02058 
<a name="l02059"></a>02059    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(mailbox)) {
<a name="l02060"></a>02060       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Mailbox not specified"</span>);
<a name="l02061"></a>02061       <span class="keywordflow">return</span> 0;
<a name="l02062"></a>02062    }
<a name="l02063"></a>02063    <a class="code" href="app_8c.html#efbc8765f2d92250572a2a1bc05e05d2">ast_app_inboxcount</a>(mailbox, &amp;newmsgs, &amp;oldmsgs);
<a name="l02064"></a>02064    <a class="code" href="group__Group__AMI.html#gbbca0d5619931eef0a531fe18c27416a">astman_start_ack</a>(s, m);
<a name="l02065"></a>02065    <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s,   <span class="stringliteral">"Message: Mailbox Message Count\r\n"</span>
<a name="l02066"></a>02066             <span class="stringliteral">"Mailbox: %s\r\n"</span>
<a name="l02067"></a>02067             <span class="stringliteral">"NewMessages: %d\r\n"</span>
<a name="l02068"></a>02068             <span class="stringliteral">"OldMessages: %d\r\n"</span>
<a name="l02069"></a>02069             <span class="stringliteral">"\r\n"</span>,
<a name="l02070"></a>02070             mailbox, newmsgs, oldmsgs);
<a name="l02071"></a>02071    <span class="keywordflow">return</span> 0;
<a name="l02072"></a>02072 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g44d5b6b832d95db5bfb983d39e56ee21"></a><!-- doxytag: member="manager.c::action_mailboxstatus" ref="g44d5b6b832d95db5bfb983d39e56ee21" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_mailboxstatus           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02026">2026</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="app_8c-source.html#l00190">ast_app_has_voicemail()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="manager_8c-source.html#l00802">astman_append()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, <a class="el" href="manager_8c-source.html#l00869">astman_start_ack()</a>, and <a class="el" href="chan__mgcp_8c-source.html#l00192">mailbox</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l02027"></a>02027 {
<a name="l02028"></a>02028    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="chan__mgcp_8c.html#be2fc5fd64209e633c78549d39c04fb2">mailbox</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Mailbox"</span>);
<a name="l02029"></a>02029    <span class="keywordtype">int</span> ret;
<a name="l02030"></a>02030 
<a name="l02031"></a>02031    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(mailbox)) {
<a name="l02032"></a>02032       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Mailbox not specified"</span>);
<a name="l02033"></a>02033       <span class="keywordflow">return</span> 0;
<a name="l02034"></a>02034    }
<a name="l02035"></a>02035    ret = <a class="code" href="app_8c.html#0b70c376a3774cd6d951a7dbbd49e6ac">ast_app_has_voicemail</a>(mailbox, NULL);
<a name="l02036"></a>02036    <a class="code" href="group__Group__AMI.html#gbbca0d5619931eef0a531fe18c27416a">astman_start_ack</a>(s, m);
<a name="l02037"></a>02037    <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"Message: Mailbox Status\r\n"</span>
<a name="l02038"></a>02038           <span class="stringliteral">"Mailbox: %s\r\n"</span>
<a name="l02039"></a>02039           <span class="stringliteral">"Waiting: %d\r\n\r\n"</span>, mailbox, ret);
<a name="l02040"></a>02040    <span class="keywordflow">return</span> 0;
<a name="l02041"></a>02041 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="gd8bc04cda5ffb147cb7c5542d3f8c1ea"></a><!-- doxytag: member="manager.c::action_originate" ref="gd8bc04cda5ffb147cb7c5542d3f8c1ea" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_originate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01912">1912</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="adsistub_8c-source.html#l00059">app</a>, <a class="el" href="callerid_8c-source.html#l00949">ast_callerid_parse()</a>, <a class="el" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>, <a class="el" href="pbx_8c-source.html#l02188">ast_findlabel_extension()</a>, <a class="el" href="frame_8h-source.html#l00233">AST_FORMAT_SLINEAR</a>, <a class="el" href="pbx_8c-source.html#l05150">ast_pbx_outgoing_app()</a>, <a class="el" href="pbx_8c-source.html#l04991">ast_pbx_outgoing_exten()</a>, <a class="el" href="utils_8h-source.html#l00302">ast_pthread_create_detached</a>, <a class="el" href="callerid_8c-source.html#l00871">ast_shrink_phone_number()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="utils_8c-source.html#l00724">ast_true()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00726">astman_get_variables()</a>, <a class="el" href="manager_8c-source.html#l00864">astman_send_ack()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, <a class="el" href="chan__alsa_8c-source.html#l00124">context</a>, <a class="el" href="channel_8h-source.html#l00422">ast_channel::data</a>, <a class="el" href="chan__alsa_8c-source.html#l00126">exten</a>, <a class="el" href="manager_8c-source.html#l01850">fast_originate()</a>, <a class="el" href="callerid_8c-source.html#l01043">name</a>, <a class="el" href="channel_8h-source.html#l00443">ast_channel::priority</a>, and <a class="el" href="channel_8h-source.html#l00385">ast_channel::tech</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l01913"></a>01913 {
<a name="l01914"></a>01914    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Channel"</span>);
<a name="l01915"></a>01915    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="chan__alsa_8c.html#5aedfeaeaac21e5e5f297360633ea9a3">exten</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Exten"</span>);
<a name="l01916"></a>01916    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="chan__alsa_8c.html#c1ae8ba118483c4c23841d72b5e7ebbb">context</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Context"</span>);
<a name="l01917"></a>01917    <span class="keyword">const</span> <span class="keywordtype">char</span> *priority = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Priority"</span>);
<a name="l01918"></a>01918    <span class="keyword">const</span> <span class="keywordtype">char</span> *timeout = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Timeout"</span>);
<a name="l01919"></a>01919    <span class="keyword">const</span> <span class="keywordtype">char</span> *callerid = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"CallerID"</span>);
<a name="l01920"></a>01920    <span class="keyword">const</span> <span class="keywordtype">char</span> *account = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Account"</span>);
<a name="l01921"></a>01921    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#d2a57dc1d883fd21fb9951699df71cc7">app</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Application"</span>);
<a name="l01922"></a>01922    <span class="keyword">const</span> <span class="keywordtype">char</span> *appdata = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Data"</span>);
<a name="l01923"></a>01923    <span class="keyword">const</span> <span class="keywordtype">char</span> *async = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Async"</span>);
<a name="l01924"></a>01924    <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"ActionID"</span>);
<a name="l01925"></a>01925    <span class="keyword">struct </span><a class="code" href="structast__variable.html">ast_variable</a> *vars = <a class="code" href="group__Group__AMI.html#gf6be899da040cd416bb8317db016c1ff">astman_get_variables</a>(m);
<a name="l01926"></a>01926    <span class="keywordtype">char</span> *tech, *data;
<a name="l01927"></a>01927    <span class="keywordtype">char</span> *l = NULL, *n = NULL;
<a name="l01928"></a>01928    <span class="keywordtype">int</span> pi = 0;
<a name="l01929"></a>01929    <span class="keywordtype">int</span> res;
<a name="l01930"></a>01930    <span class="keywordtype">int</span> to = 30000;
<a name="l01931"></a>01931    <span class="keywordtype">int</span> reason = 0;
<a name="l01932"></a>01932    <span class="keywordtype">char</span> tmp[256];
<a name="l01933"></a>01933    <span class="keywordtype">char</span> tmp2[256];
<a name="l01934"></a>01934 
<a name="l01935"></a>01935    pthread_t th;
<a name="l01936"></a>01936    <span class="keywordflow">if</span> (!name) {
<a name="l01937"></a>01937       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Channel not specified"</span>);
<a name="l01938"></a>01938       <span class="keywordflow">return</span> 0;
<a name="l01939"></a>01939    }
<a name="l01940"></a>01940    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(priority) &amp;&amp; (sscanf(priority, <span class="stringliteral">"%d"</span>, &amp;pi) != 1)) {
<a name="l01941"></a>01941       <span class="keywordflow">if</span> ((pi = <a class="code" href="pbx_8c.html#6f1b63f69b489517c49ccfecdbe1642e">ast_findlabel_extension</a>(NULL, context, exten, priority, NULL)) &lt; 1) {
<a name="l01942"></a>01942          <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Invalid priority\n"</span>);
<a name="l01943"></a>01943          <span class="keywordflow">return</span> 0;
<a name="l01944"></a>01944       }
<a name="l01945"></a>01945    }
<a name="l01946"></a>01946    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(timeout) &amp;&amp; (sscanf(timeout, <span class="stringliteral">"%d"</span>, &amp;to) != 1)) {
<a name="l01947"></a>01947       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Invalid timeout\n"</span>);
<a name="l01948"></a>01948       <span class="keywordflow">return</span> 0;
<a name="l01949"></a>01949    }
<a name="l01950"></a>01950    ast_copy_string(tmp, name, <span class="keyword">sizeof</span>(tmp));
<a name="l01951"></a>01951    tech = tmp;
<a name="l01952"></a>01952    data = strchr(tmp, <span class="charliteral">'/'</span>);
<a name="l01953"></a>01953    <span class="keywordflow">if</span> (!data) {
<a name="l01954"></a>01954       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Invalid channel\n"</span>);
<a name="l01955"></a>01955       <span class="keywordflow">return</span> 0;
<a name="l01956"></a>01956    }
<a name="l01957"></a>01957    *data++ = <span class="charliteral">'\0'</span>;
<a name="l01958"></a>01958    ast_copy_string(tmp2, callerid, <span class="keyword">sizeof</span>(tmp2));
<a name="l01959"></a>01959    <a class="code" href="callerid_8c.html#914d0eb3b42ed9d3547306d24d2e67a0">ast_callerid_parse</a>(tmp2, &amp;n, &amp;l);
<a name="l01960"></a>01960    <span class="keywordflow">if</span> (n) {
<a name="l01961"></a>01961       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(n))
<a name="l01962"></a>01962          n = NULL;
<a name="l01963"></a>01963    }
<a name="l01964"></a>01964    <span class="keywordflow">if</span> (l) {
<a name="l01965"></a>01965       <a class="code" href="callerid_8c.html#472e6c01db8037ff1904969285f4e91c">ast_shrink_phone_number</a>(l);
<a name="l01966"></a>01966       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(l))
<a name="l01967"></a>01967          l = NULL;
<a name="l01968"></a>01968    }
<a name="l01969"></a>01969    <span class="keywordflow">if</span> (<a class="code" href="utils_8c.html#63bb02e4d6f18c1dbeca92dc63310685">ast_true</a>(async)) {
<a name="l01970"></a>01970       <span class="keyword">struct </span><a class="code" href="structfast__originate__helper.html">fast_originate_helper</a> *fast = <a class="code" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*fast));
<a name="l01971"></a>01971       <span class="keywordflow">if</span> (!fast) {
<a name="l01972"></a>01972          res = -1;
<a name="l01973"></a>01973       } <span class="keywordflow">else</span> {
<a name="l01974"></a>01974          <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(<span class="keywordtype">id</span>))
<a name="l01975"></a>01975             snprintf(fast-&gt;<a class="code" href="structfast__originate__helper.html#0b9b4614d6434ea0573c89d67e0170b7">idtext</a>, <span class="keyword">sizeof</span>(fast-&gt;<a class="code" href="structfast__originate__helper.html#0b9b4614d6434ea0573c89d67e0170b7">idtext</a>), <span class="stringliteral">"ActionID: %s\r\n"</span>, <span class="keywordtype">id</span>);
<a name="l01976"></a>01976          ast_copy_string(fast-&gt;<a class="code" href="structfast__originate__helper.html#646099ae10c2b6f54bbbd25d705d326b">tech</a>, tech, <span class="keyword">sizeof</span>(fast-&gt;<a class="code" href="structfast__originate__helper.html#646099ae10c2b6f54bbbd25d705d326b">tech</a>));
<a name="l01977"></a>01977             ast_copy_string(fast-&gt;<a class="code" href="structfast__originate__helper.html#9a1c389bd0690d134877ca3ca177c8d2">data</a>, data, <span class="keyword">sizeof</span>(fast-&gt;<a class="code" href="structfast__originate__helper.html#9a1c389bd0690d134877ca3ca177c8d2">data</a>));
<a name="l01978"></a>01978          ast_copy_string(fast-&gt;<a class="code" href="structfast__originate__helper.html#d87b6ee5a83ee70a6697ba886125ae9e">app</a>, app, <span class="keyword">sizeof</span>(fast-&gt;<a class="code" href="structfast__originate__helper.html#d87b6ee5a83ee70a6697ba886125ae9e">app</a>));
<a name="l01979"></a>01979          ast_copy_string(fast-&gt;<a class="code" href="structfast__originate__helper.html#c59a3713a42d7885b689012cb769c29f">appdata</a>, appdata, <span class="keyword">sizeof</span>(fast-&gt;<a class="code" href="structfast__originate__helper.html#c59a3713a42d7885b689012cb769c29f">appdata</a>));
<a name="l01980"></a>01980          <span class="keywordflow">if</span> (l)
<a name="l01981"></a>01981             ast_copy_string(fast-&gt;<a class="code" href="structfast__originate__helper.html#ca3c0eb6b6e898f3a32aed5de1320774">cid_num</a>, l, <span class="keyword">sizeof</span>(fast-&gt;<a class="code" href="structfast__originate__helper.html#ca3c0eb6b6e898f3a32aed5de1320774">cid_num</a>));
<a name="l01982"></a>01982          <span class="keywordflow">if</span> (n)
<a name="l01983"></a>01983             ast_copy_string(fast-&gt;<a class="code" href="structfast__originate__helper.html#70f178a59d8df82fe5e107da71415b9b">cid_name</a>, n, <span class="keyword">sizeof</span>(fast-&gt;<a class="code" href="structfast__originate__helper.html#70f178a59d8df82fe5e107da71415b9b">cid_name</a>));
<a name="l01984"></a>01984          fast-&gt;<a class="code" href="structfast__originate__helper.html#b63119da730344b345cdc8f62a4711e9">vars</a> = vars;
<a name="l01985"></a>01985          ast_copy_string(fast-&gt;<a class="code" href="structfast__originate__helper.html#c1ae8ba118483c4c23841d72b5e7ebbb">context</a>, context, <span class="keyword">sizeof</span>(fast-&gt;<a class="code" href="structfast__originate__helper.html#c1ae8ba118483c4c23841d72b5e7ebbb">context</a>));
<a name="l01986"></a>01986          ast_copy_string(fast-&gt;<a class="code" href="structfast__originate__helper.html#5aedfeaeaac21e5e5f297360633ea9a3">exten</a>, exten, <span class="keyword">sizeof</span>(fast-&gt;<a class="code" href="structfast__originate__helper.html#5aedfeaeaac21e5e5f297360633ea9a3">exten</a>));
<a name="l01987"></a>01987          ast_copy_string(fast-&gt;<a class="code" href="structfast__originate__helper.html#a68ae5b7bc66091c1f471b9d6ebb5293">account</a>, account, <span class="keyword">sizeof</span>(fast-&gt;<a class="code" href="structfast__originate__helper.html#a68ae5b7bc66091c1f471b9d6ebb5293">account</a>));
<a name="l01988"></a>01988          fast-&gt;<a class="code" href="structfast__originate__helper.html#90272dda245ae1fb3cf197e91a8689dc">timeout</a> = to;
<a name="l01989"></a>01989          fast-&gt;<a class="code" href="structfast__originate__helper.html#b988295c268025b49dfb3df26171ddc3">priority</a> = pi;
<a name="l01990"></a>01990          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#97e9ed35da1f19087b177cdffdf53c97">ast_pthread_create_detached</a>(&amp;th, NULL, <a class="code" href="group__Group__AMI.html#g07edcd94b098b94138489a2a65ce84f8">fast_originate</a>, fast)) {
<a name="l01991"></a>01991             res = -1;
<a name="l01992"></a>01992          } <span class="keywordflow">else</span> {
<a name="l01993"></a>01993             res = 0;
<a name="l01994"></a>01994          }
<a name="l01995"></a>01995       }
<a name="l01996"></a>01996    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(app)) {
<a name="l01997"></a>01997          res = <a class="code" href="pbx_8c.html#8bd05d7cdf218eaecfb4a33dd0eb32d8">ast_pbx_outgoing_app</a>(tech, <a class="code" href="frame_8h.html#ce4d062ff9a85be84b636e7ec67a068b">AST_FORMAT_SLINEAR</a>, data, to, app, appdata, &amp;reason, 1, l, n, vars, account, NULL);
<a name="l01998"></a>01998       } <span class="keywordflow">else</span> {
<a name="l01999"></a>01999       <span class="keywordflow">if</span> (exten &amp;&amp; context &amp;&amp; pi)
<a name="l02000"></a>02000             res = <a class="code" href="pbx_8c.html#1b1911a618935b371e69b60c66cf6221">ast_pbx_outgoing_exten</a>(tech, <a class="code" href="frame_8h.html#ce4d062ff9a85be84b636e7ec67a068b">AST_FORMAT_SLINEAR</a>, data, to, context, exten, pi, &amp;reason, 1, l, n, vars, account, NULL);
<a name="l02001"></a>02001       <span class="keywordflow">else</span> {
<a name="l02002"></a>02002          <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Originate with 'Exten' requires 'Context' and 'Priority'"</span>);
<a name="l02003"></a>02003          <span class="keywordflow">return</span> 0;
<a name="l02004"></a>02004       }
<a name="l02005"></a>02005    }
<a name="l02006"></a>02006    <span class="keywordflow">if</span> (!res)
<a name="l02007"></a>02007       <a class="code" href="group__Group__AMI.html#g0c64878b307241bfe01cea67e09f49e2">astman_send_ack</a>(s, m, <span class="stringliteral">"Originate successfully queued"</span>);
<a name="l02008"></a>02008    <span class="keywordflow">else</span>
<a name="l02009"></a>02009       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Originate failed"</span>);
<a name="l02010"></a>02010    <span class="keywordflow">return</span> 0;
<a name="l02011"></a>02011 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="gbd5ac0feea5a76122c4bb7950f72dba9"></a><!-- doxytag: member="manager.c::action_ping" ref="gbd5ac0feea5a76122c4bb7950f72dba9" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_ping           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01053">1053</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00854">astman_send_response()</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l01054"></a>01054 {
<a name="l01055"></a>01055    <a class="code" href="group__Group__AMI.html#g005978ca7456f4c36c0cd89907d68fdb">astman_send_response</a>(s, m, <span class="stringliteral">"Pong"</span>, NULL);
<a name="l01056"></a>01056    <span class="keywordflow">return</span> 0;
<a name="l01057"></a>01057 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g0076609fb6806996b6584b7a37870927"></a><!-- doxytag: member="manager.c::action_redirect" ref="g0076609fb6806996b6584b7a37870927" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_redirect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
action_redirect: The redirect manager command 
<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01726">1726</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="pbx_8c-source.html#l04595">ast_async_goto()</a>, <a class="el" href="lock_8h.html#a2fac4e1b143bef3b1ac807e0ab48f9f">ast_channel_unlock</a>, <a class="el" href="channel_8c-source.html#l00325">ast_check_hangup()</a>, <a class="el" href="pbx_8c-source.html#l02188">ast_findlabel_extension()</a>, <a class="el" href="channel_8c-source.html#l00995">ast_get_channel_by_name_locked()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00864">astman_send_ack()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, <a class="el" href="adsistub_8c-source.html#l00065">buf</a>, <a class="el" href="adsistub_8c-source.html#l00055">chan</a>, <a class="el" href="chan__alsa_8c-source.html#l00124">context</a>, <a class="el" href="chan__alsa_8c-source.html#l00126">exten</a>, <a class="el" href="callerid_8c-source.html#l01043">name</a>, and <a class="el" href="channel_8h-source.html#l00443">ast_channel::priority</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l01727"></a>01727 {
<a name="l01728"></a>01728    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Channel"</span>);
<a name="l01729"></a>01729    <span class="keyword">const</span> <span class="keywordtype">char</span> *name2 = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"ExtraChannel"</span>);
<a name="l01730"></a>01730    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="chan__alsa_8c.html#5aedfeaeaac21e5e5f297360633ea9a3">exten</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Exten"</span>);
<a name="l01731"></a>01731    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="chan__alsa_8c.html#c1ae8ba118483c4c23841d72b5e7ebbb">context</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Context"</span>);
<a name="l01732"></a>01732    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structfast__originate__helper.html#b988295c268025b49dfb3df26171ddc3">priority</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Priority"</span>);
<a name="l01733"></a>01733    <span class="keyword">struct </span><a class="code" href="structast__channel.html">ast_channel</a> *<a class="code" href="adsistub_8c.html#26c322652770620e64ac90682eb6504c">chan</a>, *chan2 = NULL;
<a name="l01734"></a>01734    <span class="keywordtype">int</span> pi = 0;
<a name="l01735"></a>01735    <span class="keywordtype">int</span> res;
<a name="l01736"></a>01736 
<a name="l01737"></a>01737    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(name)) {
<a name="l01738"></a>01738       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Channel not specified"</span>);
<a name="l01739"></a>01739       <span class="keywordflow">return</span> 0;
<a name="l01740"></a>01740    }
<a name="l01741"></a>01741    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(priority) &amp;&amp; (sscanf(priority, <span class="stringliteral">"%d"</span>, &amp;pi) != 1)) {
<a name="l01742"></a>01742       <span class="keywordflow">if</span> ((pi = <a class="code" href="pbx_8c.html#6f1b63f69b489517c49ccfecdbe1642e">ast_findlabel_extension</a>(NULL, context, exten, priority, NULL)) &lt; 1) {
<a name="l01743"></a>01743          <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Invalid priority\n"</span>);
<a name="l01744"></a>01744          <span class="keywordflow">return</span> 0;
<a name="l01745"></a>01745       }
<a name="l01746"></a>01746    }
<a name="l01747"></a>01747    <span class="comment">/* XXX watch out, possible deadlock - we are trying to get two channels!!! */</span>
<a name="l01748"></a>01748    chan = <a class="code" href="channel_8c.html#e01fecb172f34785571d94adbc5c6558">ast_get_channel_by_name_locked</a>(name);
<a name="l01749"></a>01749    <span class="keywordflow">if</span> (!chan) {
<a name="l01750"></a>01750       <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>[BUFSIZ];
<a name="l01751"></a>01751       snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">"Channel does not exist: %s"</span>, name);
<a name="l01752"></a>01752       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, buf);
<a name="l01753"></a>01753       <span class="keywordflow">return</span> 0;
<a name="l01754"></a>01754    }
<a name="l01755"></a>01755    <span class="keywordflow">if</span> (<a class="code" href="channel_8c.html#042e64a8d465783855a52ec8c56a9373">ast_check_hangup</a>(chan)) {
<a name="l01756"></a>01756       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Redirect failed, channel not up.\n"</span>);
<a name="l01757"></a>01757       <a class="code" href="lock_8h.html#a2fac4e1b143bef3b1ac807e0ab48f9f">ast_channel_unlock</a>(chan);
<a name="l01758"></a>01758       <span class="keywordflow">return</span> 0;
<a name="l01759"></a>01759    }
<a name="l01760"></a>01760    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(name2))
<a name="l01761"></a>01761       chan2 = <a class="code" href="channel_8c.html#e01fecb172f34785571d94adbc5c6558">ast_get_channel_by_name_locked</a>(name2);
<a name="l01762"></a>01762    <span class="keywordflow">if</span> (chan2 &amp;&amp; <a class="code" href="channel_8c.html#042e64a8d465783855a52ec8c56a9373">ast_check_hangup</a>(chan2)) {
<a name="l01763"></a>01763       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Redirect failed, extra channel not up.\n"</span>);
<a name="l01764"></a>01764       <a class="code" href="lock_8h.html#a2fac4e1b143bef3b1ac807e0ab48f9f">ast_channel_unlock</a>(chan);
<a name="l01765"></a>01765       <a class="code" href="lock_8h.html#a2fac4e1b143bef3b1ac807e0ab48f9f">ast_channel_unlock</a>(chan2);
<a name="l01766"></a>01766       <span class="keywordflow">return</span> 0;
<a name="l01767"></a>01767    }
<a name="l01768"></a>01768    res = <a class="code" href="pbx_8c.html#563b92a651459898f8ccfdc367746147">ast_async_goto</a>(chan, context, exten, pi);
<a name="l01769"></a>01769    <span class="keywordflow">if</span> (!res) {
<a name="l01770"></a>01770       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(name2)) {
<a name="l01771"></a>01771          <span class="keywordflow">if</span> (chan2)
<a name="l01772"></a>01772             res = <a class="code" href="pbx_8c.html#563b92a651459898f8ccfdc367746147">ast_async_goto</a>(chan2, context, exten, pi);
<a name="l01773"></a>01773          <span class="keywordflow">else</span>
<a name="l01774"></a>01774             res = -1;
<a name="l01775"></a>01775          <span class="keywordflow">if</span> (!res)
<a name="l01776"></a>01776             <a class="code" href="group__Group__AMI.html#g0c64878b307241bfe01cea67e09f49e2">astman_send_ack</a>(s, m, <span class="stringliteral">"Dual Redirect successful"</span>);
<a name="l01777"></a>01777          <span class="keywordflow">else</span>
<a name="l01778"></a>01778             <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Secondary redirect failed"</span>);
<a name="l01779"></a>01779       } <span class="keywordflow">else</span>
<a name="l01780"></a>01780          <a class="code" href="group__Group__AMI.html#g0c64878b307241bfe01cea67e09f49e2">astman_send_ack</a>(s, m, <span class="stringliteral">"Redirect successful"</span>);
<a name="l01781"></a>01781    } <span class="keywordflow">else</span>
<a name="l01782"></a>01782       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Redirect failed"</span>);
<a name="l01783"></a>01783    <span class="keywordflow">if</span> (chan)
<a name="l01784"></a>01784       <a class="code" href="lock_8h.html#a2fac4e1b143bef3b1ac807e0ab48f9f">ast_channel_unlock</a>(chan);
<a name="l01785"></a>01785    <span class="keywordflow">if</span> (chan2)
<a name="l01786"></a>01786       <a class="code" href="lock_8h.html#a2fac4e1b143bef3b1ac807e0ab48f9f">ast_channel_unlock</a>(chan2);
<a name="l01787"></a>01787    <span class="keywordflow">return</span> 0;
<a name="l01788"></a>01788 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g250e20c09ed384cd90623cfd01f8b551"></a><!-- doxytag: member="manager.c::action_sendtext" ref="g250e20c09ed384cd90623cfd01f8b551" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_sendtext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01681">1681</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="channel_8c-source.html#l00995">ast_get_channel_by_name_locked()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="channel_8c-source.html#l02549">ast_sendtext()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00864">astman_send_ack()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, <a class="el" href="channel_8h-source.html#l00418">ast_channel::lock</a>, and <a class="el" href="callerid_8c-source.html#l01043">name</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l01682"></a>01682 {
<a name="l01683"></a>01683    <span class="keyword">struct </span><a class="code" href="structast__channel.html">ast_channel</a> *c = NULL;
<a name="l01684"></a>01684    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Channel"</span>);
<a name="l01685"></a>01685    <span class="keyword">const</span> <span class="keywordtype">char</span> *textmsg = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Message"</span>);
<a name="l01686"></a>01686    <span class="keywordtype">int</span> res = 0;
<a name="l01687"></a>01687 
<a name="l01688"></a>01688    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(name)) {
<a name="l01689"></a>01689       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"No channel specified"</span>);
<a name="l01690"></a>01690       <span class="keywordflow">return</span> 0;
<a name="l01691"></a>01691    }
<a name="l01692"></a>01692 
<a name="l01693"></a>01693    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(textmsg)) {
<a name="l01694"></a>01694       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"No Message specified"</span>);
<a name="l01695"></a>01695       <span class="keywordflow">return</span> 0;
<a name="l01696"></a>01696    }
<a name="l01697"></a>01697 
<a name="l01698"></a>01698    c = <a class="code" href="channel_8c.html#e01fecb172f34785571d94adbc5c6558">ast_get_channel_by_name_locked</a>(name);
<a name="l01699"></a>01699    <span class="keywordflow">if</span> (!c) {
<a name="l01700"></a>01700       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"No such channel"</span>);
<a name="l01701"></a>01701       <span class="keywordflow">return</span> 0;
<a name="l01702"></a>01702    }
<a name="l01703"></a>01703 
<a name="l01704"></a>01704    res = <a class="code" href="channel_8c.html#3274faaaeb7a5646df6beead26f9ce8f">ast_sendtext</a>(c, textmsg);
<a name="l01705"></a>01705    <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;c-&gt;<a class="code" href="structast__channel.html#dce7c4174ce9323904a934a486c41288">lock</a>);
<a name="l01706"></a>01706    
<a name="l01707"></a>01707    <span class="keywordflow">if</span> (res &gt; 0)
<a name="l01708"></a>01708       <a class="code" href="group__Group__AMI.html#g0c64878b307241bfe01cea67e09f49e2">astman_send_ack</a>(s, m, <span class="stringliteral">"Success"</span>);
<a name="l01709"></a>01709    <span class="keywordflow">else</span>
<a name="l01710"></a>01710       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Failure"</span>);
<a name="l01711"></a>01711    
<a name="l01712"></a>01712    <span class="keywordflow">return</span> res;
<a name="l01713"></a>01713 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="gff61c40432e7043889c37096ac0560c7"></a><!-- doxytag: member="manager.c::action_setvar" ref="gff61c40432e7043889c37096ac0560c7" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_setvar           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01506">1506</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="lock_8h.html#a2fac4e1b143bef3b1ac807e0ab48f9f">ast_channel_unlock</a>, <a class="el" href="channel_8c-source.html#l00995">ast_get_channel_by_name_locked()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00864">astman_send_ack()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, <a class="el" href="callerid_8c-source.html#l01043">name</a>, and <a class="el" href="pbx_8c-source.html#l05821">pbx_builtin_setvar_helper()</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l01507"></a>01507 {
<a name="l01508"></a>01508         <span class="keyword">struct </span><a class="code" href="structast__channel.html">ast_channel</a> *c = NULL;
<a name="l01509"></a>01509    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Channel"</span>);
<a name="l01510"></a>01510    <span class="keyword">const</span> <span class="keywordtype">char</span> *varname = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Variable"</span>);
<a name="l01511"></a>01511    <span class="keyword">const</span> <span class="keywordtype">char</span> *varval = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Value"</span>);
<a name="l01512"></a>01512 
<a name="l01513"></a>01513    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(varname)) {
<a name="l01514"></a>01514       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"No variable specified"</span>);
<a name="l01515"></a>01515       <span class="keywordflow">return</span> 0;
<a name="l01516"></a>01516    }
<a name="l01517"></a>01517 
<a name="l01518"></a>01518    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(varval)) {
<a name="l01519"></a>01519       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"No value specified"</span>);
<a name="l01520"></a>01520       <span class="keywordflow">return</span> 0;
<a name="l01521"></a>01521    }
<a name="l01522"></a>01522 
<a name="l01523"></a>01523    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(name)) {
<a name="l01524"></a>01524       c = <a class="code" href="channel_8c.html#e01fecb172f34785571d94adbc5c6558">ast_get_channel_by_name_locked</a>(name);
<a name="l01525"></a>01525       <span class="keywordflow">if</span> (!c) {
<a name="l01526"></a>01526          <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"No such channel"</span>);
<a name="l01527"></a>01527          <span class="keywordflow">return</span> 0;
<a name="l01528"></a>01528       }
<a name="l01529"></a>01529    }
<a name="l01530"></a>01530 
<a name="l01531"></a>01531    <a class="code" href="pbx_8c.html#64407c916a2de6ae3f0efeca471c1b1d">pbx_builtin_setvar_helper</a>(c, varname, varval);
<a name="l01532"></a>01532 
<a name="l01533"></a>01533    <span class="keywordflow">if</span> (c)
<a name="l01534"></a>01534       <a class="code" href="lock_8h.html#a2fac4e1b143bef3b1ac807e0ab48f9f">ast_channel_unlock</a>(c);
<a name="l01535"></a>01535 
<a name="l01536"></a>01536    <a class="code" href="group__Group__AMI.html#g0c64878b307241bfe01cea67e09f49e2">astman_send_ack</a>(s, m, <span class="stringliteral">"Variable Set"</span>);
<a name="l01537"></a>01537 
<a name="l01538"></a>01538    <span class="keywordflow">return</span> 0;
<a name="l01539"></a>01539 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g6a023aadcdeed0f3c8db7756f06a85fe"></a><!-- doxytag: member="manager.c::action_status" ref="g6a023aadcdeed0f3c8db7756f06a85fe" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_status           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Manager "status" command to show channels. 
<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01587">1587</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="channel_8h-source.html#l00409">ast_channel::_bridge</a>, <a class="el" href="channel_8h-source.html#l00435">ast_channel::_state</a>, <a class="el" href="lock_8h.html#a2fac4e1b143bef3b1ac807e0ab48f9f">ast_channel_unlock</a>, <a class="el" href="channel_8c-source.html#l00989">ast_channel_walk_locked()</a>, <a class="el" href="channel_8c-source.html#l00995">ast_get_channel_by_name_locked()</a>, <a class="el" href="channel_8c-source.html#l00523">ast_state2str()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="manager_8c-source.html#l00802">astman_append()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00864">astman_send_ack()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, <a class="el" href="channel_8h-source.html#l00451">ast_channel::cdr</a>, <a class="el" href="channel_8h-source.html#l00437">ast_channel::cid</a>, <a class="el" href="channel_8h-source.html#l00213">ast_callerid::cid_name</a>, <a class="el" href="channel_8h-source.html#l00212">ast_callerid::cid_num</a>, <a class="el" href="channel_8h-source.html#l00441">ast_channel::context</a>, <a class="el" href="channel_8h-source.html#l00442">ast_channel::exten</a>, <a class="el" href="callerid_8c-source.html#l01043">name</a>, <a class="el" href="channel_8h-source.html#l00449">ast_channel::pbx</a>, <a class="el" href="channel_8h-source.html#l00443">ast_channel::priority</a>, <a class="el" href="strings_8h-source.html#l00045">S_OR</a>, and <a class="el" href="cdr_8h-source.html#l00070">ast_cdr::start</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l01588"></a>01588 {
<a name="l01589"></a>01589    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m,<span class="stringliteral">"Channel"</span>);
<a name="l01590"></a>01590    <span class="keyword">struct </span><a class="code" href="structast__channel.html">ast_channel</a> *c;
<a name="l01591"></a>01591    <span class="keywordtype">char</span> bridge[256];
<a name="l01592"></a>01592    <span class="keyword">struct </span>timeval now = ast_tvnow();
<a name="l01593"></a>01593    <span class="keywordtype">long</span> elapsed_seconds = 0;
<a name="l01594"></a>01594    <span class="keywordtype">int</span> all = <a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(name); <span class="comment">/* set if we want all channels */</span>
<a name="l01595"></a>01595    <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m,<span class="stringliteral">"ActionID"</span>);
<a name="l01596"></a>01596    <span class="keywordtype">char</span> idText[256] = <span class="stringliteral">""</span>;
<a name="l01597"></a>01597 
<a name="l01598"></a>01598    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(<span class="keywordtype">id</span>))
<a name="l01599"></a>01599       snprintf(idText, <span class="keyword">sizeof</span>(idText), <span class="stringliteral">"ActionID: %s\r\n"</span>, <span class="keywordtype">id</span>);
<a name="l01600"></a>01600 
<a name="l01601"></a>01601    <span class="keywordflow">if</span> (all)
<a name="l01602"></a>01602       c = <a class="code" href="channel_8c.html#8ada12445e0d71c8bcd465f6838bf4e5">ast_channel_walk_locked</a>(NULL);
<a name="l01603"></a>01603    <span class="keywordflow">else</span> {
<a name="l01604"></a>01604       c = <a class="code" href="channel_8c.html#e01fecb172f34785571d94adbc5c6558">ast_get_channel_by_name_locked</a>(name);
<a name="l01605"></a>01605       <span class="keywordflow">if</span> (!c) {
<a name="l01606"></a>01606          <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"No such channel"</span>);
<a name="l01607"></a>01607          <span class="keywordflow">return</span> 0;
<a name="l01608"></a>01608       }
<a name="l01609"></a>01609    }
<a name="l01610"></a>01610    <a class="code" href="group__Group__AMI.html#g0c64878b307241bfe01cea67e09f49e2">astman_send_ack</a>(s, m, <span class="stringliteral">"Channel status will follow"</span>);
<a name="l01611"></a>01611    <span class="comment">/* if we look by name, we break after the first iteration */</span>
<a name="l01612"></a>01612    <span class="keywordflow">while</span> (c) {
<a name="l01613"></a>01613       <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structast__channel.html#d1256a036a9f1d1bb86a04aa3e2c35dd">_bridge</a>)
<a name="l01614"></a>01614          snprintf(bridge, <span class="keyword">sizeof</span>(bridge), <span class="stringliteral">"Link: %s\r\n"</span>, c-&gt;<a class="code" href="structast__channel.html#d1256a036a9f1d1bb86a04aa3e2c35dd">_bridge</a>-&gt;name);
<a name="l01615"></a>01615       <span class="keywordflow">else</span>
<a name="l01616"></a>01616          bridge[0] = <span class="charliteral">'\0'</span>;
<a name="l01617"></a>01617       <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structast__channel.html#569f7a090087f9e7071a247a24ea0809">pbx</a>) {
<a name="l01618"></a>01618          <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a>) {
<a name="l01619"></a>01619             elapsed_seconds = now.tv_sec - c-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a>-&gt;<a class="code" href="structast__cdr.html#ea2b2676c28c0db26d39331a336c6b92">start</a>.tv_sec;
<a name="l01620"></a>01620          }
<a name="l01621"></a>01621          <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s,
<a name="l01622"></a>01622          <span class="stringliteral">"Event: Status\r\n"</span>
<a name="l01623"></a>01623          <span class="stringliteral">"Privilege: Call\r\n"</span>
<a name="l01624"></a>01624          <span class="stringliteral">"Channel: %s\r\n"</span>
<a name="l01625"></a>01625          <span class="stringliteral">"CallerIDNum: %s\r\n"</span>
<a name="l01626"></a>01626          <span class="stringliteral">"CallerIDName: %s\r\n"</span>
<a name="l01627"></a>01627          <span class="stringliteral">"Account: %s\r\n"</span>
<a name="l01628"></a>01628          <span class="stringliteral">"State: %s\r\n"</span>
<a name="l01629"></a>01629          <span class="stringliteral">"Context: %s\r\n"</span>
<a name="l01630"></a>01630          <span class="stringliteral">"Extension: %s\r\n"</span>
<a name="l01631"></a>01631          <span class="stringliteral">"Priority: %d\r\n"</span>
<a name="l01632"></a>01632          <span class="stringliteral">"Seconds: %ld\r\n"</span>
<a name="l01633"></a>01633          <span class="stringliteral">"%s"</span>
<a name="l01634"></a>01634          <span class="stringliteral">"Uniqueid: %s\r\n"</span>
<a name="l01635"></a>01635          <span class="stringliteral">"%s"</span>
<a name="l01636"></a>01636          <span class="stringliteral">"\r\n"</span>,
<a name="l01637"></a>01637          c-&gt;name,
<a name="l01638"></a>01638          <a class="code" href="strings_8h.html#a5b939153ec133be2de0e3647df143f4">S_OR</a>(c-&gt;<a class="code" href="structast__channel.html#4b7cc5694dd3a265bac326eaba31266e">cid</a>.<a class="code" href="structast__callerid.html#64191918d2ec3d68a26f486c5d134221">cid_num</a>, <span class="stringliteral">"&lt;unknown&gt;"</span>),
<a name="l01639"></a>01639          <a class="code" href="strings_8h.html#a5b939153ec133be2de0e3647df143f4">S_OR</a>(c-&gt;<a class="code" href="structast__channel.html#4b7cc5694dd3a265bac326eaba31266e">cid</a>.<a class="code" href="structast__callerid.html#51ae63e8ccffb05b130f96cc397ec7b0">cid_name</a>, <span class="stringliteral">"&lt;unknown&gt;"</span>),
<a name="l01640"></a>01640          c-&gt;accountcode,
<a name="l01641"></a>01641          <a class="code" href="channel_8c.html#1c242fd13329f5600ccd56263aba7272">ast_state2str</a>(c-&gt;<a class="code" href="structast__channel.html#fb303761f789500fe4c0c9938c1c0245">_state</a>), c-&gt;<a class="code" href="structast__channel.html#c1ae8ba118483c4c23841d72b5e7ebbb">context</a>,
<a name="l01642"></a>01642          c-&gt;<a class="code" href="structast__channel.html#5aedfeaeaac21e5e5f297360633ea9a3">exten</a>, c-&gt;<a class="code" href="structast__channel.html#b988295c268025b49dfb3df26171ddc3">priority</a>, (<span class="keywordtype">long</span>)elapsed_seconds, bridge, c-&gt;uniqueid, idText);
<a name="l01643"></a>01643       } <span class="keywordflow">else</span> {
<a name="l01644"></a>01644          <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s,
<a name="l01645"></a>01645          <span class="stringliteral">"Event: Status\r\n"</span>
<a name="l01646"></a>01646          <span class="stringliteral">"Privilege: Call\r\n"</span>
<a name="l01647"></a>01647          <span class="stringliteral">"Channel: %s\r\n"</span>
<a name="l01648"></a>01648          <span class="stringliteral">"CallerIDNum: %s\r\n"</span>
<a name="l01649"></a>01649          <span class="stringliteral">"CallerIDName: %s\r\n"</span>
<a name="l01650"></a>01650          <span class="stringliteral">"Account: %s\r\n"</span>
<a name="l01651"></a>01651          <span class="stringliteral">"State: %s\r\n"</span>
<a name="l01652"></a>01652          <span class="stringliteral">"%s"</span>
<a name="l01653"></a>01653          <span class="stringliteral">"Uniqueid: %s\r\n"</span>
<a name="l01654"></a>01654          <span class="stringliteral">"%s"</span>
<a name="l01655"></a>01655          <span class="stringliteral">"\r\n"</span>,
<a name="l01656"></a>01656          c-&gt;name,
<a name="l01657"></a>01657          <a class="code" href="strings_8h.html#a5b939153ec133be2de0e3647df143f4">S_OR</a>(c-&gt;<a class="code" href="structast__channel.html#4b7cc5694dd3a265bac326eaba31266e">cid</a>.<a class="code" href="structast__callerid.html#64191918d2ec3d68a26f486c5d134221">cid_num</a>, <span class="stringliteral">"&lt;unknown&gt;"</span>),
<a name="l01658"></a>01658          <a class="code" href="strings_8h.html#a5b939153ec133be2de0e3647df143f4">S_OR</a>(c-&gt;<a class="code" href="structast__channel.html#4b7cc5694dd3a265bac326eaba31266e">cid</a>.<a class="code" href="structast__callerid.html#51ae63e8ccffb05b130f96cc397ec7b0">cid_name</a>, <span class="stringliteral">"&lt;unknown&gt;"</span>),
<a name="l01659"></a>01659          c-&gt;accountcode,
<a name="l01660"></a>01660          <a class="code" href="channel_8c.html#1c242fd13329f5600ccd56263aba7272">ast_state2str</a>(c-&gt;<a class="code" href="structast__channel.html#fb303761f789500fe4c0c9938c1c0245">_state</a>), bridge, c-&gt;uniqueid, idText);
<a name="l01661"></a>01661       }
<a name="l01662"></a>01662       <a class="code" href="lock_8h.html#a2fac4e1b143bef3b1ac807e0ab48f9f">ast_channel_unlock</a>(c);
<a name="l01663"></a>01663       <span class="keywordflow">if</span> (!all)
<a name="l01664"></a>01664          <span class="keywordflow">break</span>;
<a name="l01665"></a>01665       c = <a class="code" href="channel_8c.html#8ada12445e0d71c8bcd465f6838bf4e5">ast_channel_walk_locked</a>(c);
<a name="l01666"></a>01666    }
<a name="l01667"></a>01667    <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s,
<a name="l01668"></a>01668    <span class="stringliteral">"Event: StatusComplete\r\n"</span>
<a name="l01669"></a>01669    <span class="stringliteral">"%s"</span>
<a name="l01670"></a>01670    <span class="stringliteral">"\r\n"</span>,idText);
<a name="l01671"></a>01671    <span class="keywordflow">return</span> 0;
<a name="l01672"></a>01672 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="ga8bc516739f567719fd6e75177f08f27"></a><!-- doxytag: member="manager.c::action_timeout" ref="ga8bc516739f567719fd6e75177f08f27" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_timeout           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02116">2116</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="channel_8c-source.html#l00386">ast_channel_setwhentohangup()</a>, <a class="el" href="lock_8h.html#a2fac4e1b143bef3b1ac807e0ab48f9f">ast_channel_unlock</a>, <a class="el" href="channel_8c-source.html#l00995">ast_get_channel_by_name_locked()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00864">astman_send_ack()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, and <a class="el" href="callerid_8c-source.html#l01043">name</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l02117"></a>02117 {
<a name="l02118"></a>02118    <span class="keyword">struct </span><a class="code" href="structast__channel.html">ast_channel</a> *c;
<a name="l02119"></a>02119    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Channel"</span>);
<a name="l02120"></a>02120    <span class="keywordtype">int</span> timeout = atoi(<a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Timeout"</span>));
<a name="l02121"></a>02121 
<a name="l02122"></a>02122    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(name)) {
<a name="l02123"></a>02123       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"No channel specified"</span>);
<a name="l02124"></a>02124       <span class="keywordflow">return</span> 0;
<a name="l02125"></a>02125    }
<a name="l02126"></a>02126    <span class="keywordflow">if</span> (!timeout) {
<a name="l02127"></a>02127       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"No timeout specified"</span>);
<a name="l02128"></a>02128       <span class="keywordflow">return</span> 0;
<a name="l02129"></a>02129    }
<a name="l02130"></a>02130    c = <a class="code" href="channel_8c.html#e01fecb172f34785571d94adbc5c6558">ast_get_channel_by_name_locked</a>(name);
<a name="l02131"></a>02131    <span class="keywordflow">if</span> (!c) {
<a name="l02132"></a>02132       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"No such channel"</span>);
<a name="l02133"></a>02133       <span class="keywordflow">return</span> 0;
<a name="l02134"></a>02134    }
<a name="l02135"></a>02135    <a class="code" href="channel_8c.html#a572798172ac3e5c4a518e6c247da125">ast_channel_setwhentohangup</a>(c, timeout);
<a name="l02136"></a>02136    <a class="code" href="lock_8h.html#a2fac4e1b143bef3b1ac807e0ab48f9f">ast_channel_unlock</a>(c);
<a name="l02137"></a>02137    <a class="code" href="group__Group__AMI.html#g0c64878b307241bfe01cea67e09f49e2">astman_send_ack</a>(s, m, <span class="stringliteral">"Timeout Set"</span>);
<a name="l02138"></a>02138    <span class="keywordflow">return</span> 0;
<a name="l02139"></a>02139 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g2543b90f06c6700af2c68d854b6b4558"></a><!-- doxytag: member="manager.c::action_updateconfig" ref="g2543b90f06c6700af2c68d854b6b4558" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_updateconfig           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01251">1251</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="config_8c-source.html#l00555">ast_config_destroy()</a>, <a class="el" href="config_8c-source.html#l01294">ast_config_load_with_comments()</a>, <a class="el" href="loader_8c-source.html#l00520">ast_module_reload()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="utils_8c-source.html#l00724">ast_true()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00864">astman_send_ack()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, <a class="el" href="config_8c-source.html#l00951">config_text_file_save()</a>, and <a class="el" href="manager_8c-source.html#l01177">handle_updates()</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l01252"></a>01252 {
<a name="l01253"></a>01253    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg;
<a name="l01254"></a>01254    <span class="keyword">const</span> <span class="keywordtype">char</span> *sfn = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"SrcFilename"</span>);
<a name="l01255"></a>01255    <span class="keyword">const</span> <span class="keywordtype">char</span> *dfn = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"DstFilename"</span>);
<a name="l01256"></a>01256    <span class="keywordtype">int</span> res;
<a name="l01257"></a>01257    <span class="keyword">const</span> <span class="keywordtype">char</span> *rld = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Reload"</span>);
<a name="l01258"></a>01258 
<a name="l01259"></a>01259    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(sfn) || <a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(dfn)) {
<a name="l01260"></a>01260       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Filename not specified"</span>);
<a name="l01261"></a>01261       <span class="keywordflow">return</span> 0;
<a name="l01262"></a>01262    }
<a name="l01263"></a>01263    <span class="keywordflow">if</span> (!(cfg = <a class="code" href="config_8c.html#2263d3aacd27024be95ac630a0a609dd">ast_config_load_with_comments</a>(sfn))) {
<a name="l01264"></a>01264       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Config file not found"</span>);
<a name="l01265"></a>01265       <span class="keywordflow">return</span> 0;
<a name="l01266"></a>01266    }
<a name="l01267"></a>01267    <a class="code" href="group__Group__AMI.html#g745d3d4809316e9124d216a6e3ce93d3">handle_updates</a>(s, m, cfg);
<a name="l01268"></a>01268    res = <a class="code" href="config_8c.html#509bc97b1300e42c8323c0d6122b9457">config_text_file_save</a>(dfn, cfg, <span class="stringliteral">"Manager"</span>);
<a name="l01269"></a>01269    <a class="code" href="config_8c.html#ad84c9d29ca53758c2a113d057e221a0">ast_config_destroy</a>(cfg);
<a name="l01270"></a>01270    <span class="keywordflow">if</span> (res) {
<a name="l01271"></a>01271       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Save of config failed"</span>);
<a name="l01272"></a>01272       <span class="keywordflow">return</span> 0;
<a name="l01273"></a>01273    }
<a name="l01274"></a>01274    <a class="code" href="group__Group__AMI.html#g0c64878b307241bfe01cea67e09f49e2">astman_send_ack</a>(s, m, NULL);
<a name="l01275"></a>01275    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(rld)) {
<a name="l01276"></a>01276       <span class="keywordflow">if</span> (<a class="code" href="utils_8c.html#63bb02e4d6f18c1dbeca92dc63310685">ast_true</a>(rld))
<a name="l01277"></a>01277          rld = NULL;
<a name="l01278"></a>01278       <a class="code" href="loader_8c.html#12479ce54a93d95bd3c845793c3c0f19">ast_module_reload</a>(rld);
<a name="l01279"></a>01279    }
<a name="l01280"></a>01280    <span class="keywordflow">return</span> 0;
<a name="l01281"></a>01281 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g81297609484dc4a21d32483e91c8b11d"></a><!-- doxytag: member="manager.c::action_userevent" ref="g81297609484dc4a21d32483e91c8b11d" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_userevent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02176">2176</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8h-source.html#l00166">event</a>, <a class="el" href="manager_8h-source.html#l00057">EVENT_FLAG_USER</a>, <a class="el" href="manager_8h-source.html#l00097">message::headers</a>, and <a class="el" href="manager_8h-source.html#l00163">manager_event</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l02177"></a>02177 {
<a name="l02178"></a>02178    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="manager_8h.html#4119639092e62c55ea8be348e4d9260d">event</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"UserEvent"</span>);
<a name="l02179"></a>02179    <span class="keywordtype">char</span> body[2048] = <span class="stringliteral">""</span>;
<a name="l02180"></a>02180    <span class="keywordtype">int</span> x, bodylen = 0;
<a name="l02181"></a>02181    <span class="keywordflow">for</span> (x = 0; x &lt; m-&gt;hdrcount; x++) {
<a name="l02182"></a>02182       <span class="keywordflow">if</span> (strncasecmp(<span class="stringliteral">"UserEvent:"</span>, m-&gt;<a class="code" href="structmessage.html#0e403735bca63ec8eb4378badc1c98d0">headers</a>[x], strlen(<span class="stringliteral">"UserEvent:"</span>))) {
<a name="l02183"></a>02183          ast_copy_string(body + bodylen, m-&gt;<a class="code" href="structmessage.html#0e403735bca63ec8eb4378badc1c98d0">headers</a>[x], <span class="keyword">sizeof</span>(body) - bodylen - 3);
<a name="l02184"></a>02184          bodylen += strlen(m-&gt;<a class="code" href="structmessage.html#0e403735bca63ec8eb4378badc1c98d0">headers</a>[x]);
<a name="l02185"></a>02185          ast_copy_string(body + bodylen, <span class="stringliteral">"\r\n"</span>, 3);
<a name="l02186"></a>02186          bodylen += 2;
<a name="l02187"></a>02187       }
<a name="l02188"></a>02188    }
<a name="l02189"></a>02189 
<a name="l02190"></a>02190    <a class="code" href="manager_8h.html#17a8c809d5b2d04cbb8969a209134c2b">manager_event</a>(<a class="code" href="manager_8h.html#87a2ec651ddd1db88b41715162d7a242">EVENT_FLAG_USER</a>, <span class="stringliteral">"UserEvent"</span>, <span class="stringliteral">"UserEvent: %s\r\n%s"</span>, event, body);
<a name="l02191"></a>02191    <span class="keywordflow">return</span> 0;
<a name="l02192"></a>02192 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g8c03c9dc4ab8279645aa28d8ec5d7290"></a><!-- doxytag: member="manager.c::action_waitevent" ref="g8c03c9dc4ab8279645aa28d8ec5d7290" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int action_waitevent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01291">1291</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00141">mansession::__lock</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="lock_8h-source.html#l00074">AST_PTHREADT_NULL</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="utils_8c-source.html#l00624">ast_wait_for_input()</a>, <a class="el" href="manager_8c-source.html#l00802">astman_append()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00854">astman_send_response()</a>, <a class="el" href="manager_8c-source.html#l00145">mansession::fd</a>, <a class="el" href="manager_8c-source.html#l00160">mansession::last_ev</a>, <a class="el" href="logger_8h-source.html#l00094">LOG_DEBUG</a>, <a class="el" href="manager_8c-source.html#l00149">mansession::managerid</a>, <a class="el" href="manager_8c-source.html#l00147">mansession::needdestroy</a>, <a class="el" href="manager_8c-source.html#l00165">NEW_EVENT</a>, <a class="el" href="asterisk_8c-source.html#l00164">option_debug</a>, <a class="el" href="manager_8c-source.html#l00154">mansession::readperm</a>, <a class="el" href="manager_8c-source.html#l00685">ref_event()</a>, <a class="el" href="manager_8c-source.html#l00159">mansession::send_events</a>, <a class="el" href="manager_8c-source.html#l00150">mansession::sessiontimeout</a>, <a class="el" href="manager_8c-source.html#l00679">unref_event()</a>, and <a class="el" href="manager_8c-source.html#l00148">mansession::waiting_thread</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l01292"></a>01292 {
<a name="l01293"></a>01293    <span class="keyword">const</span> <span class="keywordtype">char</span> *timeouts = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Timeout"</span>);
<a name="l01294"></a>01294    <span class="keywordtype">int</span> timeout = -1;
<a name="l01295"></a>01295    <span class="keywordtype">int</span> x;
<a name="l01296"></a>01296    <span class="keywordtype">int</span> needexit = 0;
<a name="l01297"></a>01297    <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m,<span class="stringliteral">"ActionID"</span>);
<a name="l01298"></a>01298    <span class="keywordtype">char</span> idText[256] = <span class="stringliteral">""</span>;
<a name="l01299"></a>01299 
<a name="l01300"></a>01300    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(<span class="keywordtype">id</span>))
<a name="l01301"></a>01301       snprintf(idText, <span class="keyword">sizeof</span>(idText), <span class="stringliteral">"ActionID: %s\r\n"</span>, <span class="keywordtype">id</span>);
<a name="l01302"></a>01302 
<a name="l01303"></a>01303    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(timeouts)) {
<a name="l01304"></a>01304       sscanf(timeouts, <span class="stringliteral">"%i"</span>, &amp;timeout);
<a name="l01305"></a>01305       <span class="keywordflow">if</span> (timeout &lt; -1)
<a name="l01306"></a>01306          timeout = -1;
<a name="l01307"></a>01307       <span class="comment">/* XXX maybe put an upper bound, or prevent the use of 0 ? */</span>
<a name="l01308"></a>01308    }
<a name="l01309"></a>01309 
<a name="l01310"></a>01310    <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l01311"></a>01311    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structmansession.html#6ab67d39209330f594dbe0828ca5ac80">waiting_thread</a> != <a class="code" href="lock_8h.html#84e4b34008de83ea9d1fa44057758022">AST_PTHREADT_NULL</a>)
<a name="l01312"></a>01312       pthread_kill(s-&gt;<a class="code" href="structmansession.html#6ab67d39209330f594dbe0828ca5ac80">waiting_thread</a>, SIGURG);
<a name="l01313"></a>01313 
<a name="l01314"></a>01314    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structmansession.html#5eb0038a1d93de54c255dc46dcd40c66">managerid</a>) { <span class="comment">/* AMI-over-HTTP session */</span>
<a name="l01315"></a>01315       <span class="comment">/*</span>
<a name="l01316"></a>01316 <span class="comment">       * Make sure the timeout is within the expire time of the session,</span>
<a name="l01317"></a>01317 <span class="comment">       * as the client will likely abort the request if it does not see</span>
<a name="l01318"></a>01318 <span class="comment">       * data coming after some amount of time.</span>
<a name="l01319"></a>01319 <span class="comment">       */</span>
<a name="l01320"></a>01320       time_t now = time(NULL);
<a name="l01321"></a>01321       <span class="keywordtype">int</span> max = s-&gt;<a class="code" href="structmansession.html#cc09d7a7585e6c67ce40707760dd8ba2">sessiontimeout</a> - now - 10;
<a name="l01322"></a>01322 
<a name="l01323"></a>01323       <span class="keywordflow">if</span> (max &lt; 0)   <span class="comment">/* We are already late. Strange but possible. */</span>
<a name="l01324"></a>01324          max = 0;
<a name="l01325"></a>01325       <span class="keywordflow">if</span> (timeout &lt; 0 || timeout &gt; max)
<a name="l01326"></a>01326          timeout = max;
<a name="l01327"></a>01327       <span class="keywordflow">if</span> (!s-&gt;<a class="code" href="structmansession.html#7f0871bb51563c57440b9ba3875cdaa1">send_events</a>) <span class="comment">/* make sure we record events */</span>
<a name="l01328"></a>01328          s-&gt;<a class="code" href="structmansession.html#7f0871bb51563c57440b9ba3875cdaa1">send_events</a> = -1;
<a name="l01329"></a>01329    }
<a name="l01330"></a>01330    <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l01331"></a>01331 
<a name="l01332"></a>01332    <span class="comment">/* XXX should this go inside the lock ? */</span>
<a name="l01333"></a>01333    s-&gt;<a class="code" href="structmansession.html#6ab67d39209330f594dbe0828ca5ac80">waiting_thread</a> = pthread_self(); <span class="comment">/* let new events wake up this thread */</span>
<a name="l01334"></a>01334    <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a>)
<a name="l01335"></a>01335       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"Starting waiting for an event!\n"</span>);
<a name="l01336"></a>01336 
<a name="l01337"></a>01337    <span class="keywordflow">for</span> (x=0; x &lt; timeout || timeout &lt; 0; x++) {
<a name="l01338"></a>01338       <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l01339"></a>01339       <span class="keywordflow">if</span> (<a class="code" href="group__Group__AMI.html#gf074edf91f83d1f06f7e1bb384bb050a">NEW_EVENT</a>(s))
<a name="l01340"></a>01340          needexit = 1;
<a name="l01341"></a>01341       <span class="comment">/* We can have multiple HTTP session point to the same mansession entry.</span>
<a name="l01342"></a>01342 <span class="comment">       * The way we deal with it is not very nice: newcomers kick out the previous</span>
<a name="l01343"></a>01343 <span class="comment">       * HTTP session. XXX this needs to be improved.</span>
<a name="l01344"></a>01344 <span class="comment">       */</span>
<a name="l01345"></a>01345       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structmansession.html#6ab67d39209330f594dbe0828ca5ac80">waiting_thread</a> != pthread_self())
<a name="l01346"></a>01346          needexit = 1;
<a name="l01347"></a>01347       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structmansession.html#550961e9c744e38a27b28e50d66f595d">needdestroy</a>)
<a name="l01348"></a>01348          needexit = 1;
<a name="l01349"></a>01349       <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l01350"></a>01350       <span class="keywordflow">if</span> (needexit)
<a name="l01351"></a>01351          <span class="keywordflow">break</span>;
<a name="l01352"></a>01352       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structmansession.html#5eb0038a1d93de54c255dc46dcd40c66">managerid</a> == 0) {   <span class="comment">/* AMI session */</span>
<a name="l01353"></a>01353          <span class="keywordflow">if</span> (<a class="code" href="utils_8c.html#88e6eaa2c6fb4d77011df76d5d193728">ast_wait_for_input</a>(s-&gt;<a class="code" href="structmansession.html#36eba1e1e343279857ea7f69a597324e">fd</a>, 1000))
<a name="l01354"></a>01354             <span class="keywordflow">break</span>;
<a name="l01355"></a>01355       } <span class="keywordflow">else</span> { <span class="comment">/* HTTP session */</span>
<a name="l01356"></a>01356          sleep(1);
<a name="l01357"></a>01357       }
<a name="l01358"></a>01358    }
<a name="l01359"></a>01359    <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a>)
<a name="l01360"></a>01360       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"Finished waiting for an event!\n"</span>);
<a name="l01361"></a>01361    <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l01362"></a>01362    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structmansession.html#6ab67d39209330f594dbe0828ca5ac80">waiting_thread</a> == pthread_self()) {
<a name="l01363"></a>01363       <span class="keyword">struct </span><a class="code" href="structeventqent.html">eventqent</a> *eqe;
<a name="l01364"></a>01364       <a class="code" href="group__Group__AMI.html#g005978ca7456f4c36c0cd89907d68fdb">astman_send_response</a>(s, m, <span class="stringliteral">"Success"</span>, <span class="stringliteral">"Waiting for Event completed."</span>);
<a name="l01365"></a>01365       <span class="keywordflow">while</span> ( (eqe = <a class="code" href="group__Group__AMI.html#gf074edf91f83d1f06f7e1bb384bb050a">NEW_EVENT</a>(s)) ) {
<a name="l01366"></a>01366          <a class="code" href="group__Group__AMI.html#ga640283e96a4cdde5b36633464a1318a">ref_event</a>(eqe);
<a name="l01367"></a>01367          <span class="keywordflow">if</span> (((s-&gt;<a class="code" href="structmansession.html#e12b8f9551a73d6196648b62754aa9e1">readperm</a> &amp; eqe-&gt;<a class="code" href="structeventqent.html#c4ef352f74e502ef5e7bc98e6f4e493d">category</a>) == eqe-&gt;<a class="code" href="structeventqent.html#c4ef352f74e502ef5e7bc98e6f4e493d">category</a>) &amp;&amp;
<a name="l01368"></a>01368              ((s-&gt;<a class="code" href="structmansession.html#7f0871bb51563c57440b9ba3875cdaa1">send_events</a> &amp; eqe-&gt;<a class="code" href="structeventqent.html#c4ef352f74e502ef5e7bc98e6f4e493d">category</a>) == eqe-&gt;<a class="code" href="structeventqent.html#c4ef352f74e502ef5e7bc98e6f4e493d">category</a>)) {
<a name="l01369"></a>01369             <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"%s"</span>, eqe-&gt;eventdata);
<a name="l01370"></a>01370          }
<a name="l01371"></a>01371          s-&gt;<a class="code" href="structmansession.html#272f831d79581a3d16783a36da17e10c">last_ev</a> = <a class="code" href="group__Group__AMI.html#gfb5ee4f215d8a2bd0f91355e21f53df5">unref_event</a>(s-&gt;<a class="code" href="structmansession.html#272f831d79581a3d16783a36da17e10c">last_ev</a>);
<a name="l01372"></a>01372       }
<a name="l01373"></a>01373       <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s,
<a name="l01374"></a>01374          <span class="stringliteral">"Event: WaitEventComplete\r\n"</span>
<a name="l01375"></a>01375          <span class="stringliteral">"%s"</span>
<a name="l01376"></a>01376          <span class="stringliteral">"\r\n"</span>, idText);
<a name="l01377"></a>01377       s-&gt;<a class="code" href="structmansession.html#6ab67d39209330f594dbe0828ca5ac80">waiting_thread</a> = <a class="code" href="lock_8h.html#84e4b34008de83ea9d1fa44057758022">AST_PTHREADT_NULL</a>;
<a name="l01378"></a>01378    } <span class="keywordflow">else</span> {
<a name="l01379"></a>01379       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a>)
<a name="l01380"></a>01380          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"Abandoning event request!\n"</span>);
<a name="l01381"></a>01381    }
<a name="l01382"></a>01382    <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l01383"></a>01383    <span class="keywordflow">return</span> 0;
<a name="l01384"></a>01384 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g38726448f966fa5ad7aaa3141ba16235"></a><!-- doxytag: member="manager.c::append_event" ref="g38726448f966fa5ad7aaa3141ba16235" args="(const char *str, int category)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int append_event           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>str</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>category</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02536">2536</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="linkedlists_8h-source.html#l00670">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00403">AST_LIST_NEXT</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, <a class="el" href="utils_8h-source.html#l00359">ast_malloc</a>, and <a class="el" href="manager_8c-source.html#l00106">eventqent::seq</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l02563">__manager_event()</a>, and <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l02537"></a>02537 {
<a name="l02538"></a>02538    <span class="keyword">struct </span><a class="code" href="structeventqent.html">eventqent</a> *tmp = <a class="code" href="utils_8h.html#efc2f2f953e736b509e4a2cee96151db">ast_malloc</a>(<span class="keyword">sizeof</span>(*tmp) + strlen(str));
<a name="l02539"></a>02539    <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__sms_8c.html#e068c2de26d760f20cf10afc4b87ef0f">seq</a>;   <span class="comment">/* sequence number */</span>
<a name="l02540"></a>02540 
<a name="l02541"></a>02541    <span class="keywordflow">if</span> (!tmp)
<a name="l02542"></a>02542       <span class="keywordflow">return</span> -1;
<a name="l02543"></a>02543 
<a name="l02544"></a>02544    <span class="comment">/* need to init all fields, because ast_malloc() does not */</span>
<a name="l02545"></a>02545    tmp-&gt;usecount = 0;
<a name="l02546"></a>02546    tmp-&gt;category = <a class="code" href="structeventqent.html#c4ef352f74e502ef5e7bc98e6f4e493d">category</a>;
<a name="l02547"></a>02547    tmp-&gt;seq = ast_atomic_fetchadd_int(&amp;seq, 1);
<a name="l02548"></a>02548    <a class="code" href="linkedlists_8h.html#ab7d30c78fda9982ddc59f746adf8a69">AST_LIST_NEXT</a>(tmp, eq_next) = NULL;
<a name="l02549"></a>02549    strcpy(tmp-&gt;eventdata, str);
<a name="l02550"></a>02550 
<a name="l02551"></a>02551    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;all_events);
<a name="l02552"></a>02552    <a class="code" href="linkedlists_8h.html#8de6ce8a3b9d59e7e7fddee6b62b32a7">AST_LIST_INSERT_TAIL</a>(&amp;all_events, tmp, eq_next);
<a name="l02553"></a>02553    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;all_events);
<a name="l02554"></a>02554 
<a name="l02555"></a>02555    <span class="keywordflow">return</span> 0;
<a name="l02556"></a>02556 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g5084ba51108af1062dd03070916e4990"></a><!-- doxytag: member="manager.c::ast_instring" ref="g5084ba51108af1062dd03070916e4990" args="(const char *bigstr, const char *smallstr, const char delim)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int ast_instring           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>bigstr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>smallstr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char&nbsp;</td>
          <td class="mdname" nowrap> <em>delim</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Tells you if smallstr exists inside bigstr which is delim by delim and uses no buf or stringsep ast_instring("this|that|more","this",'|') == 1;<p>
feel free to move this to <a class="el" href="app_8c.html">app.c</a> -anthm 
<p>
Definition at line <a class="el" href="manager_8c-source.html#l00349">349</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l00366">get_perm()</a>.<div class="fragment"><pre class="fragment"><a name="l00350"></a>00350 {
<a name="l00351"></a>00351    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structval.html">val</a> = bigstr, *next;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353    <span class="keywordflow">do</span> {
<a name="l00354"></a>00354       <span class="keywordflow">if</span> ((next = strchr(val, delim))) {
<a name="l00355"></a>00355          <span class="keywordflow">if</span> (!strncmp(val, smallstr, (next - val)))
<a name="l00356"></a>00356             <span class="keywordflow">return</span> 1;
<a name="l00357"></a>00357          <span class="keywordflow">else</span>
<a name="l00358"></a>00358             <span class="keywordflow">continue</span>;
<a name="l00359"></a>00359       } <span class="keywordflow">else</span>
<a name="l00360"></a>00360          <span class="keywordflow">return</span> !strcmp(smallstr, val);
<a name="l00361"></a>00361    } <span class="keywordflow">while</span> (*(val = (next + 1)));
<a name="l00362"></a>00362 
<a name="l00363"></a>00363    <span class="keywordflow">return</span> 0;
<a name="l00364"></a>00364 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g27dd5ddaaf167c42db67c0ca97effe80"></a><!-- doxytag: member="manager.c::AST_LIST_HEAD_STATIC" ref="g27dd5ddaaf167c42db67c0ca97effe80" args="(users, ast_manager_user)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static AST_LIST_HEAD_STATIC           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">users&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="structast__manager__user.html">ast_manager_user</a>&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
list of users found in the config file 
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g2c7cd483b33dbd5909699ec9fead5820"></a><!-- doxytag: member="manager.c::AST_LIST_HEAD_STATIC" ref="g2c7cd483b33dbd5909699ec9fead5820" args="(sessions, mansession)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static AST_LIST_HEAD_STATIC           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="structmansession.html">mansession</a>&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g43f98ff67535a3a333db98cd235b847b"></a><!-- doxytag: member="manager.c::AST_LIST_HEAD_STATIC" ref="g43f98ff67535a3a333db98cd235b847b" args="(all_events, eventqent)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static AST_LIST_HEAD_STATIC           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">all_events&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="structeventqent.html">eventqent</a>&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g84a70f66019d4cf74b8e203011d22431"></a><!-- doxytag: member="manager.c::ast_manager_register2" ref="g84a70f66019d4cf74b8e203011d22431" args="(const char *action, int auth, int(*func)(struct mansession *s, const struct message *m), const char *synopsis, const char *description)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_manager_register2           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>action</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>authority</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int(*)(struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)&nbsp;</td>
          <td class="mdname" nowrap> <em>func</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>synopsis</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>description</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
register a new command with manager, including online help. This is the preferred way to register a manager command 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>action</em>&nbsp;</td><td>Name of the requested Action: </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>authority</em>&nbsp;</td><td>Required authority for this command </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>func</em>&nbsp;</td><td>Function to call for this command </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>synopsis</em>&nbsp;</td><td>Help text (one line, up to 30 chars) for CLI manager show commands </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>description</em>&nbsp;</td><td>Help text, several lines </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02694">2694</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="utils_8h-source.html#l00359">ast_malloc</a>, and <a class="el" href="manager_8c-source.html#l02664">ast_manager_register_struct()</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>, <a class="el" href="app__senddtmf_8c-source.html#l00133">load_module()</a>, and <a class="el" href="pbx_8c-source.html#l06035">load_pbx()</a>.<div class="fragment"><pre class="fragment"><a name="l02695"></a>02695 {
<a name="l02696"></a>02696    <span class="keyword">struct </span><a class="code" href="structmanager__action.html">manager_action</a> *cur;
<a name="l02697"></a>02697 
<a name="l02698"></a>02698    cur = <a class="code" href="utils_8h.html#efc2f2f953e736b509e4a2cee96151db">ast_malloc</a>(<span class="keyword">sizeof</span>(*cur));
<a name="l02699"></a>02699    <span class="keywordflow">if</span> (!cur)
<a name="l02700"></a>02700       <span class="keywordflow">return</span> -1;
<a name="l02701"></a>02701 
<a name="l02702"></a>02702    cur-&gt;<a class="code" href="structmanager__action.html#418c5509e2171d55b0aee5c2ea4442b5">action</a> = <a class="code" href="structmanager__action.html#418c5509e2171d55b0aee5c2ea4442b5">action</a>;
<a name="l02703"></a>02703    cur-&gt;<a class="code" href="structmanager__action.html#873e9c0b50183b613336eea1020f4369">authority</a> = auth;
<a name="l02704"></a>02704    cur-&gt;<a class="code" href="structmanager__action.html#b9de002f6fa5a7254b767f219f6a5d42">func</a> = <a class="code" href="manager_8h.html#7df4935f4a5a2865191ef74f64df8754">func</a>;
<a name="l02705"></a>02705    cur-&gt;<a class="code" href="structmanager__action.html#512fbb4e7b617c04031f58b631f2b05d">synopsis</a> = <a class="code" href="chan__agent_8c.html#485d112e4e425dde393e2e7091451856">synopsis</a>;
<a name="l02706"></a>02706    cur-&gt;<a class="code" href="structmanager__action.html#67daf92c833c41c95db874e18fcb2786">description</a> = <a class="code" href="callerid_8c.html#67daf92c833c41c95db874e18fcb2786">description</a>;
<a name="l02707"></a>02707    cur-&gt;<a class="code" href="structmanager__action.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a> = NULL;
<a name="l02708"></a>02708 
<a name="l02709"></a>02709    <a class="code" href="group__Group__AMI.html#g1c56b6ed4b387e1facec1c969283ad56">ast_manager_register_struct</a>(cur);
<a name="l02710"></a>02710 
<a name="l02711"></a>02711    <span class="keywordflow">return</span> 0;
<a name="l02712"></a>02712 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g6c0dd33a0e93b1a38be809f2e99980e4"></a><!-- doxytag: member="manager.c::ast_manager_register_hook" ref="g6c0dd33a0e93b1a38be809f2e99980e4" args="(struct manager_custom_hook *hook)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_manager_register_hook           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmanager__custom__hook.html">manager_custom_hook</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hook</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Add a custom hook to be called when an event is fired. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hook</em>&nbsp;</td><td>struct <a class="el" href="structmanager__custom__hook.html">manager_custom_hook</a> object to add </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00197">197</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="linkedlists_8h-source.html#l00680">AST_RWLIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h-source.html#l00115">AST_RWLIST_UNLOCK</a>, and <a class="el" href="linkedlists_8h-source.html#l00049">AST_RWLIST_WRLOCK</a>.<div class="fragment"><pre class="fragment"><a name="l00198"></a>00198 {
<a name="l00199"></a>00199    <a class="code" href="linkedlists_8h.html#a8a78c1cb0b68179bb2e44d27216a5af">AST_RWLIST_WRLOCK</a>(&amp;manager_hooks);
<a name="l00200"></a>00200    <a class="code" href="linkedlists_8h.html#64b41a3e9f2e6a867c09431dfae7ce21">AST_RWLIST_INSERT_TAIL</a>(&amp;manager_hooks, hook, list);
<a name="l00201"></a>00201    <a class="code" href="linkedlists_8h.html#470215c8af4ffcdb09701e5d092a9205">AST_RWLIST_UNLOCK</a>(&amp;manager_hooks);
<a name="l00202"></a>00202    <span class="keywordflow">return</span>;
<a name="l00203"></a>00203 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g1c56b6ed4b387e1facec1c969283ad56"></a><!-- doxytag: member="manager.c::ast_manager_register_struct" ref="g1c56b6ed4b387e1facec1c969283ad56" args="(struct manager_action *act)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int ast_manager_register_struct           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmanager__action.html">manager_action</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>act</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02664">2664</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8h-source.html#l00102">manager_action::action</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="lock_8h-source.html#l00637">ast_rwlock_unlock()</a>, <a class="el" href="lock_8h-source.html#l00652">ast_rwlock_wrlock()</a>, <a class="el" href="logger_8c-source.html#l00989">ast_verbose()</a>, <a class="el" href="manager_8c-source.html#l00191">first_action</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="manager_8h-source.html#l00112">manager_action::next</a>, <a class="el" href="asterisk_8c-source.html#l00163">option_verbose</a>, and <a class="el" href="logger_8h-source.html#l00044">VERBOSE_PREFIX_2</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l02694">ast_manager_register2()</a>.<div class="fragment"><pre class="fragment"><a name="l02665"></a>02665 {
<a name="l02666"></a>02666    <span class="keyword">struct </span><a class="code" href="structmanager__action.html">manager_action</a> *cur, *prev = NULL;
<a name="l02667"></a>02667    <span class="keywordtype">int</span> ret;
<a name="l02668"></a>02668 
<a name="l02669"></a>02669    <a class="code" href="lock_8h.html#25d2e851f878ee9a64d36b67b67ede6e">ast_rwlock_wrlock</a>(&amp;actionlock);
<a name="l02670"></a>02670    <span class="keywordflow">for</span> (cur = <a class="code" href="group__Group__AMI.html#gb9fdf2c32a9e1ffe8bea294eb2132fe6">first_action</a>; cur; prev = cur, cur = cur-&gt;<a class="code" href="structmanager__action.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>) {
<a name="l02671"></a>02671       ret = strcasecmp(cur-&gt;<a class="code" href="structmanager__action.html#418c5509e2171d55b0aee5c2ea4442b5">action</a>, act-&gt;<a class="code" href="structmanager__action.html#418c5509e2171d55b0aee5c2ea4442b5">action</a>);
<a name="l02672"></a>02672       <span class="keywordflow">if</span> (ret == 0) {
<a name="l02673"></a>02673          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Manager: Action '%s' already registered\n"</span>, act-&gt;<a class="code" href="structmanager__action.html#418c5509e2171d55b0aee5c2ea4442b5">action</a>);
<a name="l02674"></a>02674          <a class="code" href="lock_8h.html#97ed909ef0a0582cf3870dd0629852c8">ast_rwlock_unlock</a>(&amp;actionlock);
<a name="l02675"></a>02675          <span class="keywordflow">return</span> -1;
<a name="l02676"></a>02676       }
<a name="l02677"></a>02677       <span class="keywordflow">if</span> (ret &gt; 0)   <span class="comment">/* Insert these alphabetically */</span>
<a name="l02678"></a>02678          <span class="keywordflow">break</span>;
<a name="l02679"></a>02679    }
<a name="l02680"></a>02680    <span class="keywordflow">if</span> (prev)
<a name="l02681"></a>02681       prev-&gt;<a class="code" href="structmanager__action.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a> = act;
<a name="l02682"></a>02682    <span class="keywordflow">else</span>
<a name="l02683"></a>02683       <a class="code" href="group__Group__AMI.html#gb9fdf2c32a9e1ffe8bea294eb2132fe6">first_action</a> = act;
<a name="l02684"></a>02684    act-&gt;<a class="code" href="structmanager__action.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a> = cur;
<a name="l02685"></a>02685 
<a name="l02686"></a>02686    <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ge36cdd7167e060bff70d00fbd82809eb">option_verbose</a> &gt; 1)
<a name="l02687"></a>02687       <a class="code" href="logger_8c.html#6a1ef0a194bcc79fccfb662192954477">ast_verbose</a>(<a class="code" href="logger_8h.html#6e3640436a97291b451a8d264b5ab15d">VERBOSE_PREFIX_2</a> <span class="stringliteral">"Manager registered action %s\n"</span>, act-&gt;<a class="code" href="structmanager__action.html#418c5509e2171d55b0aee5c2ea4442b5">action</a>);
<a name="l02688"></a>02688    <a class="code" href="lock_8h.html#97ed909ef0a0582cf3870dd0629852c8">ast_rwlock_unlock</a>(&amp;actionlock);
<a name="l02689"></a>02689    <span class="keywordflow">return</span> 0;
<a name="l02690"></a>02690 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g2ec5f3830dfb4a55fdf0ad8e78bc0db6"></a><!-- doxytag: member="manager.c::ast_manager_unregister" ref="g2ec5f3830dfb4a55fdf0ad8e78bc0db6" args="(char *action)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_manager_unregister           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>action</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>action</em>&nbsp;</td><td>Name of registred Action: </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02633">2633</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8h-source.html#l00102">manager_action::action</a>, <a class="el" href="lock_8h-source.html#l00637">ast_rwlock_unlock()</a>, <a class="el" href="lock_8h-source.html#l00652">ast_rwlock_wrlock()</a>, <a class="el" href="logger_8c-source.html#l00989">ast_verbose()</a>, <a class="el" href="manager_8c-source.html#l00191">first_action</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="manager_8h-source.html#l00112">manager_action::next</a>, <a class="el" href="asterisk_8c-source.html#l00163">option_verbose</a>, and <a class="el" href="logger_8h-source.html#l00044">VERBOSE_PREFIX_2</a>.
<p>
Referenced by <a class="el" href="chan__iax2_8c-source.html#l10340">__unload_module()</a>, and <a class="el" href="app__meetme_8c-source.html#l04823">unload_module()</a>.<div class="fragment"><pre class="fragment"><a name="l02634"></a>02634 {
<a name="l02635"></a>02635    <span class="keyword">struct </span><a class="code" href="structmanager__action.html">manager_action</a> *cur, *prev;
<a name="l02636"></a>02636 
<a name="l02637"></a>02637    <a class="code" href="lock_8h.html#25d2e851f878ee9a64d36b67b67ede6e">ast_rwlock_wrlock</a>(&amp;actionlock);
<a name="l02638"></a>02638    <span class="keywordflow">for</span> (cur = <a class="code" href="group__Group__AMI.html#gb9fdf2c32a9e1ffe8bea294eb2132fe6">first_action</a>, prev = NULL; cur; prev = cur, cur = cur-&gt;<a class="code" href="structmanager__action.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>) {
<a name="l02639"></a>02639       <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="structmanager__action.html#418c5509e2171d55b0aee5c2ea4442b5">action</a>, cur-&gt;<a class="code" href="structmanager__action.html#418c5509e2171d55b0aee5c2ea4442b5">action</a>)) {
<a name="l02640"></a>02640          <span class="keywordflow">if</span> (prev)
<a name="l02641"></a>02641             prev-&gt;<a class="code" href="structmanager__action.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a> = cur-&gt;<a class="code" href="structmanager__action.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>;
<a name="l02642"></a>02642          <span class="keywordflow">else</span>
<a name="l02643"></a>02643             <a class="code" href="group__Group__AMI.html#gb9fdf2c32a9e1ffe8bea294eb2132fe6">first_action</a> = cur-&gt;<a class="code" href="structmanager__action.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>;
<a name="l02644"></a>02644          <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(cur);
<a name="l02645"></a>02645          <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ge36cdd7167e060bff70d00fbd82809eb">option_verbose</a> &gt; 1)
<a name="l02646"></a>02646             <a class="code" href="logger_8c.html#6a1ef0a194bcc79fccfb662192954477">ast_verbose</a>(<a class="code" href="logger_8h.html#6e3640436a97291b451a8d264b5ab15d">VERBOSE_PREFIX_2</a> <span class="stringliteral">"Manager unregistered action %s\n"</span>, <a class="code" href="structmanager__action.html#418c5509e2171d55b0aee5c2ea4442b5">action</a>);
<a name="l02647"></a>02647          <span class="keywordflow">break</span>;
<a name="l02648"></a>02648       }
<a name="l02649"></a>02649    }
<a name="l02650"></a>02650    <a class="code" href="lock_8h.html#97ed909ef0a0582cf3870dd0629852c8">ast_rwlock_unlock</a>(&amp;actionlock);
<a name="l02651"></a>02651    <span class="keywordflow">return</span> 0;
<a name="l02652"></a>02652 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g146f09ab1ed1df560f0ffe8113b3a88d"></a><!-- doxytag: member="manager.c::ast_manager_unregister_hook" ref="g146f09ab1ed1df560f0ffe8113b3a88d" args="(struct manager_custom_hook *hook)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_manager_unregister_hook           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmanager__custom__hook.html">manager_custom_hook</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>hook</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Delete a custom hook to be called when an event is fired. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hook</em>&nbsp;</td><td>struct <a class="el" href="structmanager__custom__hook.html">manager_custom_hook</a> object to delete </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00206">206</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="linkedlists_8h-source.html#l00749">AST_RWLIST_REMOVE</a>, <a class="el" href="linkedlists_8h-source.html#l00115">AST_RWLIST_UNLOCK</a>, and <a class="el" href="linkedlists_8h-source.html#l00049">AST_RWLIST_WRLOCK</a>.<div class="fragment"><pre class="fragment"><a name="l00207"></a>00207 {
<a name="l00208"></a>00208    <a class="code" href="linkedlists_8h.html#a8a78c1cb0b68179bb2e44d27216a5af">AST_RWLIST_WRLOCK</a>(&amp;manager_hooks);
<a name="l00209"></a>00209    <a class="code" href="linkedlists_8h.html#dd27d7fa9f70ab8e5e35161cafdd0459">AST_RWLIST_REMOVE</a>(&amp;manager_hooks, hook, list);
<a name="l00210"></a>00210    <a class="code" href="linkedlists_8h.html#470215c8af4ffcdb09701e5d092a9205">AST_RWLIST_UNLOCK</a>(&amp;manager_hooks);
<a name="l00211"></a>00211    <span class="keywordflow">return</span>;
<a name="l00212"></a>00212 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="gdbef91cfd3f735bb23131f3ba504e92c"></a><!-- doxytag: member="manager.c::AST_RWLIST_HEAD_STATIC" ref="gdbef91cfd3f735bb23131f3ba504e92c" args="(manager_hooks, manager_custom_hook)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static AST_RWLIST_HEAD_STATIC           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">manager_hooks&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="structmanager__custom__hook.html">manager_custom_hook</a>&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g65d58d1cf1ff44fff0b3a95a45ab8ce4"></a><!-- doxytag: member="manager.c::AST_RWLOCK_DEFINE_STATIC" ref="g65d58d1cf1ff44fff0b3a95a45ab8ce4" args="(actionlock)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">AST_RWLOCK_DEFINE_STATIC           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">actionlock&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="gc8eeff4c44733611adbabf832d757bcc"></a><!-- doxytag: member="manager.c::AST_THREADSTORAGE" ref="gc8eeff4c44733611adbabf832d757bcc" args="(manager_event_buf)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">AST_THREADSTORAGE           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">manager_event_buf&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g4512bf7f1ec9d9c1e5a77990fe18ea5f"></a><!-- doxytag: member="manager.c::AST_THREADSTORAGE" ref="g4512bf7f1ec9d9c1e5a77990fe18ea5f" args="(astman_append_buf)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">AST_THREADSTORAGE           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">astman_append_buf&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="gb743ac558357307ea2fdd322561e371b"></a><!-- doxytag: member="manager.c::astman_append" ref="gb743ac558357307ea2fdd322561e371b" args="(struct mansession *s, const char *fmt,...)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void astman_append           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>&nbsp;</td>
          <td class="mdname" nowrap> <em>...</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
utility functions for creating AMI replies 
<p>
Definition at line <a class="el" href="manager_8c-source.html#l00802">802</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="strings_8h-source.html#l00552">ast_str_set_va</a>, <a class="el" href="logger_8c-source.html#l00989">ast_verbose()</a>, <a class="el" href="manager_8c-source.html#l00797">ASTMAN_APPEND_BUF_INITSIZE</a>, <a class="el" href="adsistub_8c-source.html#l00065">buf</a>, <a class="el" href="manager_8c-source.html#l00144">mansession::f</a>, <a class="el" href="manager_8c-source.html#l00767">send_string()</a>, and <a class="el" href="strings_8h-source.html#l00319">ast_str::str</a>.
<p>
Referenced by <a class="el" href="chan__iax2_8c-source.html#l04208">__iax2_show_peers()</a>, <a class="el" href="chan__sip_8c-source.html#l10808">_sip_show_peer()</a>, <a class="el" href="chan__agent_8c-source.html#l01402">action_agents()</a>, <a class="el" href="manager_8c-source.html#l01458">action_challenge()</a>, <a class="el" href="manager_8c-source.html#l01797">action_command()</a>, <a class="el" href="manager_8c-source.html#l02200">action_coresettings()</a>, <a class="el" href="manager_8c-source.html#l02244">action_corestatus()</a>, <a class="el" href="manager_8c-source.html#l02085">action_extensionstate()</a>, <a class="el" href="manager_8c-source.html#l01065">action_getconfig()</a>, <a class="el" href="manager_8c-source.html#l01114">action_getconfigjson()</a>, <a class="el" href="manager_8c-source.html#l01548">action_getvar()</a>, <a class="el" href="manager_8c-source.html#l01392">action_listcommands()</a>, <a class="el" href="manager_8c-source.html#l02054">action_mailboxcount()</a>, <a class="el" href="manager_8c-source.html#l02026">action_mailboxstatus()</a>, <a class="el" href="manager_8c-source.html#l01587">action_status()</a>, <a class="el" href="manager_8c-source.html#l01291">action_waitevent()</a>, <a class="el" href="chan__zap_8c-source.html#l11333">action_zapshowchannels()</a>, <a class="el" href="chan__iax2_8c-source.html#l04530">ast_cli_netstats()</a>, <a class="el" href="manager_8c-source.html#l00837">astman_send_response_full()</a>, <a class="el" href="app__queue_8c-source.html#l04132">do_print()</a>, <a class="el" href="db_8c-source.html#l00557">manager_dbget()</a>, <a class="el" href="chan__iax2_8c-source.html#l04392">manager_iax2_show_netstats()</a>, <a class="el" href="chan__iax2_8c-source.html#l04420">manager_iax2_show_peers()</a>, <a class="el" href="res__jabber_8c-source.html#l02339">manager_jabber_send()</a>, <a class="el" href="res__features_8c-source.html#l02301">manager_parking_status()</a>, <a class="el" href="app__queue_8c-source.html#l04256">manager_queues_show()</a>, <a class="el" href="app__queue_8c-source.html#l04325">manager_queues_status()</a>, <a class="el" href="app__queue_8c-source.html#l04267">manager_queues_summary()</a>, <a class="el" href="pbx_8c-source.html#l03545">manager_show_dialplan_helper()</a>, <a class="el" href="chan__sip_8c-source.html#l10778">manager_sip_show_peer()</a>, <a class="el" href="chan__sip_8c-source.html#l10326">manager_sip_show_peers()</a>, and <a class="el" href="manager_8c-source.html#l02448">session_do()</a>.<div class="fragment"><pre class="fragment"><a name="l00803"></a>00803 {
<a name="l00804"></a>00804    va_list ap;
<a name="l00805"></a>00805    <span class="keyword">struct </span><a class="code" href="structast__str.html">ast_str</a> *<a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>;
<a name="l00806"></a>00806 
<a name="l00807"></a>00807    <span class="keywordflow">if</span> (!(buf = ast_str_thread_get(&amp;astman_append_buf, <a class="code" href="group__Group__AMI.html#gf9f69200540a7ff01b9714a361ccf60b">ASTMAN_APPEND_BUF_INITSIZE</a>)))
<a name="l00808"></a>00808       <span class="keywordflow">return</span>;
<a name="l00809"></a>00809 
<a name="l00810"></a>00810    va_start(ap, <a class="code" href="manager_8h.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>);
<a name="l00811"></a>00811    <a class="code" href="strings_8h.html#e22d33692bbb95b75e1f68a3a7f0f3d6">ast_str_set_va</a>(&amp;buf, 0, <a class="code" href="manager_8h.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>, ap);
<a name="l00812"></a>00812    va_end(ap);
<a name="l00813"></a>00813 
<a name="l00814"></a>00814    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structmansession.html#8fa14cdd754f91cc6554c9e71929cce7">f</a> != NULL)
<a name="l00815"></a>00815       <a class="code" href="group__Group__AMI.html#g28148bd9372a54210c67afe221c2141a">send_string</a>(s, buf-&gt;<a class="code" href="structast__str.html#3929b4348d8e5ee862fd1e38834d0217">str</a>);
<a name="l00816"></a>00816    <span class="keywordflow">else</span>
<a name="l00817"></a>00817       <a class="code" href="logger_8c.html#6a1ef0a194bcc79fccfb662192954477">ast_verbose</a>(<span class="stringliteral">"fd == -1 in astman_append, should not happen\n"</span>);
<a name="l00818"></a>00818 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="gd208abe83c7bd47d8004134de94d1b4b"></a><!-- doxytag: member="manager.c::astman_get_header" ref="gd208abe83c7bd47d8004134de94d1b4b" args="(const struct message *m, char *var)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char* astman_get_header           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>var</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get header from mananger transaction 
<p>
Definition at line <a class="el" href="manager_8c-source.html#l00713">713</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8h-source.html#l00097">message::headers</a>.
<p>
Referenced by <a class="el" href="chan__sip_8c-source.html#l10808">_sip_show_peer()</a>, <a class="el" href="chan__sip_8c-source.html#l10356">_sip_show_peers()</a>, <a class="el" href="chan__agent_8c-source.html#l01567">action_agent_logoff()</a>, <a class="el" href="chan__agent_8c-source.html#l01402">action_agents()</a>, <a class="el" href="res__features_8c-source.html#l02163">action_bridge()</a>, <a class="el" href="manager_8c-source.html#l01458">action_challenge()</a>, <a class="el" href="manager_8c-source.html#l01797">action_command()</a>, <a class="el" href="manager_8c-source.html#l02200">action_coresettings()</a>, <a class="el" href="manager_8c-source.html#l02244">action_corestatus()</a>, <a class="el" href="manager_8c-source.html#l01416">action_events()</a>, <a class="el" href="manager_8c-source.html#l02085">action_extensionstate()</a>, <a class="el" href="manager_8c-source.html#l01065">action_getconfig()</a>, <a class="el" href="manager_8c-source.html#l01114">action_getconfigjson()</a>, <a class="el" href="manager_8c-source.html#l01548">action_getvar()</a>, <a class="el" href="manager_8c-source.html#l01480">action_hangup()</a>, <a class="el" href="manager_8c-source.html#l02054">action_mailboxcount()</a>, <a class="el" href="manager_8c-source.html#l02026">action_mailboxstatus()</a>, <a class="el" href="manager_8c-source.html#l01912">action_originate()</a>, <a class="el" href="manager_8c-source.html#l01726">action_redirect()</a>, <a class="el" href="manager_8c-source.html#l01681">action_sendtext()</a>, <a class="el" href="manager_8c-source.html#l01506">action_setvar()</a>, <a class="el" href="manager_8c-source.html#l01587">action_status()</a>, <a class="el" href="manager_8c-source.html#l02116">action_timeout()</a>, <a class="el" href="chan__zap_8c-source.html#l11263">action_transfer()</a>, <a class="el" href="chan__zap_8c-source.html#l11282">action_transferhangup()</a>, <a class="el" href="manager_8c-source.html#l01251">action_updateconfig()</a>, <a class="el" href="manager_8c-source.html#l02176">action_userevent()</a>, <a class="el" href="manager_8c-source.html#l01291">action_waitevent()</a>, <a class="el" href="chan__zap_8c-source.html#l11301">action_zapdialoffhook()</a>, <a class="el" href="chan__zap_8c-source.html#l11244">action_zapdndoff()</a>, <a class="el" href="chan__zap_8c-source.html#l11225">action_zapdndon()</a>, <a class="el" href="chan__zap_8c-source.html#l11333">action_zapshowchannels()</a>, <a class="el" href="manager_8c-source.html#l00837">astman_send_response_full()</a>, <a class="el" href="manager_8c-source.html#l00903">authenticate()</a>, <a class="el" href="res__monitor_8c-source.html#l00566">change_monitor_action()</a>, <a class="el" href="res__monitor_8c-source.html#l00606">do_pause_or_unpause()</a>, <a class="el" href="manager_8c-source.html#l01177">handle_updates()</a>, <a class="el" href="app__queue_8c-source.html#l04416">manager_add_queue_member()</a>, <a class="el" href="db_8c-source.html#l00594">manager_dbdel()</a>, <a class="el" href="db_8c-source.html#l00619">manager_dbdeltree()</a>, <a class="el" href="db_8c-source.html#l00557">manager_dbget()</a>, <a class="el" href="db_8c-source.html#l00528">manager_dbput()</a>, <a class="el" href="chan__iax2_8c-source.html#l04420">manager_iax2_show_peers()</a>, <a class="el" href="res__jabber_8c-source.html#l02339">manager_jabber_send()</a>, <a class="el" href="res__features_8c-source.html#l02348">manager_park()</a>, <a class="el" href="res__features_8c-source.html#l02301">manager_parking_status()</a>, <a class="el" href="app__queue_8c-source.html#l04500">manager_pause_queue_member()</a>, <a class="el" href="app__senddtmf_8c-source.html#l00097">manager_play_dtmf()</a>, <a class="el" href="app__queue_8c-source.html#l04523">manager_queue_log_custom()</a>, <a class="el" href="app__queue_8c-source.html#l04325">manager_queues_status()</a>, <a class="el" href="app__queue_8c-source.html#l04267">manager_queues_summary()</a>, <a class="el" href="app__queue_8c-source.html#l04469">manager_remove_queue_member()</a>, <a class="el" href="pbx_8c-source.html#l03690">manager_show_dialplan()</a>, <a class="el" href="chan__sip_8c-source.html#l10778">manager_sip_show_peer()</a>, <a class="el" href="chan__sip_8c-source.html#l10326">manager_sip_show_peers()</a>, <a class="el" href="app__meetme_8c-source.html#l02974">meetmemute()</a>, <a class="el" href="manager_8c-source.html#l02288">process_message()</a>, <a class="el" href="res__monitor_8c-source.html#l00481">start_monitor_action()</a>, and <a class="el" href="res__monitor_8c-source.html#l00534">stop_monitor_action()</a>.<div class="fragment"><pre class="fragment"><a name="l00714"></a>00714 {
<a name="l00715"></a>00715    <span class="keywordtype">int</span> x, l = strlen(<a class="code" href="ast__expr2f_8c.html#b2145aac704ce76dbe1ac7adac535b23">var</a>);
<a name="l00716"></a>00716 
<a name="l00717"></a>00717    <span class="keywordflow">for</span> (x = 0; x &lt; m-&gt;hdrcount; x++) {
<a name="l00718"></a>00718       <span class="keyword">const</span> <span class="keywordtype">char</span> *h = m-&gt;<a class="code" href="structmessage.html#0e403735bca63ec8eb4378badc1c98d0">headers</a>[x];
<a name="l00719"></a>00719       <span class="keywordflow">if</span> (!strncasecmp(<a class="code" href="ast__expr2f_8c.html#b2145aac704ce76dbe1ac7adac535b23">var</a>, h, l) &amp;&amp; h[l] == <span class="charliteral">':'</span> &amp;&amp; h[l+1] == <span class="charliteral">' '</span>)
<a name="l00720"></a>00720          <span class="keywordflow">return</span> h + l + 2;
<a name="l00721"></a>00721    }
<a name="l00722"></a>00722 
<a name="l00723"></a>00723    <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
<a name="l00724"></a>00724 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="gf6be899da040cd416bb8317db016c1ff"></a><!-- doxytag: member="manager.c::astman_get_variables" ref="gf6be899da040cd416bb8317db016c1ff" args="(const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__variable.html">ast_variable</a>* astman_get_variables           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>m</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get a linked list of the Variable: headers 
<p>
Definition at line <a class="el" href="manager_8c-source.html#l00726">726</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="app_8h-source.html#l00246">AST_APP_ARG</a>, <a class="el" href="app_8h-source.html#l00263">AST_DECLARE_APP_ARGS</a>, <a class="el" href="app_8h-source.html#l00279">AST_STANDARD_APP_ARGS</a>, <a class="el" href="utils_8h.html#b38bbfc0f090d7e013ad805ff172a7d2">ast_strdupa</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="config_8c-source.html#l00183">ast_variable_new()</a>, <a class="el" href="manager_8h-source.html#l00097">message::headers</a>, <a class="el" href="chan__mgcp_8c-source.html#l01734">parse()</a>, <a class="el" href="strcompat_8c-source.html#l00035">strsep()</a>, and <a class="el" href="ast__expr2f_8c-source.html#l01417">var</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l01912">action_originate()</a>.<div class="fragment"><pre class="fragment"><a name="l00727"></a>00727 {
<a name="l00728"></a>00728    <span class="keywordtype">int</span> varlen, x, y;
<a name="l00729"></a>00729    <span class="keyword">struct </span><a class="code" href="structast__variable.html">ast_variable</a> *head = NULL, *cur;
<a name="l00730"></a>00730 
<a name="l00731"></a>00731    <a class="code" href="app_8h.html#f2237dba0ffbe2f9ec8209c3f9fe82a7">AST_DECLARE_APP_ARGS</a>(args,
<a name="l00732"></a>00732       <a class="code" href="app_8h.html#a6b5292002b488b8ce11fedacb317800">AST_APP_ARG</a>(vars)[32];
<a name="l00733"></a>00733    );
<a name="l00734"></a>00734 
<a name="l00735"></a>00735    varlen = strlen(<span class="stringliteral">"Variable: "</span>);
<a name="l00736"></a>00736 
<a name="l00737"></a>00737    <span class="keywordflow">for</span> (x = 0; x &lt; m-&gt;hdrcount; x++) {
<a name="l00738"></a>00738       <span class="keywordtype">char</span> *<a class="code" href="chan__mgcp_8c.html#96d2a4ae057584ce23ca92b03303bd2f">parse</a>, *<a class="code" href="ast__expr2f_8c.html#b2145aac704ce76dbe1ac7adac535b23">var</a>, *<a class="code" href="structval.html">val</a>;
<a name="l00739"></a>00739 
<a name="l00740"></a>00740       <span class="keywordflow">if</span> (strncasecmp(<span class="stringliteral">"Variable: "</span>, m-&gt;<a class="code" href="structmessage.html#0e403735bca63ec8eb4378badc1c98d0">headers</a>[x], varlen))
<a name="l00741"></a>00741          <span class="keywordflow">continue</span>;
<a name="l00742"></a>00742       parse = <a class="code" href="utils_8h.html#b38bbfc0f090d7e013ad805ff172a7d2">ast_strdupa</a>(m-&gt;<a class="code" href="structmessage.html#0e403735bca63ec8eb4378badc1c98d0">headers</a>[x] + varlen);
<a name="l00743"></a>00743 
<a name="l00744"></a>00744       <a class="code" href="app_8h.html#c086f828d1f39897759c5668a4d20127">AST_STANDARD_APP_ARGS</a>(args, parse);
<a name="l00745"></a>00745       <span class="keywordflow">if</span> (!args.argc)
<a name="l00746"></a>00746          <span class="keywordflow">continue</span>;
<a name="l00747"></a>00747       <span class="keywordflow">for</span> (y = 0; y &lt; args.argc; y++) {
<a name="l00748"></a>00748          <span class="keywordflow">if</span> (!args.vars[y])
<a name="l00749"></a>00749             <span class="keywordflow">continue</span>;
<a name="l00750"></a>00750          var = val = <a class="code" href="utils_8h.html#b38bbfc0f090d7e013ad805ff172a7d2">ast_strdupa</a>(args.vars[y]);
<a name="l00751"></a>00751          <a class="code" href="strcompat_8c.html#a541370456ac872bdb4bdcc462fc6a6e">strsep</a>(&amp;val, <span class="stringliteral">"="</span>);
<a name="l00752"></a>00752          <span class="keywordflow">if</span> (!val || <a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(var))
<a name="l00753"></a>00753             <span class="keywordflow">continue</span>;
<a name="l00754"></a>00754          cur = <a class="code" href="config_8c.html#c21fb3a90ccd9ec4f8708c3b67b3c654">ast_variable_new</a>(var, val);
<a name="l00755"></a>00755          cur-&gt;next = head;
<a name="l00756"></a>00756          head = cur;
<a name="l00757"></a>00757       }
<a name="l00758"></a>00758    }
<a name="l00759"></a>00759 
<a name="l00760"></a>00760    <span class="keywordflow">return</span> head;
<a name="l00761"></a>00761 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g0c64878b307241bfe01cea67e09f49e2"></a><!-- doxytag: member="manager.c::astman_send_ack" ref="g0c64878b307241bfe01cea67e09f49e2" args="(struct mansession *s, const struct message *m, char *msg)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void astman_send_ack           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00864">864</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00837">astman_send_response_full()</a>.
<p>
Referenced by <a class="el" href="chan__agent_8c-source.html#l01567">action_agent_logoff()</a>, <a class="el" href="chan__agent_8c-source.html#l01402">action_agents()</a>, <a class="el" href="res__features_8c-source.html#l02163">action_bridge()</a>, <a class="el" href="manager_8c-source.html#l01480">action_hangup()</a>, <a class="el" href="manager_8c-source.html#l01440">action_login()</a>, <a class="el" href="manager_8c-source.html#l01912">action_originate()</a>, <a class="el" href="manager_8c-source.html#l01726">action_redirect()</a>, <a class="el" href="manager_8c-source.html#l01681">action_sendtext()</a>, <a class="el" href="manager_8c-source.html#l01506">action_setvar()</a>, <a class="el" href="manager_8c-source.html#l01587">action_status()</a>, <a class="el" href="manager_8c-source.html#l02116">action_timeout()</a>, <a class="el" href="chan__zap_8c-source.html#l11263">action_transfer()</a>, <a class="el" href="chan__zap_8c-source.html#l11282">action_transferhangup()</a>, <a class="el" href="manager_8c-source.html#l01251">action_updateconfig()</a>, <a class="el" href="chan__zap_8c-source.html#l11301">action_zapdialoffhook()</a>, <a class="el" href="chan__zap_8c-source.html#l11244">action_zapdndoff()</a>, <a class="el" href="chan__zap_8c-source.html#l11225">action_zapdndon()</a>, <a class="el" href="chan__zap_8c-source.html#l10763">action_zaprestart()</a>, <a class="el" href="chan__zap_8c-source.html#l11333">action_zapshowchannels()</a>, <a class="el" href="res__monitor_8c-source.html#l00566">change_monitor_action()</a>, <a class="el" href="res__monitor_8c-source.html#l00606">do_pause_or_unpause()</a>, <a class="el" href="app__queue_8c-source.html#l04416">manager_add_queue_member()</a>, <a class="el" href="db_8c-source.html#l00594">manager_dbdel()</a>, <a class="el" href="db_8c-source.html#l00619">manager_dbdeltree()</a>, <a class="el" href="db_8c-source.html#l00557">manager_dbget()</a>, <a class="el" href="db_8c-source.html#l00528">manager_dbput()</a>, <a class="el" href="res__jabber_8c-source.html#l02339">manager_jabber_send()</a>, <a class="el" href="res__features_8c-source.html#l02348">manager_park()</a>, <a class="el" href="res__features_8c-source.html#l02301">manager_parking_status()</a>, <a class="el" href="app__queue_8c-source.html#l04500">manager_pause_queue_member()</a>, <a class="el" href="app__senddtmf_8c-source.html#l00097">manager_play_dtmf()</a>, <a class="el" href="app__queue_8c-source.html#l04523">manager_queue_log_custom()</a>, <a class="el" href="app__queue_8c-source.html#l04325">manager_queues_status()</a>, <a class="el" href="app__queue_8c-source.html#l04267">manager_queues_summary()</a>, <a class="el" href="app__queue_8c-source.html#l04469">manager_remove_queue_member()</a>, <a class="el" href="app__meetme_8c-source.html#l02974">meetmemute()</a>, <a class="el" href="res__monitor_8c-source.html#l00481">start_monitor_action()</a>, and <a class="el" href="res__monitor_8c-source.html#l00534">stop_monitor_action()</a>.<div class="fragment"><pre class="fragment"><a name="l00865"></a>00865 {
<a name="l00866"></a>00866    <a class="code" href="group__Group__AMI.html#g653336d14301d38a863c7b20ccec8a1c">astman_send_response_full</a>(s, m, <span class="stringliteral">"Success"</span>, <a class="code" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>, NULL);
<a name="l00867"></a>00867 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g23a27dba104a8df4bb1c6a217a71e7e7"></a><!-- doxytag: member="manager.c::astman_send_error" ref="g23a27dba104a8df4bb1c6a217a71e7e7" args="(struct mansession *s, const struct message *m, char *error)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void astman_send_error           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>error</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Send error in manager transaction 
<p>
Definition at line <a class="el" href="manager_8c-source.html#l00859">859</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00837">astman_send_response_full()</a>.
<p>
Referenced by <a class="el" href="chan__sip_8c-source.html#l10808">_sip_show_peer()</a>, <a class="el" href="chan__agent_8c-source.html#l01567">action_agent_logoff()</a>, <a class="el" href="res__features_8c-source.html#l02163">action_bridge()</a>, <a class="el" href="manager_8c-source.html#l01458">action_challenge()</a>, <a class="el" href="manager_8c-source.html#l01797">action_command()</a>, <a class="el" href="manager_8c-source.html#l02085">action_extensionstate()</a>, <a class="el" href="manager_8c-source.html#l01065">action_getconfig()</a>, <a class="el" href="manager_8c-source.html#l01114">action_getconfigjson()</a>, <a class="el" href="manager_8c-source.html#l01548">action_getvar()</a>, <a class="el" href="manager_8c-source.html#l01480">action_hangup()</a>, <a class="el" href="manager_8c-source.html#l01440">action_login()</a>, <a class="el" href="manager_8c-source.html#l02054">action_mailboxcount()</a>, <a class="el" href="manager_8c-source.html#l02026">action_mailboxstatus()</a>, <a class="el" href="manager_8c-source.html#l01912">action_originate()</a>, <a class="el" href="manager_8c-source.html#l01726">action_redirect()</a>, <a class="el" href="manager_8c-source.html#l01681">action_sendtext()</a>, <a class="el" href="manager_8c-source.html#l01506">action_setvar()</a>, <a class="el" href="manager_8c-source.html#l01587">action_status()</a>, <a class="el" href="manager_8c-source.html#l02116">action_timeout()</a>, <a class="el" href="chan__zap_8c-source.html#l11263">action_transfer()</a>, <a class="el" href="chan__zap_8c-source.html#l11282">action_transferhangup()</a>, <a class="el" href="manager_8c-source.html#l01251">action_updateconfig()</a>, <a class="el" href="chan__zap_8c-source.html#l11301">action_zapdialoffhook()</a>, <a class="el" href="chan__zap_8c-source.html#l11244">action_zapdndoff()</a>, <a class="el" href="chan__zap_8c-source.html#l11225">action_zapdndon()</a>, <a class="el" href="chan__zap_8c-source.html#l10763">action_zaprestart()</a>, <a class="el" href="res__monitor_8c-source.html#l00566">change_monitor_action()</a>, <a class="el" href="res__monitor_8c-source.html#l00606">do_pause_or_unpause()</a>, <a class="el" href="app__queue_8c-source.html#l04416">manager_add_queue_member()</a>, <a class="el" href="db_8c-source.html#l00594">manager_dbdel()</a>, <a class="el" href="db_8c-source.html#l00619">manager_dbdeltree()</a>, <a class="el" href="db_8c-source.html#l00557">manager_dbget()</a>, <a class="el" href="db_8c-source.html#l00528">manager_dbput()</a>, <a class="el" href="res__jabber_8c-source.html#l02339">manager_jabber_send()</a>, <a class="el" href="res__features_8c-source.html#l02348">manager_park()</a>, <a class="el" href="app__queue_8c-source.html#l04500">manager_pause_queue_member()</a>, <a class="el" href="app__senddtmf_8c-source.html#l00097">manager_play_dtmf()</a>, <a class="el" href="app__queue_8c-source.html#l04523">manager_queue_log_custom()</a>, <a class="el" href="app__queue_8c-source.html#l04469">manager_remove_queue_member()</a>, <a class="el" href="pbx_8c-source.html#l03690">manager_show_dialplan()</a>, <a class="el" href="pbx_8c-source.html#l03545">manager_show_dialplan_helper()</a>, <a class="el" href="chan__sip_8c-source.html#l10778">manager_sip_show_peer()</a>, <a class="el" href="app__meetme_8c-source.html#l02974">meetmemute()</a>, <a class="el" href="manager_8c-source.html#l02288">process_message()</a>, <a class="el" href="res__monitor_8c-source.html#l00481">start_monitor_action()</a>, and <a class="el" href="res__monitor_8c-source.html#l00534">stop_monitor_action()</a>.<div class="fragment"><pre class="fragment"><a name="l00860"></a>00860 {
<a name="l00861"></a>00861    <a class="code" href="group__Group__AMI.html#g653336d14301d38a863c7b20ccec8a1c">astman_send_response_full</a>(s, m, <span class="stringliteral">"Error"</span>, <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>, NULL);
<a name="l00862"></a>00862 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="ga868a0aada874f97606fcc3119bad3da"></a><!-- doxytag: member="manager.c::astman_send_listack" ref="ga868a0aada874f97606fcc3119bad3da" args="(struct mansession *s, const struct message *m, char *msg, char *listflag)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void astman_send_listack           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>listflag</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00874">874</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00837">astman_send_response_full()</a>.
<p>
Referenced by <a class="el" href="pbx_8c-source.html#l03536">manager_dpsendack()</a>, and <a class="el" href="chan__sip_8c-source.html#l10326">manager_sip_show_peers()</a>.<div class="fragment"><pre class="fragment"><a name="l00875"></a>00875 {
<a name="l00876"></a>00876    <a class="code" href="group__Group__AMI.html#g653336d14301d38a863c7b20ccec8a1c">astman_send_response_full</a>(s, m, <span class="stringliteral">"Success"</span>, <a class="code" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>, listflag);
<a name="l00877"></a>00877 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g005978ca7456f4c36c0cd89907d68fdb"></a><!-- doxytag: member="manager.c::astman_send_response" ref="g005978ca7456f4c36c0cd89907d68fdb" args="(struct mansession *s, const struct message *m, char *resp, char *msg)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void astman_send_response           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>resp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00854">854</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00837">astman_send_response_full()</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l01416">action_events()</a>, <a class="el" href="manager_8c-source.html#l01434">action_logoff()</a>, <a class="el" href="manager_8c-source.html#l01053">action_ping()</a>, and <a class="el" href="manager_8c-source.html#l01291">action_waitevent()</a>.<div class="fragment"><pre class="fragment"><a name="l00855"></a>00855 {
<a name="l00856"></a>00856    <a class="code" href="group__Group__AMI.html#g653336d14301d38a863c7b20ccec8a1c">astman_send_response_full</a>(s, m, resp, <a class="code" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>, NULL);
<a name="l00857"></a>00857 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g653336d14301d38a863c7b20ccec8a1c"></a><!-- doxytag: member="manager.c::astman_send_response_full" ref="g653336d14301d38a863c7b20ccec8a1c" args="(struct mansession *s, const struct message *m, char *resp, char *msg, char *listflag)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void astman_send_response_full           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>resp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>listflag</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00837">837</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="manager_8c-source.html#l00802">astman_append()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, and <a class="el" href="manager_8c-source.html#l00836">MSG_MOREDATA</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l00864">astman_send_ack()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, <a class="el" href="manager_8c-source.html#l00874">astman_send_listack()</a>, <a class="el" href="manager_8c-source.html#l00854">astman_send_response()</a>, and <a class="el" href="manager_8c-source.html#l00869">astman_start_ack()</a>.<div class="fragment"><pre class="fragment"><a name="l00838"></a>00838 {
<a name="l00839"></a>00839    <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m,<span class="stringliteral">"ActionID"</span>);
<a name="l00840"></a>00840 
<a name="l00841"></a>00841    <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"Response: %s\r\n"</span>, resp);
<a name="l00842"></a>00842    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(<span class="keywordtype">id</span>))
<a name="l00843"></a>00843       <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"ActionID: %s\r\n"</span>, <span class="keywordtype">id</span>);
<a name="l00844"></a>00844    <span class="keywordflow">if</span> (listflag)
<a name="l00845"></a>00845       <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"Eventlist: %s\r\n"</span>, listflag);   <span class="comment">/* Start, complete, cancelled */</span>
<a name="l00846"></a>00846    <span class="keywordflow">if</span> (<a class="code" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a> == <a class="code" href="group__Group__AMI.html#g707bedc997e8781f153bcc7a5d1a944a">MSG_MOREDATA</a>)
<a name="l00847"></a>00847       <span class="keywordflow">return</span>;
<a name="l00848"></a>00848    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>)
<a name="l00849"></a>00849       <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"Message: %s\r\n\r\n"</span>, <a class="code" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>);
<a name="l00850"></a>00850    <span class="keywordflow">else</span>
<a name="l00851"></a>00851       <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"\r\n"</span>);
<a name="l00852"></a>00852 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="gbbca0d5619931eef0a531fe18c27416a"></a><!-- doxytag: member="manager.c::astman_start_ack" ref="gbbca0d5619931eef0a531fe18c27416a" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void astman_start_ack           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00869">869</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00837">astman_send_response_full()</a>, and <a class="el" href="manager_8c-source.html#l00836">MSG_MOREDATA</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l01458">action_challenge()</a>, <a class="el" href="manager_8c-source.html#l02085">action_extensionstate()</a>, <a class="el" href="manager_8c-source.html#l01065">action_getconfig()</a>, <a class="el" href="manager_8c-source.html#l01114">action_getconfigjson()</a>, <a class="el" href="manager_8c-source.html#l01548">action_getvar()</a>, <a class="el" href="manager_8c-source.html#l01392">action_listcommands()</a>, <a class="el" href="manager_8c-source.html#l02054">action_mailboxcount()</a>, and <a class="el" href="manager_8c-source.html#l02026">action_mailboxstatus()</a>.<div class="fragment"><pre class="fragment"><a name="l00870"></a>00870 {
<a name="l00871"></a>00871    <a class="code" href="group__Group__AMI.html#g653336d14301d38a863c7b20ccec8a1c">astman_send_response_full</a>(s, m, <span class="stringliteral">"Success"</span>, <a class="code" href="group__Group__AMI.html#g707bedc997e8781f153bcc7a5d1a944a">MSG_MOREDATA</a>, NULL);
<a name="l00872"></a>00872 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g0c601c39a357acbe91e4070d54d89001"></a><!-- doxytag: member="manager.c::authenticate" ref="g0c601c39a357acbe91e4070d54d89001" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int authenticate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00903">903</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="acl_8c-source.html#l00140">ast_append_ha()</a>, <a class="el" href="acl_8c-source.html#l00205">ast_apply_ha()</a>, <a class="el" href="config_8c-source.html#l00357">ast_category_browse()</a>, <a class="el" href="config_8c-source.html#l00555">ast_config_destroy()</a>, <a class="el" href="config_8c-source.html#l01278">ast_config_load()</a>, <a class="el" href="acl_8c-source.html#l00087">ast_free_ha()</a>, <a class="el" href="utils_8c-source.html#l00493">ast_inet_ntoa()</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="utils_8h.html#b38bbfc0f090d7e013ad805ff172a7d2">ast_strdupa</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="utils_8c-source.html#l00724">ast_true()</a>, <a class="el" href="config_8c-source.html#l00222">ast_variable_browse()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00152">mansession::challenge</a>, <a class="el" href="dlfcn_8c-source.html#l00196">error()</a>, <a class="el" href="manager_8c-source.html#l00366">get_perm()</a>, <a class="el" href="func__channel_8c-source.html#l00149">key()</a>, <a class="el" href="utils_8h-source.html#l00386">len</a>, <a class="el" href="config_8h-source.html#l00041">ast_variable::lineno</a>, <a class="el" href="logger_8h-source.html#l00094">LOG_DEBUG</a>, <a class="el" href="logger_8h-source.html#l00106">LOG_NOTICE</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="md5_8c-source.html#l00124">MD5Final()</a>, <a class="el" href="md5_8c-source.html#l00061">MD5Init()</a>, <a class="el" href="md5_8c-source.html#l00076">MD5Update()</a>, <a class="el" href="config_8h-source.html#l00039">ast_variable::name</a>, <a class="el" href="config_8h-source.html#l00046">ast_variable::next</a>, <a class="el" href="cdr__odbc_8c-source.html#l00069">password</a>, <a class="el" href="manager_8c-source.html#l00154">mansession::readperm</a>, <a class="el" href="strings_8h-source.html#l00045">S_OR</a>, <a class="el" href="manager_8c-source.html#l00884">set_eventmask()</a>, <a class="el" href="manager_8c-source.html#l00143">mansession::sin</a>, <a class="el" href="manager_8c-source.html#l00151">mansession::username</a>, <a class="el" href="config_8h-source.html#l00040">ast_variable::value</a>, <a class="el" href="manager_8c-source.html#l00155">mansession::writeperm</a>, and <a class="el" href="manager_8c-source.html#l00161">mansession::writetimeout</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l01440">action_login()</a>, <a class="el" href="chan__iax2_8c-source.html#l05318">authenticate_reply()</a>, and <a class="el" href="chan__iax2_8c-source.html#l05904">registry_rerequest()</a>.<div class="fragment"><pre class="fragment"><a name="l00904"></a>00904 {
<a name="l00905"></a>00905    <span class="keyword">const</span> <span class="keywordtype">char</span> *user = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Username"</span>);
<a name="l00906"></a>00906    <span class="keywordtype">int</span> <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a> = -1;
<a name="l00907"></a>00907    <span class="keyword">struct </span><a class="code" href="structast__ha.html">ast_ha</a> *ha = NULL;
<a name="l00908"></a>00908    <span class="keywordtype">char</span> *<a class="code" href="cdr__odbc_8c.html#5f4dcc3b5aa765d61d8327deb882cf99">password</a> = NULL;
<a name="l00909"></a>00909    <span class="keywordtype">int</span> readperm = 0, writeperm = 0;
<a name="l00910"></a>00910 
<a name="l00911"></a>00911    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(user)) <span class="comment">/* missing username */</span>
<a name="l00912"></a>00912       <span class="keywordflow">return</span> -1;
<a name="l00913"></a>00913 
<a name="l00914"></a>00914     {
<a name="l00915"></a>00915    <span class="comment">/*</span>
<a name="l00916"></a>00916 <span class="comment">    * XXX there should be no need to scan the config file again here,</span>
<a name="l00917"></a>00917 <span class="comment">    * suffices to call get_manager_by_name_locked() to fetch</span>
<a name="l00918"></a>00918 <span class="comment">    * the user's entry.</span>
<a name="l00919"></a>00919 <span class="comment">    */</span>
<a name="l00920"></a>00920    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg = <a class="code" href="config_8c.html#0ea8bde5422fa0db50302e0f710e18c1">ast_config_load</a>(<span class="stringliteral">"manager.conf"</span>);
<a name="l00921"></a>00921    <span class="keywordtype">char</span> *cat = NULL;
<a name="l00922"></a>00922    <span class="keyword">struct </span><a class="code" href="structast__variable.html">ast_variable</a> *v;
<a name="l00923"></a>00923 
<a name="l00924"></a>00924    <span class="keywordflow">if</span> (!cfg)
<a name="l00925"></a>00925       <span class="keywordflow">return</span> -1;
<a name="l00926"></a>00926    <span class="keywordflow">while</span> ( (cat = <a class="code" href="config_8c.html#38fbac9adb1c1bf165ecce251cb206a8">ast_category_browse</a>(cfg, cat)) ) {
<a name="l00927"></a>00927       <span class="comment">/* "general" is not a valid user */</span>
<a name="l00928"></a>00928       <span class="keywordflow">if</span> (strcasecmp(cat, user) || !strcasecmp(cat, <span class="stringliteral">"general"</span>))
<a name="l00929"></a>00929          <span class="keywordflow">continue</span>;
<a name="l00930"></a>00930       <span class="comment">/* collect parameters for the user's entry */</span>
<a name="l00931"></a>00931       <span class="keywordflow">for</span> (v = <a class="code" href="config_8c.html#65ed813ca973e0e5dd3426804249db4f">ast_variable_browse</a>(cfg, cat); v; v = v-&gt;<a class="code" href="structast__variable.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>) {
<a name="l00932"></a>00932          <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"secret"</span>))
<a name="l00933"></a>00933             password = <a class="code" href="utils_8h.html#b38bbfc0f090d7e013ad805ff172a7d2">ast_strdupa</a>(v-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>);
<a name="l00934"></a>00934          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"read"</span>))
<a name="l00935"></a>00935             readperm = <a class="code" href="group__Group__AMI.html#g6bfcdc2d3a50cfc5be0ca0b6dbc622ea">get_perm</a>(v-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>);
<a name="l00936"></a>00936          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"write"</span>))
<a name="l00937"></a>00937             writeperm = <a class="code" href="group__Group__AMI.html#g6bfcdc2d3a50cfc5be0ca0b6dbc622ea">get_perm</a>(v-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>);
<a name="l00938"></a>00938          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"permit"</span>) ||
<a name="l00939"></a>00939                !strcasecmp(v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"deny"</span>)) {
<a name="l00940"></a>00940             ha = <a class="code" href="acl_8c.html#bd7ec664091783cbeef4274f5c30d7b4">ast_append_ha</a>(v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, v-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>, ha, NULL);
<a name="l00941"></a>00941          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"writetimeout"</span>)) {
<a name="l00942"></a>00942             <span class="keywordtype">int</span> <a class="code" href="structval.html">val</a> = atoi(v-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>);
<a name="l00943"></a>00943    
<a name="l00944"></a>00944             <span class="keywordflow">if</span> (val &lt; 100)
<a name="l00945"></a>00945                <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Invalid writetimeout value '%s' at line %d\n"</span>, v-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>, v-&gt;<a class="code" href="structast__variable.html#5525da36abafe9a243105119cea54be5">lineno</a>);
<a name="l00946"></a>00946             <span class="keywordflow">else</span>
<a name="l00947"></a>00947                s-&gt;<a class="code" href="structmansession.html#8aa2aeb656bfe257d9d8c38188f42041">writetimeout</a> = val;
<a name="l00948"></a>00948          }
<a name="l00949"></a>00949       }
<a name="l00950"></a>00950       <span class="keywordflow">break</span>;
<a name="l00951"></a>00951    }
<a name="l00952"></a>00952 
<a name="l00953"></a>00953    <a class="code" href="config_8c.html#ad84c9d29ca53758c2a113d057e221a0">ast_config_destroy</a>(cfg);
<a name="l00954"></a>00954    <span class="keywordflow">if</span> (!cat) {
<a name="l00955"></a>00955       <span class="comment">/* Didn't find the user in manager.conf, check users.conf */</span>
<a name="l00956"></a>00956       <span class="keywordtype">int</span> hasmanager = 0;
<a name="l00957"></a>00957       cfg = <a class="code" href="config_8c.html#0ea8bde5422fa0db50302e0f710e18c1">ast_config_load</a>(<span class="stringliteral">"users.conf"</span>);
<a name="l00958"></a>00958       <span class="keywordflow">if</span> (!cfg)
<a name="l00959"></a>00959          <span class="keywordflow">return</span> -1;
<a name="l00960"></a>00960       <span class="keywordflow">while</span> ( (cat = <a class="code" href="config_8c.html#38fbac9adb1c1bf165ecce251cb206a8">ast_category_browse</a>(cfg, cat)) ) {
<a name="l00961"></a>00961          <span class="keywordflow">if</span> (!strcasecmp(cat, user) &amp;&amp; strcasecmp(cat, <span class="stringliteral">"general"</span>))
<a name="l00962"></a>00962             <span class="keywordflow">break</span>;
<a name="l00963"></a>00963       }
<a name="l00964"></a>00964       <span class="keywordflow">if</span> (!cat) {
<a name="l00965"></a>00965          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#bbf95aad74d847cd4bcb129604f798cd">LOG_NOTICE</a>, <span class="stringliteral">"%s tried to authenticate with nonexistent user '%s'\n"</span>, <a class="code" href="utils_8c.html#d5490a9b672272bd2f20ee1e5b72c11e">ast_inet_ntoa</a>(s-&gt;<a class="code" href="structmansession.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_addr), user);
<a name="l00966"></a>00966          <a class="code" href="config_8c.html#ad84c9d29ca53758c2a113d057e221a0">ast_config_destroy</a>(cfg);
<a name="l00967"></a>00967          <span class="keywordflow">return</span> -1;
<a name="l00968"></a>00968       }
<a name="l00969"></a>00969       <span class="comment">/* collect parameters for the user's entry from users.conf */</span>
<a name="l00970"></a>00970       <span class="keywordflow">for</span> (v = <a class="code" href="config_8c.html#65ed813ca973e0e5dd3426804249db4f">ast_variable_browse</a>(cfg, cat); v; v = v-&gt;<a class="code" href="structast__variable.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>) {
<a name="l00971"></a>00971          <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"secret"</span>))
<a name="l00972"></a>00972             password = <a class="code" href="utils_8h.html#b38bbfc0f090d7e013ad805ff172a7d2">ast_strdupa</a>(v-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>);
<a name="l00973"></a>00973          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"read"</span>))
<a name="l00974"></a>00974             readperm = <a class="code" href="group__Group__AMI.html#g6bfcdc2d3a50cfc5be0ca0b6dbc622ea">get_perm</a>(v-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>);
<a name="l00975"></a>00975          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"write"</span>))
<a name="l00976"></a>00976             writeperm = <a class="code" href="group__Group__AMI.html#g6bfcdc2d3a50cfc5be0ca0b6dbc622ea">get_perm</a>(v-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>);
<a name="l00977"></a>00977          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"permit"</span>) ||
<a name="l00978"></a>00978                !strcasecmp(v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"deny"</span>)) {
<a name="l00979"></a>00979             ha = <a class="code" href="acl_8c.html#bd7ec664091783cbeef4274f5c30d7b4">ast_append_ha</a>(v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, v-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>, ha, NULL);
<a name="l00980"></a>00980          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"writetimeout"</span>)) {
<a name="l00981"></a>00981             <span class="keywordtype">int</span> <a class="code" href="structval.html">val</a> = atoi(v-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>);
<a name="l00982"></a>00982    
<a name="l00983"></a>00983             <span class="keywordflow">if</span> (val &lt; 100)
<a name="l00984"></a>00984                <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Invalid writetimeout value '%s' at line %d\n"</span>, v-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>, v-&gt;<a class="code" href="structast__variable.html#5525da36abafe9a243105119cea54be5">lineno</a>);
<a name="l00985"></a>00985             <span class="keywordflow">else</span>
<a name="l00986"></a>00986                s-&gt;<a class="code" href="structmansession.html#8aa2aeb656bfe257d9d8c38188f42041">writetimeout</a> = val;
<a name="l00987"></a>00987          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"hasmanager"</span>)) {
<a name="l00988"></a>00988             hasmanager = <a class="code" href="utils_8c.html#63bb02e4d6f18c1dbeca92dc63310685">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>);
<a name="l00989"></a>00989          }
<a name="l00990"></a>00990       }
<a name="l00991"></a>00991       <a class="code" href="config_8c.html#ad84c9d29ca53758c2a113d057e221a0">ast_config_destroy</a>(cfg);
<a name="l00992"></a>00992       <span class="keywordflow">if</span> (!hasmanager) {
<a name="l00993"></a>00993          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#bbf95aad74d847cd4bcb129604f798cd">LOG_NOTICE</a>, <span class="stringliteral">"%s tried to authenticate with nonexistent user '%s'\n"</span>, <a class="code" href="utils_8c.html#d5490a9b672272bd2f20ee1e5b72c11e">ast_inet_ntoa</a>(s-&gt;<a class="code" href="structmansession.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_addr), user);
<a name="l00994"></a>00994          <span class="keywordflow">return</span> -1;
<a name="l00995"></a>00995       }
<a name="l00996"></a>00996    }
<a name="l00997"></a>00997 
<a name="l00998"></a>00998    }
<a name="l00999"></a>00999 
<a name="l01000"></a>01000    <span class="keywordflow">if</span> (ha) {
<a name="l01001"></a>01001       <span class="keywordtype">int</span> good = <a class="code" href="acl_8c.html#ad4795f3b2afa9e898bbd529d0735a32">ast_apply_ha</a>(ha, &amp;(s-&gt;<a class="code" href="structmansession.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>));
<a name="l01002"></a>01002       <a class="code" href="acl_8c.html#395c900def2430bc4d7270a1b537c870">ast_free_ha</a>(ha);
<a name="l01003"></a>01003       <span class="keywordflow">if</span> (!good) {
<a name="l01004"></a>01004          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#bbf95aad74d847cd4bcb129604f798cd">LOG_NOTICE</a>, <span class="stringliteral">"%s failed to pass IP ACL as '%s'\n"</span>, <a class="code" href="utils_8c.html#d5490a9b672272bd2f20ee1e5b72c11e">ast_inet_ntoa</a>(s-&gt;<a class="code" href="structmansession.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_addr), user);
<a name="l01005"></a>01005          <span class="keywordflow">return</span> -1;
<a name="l01006"></a>01006       }
<a name="l01007"></a>01007    }
<a name="l01008"></a>01008    <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"AuthType"</span>), <span class="stringliteral">"MD5"</span>)) {
<a name="l01009"></a>01009       <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="func__channel_8c.html#87ef31d54f81072952c331d5c7339d8e">key</a> = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Key"</span>);
<a name="l01010"></a>01010       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(key) &amp;&amp; !<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(s-&gt;<a class="code" href="structmansession.html#35a1613258a052cc893255c98df3338a">challenge</a>) &amp;&amp;
<a name="l01011"></a>01011           !<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(password)) {
<a name="l01012"></a>01012          <span class="keywordtype">int</span> x;
<a name="l01013"></a>01013          <span class="keywordtype">int</span> <a class="code" href="utils_8h.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a> = 0;
<a name="l01014"></a>01014          <span class="keywordtype">char</span> md5key[256] = <span class="stringliteral">""</span>;
<a name="l01015"></a>01015          <span class="keyword">struct </span><a class="code" href="structMD5Context.html">MD5Context</a> md5;
<a name="l01016"></a>01016          <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> digest[16];
<a name="l01017"></a>01017 
<a name="l01018"></a>01018          <a class="code" href="md5_8c.html#c5e42e491ef01932075bc2b458adb3d3">MD5Init</a>(&amp;md5);
<a name="l01019"></a>01019          <a class="code" href="md5_8c.html#1cf20b07870b08b3511ab4a4a8bbebf2">MD5Update</a>(&amp;md5, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) s-&gt;<a class="code" href="structmansession.html#35a1613258a052cc893255c98df3338a">challenge</a>, strlen(s-&gt;<a class="code" href="structmansession.html#35a1613258a052cc893255c98df3338a">challenge</a>));
<a name="l01020"></a>01020          <a class="code" href="md5_8c.html#1cf20b07870b08b3511ab4a4a8bbebf2">MD5Update</a>(&amp;md5, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) password, strlen(password));
<a name="l01021"></a>01021          <a class="code" href="md5_8c.html#200ba291fa2daa9d56ef744b5ff26549">MD5Final</a>(digest, &amp;md5);
<a name="l01022"></a>01022          <span class="keywordflow">for</span> (x=0; x&lt;16; x++)
<a name="l01023"></a>01023             len += sprintf(md5key + len, <span class="stringliteral">"%2.2x"</span>, digest[x]);
<a name="l01024"></a>01024          <span class="keywordflow">if</span> (!strcmp(md5key, key))
<a name="l01025"></a>01025             error = 0;
<a name="l01026"></a>01026       } <span class="keywordflow">else</span> {
<a name="l01027"></a>01027          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"MD5 authentication is not possible.  challenge: '%s'\n"</span>, 
<a name="l01028"></a>01028             <a class="code" href="strings_8h.html#a5b939153ec133be2de0e3647df143f4">S_OR</a>(s-&gt;<a class="code" href="structmansession.html#35a1613258a052cc893255c98df3338a">challenge</a>, <span class="stringliteral">""</span>));
<a name="l01029"></a>01029          <span class="keywordflow">return</span> -1;
<a name="l01030"></a>01030       }
<a name="l01031"></a>01031    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (password) {
<a name="l01032"></a>01032       <span class="keyword">const</span> <span class="keywordtype">char</span> *pass = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Secret"</span>);
<a name="l01033"></a>01033       <span class="keywordflow">if</span> (!strcmp(password, pass))
<a name="l01034"></a>01034          error = 0;
<a name="l01035"></a>01035    }
<a name="l01036"></a>01036    <span class="keywordflow">if</span> (error) {
<a name="l01037"></a>01037       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#bbf95aad74d847cd4bcb129604f798cd">LOG_NOTICE</a>, <span class="stringliteral">"%s failed to authenticate as '%s'\n"</span>, <a class="code" href="utils_8c.html#d5490a9b672272bd2f20ee1e5b72c11e">ast_inet_ntoa</a>(s-&gt;<a class="code" href="structmansession.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_addr), user);
<a name="l01038"></a>01038       <span class="keywordflow">return</span> -1;
<a name="l01039"></a>01039    }
<a name="l01040"></a>01040    ast_copy_string(s-&gt;<a class="code" href="structmansession.html#5aec535b6e1a39142c62cb283d7f9268">username</a>, user, <span class="keyword">sizeof</span>(s-&gt;<a class="code" href="structmansession.html#5aec535b6e1a39142c62cb283d7f9268">username</a>));
<a name="l01041"></a>01041    s-&gt;<a class="code" href="structmansession.html#e12b8f9551a73d6196648b62754aa9e1">readperm</a> = readperm;
<a name="l01042"></a>01042    s-&gt;<a class="code" href="structmansession.html#1cc72854e73b9b510a12e993d6479e86">writeperm</a> = writeperm;
<a name="l01043"></a>01043    <a class="code" href="group__Group__AMI.html#gca4968afc65b84cc5b3781d465536b32">set_eventmask</a>(s, <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Events"</span>));
<a name="l01044"></a>01044    <span class="keywordflow">return</span> 0;
<a name="l01045"></a>01045 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g7a74ba6c31130ec1d434b549ec0bd523"></a><!-- doxytag: member="manager.c::authority_to_str" ref="g7a74ba6c31130ec1d434b549ec0bd523" args="(int authority, struct ast_str **res)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static char* authority_to_str           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>authority</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct <a class="el" href="structast__str.html">ast_str</a> **&nbsp;</td>
          <td class="mdname" nowrap> <em>res</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Convert authority code to a list of options. 
<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00325">325</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append()</a>, <a class="el" href="adsistub_8c-source.html#l00083">num</a>, and <a class="el" href="group__Group__AMI.html#g94a45625d6a1e46563105bbad0c894f9">perms</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l02563">__manager_event()</a>, <a class="el" href="manager_8c-source.html#l01392">action_listcommands()</a>, <a class="el" href="res__astum_8c-source.html#l00562">cli_aum_show_group()</a>, <a class="el" href="res__astum_8c-source.html#l00474">cli_aum_show_user()</a>, <a class="el" href="manager_8c-source.html#l00456">handle_showmancmd()</a>, and <a class="el" href="manager_8c-source.html#l00566">handle_showmancmds()</a>.<div class="fragment"><pre class="fragment"><a name="l00326"></a>00326 {
<a name="l00327"></a>00327    <span class="keywordtype">int</span> i;
<a name="l00328"></a>00328    <span class="keywordtype">char</span> *sep = <span class="stringliteral">""</span>;
<a name="l00329"></a>00329 
<a name="l00330"></a>00330    (*res)-&gt;used = 0;
<a name="l00331"></a>00331    <span class="keywordflow">for</span> (i = 0; i &lt; (<span class="keyword">sizeof</span>(<a class="code" href="group__Group__AMI.html#g94a45625d6a1e46563105bbad0c894f9">perms</a>) / <span class="keyword">sizeof</span>(perms[0])) - 1; i++) {
<a name="l00332"></a>00332       <span class="keywordflow">if</span> (authority &amp; perms[i].<a class="code" href="adsistub_8c.html#0fc3cfbc27e91ea60a787de13dae3e3c">num</a>) {
<a name="l00333"></a>00333          <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(res, 0, <span class="stringliteral">"%s%s"</span>, sep, perms[i].label);
<a name="l00334"></a>00334          sep = <span class="stringliteral">","</span>;
<a name="l00335"></a>00335       }
<a name="l00336"></a>00336    }
<a name="l00337"></a>00337 
<a name="l00338"></a>00338    <span class="keywordflow">if</span> ((*res)-&gt;used == 0)  <span class="comment">/* replace empty string with something sensible */</span>
<a name="l00339"></a>00339       <a class="code" href="strings_8h.html#0c00985509b077cfe0ccdd5829342ca4">ast_str_append</a>(res, 0, <span class="stringliteral">"&lt;none&gt;"</span>);
<a name="l00340"></a>00340 
<a name="l00341"></a>00341    <span class="keywordflow">return</span> (*res)-&gt;str;
<a name="l00342"></a>00342 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="gd45bb050dddb40e1768551d6be08c1ad"></a><!-- doxytag: member="manager.c::check_manager_enabled" ref="gd45bb050dddb40e1768551d6be08c1ad" args="()" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int check_manager_enabled           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Check if AMI is enabled. 
<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00257">257</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00117">manager_enabled</a>.
<p>
Referenced by <a class="el" href="asterisk_8c-source.html#l00344">handle_show_settings()</a>.<div class="fragment"><pre class="fragment"><a name="l00258"></a>00258 {
<a name="l00259"></a>00259    <span class="keywordflow">return</span> <a class="code" href="group__Group__AMI.html#g7fa4f9f44eb840da897cd6df25e71ea4">manager_enabled</a>;
<a name="l00260"></a>00260 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g1889b1316d12271fa30e9f302c0da675"></a><!-- doxytag: member="manager.c::check_manager_session_inuse" ref="g1889b1316d12271fa30e9f302c0da675" args="(const char *name)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int check_manager_session_inuse           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>name</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00426">426</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00453">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, and <a class="el" href="manager_8c-source.html#l00151">mansession::username</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l02288">process_message()</a>.<div class="fragment"><pre class="fragment"><a name="l00427"></a>00427 {
<a name="l00428"></a>00428    <span class="keyword">struct </span><a class="code" href="structmansession.html">mansession</a> *session = NULL;
<a name="l00429"></a>00429 
<a name="l00430"></a>00430    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>);
<a name="l00431"></a>00431    <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>, session, list) {
<a name="l00432"></a>00432       <span class="keywordflow">if</span> (!strcasecmp(session-&gt;<a class="code" href="structmansession.html#5aec535b6e1a39142c62cb283d7f9268">username</a>, <a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>)) 
<a name="l00433"></a>00433          <span class="keywordflow">break</span>;
<a name="l00434"></a>00434    }
<a name="l00435"></a>00435    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>);
<a name="l00436"></a>00436 
<a name="l00437"></a>00437    <span class="keywordflow">return</span> session ? 1 : 0;
<a name="l00438"></a>00438 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g6fcd08c8c073e9da6c6f96d6663d69d9"></a><!-- doxytag: member="manager.c::check_webmanager_enabled" ref="g6fcd08c8c073e9da6c6f96d6663d69d9" args="()" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int check_webmanager_enabled           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Check if AMI/HTTP is enabled. 
<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00262">262</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00117">manager_enabled</a>, and <a class="el" href="manager_8c-source.html#l00118">webmanager_enabled</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l02200">action_coresettings()</a>, and <a class="el" href="asterisk_8c-source.html#l00344">handle_show_settings()</a>.<div class="fragment"><pre class="fragment"><a name="l00263"></a>00263 {
<a name="l00264"></a>00264    <span class="keywordflow">return</span> (<a class="code" href="group__Group__AMI.html#ge48c16ca333fc1529958ca58131fd875">webmanager_enabled</a> &amp;&amp; <a class="code" href="group__Group__AMI.html#g7fa4f9f44eb840da897cd6df25e71ea4">manager_enabled</a>);
<a name="l00265"></a>00265 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g4602d648ab671d826260eb839d90ab26"></a><!-- doxytag: member="manager.c::complete_show_mancmd" ref="g4602d648ab671d826260eb839d90ab26" args="(const char *line, const char *word, int pos, int state)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static char* complete_show_mancmd           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>line</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>word</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>pos</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>state</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00408">408</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8h-source.html#l00102">manager_action::action</a>, <a class="el" href="lock_8h-source.html#l00642">ast_rwlock_rdlock()</a>, <a class="el" href="lock_8h-source.html#l00637">ast_rwlock_unlock()</a>, <a class="el" href="utils_8h.html#d67aacdb581292a9d103cf349d0d2862">ast_strdup</a>, <a class="el" href="manager_8c-source.html#l00191">first_action</a>, and <a class="el" href="manager_8h-source.html#l00112">manager_action::next</a>.<div class="fragment"><pre class="fragment"><a name="l00409"></a>00409 {
<a name="l00410"></a>00410    <span class="keyword">struct </span><a class="code" href="structmanager__action.html">manager_action</a> *cur;
<a name="l00411"></a>00411    <span class="keywordtype">int</span> l = strlen(word), which = 0;
<a name="l00412"></a>00412    <span class="keywordtype">char</span> *ret = NULL;
<a name="l00413"></a>00413 
<a name="l00414"></a>00414    <a class="code" href="lock_8h.html#f4b8158bcd471d4f28b380768e3ee073">ast_rwlock_rdlock</a>(&amp;actionlock);
<a name="l00415"></a>00415    <span class="keywordflow">for</span> (cur = <a class="code" href="group__Group__AMI.html#gb9fdf2c32a9e1ffe8bea294eb2132fe6">first_action</a>; cur; cur = cur-&gt;<a class="code" href="structmanager__action.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>) { <span class="comment">/* Walk the list of actions */</span>
<a name="l00416"></a>00416       <span class="keywordflow">if</span> (!strncasecmp(word, cur-&gt;<a class="code" href="structmanager__action.html#418c5509e2171d55b0aee5c2ea4442b5">action</a>, l) &amp;&amp; ++which &gt; <a class="code" href="structstate.html">state</a>) {
<a name="l00417"></a>00417          ret = <a class="code" href="utils_8h.html#d67aacdb581292a9d103cf349d0d2862">ast_strdup</a>(cur-&gt;<a class="code" href="structmanager__action.html#418c5509e2171d55b0aee5c2ea4442b5">action</a>);
<a name="l00418"></a>00418          <span class="keywordflow">break</span>;   <span class="comment">/* make sure we exit even if ast_strdup() returns NULL */</span>
<a name="l00419"></a>00419       }
<a name="l00420"></a>00420    }
<a name="l00421"></a>00421    <a class="code" href="lock_8h.html#97ed909ef0a0582cf3870dd0629852c8">ast_rwlock_unlock</a>(&amp;actionlock);
<a name="l00422"></a>00422 
<a name="l00423"></a>00423    <span class="keywordflow">return</span> ret;
<a name="l00424"></a>00424 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g2748014a620509eb30d57cd01d0218ce"></a><!-- doxytag: member="manager.c::destroy_session" ref="g2748014a620509eb30d57cd01d0218ce" args="(struct mansession *s)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void destroy_session           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>s</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00703">703</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00731">AST_LIST_REMOVE</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, <a class="el" href="manager_8c-source.html#l00693">free_session()</a>, and <a class="el" href="manager_8c-source.html#l00121">num_sessions</a>.
<p>
Referenced by <a class="el" href="chan__skinny_8c-source.html#l04509">accept_thread()</a>, <a class="el" href="manager_8c-source.html#l02988">generic_http_callback()</a>, <a class="el" href="manager_8c-source.html#l02448">session_do()</a>, and <a class="el" href="chan__skinny_8c-source.html#l04472">skinny_session()</a>.<div class="fragment"><pre class="fragment"><a name="l00704"></a>00704 {
<a name="l00705"></a>00705    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>);
<a name="l00706"></a>00706    <a class="code" href="linkedlists_8h.html#d4a4c53d3b264b4e1c5e3fdd84cd8b5a">AST_LIST_REMOVE</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>, s, list);
<a name="l00707"></a>00707    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>);
<a name="l00708"></a>00708 
<a name="l00709"></a>00709    ast_atomic_fetchadd_int(&amp;<a class="code" href="group__Group__AMI.html#g16d027da9851b664ff9336caf28769e8">num_sessions</a>, -1);
<a name="l00710"></a>00710    <a class="code" href="group__Group__AMI.html#g1ea5536cdcef90f22613b5db2ee59b0d">free_session</a>(s);
<a name="l00711"></a>00711 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g9af7cd1eddf73300ec737507cdaee283"></a><!-- doxytag: member="manager.c::do_message" ref="g9af7cd1eddf73300ec737507cdaee283" args="(struct mansession *s)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int do_message           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>s</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02416">2416</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8h-source.html#l00062">AST_MAX_MANHEADERS</a>, <a class="el" href="utils_8h.html#b38bbfc0f090d7e013ad805ff172a7d2">ast_strdupa</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="manager_8c-source.html#l02351">get_input()</a>, <a class="el" href="manager_8h-source.html#l00096">message::hdrcount</a>, <a class="el" href="manager_8h-source.html#l00097">message::headers</a>, <a class="el" href="manager_8c-source.html#l00156">mansession::inbuf</a>, <a class="el" href="manager_8c-source.html#l02146">process_events()</a>, and <a class="el" href="manager_8c-source.html#l02288">process_message()</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l02448">session_do()</a>.<div class="fragment"><pre class="fragment"><a name="l02417"></a>02417 {
<a name="l02418"></a>02418    <span class="keyword">struct </span><a class="code" href="structmessage.html">message</a> m = { 0 };
<a name="l02419"></a>02419    <span class="keywordtype">char</span> header_buf[<span class="keyword">sizeof</span>(s-&gt;<a class="code" href="structmansession.html#62d43bda85ee13dbbf7f0a8a5248533a">inbuf</a>)] = { <span class="charliteral">'\0'</span> };
<a name="l02420"></a>02420    <span class="keywordtype">int</span> res;
<a name="l02421"></a>02421 
<a name="l02422"></a>02422    <span class="keywordflow">for</span> (;;) {
<a name="l02423"></a>02423       <span class="comment">/* Check if any events are pending and do them if needed */</span>
<a name="l02424"></a>02424       <span class="keywordflow">if</span> (<a class="code" href="group__Group__AMI.html#g83b7cdf115b0fd94f4417d71e9f3abe2">process_events</a>(s))
<a name="l02425"></a>02425          <span class="keywordflow">return</span> -1;
<a name="l02426"></a>02426       res = <a class="code" href="group__Group__AMI.html#gf6b259125b17075ea07ee9939d7fdbf5">get_input</a>(s, header_buf);
<a name="l02427"></a>02427       <span class="keywordflow">if</span> (res == 0) {
<a name="l02428"></a>02428          <span class="keywordflow">continue</span>;
<a name="l02429"></a>02429       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res &gt; 0) {
<a name="l02430"></a>02430          <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(header_buf))
<a name="l02431"></a>02431             <span class="keywordflow">return</span> <a class="code" href="group__Group__AMI.html#g4b975e0463cced020259b711bb8481e2">process_message</a>(s, &amp;m) ? -1 : 0;
<a name="l02432"></a>02432          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m.<a class="code" href="structmessage.html#76e7ad105b17b3d39436c0487d899200">hdrcount</a> &lt; (<a class="code" href="manager_8h.html#233ac9532f94e3f2b355891d25414118">AST_MAX_MANHEADERS</a> - 1))
<a name="l02433"></a>02433             m.<a class="code" href="structmessage.html#0e403735bca63ec8eb4378badc1c98d0">headers</a>[m.<a class="code" href="structmessage.html#76e7ad105b17b3d39436c0487d899200">hdrcount</a>++] = <a class="code" href="utils_8h.html#b38bbfc0f090d7e013ad805ff172a7d2">ast_strdupa</a>(header_buf);
<a name="l02434"></a>02434       } <span class="keywordflow">else</span> {
<a name="l02435"></a>02435          <span class="keywordflow">return</span> res;
<a name="l02436"></a>02436       }
<a name="l02437"></a>02437    }
<a name="l02438"></a>02438 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g07edcd94b098b94138489a2a65ce84f8"></a><!-- doxytag: member="manager.c::fast_originate" ref="g07edcd94b098b94138489a2a65ce84f8" args="(void *data)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void* fast_originate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>data</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01850">1850</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l01845">fast_originate_helper::account</a>, <a class="el" href="manager_8c-source.html#l01838">fast_originate_helper::app</a>, <a class="el" href="manager_8c-source.html#l01839">fast_originate_helper::appdata</a>, <a class="el" href="channel_8h-source.html#l00141">AST_CHANNEL_NAME</a>, <a class="el" href="lock_8h.html#a2fac4e1b143bef3b1ac807e0ab48f9f">ast_channel_unlock</a>, <a class="el" href="frame_8h-source.html#l00233">AST_FORMAT_SLINEAR</a>, <a class="el" href="pbx_8c-source.html#l05150">ast_pbx_outgoing_app()</a>, <a class="el" href="pbx_8c-source.html#l04991">ast_pbx_outgoing_exten()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="adsistub_8c-source.html#l00055">chan</a>, <a class="el" href="manager_8c-source.html#l01840">fast_originate_helper::cid_name</a>, <a class="el" href="manager_8c-source.html#l01841">fast_originate_helper::cid_num</a>, <a class="el" href="manager_8c-source.html#l01842">fast_originate_helper::context</a>, <a class="el" href="manager_8c-source.html#l01836">fast_originate_helper::data</a>, <a class="el" href="manager_8h-source.html#l00052">EVENT_FLAG_CALL</a>, <a class="el" href="manager_8c-source.html#l01843">fast_originate_helper::exten</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="manager_8c-source.html#l01844">fast_originate_helper::idtext</a>, <a class="el" href="manager_8h-source.html#l00163">manager_event</a>, <a class="el" href="manager_8c-source.html#l01846">fast_originate_helper::priority</a>, <a class="el" href="strings_8h-source.html#l00045">S_OR</a>, <a class="el" href="manager_8c-source.html#l01835">fast_originate_helper::tech</a>, <a class="el" href="manager_8c-source.html#l01837">fast_originate_helper::timeout</a>, and <a class="el" href="manager_8c-source.html#l01847">fast_originate_helper::vars</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l01912">action_originate()</a>.<div class="fragment"><pre class="fragment"><a name="l01851"></a>01851 {
<a name="l01852"></a>01852    <span class="keyword">struct </span><a class="code" href="structfast__originate__helper.html">fast_originate_helper</a> *in = <a class="code" href="structfast__originate__helper.html#9a1c389bd0690d134877ca3ca177c8d2">data</a>;
<a name="l01853"></a>01853    <span class="keywordtype">int</span> res;
<a name="l01854"></a>01854    <span class="keywordtype">int</span> reason = 0;
<a name="l01855"></a>01855    <span class="keyword">struct </span><a class="code" href="structast__channel.html">ast_channel</a> *<a class="code" href="adsistub_8c.html#26c322652770620e64ac90682eb6504c">chan</a> = NULL;
<a name="l01856"></a>01856    <span class="keywordtype">char</span> requested_channel[<a class="code" href="channel_8h.html#57fb43d64b209037cdc198f3db578d39">AST_CHANNEL_NAME</a>];
<a name="l01857"></a>01857 
<a name="l01858"></a>01858    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(in-&gt;<a class="code" href="structfast__originate__helper.html#d87b6ee5a83ee70a6697ba886125ae9e">app</a>)) {
<a name="l01859"></a>01859       res = <a class="code" href="pbx_8c.html#8bd05d7cdf218eaecfb4a33dd0eb32d8">ast_pbx_outgoing_app</a>(in-&gt;<a class="code" href="structfast__originate__helper.html#646099ae10c2b6f54bbbd25d705d326b">tech</a>, <a class="code" href="frame_8h.html#ce4d062ff9a85be84b636e7ec67a068b">AST_FORMAT_SLINEAR</a>, in-&gt;<a class="code" href="structfast__originate__helper.html#9a1c389bd0690d134877ca3ca177c8d2">data</a>, in-&gt;<a class="code" href="structfast__originate__helper.html#90272dda245ae1fb3cf197e91a8689dc">timeout</a>, in-&gt;<a class="code" href="structfast__originate__helper.html#d87b6ee5a83ee70a6697ba886125ae9e">app</a>, in-&gt;<a class="code" href="structfast__originate__helper.html#c59a3713a42d7885b689012cb769c29f">appdata</a>, &amp;reason, 1,
<a name="l01860"></a>01860          <a class="code" href="strings_8h.html#a5b939153ec133be2de0e3647df143f4">S_OR</a>(in-&gt;<a class="code" href="structfast__originate__helper.html#ca3c0eb6b6e898f3a32aed5de1320774">cid_num</a>, NULL),
<a name="l01861"></a>01861          <a class="code" href="strings_8h.html#a5b939153ec133be2de0e3647df143f4">S_OR</a>(in-&gt;<a class="code" href="structfast__originate__helper.html#70f178a59d8df82fe5e107da71415b9b">cid_name</a>, NULL),
<a name="l01862"></a>01862          in-&gt;<a class="code" href="structfast__originate__helper.html#b63119da730344b345cdc8f62a4711e9">vars</a>, in-&gt;<a class="code" href="structfast__originate__helper.html#a68ae5b7bc66091c1f471b9d6ebb5293">account</a>, &amp;chan);
<a name="l01863"></a>01863    } <span class="keywordflow">else</span> {
<a name="l01864"></a>01864       res = <a class="code" href="pbx_8c.html#1b1911a618935b371e69b60c66cf6221">ast_pbx_outgoing_exten</a>(in-&gt;<a class="code" href="structfast__originate__helper.html#646099ae10c2b6f54bbbd25d705d326b">tech</a>, <a class="code" href="frame_8h.html#ce4d062ff9a85be84b636e7ec67a068b">AST_FORMAT_SLINEAR</a>, in-&gt;<a class="code" href="structfast__originate__helper.html#9a1c389bd0690d134877ca3ca177c8d2">data</a>, in-&gt;<a class="code" href="structfast__originate__helper.html#90272dda245ae1fb3cf197e91a8689dc">timeout</a>, in-&gt;<a class="code" href="structfast__originate__helper.html#c1ae8ba118483c4c23841d72b5e7ebbb">context</a>, in-&gt;<a class="code" href="structfast__originate__helper.html#5aedfeaeaac21e5e5f297360633ea9a3">exten</a>, in-&gt;<a class="code" href="structfast__originate__helper.html#b988295c268025b49dfb3df26171ddc3">priority</a>, &amp;reason, 1,
<a name="l01865"></a>01865          <a class="code" href="strings_8h.html#a5b939153ec133be2de0e3647df143f4">S_OR</a>(in-&gt;<a class="code" href="structfast__originate__helper.html#ca3c0eb6b6e898f3a32aed5de1320774">cid_num</a>, NULL),
<a name="l01866"></a>01866          <a class="code" href="strings_8h.html#a5b939153ec133be2de0e3647df143f4">S_OR</a>(in-&gt;<a class="code" href="structfast__originate__helper.html#70f178a59d8df82fe5e107da71415b9b">cid_name</a>, NULL),
<a name="l01867"></a>01867          in-&gt;<a class="code" href="structfast__originate__helper.html#b63119da730344b345cdc8f62a4711e9">vars</a>, in-&gt;<a class="code" href="structfast__originate__helper.html#a68ae5b7bc66091c1f471b9d6ebb5293">account</a>, &amp;chan);
<a name="l01868"></a>01868    }
<a name="l01869"></a>01869 
<a name="l01870"></a>01870    <span class="keywordflow">if</span> (!chan)
<a name="l01871"></a>01871       snprintf(requested_channel, <a class="code" href="channel_8h.html#57fb43d64b209037cdc198f3db578d39">AST_CHANNEL_NAME</a>, <span class="stringliteral">"%s/%s"</span>, in-&gt;<a class="code" href="structfast__originate__helper.html#646099ae10c2b6f54bbbd25d705d326b">tech</a>, in-&gt;<a class="code" href="structfast__originate__helper.html#9a1c389bd0690d134877ca3ca177c8d2">data</a>);   
<a name="l01872"></a>01872    <span class="comment">/* Tell the manager what happened with the channel */</span>
<a name="l01873"></a>01873    <a class="code" href="manager_8h.html#17a8c809d5b2d04cbb8969a209134c2b">manager_event</a>(<a class="code" href="manager_8h.html#c81a36aac6503176bd649993386b23e4">EVENT_FLAG_CALL</a>, <span class="stringliteral">"OriginateResponse"</span>,
<a name="l01874"></a>01874       <span class="stringliteral">"%s"</span>
<a name="l01875"></a>01875       <span class="stringliteral">"Response: %s\r\n"</span>
<a name="l01876"></a>01876       <span class="stringliteral">"Channel: %s\r\n"</span>
<a name="l01877"></a>01877       <span class="stringliteral">"Context: %s\r\n"</span>
<a name="l01878"></a>01878       <span class="stringliteral">"Exten: %s\r\n"</span>
<a name="l01879"></a>01879       <span class="stringliteral">"Reason: %d\r\n"</span>
<a name="l01880"></a>01880       <span class="stringliteral">"Uniqueid: %s\r\n"</span>
<a name="l01881"></a>01881       <span class="stringliteral">"CallerIDNum: %s\r\n"</span>
<a name="l01882"></a>01882       <span class="stringliteral">"CallerIDName: %s\r\n"</span>,
<a name="l01883"></a>01883       in-&gt;<a class="code" href="structfast__originate__helper.html#0b9b4614d6434ea0573c89d67e0170b7">idtext</a>, res ? <span class="stringliteral">"Failure"</span> : <span class="stringliteral">"Success"</span>, chan ? chan-&gt;name : requested_channel, in-&gt;<a class="code" href="structfast__originate__helper.html#c1ae8ba118483c4c23841d72b5e7ebbb">context</a>, in-&gt;<a class="code" href="structfast__originate__helper.html#5aedfeaeaac21e5e5f297360633ea9a3">exten</a>, reason, 
<a name="l01884"></a>01884       chan ? chan-&gt;uniqueid : <span class="stringliteral">"&lt;null&gt;"</span>,
<a name="l01885"></a>01885       <a class="code" href="strings_8h.html#a5b939153ec133be2de0e3647df143f4">S_OR</a>(in-&gt;<a class="code" href="structfast__originate__helper.html#ca3c0eb6b6e898f3a32aed5de1320774">cid_num</a>, <span class="stringliteral">"&lt;unknown&gt;"</span>),
<a name="l01886"></a>01886       <a class="code" href="strings_8h.html#a5b939153ec133be2de0e3647df143f4">S_OR</a>(in-&gt;<a class="code" href="structfast__originate__helper.html#70f178a59d8df82fe5e107da71415b9b">cid_name</a>, <span class="stringliteral">"&lt;unknown&gt;"</span>)
<a name="l01887"></a>01887       );
<a name="l01888"></a>01888 
<a name="l01889"></a>01889    <span class="comment">/* Locked by ast_pbx_outgoing_exten or ast_pbx_outgoing_app */</span>
<a name="l01890"></a>01890    <span class="keywordflow">if</span> (chan)
<a name="l01891"></a>01891       <a class="code" href="lock_8h.html#a2fac4e1b143bef3b1ac807e0ab48f9f">ast_channel_unlock</a>(chan);
<a name="l01892"></a>01892    <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(in);
<a name="l01893"></a>01893    <span class="keywordflow">return</span> NULL;
<a name="l01894"></a>01894 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g1ea5536cdcef90f22613b5db2ee59b0d"></a><!-- doxytag: member="manager.c::free_session" ref="g1ea5536cdcef90f22613b5db2ee59b0d" args="(struct mansession *s)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void free_session           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>s</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00693">693</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00141">mansession::__lock</a>, <a class="el" href="lock_8h-source.html#l00525">ast_mutex_destroy()</a>, <a class="el" href="manager_8c-source.html#l00144">mansession::f</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="manager_8c-source.html#l00160">mansession::last_ev</a>, and <a class="el" href="manager_8c-source.html#l00679">unref_event()</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l00703">destroy_session()</a>, and <a class="el" href="manager_8c-source.html#l02509">purge_sessions()</a>.<div class="fragment"><pre class="fragment"><a name="l00694"></a>00694 {
<a name="l00695"></a>00695    <span class="keyword">struct </span><a class="code" href="structeventqent.html">eventqent</a> *eqe = s-&gt;<a class="code" href="structmansession.html#272f831d79581a3d16783a36da17e10c">last_ev</a>;
<a name="l00696"></a>00696    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structmansession.html#8fa14cdd754f91cc6554c9e71929cce7">f</a> != NULL)
<a name="l00697"></a>00697       fclose(s-&gt;<a class="code" href="structmansession.html#8fa14cdd754f91cc6554c9e71929cce7">f</a>);
<a name="l00698"></a>00698    <a class="code" href="lock_8h.html#1b27af7774f46859ffe2b1340ee7c082">ast_mutex_destroy</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l00699"></a>00699    <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(s);
<a name="l00700"></a>00700    <a class="code" href="group__Group__AMI.html#gfb5ee4f215d8a2bd0f91355e21f53df5">unref_event</a>(eqe);
<a name="l00701"></a>00701 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="gf6b259125b17075ea07ee9939d7fdbf5"></a><!-- doxytag: member="manager.c::get_input" ref="gf6b259125b17075ea07ee9939d7fdbf5" args="(struct mansession *s, char *output)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int get_input           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>output</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Read one full line (including crlf) from the manager socket. <dl compact><dt><b>Note:</b></dt><dd><div class="fragment"><pre class="fragment"> * \r\n is the only valid terminator for the line.
 * (Note that, later, '\0' will be considered as the end-of-line marker,
 * so everything between the '\0' and the '\r\n' will not be used).
 * Also note that we assume output to have at least "maxlen" space.
 * </pre></div> </dd></dl>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02351">2351</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00141">mansession::__lock</a>, <a class="el" href="utils_8c-source.html#l00493">ast_inet_ntoa()</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="lock_8h-source.html#l00074">AST_PTHREADT_NULL</a>, <a class="el" href="utils_8c-source.html#l00624">ast_wait_for_input()</a>, <a class="el" href="manager_8c-source.html#l00144">mansession::f</a>, <a class="el" href="manager_8c-source.html#l00145">mansession::fd</a>, <a class="el" href="manager_8c-source.html#l00156">mansession::inbuf</a>, <a class="el" href="manager_8c-source.html#l00158">mansession::inlen</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="manager_8c-source.html#l00143">mansession::sin</a>, and <a class="el" href="manager_8c-source.html#l00148">mansession::waiting_thread</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l02416">do_message()</a>, and <a class="el" href="chan__skinny_8c-source.html#l04472">skinny_session()</a>.<div class="fragment"><pre class="fragment"><a name="l02352"></a>02352 {
<a name="l02353"></a>02353    <span class="keywordtype">int</span> res, x;
<a name="l02354"></a>02354    <span class="keywordtype">int</span> maxlen = <span class="keyword">sizeof</span>(s-&gt;<a class="code" href="structmansession.html#62d43bda85ee13dbbf7f0a8a5248533a">inbuf</a>) - 1;
<a name="l02355"></a>02355    <span class="keywordtype">char</span> *src = s-&gt;<a class="code" href="structmansession.html#62d43bda85ee13dbbf7f0a8a5248533a">inbuf</a>;
<a name="l02356"></a>02356 
<a name="l02357"></a>02357    <span class="comment">/*</span>
<a name="l02358"></a>02358 <span class="comment">    * Look for \r\n within the buffer. If found, copy to the output</span>
<a name="l02359"></a>02359 <span class="comment">    * buffer and return, trimming the \r\n (not used afterwards).</span>
<a name="l02360"></a>02360 <span class="comment">    */</span>
<a name="l02361"></a>02361    for (x = 0; x &lt; s-&gt;inlen; x++) {
<a name="l02362"></a>02362       <span class="keywordtype">int</span> cr;  <span class="comment">/* set if we have \r */</span>
<a name="l02363"></a>02363       <span class="keywordflow">if</span> (src[x] == <span class="charliteral">'\r'</span> &amp;&amp; x+1 &lt; s-&gt;<a class="code" href="structmansession.html#517cacbfd832b57c5d2993dbea96ea71">inlen</a> &amp;&amp; src[x+1] == <span class="charliteral">'\n'</span>)
<a name="l02364"></a>02364          cr = 2;  <span class="comment">/* Found. Update length to include \r\n */</span>
<a name="l02365"></a>02365       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (src[x] == <span class="charliteral">'\n'</span>)
<a name="l02366"></a>02366          cr = 1;  <span class="comment">/* also accept \n only */</span>
<a name="l02367"></a>02367       <span class="keywordflow">else</span>
<a name="l02368"></a>02368          <span class="keywordflow">continue</span>;
<a name="l02369"></a>02369       memmove(output, src, x);   <span class="comment">/*... but trim \r\n */</span>
<a name="l02370"></a>02370       output[x] = <span class="charliteral">'\0'</span>;    <span class="comment">/* terminate the string */</span>
<a name="l02371"></a>02371       x += cr;       <span class="comment">/* number of bytes used */</span>
<a name="l02372"></a>02372       s-&gt;<a class="code" href="structmansession.html#517cacbfd832b57c5d2993dbea96ea71">inlen</a> -= x;       <span class="comment">/* remaining size */</span>
<a name="l02373"></a>02373       memmove(src, src + x, s-&gt;<a class="code" href="structmansession.html#517cacbfd832b57c5d2993dbea96ea71">inlen</a>); <span class="comment">/* remove used bytes */</span>
<a name="l02374"></a>02374       <span class="keywordflow">return</span> 1;
<a name="l02375"></a>02375    }
<a name="l02376"></a>02376    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structmansession.html#517cacbfd832b57c5d2993dbea96ea71">inlen</a> &gt;= maxlen) {
<a name="l02377"></a>02377       <span class="comment">/* no crlf found, and buffer full - sorry, too long for us */</span>
<a name="l02378"></a>02378       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Dumping long line with no return from %s: %s\n"</span>, <a class="code" href="utils_8c.html#d5490a9b672272bd2f20ee1e5b72c11e">ast_inet_ntoa</a>(s-&gt;<a class="code" href="structmansession.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_addr), src);
<a name="l02379"></a>02379       s-&gt;<a class="code" href="structmansession.html#517cacbfd832b57c5d2993dbea96ea71">inlen</a> = 0;
<a name="l02380"></a>02380    }
<a name="l02381"></a>02381    res = 0;
<a name="l02382"></a>02382    <span class="keywordflow">while</span> (res == 0) {
<a name="l02383"></a>02383       <span class="comment">/* XXX do we really need this locking ? */</span>
<a name="l02384"></a>02384       <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02385"></a>02385       s-&gt;<a class="code" href="structmansession.html#6ab67d39209330f594dbe0828ca5ac80">waiting_thread</a> = pthread_self();
<a name="l02386"></a>02386       <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02387"></a>02387 
<a name="l02388"></a>02388       res = <a class="code" href="utils_8c.html#88e6eaa2c6fb4d77011df76d5d193728">ast_wait_for_input</a>(s-&gt;<a class="code" href="structmansession.html#36eba1e1e343279857ea7f69a597324e">fd</a>, -1);   <span class="comment">/* return 0 on timeout ? */</span>
<a name="l02389"></a>02389 
<a name="l02390"></a>02390       <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02391"></a>02391       s-&gt;<a class="code" href="structmansession.html#6ab67d39209330f594dbe0828ca5ac80">waiting_thread</a> = <a class="code" href="lock_8h.html#84e4b34008de83ea9d1fa44057758022">AST_PTHREADT_NULL</a>;
<a name="l02392"></a>02392       <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02393"></a>02393    }
<a name="l02394"></a>02394    <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l02395"></a>02395       <span class="comment">/* If we get a signal from some other thread (typically because</span>
<a name="l02396"></a>02396 <span class="comment">       * there are new events queued), return 0 to notify the caller.</span>
<a name="l02397"></a>02397 <span class="comment">       */</span>
<a name="l02398"></a>02398       <span class="keywordflow">if</span> (errno == EINTR)
<a name="l02399"></a>02399          <span class="keywordflow">return</span> 0;
<a name="l02400"></a>02400       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"poll() returned error: %s\n"</span>, strerror(errno));
<a name="l02401"></a>02401       <span class="keywordflow">return</span> -1;
<a name="l02402"></a>02402    }
<a name="l02403"></a>02403    <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02404"></a>02404    res = fread(src + s-&gt;<a class="code" href="structmansession.html#517cacbfd832b57c5d2993dbea96ea71">inlen</a>, 1, maxlen - s-&gt;<a class="code" href="structmansession.html#517cacbfd832b57c5d2993dbea96ea71">inlen</a>, s-&gt;<a class="code" href="structmansession.html#8fa14cdd754f91cc6554c9e71929cce7">f</a>);
<a name="l02405"></a>02405    <span class="keywordflow">if</span> (res &lt; 1)
<a name="l02406"></a>02406       res = -1;   <span class="comment">/* error return */</span>
<a name="l02407"></a>02407    <span class="keywordflow">else</span> {
<a name="l02408"></a>02408       s-&gt;<a class="code" href="structmansession.html#517cacbfd832b57c5d2993dbea96ea71">inlen</a> += res;
<a name="l02409"></a>02409       src[s-&gt;<a class="code" href="structmansession.html#517cacbfd832b57c5d2993dbea96ea71">inlen</a>] = <span class="charliteral">'\0'</span>;
<a name="l02410"></a>02410       res = 0;
<a name="l02411"></a>02411    }
<a name="l02412"></a>02412    <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02413"></a>02413    <span class="keywordflow">return</span> res;
<a name="l02414"></a>02414 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="gcf9022296a6e52672bd7bf89e570c7e0"></a><!-- doxytag: member="manager.c::get_manager_by_name_locked" ref="gcf9022296a6e52672bd7bf89e570c7e0" args="(const char *name)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static struct <a class="el" href="structast__manager__user.html">ast_manager_user</a>* get_manager_by_name_locked           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>name</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
lookup an entry in the list of registered users. must be called with the list lock held. 
<p>
Definition at line <a class="el" href="manager_8c-source.html#l00445">445</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="linkedlists_8h-source.html#l00453">AST_LIST_TRAVERSE</a>, and <a class="el" href="manager_8c-source.html#l00176">ast_manager_user::username</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l00494">handle_showmanager()</a>, and <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l00446"></a>00446 {
<a name="l00447"></a>00447    <span class="keyword">struct </span><a class="code" href="structast__manager__user.html">ast_manager_user</a> *user = NULL;
<a name="l00448"></a>00448 
<a name="l00449"></a>00449    <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;users, user, list)
<a name="l00450"></a>00450       if (!strcasecmp(user-&gt;<a class="code" href="cdr__odbc_8c.html#14c4b06b824ec593239362517f538b29">username</a>, <a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>))
<a name="l00451"></a>00451          break;
<a name="l00452"></a>00452    return user;
<a name="l00453"></a>00453 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g6bfcdc2d3a50cfc5be0ca0b6dbc622ea"></a><!-- doxytag: member="manager.c::get_perm" ref="g6bfcdc2d3a50cfc5be0ca0b6dbc622ea" args="(const char *instr)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int get_perm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>instr</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00366">366</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00349">ast_instring()</a>, and <a class="el" href="group__Group__AMI.html#g94a45625d6a1e46563105bbad0c894f9">perms</a>.
<p>
Referenced by <a class="el" href="res__astum_8c-source.html#l01424">aum_build_group()</a>, <a class="el" href="res__astum_8c-source.html#l01229">aum_build_user()</a>, <a class="el" href="manager_8c-source.html#l00903">authenticate()</a>, and <a class="el" href="manager_8c-source.html#l00385">strings_to_mask()</a>.<div class="fragment"><pre class="fragment"><a name="l00367"></a>00367 {
<a name="l00368"></a>00368    <span class="keywordtype">int</span> x = 0, ret = 0;
<a name="l00369"></a>00369 
<a name="l00370"></a>00370    <span class="keywordflow">if</span> (!instr)
<a name="l00371"></a>00371       <span class="keywordflow">return</span> 0;
<a name="l00372"></a>00372 
<a name="l00373"></a>00373    <span class="keywordflow">for</span> (x = 0; x &lt; (<span class="keyword">sizeof</span>(<a class="code" href="group__Group__AMI.html#g94a45625d6a1e46563105bbad0c894f9">perms</a>) / <span class="keyword">sizeof</span>(perms[0])); x++) {
<a name="l00374"></a>00374       <span class="keywordflow">if</span> (<a class="code" href="group__Group__AMI.html#g5084ba51108af1062dd03070916e4990">ast_instring</a>(instr, perms[x].label, <span class="charliteral">','</span>))
<a name="l00375"></a>00375          ret |= perms[x].num;
<a name="l00376"></a>00376    }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378    <span class="keywordflow">return</span> ret;
<a name="l00379"></a>00379 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g3bc926ccadf91a299fff3f875979895f"></a><!-- doxytag: member="manager.c::grab_last" ref="g3bc926ccadf91a299fff3f875979895f" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static struct <a class="el" href="structeventqent.html">eventqent</a>* grab_last           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Grab a reference to the last event, update usecount as needed. Can handle a NULL pointer. 
<p>
Definition at line <a class="el" href="manager_8c-source.html#l00271">271</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="linkedlists_8h-source.html#l00393">AST_LIST_LAST</a>, <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, and <a class="el" href="manager_8c-source.html#l00104">eventqent::usecount</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l02988">generic_http_callback()</a>, and <a class="el" href="manager_8c-source.html#l02448">session_do()</a>.<div class="fragment"><pre class="fragment"><a name="l00272"></a>00272 {
<a name="l00273"></a>00273    <span class="keyword">struct </span><a class="code" href="structeventqent.html">eventqent</a> *ret;
<a name="l00274"></a>00274 
<a name="l00275"></a>00275    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;all_events);
<a name="l00276"></a>00276    ret = <a class="code" href="linkedlists_8h.html#59bb7a6b664d9bb9678434fc0e6eefb7">AST_LIST_LAST</a>(&amp;all_events);
<a name="l00277"></a>00277    <span class="comment">/* the list is never empty now, but may become so when</span>
<a name="l00278"></a>00278 <span class="comment">    * we optimize it in the future, so be prepared.</span>
<a name="l00279"></a>00279 <span class="comment">    */</span>
<a name="l00280"></a>00280    <span class="keywordflow">if</span> (ret)
<a name="l00281"></a>00281       ast_atomic_fetchadd_int(&amp;ret-&gt;<a class="code" href="structeventqent.html#2bc03f11219aa0e7a3ea1e303a9f0c9a">usecount</a>, 1);
<a name="l00282"></a>00282    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;all_events);
<a name="l00283"></a>00283    <span class="keywordflow">return</span> ret;
<a name="l00284"></a>00284 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g92af1877a38de15bb9ee5483d0f277f7"></a><!-- doxytag: member="manager.c::handle_mandebug" ref="g92af1877a38de15bb9ee5483d0f277f7" args="(int fd, int argc, char *argv[])" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int handle_mandebug           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em>[]</td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00479">479</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="cli_8c-source.html#l00057">ast_cli()</a>, <a class="el" href="manager_8c-source.html#l00123">manager_debug</a>, <a class="el" href="cli_8h-source.html#l00038">RESULT_SHOWUSAGE</a>, and <a class="el" href="cli_8h-source.html#l00037">RESULT_SUCCESS</a>.<div class="fragment"><pre class="fragment"><a name="l00480"></a>00480 {
<a name="l00481"></a>00481    <span class="keywordflow">if</span> (argc == 2)
<a name="l00482"></a>00482       <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"manager debug is %s\n"</span>, <a class="code" href="group__Group__AMI.html#g065d88d3234671acf0f5980f9228b827">manager_debug</a>? <span class="stringliteral">"on"</span> : <span class="stringliteral">"off"</span>);
<a name="l00483"></a>00483    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argc == 3) {
<a name="l00484"></a>00484       <span class="keywordflow">if</span> (!strcasecmp(argv[2], <span class="stringliteral">"on"</span>))
<a name="l00485"></a>00485          <a class="code" href="group__Group__AMI.html#g065d88d3234671acf0f5980f9228b827">manager_debug</a> = 1;
<a name="l00486"></a>00486       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(argv[2], <span class="stringliteral">"off"</span>))
<a name="l00487"></a>00487          <a class="code" href="group__Group__AMI.html#g065d88d3234671acf0f5980f9228b827">manager_debug</a> = 0;
<a name="l00488"></a>00488       <span class="keywordflow">else</span>
<a name="l00489"></a>00489          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d7f3bcd35c16172e6fc0964a175fcadb">RESULT_SHOWUSAGE</a>;
<a name="l00490"></a>00490    }
<a name="l00491"></a>00491    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d92028a33e35e9d037718f4d846096f9">RESULT_SUCCESS</a>;
<a name="l00492"></a>00492 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="gdcf525aba75386762df1e64fa94431fd"></a><!-- doxytag: member="manager.c::handle_showmanager" ref="gdcf525aba75386762df1e64fa94431fd" args="(int fd, int argc, char *argv[])" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int handle_showmanager           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em>[]</td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00494">494</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="cli_8c-source.html#l00057">ast_cli()</a>, <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, <a class="el" href="manager_8c-source.html#l00178">ast_manager_user::deny</a>, <a class="el" href="manager_8c-source.html#l00182">ast_manager_user::displayconnects</a>, <a class="el" href="manager_8c-source.html#l00445">get_manager_by_name_locked()</a>, <a class="el" href="manager_8c-source.html#l00179">ast_manager_user::permit</a>, <a class="el" href="manager_8c-source.html#l00180">ast_manager_user::read</a>, <a class="el" href="cli_8h-source.html#l00038">RESULT_SHOWUSAGE</a>, <a class="el" href="cli_8h-source.html#l00037">RESULT_SUCCESS</a>, <a class="el" href="manager_8c-source.html#l00177">ast_manager_user::secret</a>, <a class="el" href="manager_8c-source.html#l00176">ast_manager_user::username</a>, and <a class="el" href="manager_8c-source.html#l00181">ast_manager_user::write</a>.<div class="fragment"><pre class="fragment"><a name="l00495"></a>00495 {
<a name="l00496"></a>00496    <span class="keyword">struct </span><a class="code" href="structast__manager__user.html">ast_manager_user</a> *user = NULL;
<a name="l00497"></a>00497 
<a name="l00498"></a>00498    <span class="keywordflow">if</span> (argc != 4)
<a name="l00499"></a>00499       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d7f3bcd35c16172e6fc0964a175fcadb">RESULT_SHOWUSAGE</a>;
<a name="l00500"></a>00500 
<a name="l00501"></a>00501    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;users);
<a name="l00502"></a>00502 
<a name="l00503"></a>00503    <span class="keywordflow">if</span> (!(user = <a class="code" href="group__Group__AMI.html#gcf9022296a6e52672bd7bf89e570c7e0">get_manager_by_name_locked</a>(argv[3]))) {
<a name="l00504"></a>00504       <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"There is no manager called %s\n"</span>, argv[3]);
<a name="l00505"></a>00505       <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;users);
<a name="l00506"></a>00506       <span class="keywordflow">return</span> -1;
<a name="l00507"></a>00507    }
<a name="l00508"></a>00508 
<a name="l00509"></a>00509    <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd,<span class="stringliteral">"\n"</span>);
<a name="l00510"></a>00510    <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd,
<a name="l00511"></a>00511       <span class="stringliteral">"       username: %s\n"</span>
<a name="l00512"></a>00512       <span class="stringliteral">"         secret: %s\n"</span>
<a name="l00513"></a>00513       <span class="stringliteral">"           deny: %s\n"</span>
<a name="l00514"></a>00514       <span class="stringliteral">"         permit: %s\n"</span>
<a name="l00515"></a>00515       <span class="stringliteral">"           read: %s\n"</span>
<a name="l00516"></a>00516       <span class="stringliteral">"          write: %s\n"</span>
<a name="l00517"></a>00517       <span class="stringliteral">"displayconnects: %s\n"</span>,
<a name="l00518"></a>00518       (user-&gt;<a class="code" href="structast__manager__user.html#5aec535b6e1a39142c62cb283d7f9268">username</a> ? user-&gt;<a class="code" href="structast__manager__user.html#5aec535b6e1a39142c62cb283d7f9268">username</a> : <span class="stringliteral">"(N/A)"</span>),
<a name="l00519"></a>00519       (user-&gt;<a class="code" href="structast__manager__user.html#5ebe2294ecd0e0f08eab7690d2a6ee69">secret</a> ? <span class="stringliteral">"&lt;Set&gt;"</span> : <span class="stringliteral">"(N/A)"</span>),
<a name="l00520"></a>00520       (user-&gt;<a class="code" href="structast__manager__user.html#05afb6ce69b9cef1bd6ece7e4745f96c">deny</a> ? user-&gt;<a class="code" href="structast__manager__user.html#05afb6ce69b9cef1bd6ece7e4745f96c">deny</a> : <span class="stringliteral">"(N/A)"</span>),
<a name="l00521"></a>00521       (user-&gt;<a class="code" href="structast__manager__user.html#0931be4cc434934e64b1894aa2dba1ae">permit</a> ? user-&gt;<a class="code" href="structast__manager__user.html#0931be4cc434934e64b1894aa2dba1ae">permit</a> : <span class="stringliteral">"(N/A)"</span>),
<a name="l00522"></a>00522       (user-&gt;<a class="code" href="structast__manager__user.html#ecae13117d6f0584c25a9da6c8f8415e">read</a> ? user-&gt;<a class="code" href="structast__manager__user.html#ecae13117d6f0584c25a9da6c8f8415e">read</a> : <span class="stringliteral">"(N/A)"</span>),
<a name="l00523"></a>00523       (user-&gt;<a class="code" href="structast__manager__user.html#efb2a684e4afb7d55e6147fbe5a332ee">write</a> ? user-&gt;<a class="code" href="structast__manager__user.html#efb2a684e4afb7d55e6147fbe5a332ee">write</a> : <span class="stringliteral">"(N/A)"</span>),
<a name="l00524"></a>00524       (user-&gt;<a class="code" href="structast__manager__user.html#a3b408e54a36d8024f4861b84f8648fb">displayconnects</a> ? <span class="stringliteral">"yes"</span> : <span class="stringliteral">"no"</span>));
<a name="l00525"></a>00525 
<a name="l00526"></a>00526    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;users);
<a name="l00527"></a>00527 
<a name="l00528"></a>00528    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d92028a33e35e9d037718f4d846096f9">RESULT_SUCCESS</a>;
<a name="l00529"></a>00529 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g26d7d1506f2ef8110c9c01f335f07911"></a><!-- doxytag: member="manager.c::handle_showmanagers" ref="g26d7d1506f2ef8110c9c01f335f07911" args="(int fd, int argc, char *argv[])" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int handle_showmanagers           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em>[]</td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00532">532</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="cli_8c-source.html#l00057">ast_cli()</a>, <a class="el" href="linkedlists_8h-source.html#l00413">AST_LIST_EMPTY</a>, <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00453">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, <a class="el" href="cli_8h-source.html#l00038">RESULT_SHOWUSAGE</a>, <a class="el" href="cli_8h-source.html#l00037">RESULT_SUCCESS</a>, and <a class="el" href="manager_8c-source.html#l00176">ast_manager_user::username</a>.<div class="fragment"><pre class="fragment"><a name="l00533"></a>00533 {
<a name="l00534"></a>00534    <span class="keyword">struct </span><a class="code" href="structast__manager__user.html">ast_manager_user</a> *user = NULL;
<a name="l00535"></a>00535    <span class="keywordtype">int</span> count_amu = 0;
<a name="l00536"></a>00536 
<a name="l00537"></a>00537    <span class="keywordflow">if</span> (argc != 3)
<a name="l00538"></a>00538       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d7f3bcd35c16172e6fc0964a175fcadb">RESULT_SHOWUSAGE</a>;
<a name="l00539"></a>00539 
<a name="l00540"></a>00540    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;users);
<a name="l00541"></a>00541 
<a name="l00542"></a>00542    <span class="comment">/* If there are no users, print out something along those lines */</span>
<a name="l00543"></a>00543    <span class="keywordflow">if</span> (<a class="code" href="linkedlists_8h.html#0a9573eff61452c49019359bfc0df565">AST_LIST_EMPTY</a>(&amp;users)) {
<a name="l00544"></a>00544       <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"There are no manager users.\n"</span>);
<a name="l00545"></a>00545       <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;users);
<a name="l00546"></a>00546       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d92028a33e35e9d037718f4d846096f9">RESULT_SUCCESS</a>;
<a name="l00547"></a>00547    }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549    <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"\nusername\n--------\n"</span>);
<a name="l00550"></a>00550 
<a name="l00551"></a>00551    <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;users, user, list) {
<a name="l00552"></a>00552       <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"%s\n"</span>, user-&gt;<a class="code" href="structast__manager__user.html#5aec535b6e1a39142c62cb283d7f9268">username</a>);
<a name="l00553"></a>00553       count_amu++;
<a name="l00554"></a>00554    }
<a name="l00555"></a>00555 
<a name="l00556"></a>00556    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;users);
<a name="l00557"></a>00557 
<a name="l00558"></a>00558    <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd,<span class="stringliteral">"-------------------\n"</span>);
<a name="l00559"></a>00559    <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd,<span class="stringliteral">"%d manager users configured.\n"</span>, count_amu);
<a name="l00560"></a>00560 
<a name="l00561"></a>00561    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d92028a33e35e9d037718f4d846096f9">RESULT_SUCCESS</a>;
<a name="l00562"></a>00562 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="ge553b01c2e0c4bf2d135796bb81c4826"></a><!-- doxytag: member="manager.c::handle_showmancmd" ref="ge553b01c2e0c4bf2d135796bb81c4826" args="(int fd, int argc, char *argv[])" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int handle_showmancmd           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em>[]</td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Note:</b></dt><dd>The actionlock is read-locked by the caller of this function </dd></dl>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00456">456</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8h-source.html#l00102">manager_action::action</a>, <a class="el" href="cli_8c-source.html#l00057">ast_cli()</a>, <a class="el" href="strings_8h.html#15892382538fcffb4bd4216c8956c428">ast_str_alloca</a>, <a class="el" href="manager_8h-source.html#l00108">manager_action::authority</a>, <a class="el" href="manager_8c-source.html#l00325">authority_to_str()</a>, <a class="el" href="manager_8h-source.html#l00106">manager_action::description</a>, <a class="el" href="manager_8c-source.html#l00191">first_action</a>, <a class="el" href="manager_8h-source.html#l00112">manager_action::next</a>, <a class="el" href="adsistub_8c-source.html#l00083">num</a>, <a class="el" href="cli_8h-source.html#l00038">RESULT_SHOWUSAGE</a>, <a class="el" href="cli_8h-source.html#l00037">RESULT_SUCCESS</a>, <a class="el" href="strings_8h-source.html#l00045">S_OR</a>, and <a class="el" href="manager_8h-source.html#l00104">manager_action::synopsis</a>.<div class="fragment"><pre class="fragment"><a name="l00457"></a>00457 {
<a name="l00458"></a>00458    <span class="keyword">struct </span><a class="code" href="structmanager__action.html">manager_action</a> *cur;
<a name="l00459"></a>00459    <span class="keyword">struct </span><a class="code" href="structast__str.html">ast_str</a> *authority = <a class="code" href="strings_8h.html#15892382538fcffb4bd4216c8956c428">ast_str_alloca</a>(80);
<a name="l00460"></a>00460    <span class="keywordtype">int</span> <a class="code" href="adsistub_8c.html#0fc3cfbc27e91ea60a787de13dae3e3c">num</a>;
<a name="l00461"></a>00461 
<a name="l00462"></a>00462    <span class="keywordflow">if</span> (argc != 4)
<a name="l00463"></a>00463       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d7f3bcd35c16172e6fc0964a175fcadb">RESULT_SHOWUSAGE</a>;
<a name="l00464"></a>00464 
<a name="l00465"></a>00465    <span class="keywordflow">for</span> (cur = <a class="code" href="group__Group__AMI.html#gb9fdf2c32a9e1ffe8bea294eb2132fe6">first_action</a>; cur; cur = cur-&gt;<a class="code" href="structmanager__action.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>) { <span class="comment">/* Walk the list of actions */</span>
<a name="l00466"></a>00466       <span class="keywordflow">for</span> (num = 3; num &lt; argc; num++) {
<a name="l00467"></a>00467          <span class="keywordflow">if</span> (!strcasecmp(cur-&gt;<a class="code" href="structmanager__action.html#418c5509e2171d55b0aee5c2ea4442b5">action</a>, argv[num])) {
<a name="l00468"></a>00468             <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"Action: %s\nSynopsis: %s\nPrivilege: %s\n%s\n"</span>,
<a name="l00469"></a>00469                cur-&gt;<a class="code" href="structmanager__action.html#418c5509e2171d55b0aee5c2ea4442b5">action</a>, cur-&gt;<a class="code" href="structmanager__action.html#512fbb4e7b617c04031f58b631f2b05d">synopsis</a>,
<a name="l00470"></a>00470                <a class="code" href="group__Group__AMI.html#g7a74ba6c31130ec1d434b549ec0bd523">authority_to_str</a>(cur-&gt;<a class="code" href="structmanager__action.html#873e9c0b50183b613336eea1020f4369">authority</a>, &amp;authority),
<a name="l00471"></a>00471                <a class="code" href="strings_8h.html#a5b939153ec133be2de0e3647df143f4">S_OR</a>(cur-&gt;<a class="code" href="structmanager__action.html#67daf92c833c41c95db874e18fcb2786">description</a>, <span class="stringliteral">""</span>) );
<a name="l00472"></a>00472          }
<a name="l00473"></a>00473       }
<a name="l00474"></a>00474    }
<a name="l00475"></a>00475 
<a name="l00476"></a>00476    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d92028a33e35e9d037718f4d846096f9">RESULT_SUCCESS</a>;
<a name="l00477"></a>00477 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="gb93d1c6d033baab667f87c2ec9ff671c"></a><!-- doxytag: member="manager.c::handle_showmancmds" ref="gb93d1c6d033baab667f87c2ec9ff671c" args="(int fd, int argc, char *argv[])" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int handle_showmancmds           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em>[]</td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
CLI command manager list commands. 
<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00566">566</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8h-source.html#l00102">manager_action::action</a>, <a class="el" href="cli_8c-source.html#l00057">ast_cli()</a>, <a class="el" href="lock_8h-source.html#l00642">ast_rwlock_rdlock()</a>, <a class="el" href="lock_8h-source.html#l00637">ast_rwlock_unlock()</a>, <a class="el" href="strings_8h.html#15892382538fcffb4bd4216c8956c428">ast_str_alloca</a>, <a class="el" href="manager_8h-source.html#l00108">manager_action::authority</a>, <a class="el" href="manager_8c-source.html#l00325">authority_to_str()</a>, <a class="el" href="manager_8c-source.html#l00191">first_action</a>, <a class="el" href="chan__alsa_8c-source.html#l00103">format</a>, <a class="el" href="manager_8h-source.html#l00112">manager_action::next</a>, <a class="el" href="cli_8h-source.html#l00037">RESULT_SUCCESS</a>, and <a class="el" href="manager_8h-source.html#l00104">manager_action::synopsis</a>.<div class="fragment"><pre class="fragment"><a name="l00567"></a>00567 {
<a name="l00568"></a>00568    <span class="keyword">struct </span><a class="code" href="structmanager__action.html">manager_action</a> *cur;
<a name="l00569"></a>00569    <span class="keyword">struct </span><a class="code" href="structast__str.html">ast_str</a> *authority = <a class="code" href="strings_8h.html#15892382538fcffb4bd4216c8956c428">ast_str_alloca</a>(80);
<a name="l00570"></a>00570    <span class="keywordtype">char</span> *<a class="code" href="chan__alsa_8c.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a> = <span class="stringliteral">"  %-15.15s  %-15.15s  %-55.55s\n"</span>;
<a name="l00571"></a>00571 
<a name="l00572"></a>00572    <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, format, <span class="stringliteral">"Action"</span>, <span class="stringliteral">"Privilege"</span>, <span class="stringliteral">"Synopsis"</span>);
<a name="l00573"></a>00573    <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, format, <span class="stringliteral">"------"</span>, <span class="stringliteral">"---------"</span>, <span class="stringliteral">"--------"</span>);
<a name="l00574"></a>00574 
<a name="l00575"></a>00575    <a class="code" href="lock_8h.html#f4b8158bcd471d4f28b380768e3ee073">ast_rwlock_rdlock</a>(&amp;actionlock);
<a name="l00576"></a>00576    <span class="keywordflow">for</span> (cur = <a class="code" href="group__Group__AMI.html#gb9fdf2c32a9e1ffe8bea294eb2132fe6">first_action</a>; cur; cur = cur-&gt;<a class="code" href="structmanager__action.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>) <span class="comment">/* Walk the list of actions */</span>
<a name="l00577"></a>00577       <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, format, cur-&gt;<a class="code" href="structmanager__action.html#418c5509e2171d55b0aee5c2ea4442b5">action</a>, <a class="code" href="group__Group__AMI.html#g7a74ba6c31130ec1d434b549ec0bd523">authority_to_str</a>(cur-&gt;<a class="code" href="structmanager__action.html#873e9c0b50183b613336eea1020f4369">authority</a>, &amp;authority), cur-&gt;<a class="code" href="structmanager__action.html#512fbb4e7b617c04031f58b631f2b05d">synopsis</a>);
<a name="l00578"></a>00578    <a class="code" href="lock_8h.html#97ed909ef0a0582cf3870dd0629852c8">ast_rwlock_unlock</a>(&amp;actionlock);
<a name="l00579"></a>00579 
<a name="l00580"></a>00580    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d92028a33e35e9d037718f4d846096f9">RESULT_SUCCESS</a>;
<a name="l00581"></a>00581 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="gb88212ea47b4627cdab59b899f6fb328"></a><!-- doxytag: member="manager.c::handle_showmanconn" ref="gb88212ea47b4627cdab59b899f6fb328" args="(int fd, int argc, char *argv[])" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int handle_showmanconn           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em>[]</td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
CLI command manager list connected. 
<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00584">584</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="cli_8c-source.html#l00057">ast_cli()</a>, <a class="el" href="utils_8c-source.html#l00493">ast_inet_ntoa()</a>, <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00453">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, <a class="el" href="chan__alsa_8c-source.html#l00103">format</a>, <a class="el" href="cli_8h-source.html#l00037">RESULT_SUCCESS</a>, <a class="el" href="aesopt_8h-source.html#l00399">s</a>, <a class="el" href="manager_8c-source.html#l00143">mansession::sin</a>, and <a class="el" href="manager_8c-source.html#l00151">mansession::username</a>.<div class="fragment"><pre class="fragment"><a name="l00585"></a>00585 {
<a name="l00586"></a>00586    <span class="keyword">struct </span><a class="code" href="structmansession.html">mansession</a> *<a class="code" href="aesopt_8h.html#8d6242bc80162ac99dd4d368eabe77cc">s</a>;
<a name="l00587"></a>00587    <span class="keywordtype">char</span> *<a class="code" href="chan__alsa_8c.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a> = <span class="stringliteral">"  %-15.15s  %-15.15s\n"</span>;
<a name="l00588"></a>00588 
<a name="l00589"></a>00589    <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(<a class="code" href="structmansession.html#36eba1e1e343279857ea7f69a597324e">fd</a>, format, <span class="stringliteral">"Username"</span>, <span class="stringliteral">"IP Address"</span>);
<a name="l00590"></a>00590 
<a name="l00591"></a>00591    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>);
<a name="l00592"></a>00592    <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>, s, list)
<a name="l00593"></a>00593       <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(<a class="code" href="structmansession.html#36eba1e1e343279857ea7f69a597324e">fd</a>, format,s-&gt;<a class="code" href="cdr__odbc_8c.html#14c4b06b824ec593239362517f538b29">username</a>, <a class="code" href="utils_8c.html#d5490a9b672272bd2f20ee1e5b72c11e">ast_inet_ntoa</a>(s-&gt;<a class="code" href="structmansession.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_addr));
<a name="l00594"></a>00594    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>);
<a name="l00595"></a>00595 
<a name="l00596"></a>00596    return <a class="code" href="cli_8h.html#d92028a33e35e9d037718f4d846096f9">RESULT_SUCCESS</a>;
<a name="l00597"></a>00597 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g6a11926a741d1c7d51260d13fbc4c74c"></a><!-- doxytag: member="manager.c::handle_showmaneventq" ref="g6a11926a741d1c7d51260d13fbc4c74c" args="(int fd, int argc, char *argv[])" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int handle_showmaneventq           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em>[]</td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
CLI command manager list eventq. 
<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00601">601</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="cli_8c-source.html#l00057">ast_cli()</a>, <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00453">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, <a class="el" href="manager_8c-source.html#l00105">eventqent::category</a>, <a class="el" href="cli_8h-source.html#l00037">RESULT_SUCCESS</a>, <a class="el" href="aesopt_8h-source.html#l00399">s</a>, and <a class="el" href="manager_8c-source.html#l00104">eventqent::usecount</a>.<div class="fragment"><pre class="fragment"><a name="l00602"></a>00602 {
<a name="l00603"></a>00603    <span class="keyword">struct </span><a class="code" href="structeventqent.html">eventqent</a> *<a class="code" href="aesopt_8h.html#8d6242bc80162ac99dd4d368eabe77cc">s</a>;
<a name="l00604"></a>00604 
<a name="l00605"></a>00605    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;all_events);
<a name="l00606"></a>00606    <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;all_events, s, eq_next) {
<a name="l00607"></a>00607       <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"Usecount: %d\n"</span>,s-&gt;<a class="code" href="structeventqent.html#2bc03f11219aa0e7a3ea1e303a9f0c9a">usecount</a>);
<a name="l00608"></a>00608       <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"Category: %d\n"</span>, s-&gt;<a class="code" href="structeventqent.html#c4ef352f74e502ef5e7bc98e6f4e493d">category</a>);
<a name="l00609"></a>00609       <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(fd, <span class="stringliteral">"Event:\n%s"</span>, s-&gt;eventdata);
<a name="l00610"></a>00610    }
<a name="l00611"></a>00611    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;all_events);
<a name="l00612"></a>00612 
<a name="l00613"></a>00613    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#d92028a33e35e9d037718f4d846096f9">RESULT_SUCCESS</a>;
<a name="l00614"></a>00614 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g745d3d4809316e9124d216a6e3ce93d3"></a><!-- doxytag: member="manager.c::handle_updates" ref="g745d3d4809316e9124d216a6e3ce93d3" args="(struct mansession *s, const struct message *m, struct ast_config *cfg)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void handle_updates           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct <a class="el" href="structast__config.html">ast_config</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>cfg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01177">1177</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="config_8c-source.html#l00333">ast_category_append()</a>, <a class="el" href="config_8c-source.html#l00509">ast_category_delete()</a>, <a class="el" href="config_8c-source.html#l00323">ast_category_get()</a>, <a class="el" href="config_8c-source.html#l00296">ast_category_new()</a>, <a class="el" href="config_8c-source.html#l00400">ast_category_rename()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="config_8c-source.html#l00198">ast_variable_append()</a>, <a class="el" href="config_8c-source.html#l00422">ast_variable_delete()</a>, <a class="el" href="config_8c-source.html#l00183">ast_variable_new()</a>, <a class="el" href="config_8c-source.html#l00471">ast_variable_update()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00105">eventqent::category</a>, <a class="el" href="chan__iax2_8c-source.html#l01198">match()</a>, <a class="el" href="config_8h-source.html#l00042">ast_variable::object</a>, <a class="el" href="config_8h-source.html#l00040">ast_variable::value</a>, and <a class="el" href="ast__expr2f_8c-source.html#l01417">var</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l01251">action_updateconfig()</a>.<div class="fragment"><pre class="fragment"><a name="l01178"></a>01178 {
<a name="l01179"></a>01179    <span class="keywordtype">int</span> x;
<a name="l01180"></a>01180    <span class="keywordtype">char</span> hdr[40];
<a name="l01181"></a>01181    <span class="keyword">const</span> <span class="keywordtype">char</span> *action, *cat, *<a class="code" href="ast__expr2f_8c.html#b2145aac704ce76dbe1ac7adac535b23">var</a>, *value, *<a class="code" href="chan__iax2_8c.html#b5f545ec55667a61a75dd2047251b4ac">match</a>;
<a name="l01182"></a>01182    <span class="keyword">struct </span><a class="code" href="structast__category.html">ast_category</a> *category;
<a name="l01183"></a>01183    <span class="keyword">struct </span><a class="code" href="structast__variable.html">ast_variable</a> *v;
<a name="l01184"></a>01184 
<a name="l01185"></a>01185    <span class="keywordflow">for</span> (x=0;x&lt;100000;x++) {
<a name="l01186"></a>01186       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structast__variable.html#a8cfde6331bd59eb2ac96f8911c4b666">object</a> = 0;
<a name="l01187"></a>01187 
<a name="l01188"></a>01188       snprintf(hdr, <span class="keyword">sizeof</span>(hdr), <span class="stringliteral">"Action-%06d"</span>, x);
<a name="l01189"></a>01189       action = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, hdr);
<a name="l01190"></a>01190       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(action))
<a name="l01191"></a>01191          <span class="keywordflow">break</span>;
<a name="l01192"></a>01192       snprintf(hdr, <span class="keyword">sizeof</span>(hdr), <span class="stringliteral">"Cat-%06d"</span>, x);
<a name="l01193"></a>01193       cat = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, hdr);
<a name="l01194"></a>01194       snprintf(hdr, <span class="keyword">sizeof</span>(hdr), <span class="stringliteral">"Var-%06d"</span>, x);
<a name="l01195"></a>01195       var = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, hdr);
<a name="l01196"></a>01196       snprintf(hdr, <span class="keyword">sizeof</span>(hdr), <span class="stringliteral">"Value-%06d"</span>, x);
<a name="l01197"></a>01197       value = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, hdr);
<a name="l01198"></a>01198       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(value) &amp;&amp; *value == <span class="charliteral">'&gt;'</span>) {
<a name="l01199"></a>01199          object = 1;
<a name="l01200"></a>01200          value++;
<a name="l01201"></a>01201       }
<a name="l01202"></a>01202       snprintf(hdr, <span class="keyword">sizeof</span>(hdr), <span class="stringliteral">"Match-%06d"</span>, x);
<a name="l01203"></a>01203       match = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, hdr);
<a name="l01204"></a>01204       <span class="keywordflow">if</span> (!strcasecmp(action, <span class="stringliteral">"newcat"</span>)) {
<a name="l01205"></a>01205          <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(cat)) {
<a name="l01206"></a>01206             category = <a class="code" href="config_8c.html#7c91d609091f9ffcb3b4a9f8aaa82e7b">ast_category_new</a>(cat);
<a name="l01207"></a>01207             <span class="keywordflow">if</span> (category) {
<a name="l01208"></a>01208                <a class="code" href="config_8c.html#9efd51e40d45378faf85951179110981">ast_category_append</a>(cfg, category);
<a name="l01209"></a>01209             }
<a name="l01210"></a>01210          }
<a name="l01211"></a>01211       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(action, <span class="stringliteral">"renamecat"</span>)) {
<a name="l01212"></a>01212          <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(cat) &amp;&amp; !<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(value)) {
<a name="l01213"></a>01213             category = <a class="code" href="config_8c.html#a4d454598a4630cd3a810f7cecd25d41">ast_category_get</a>(cfg, cat);
<a name="l01214"></a>01214             <span class="keywordflow">if</span> (category)
<a name="l01215"></a>01215                <a class="code" href="config_8c.html#8629d76affd844c6b15a901eb2aa63d7">ast_category_rename</a>(category, value);
<a name="l01216"></a>01216          }
<a name="l01217"></a>01217       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(action, <span class="stringliteral">"delcat"</span>)) {
<a name="l01218"></a>01218          <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(cat))
<a name="l01219"></a>01219             <a class="code" href="config_8c.html#8a891ee1cd71daa7ed06107874f3846c">ast_category_delete</a>(cfg, cat);
<a name="l01220"></a>01220       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(action, <span class="stringliteral">"update"</span>)) {
<a name="l01221"></a>01221          <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(cat) &amp;&amp; !<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(var) &amp;&amp; (category = <a class="code" href="config_8c.html#a4d454598a4630cd3a810f7cecd25d41">ast_category_get</a>(cfg, cat)))
<a name="l01222"></a>01222             <a class="code" href="config_8c.html#4fd56a903e50633096934f229d8a4340">ast_variable_update</a>(category, var, value, match, object);
<a name="l01223"></a>01223       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(action, <span class="stringliteral">"delete"</span>)) {
<a name="l01224"></a>01224          <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(cat) &amp;&amp; !<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(var) &amp;&amp; (category = <a class="code" href="config_8c.html#a4d454598a4630cd3a810f7cecd25d41">ast_category_get</a>(cfg, cat)))
<a name="l01225"></a>01225             <a class="code" href="config_8c.html#edbf64adfaa4adcef27cd5c6efe51be4">ast_variable_delete</a>(category, var, match);
<a name="l01226"></a>01226       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(action, <span class="stringliteral">"append"</span>)) {
<a name="l01227"></a>01227          <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(cat) &amp;&amp; !<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(var) &amp;&amp;
<a name="l01228"></a>01228             (category = <a class="code" href="config_8c.html#a4d454598a4630cd3a810f7cecd25d41">ast_category_get</a>(cfg, cat)) &amp;&amp;
<a name="l01229"></a>01229             (v = <a class="code" href="config_8c.html#c21fb3a90ccd9ec4f8708c3b67b3c654">ast_variable_new</a>(var, value))){
<a name="l01230"></a>01230             <span class="keywordflow">if</span> (object || (match &amp;&amp; !strcasecmp(match, <span class="stringliteral">"object"</span>)))
<a name="l01231"></a>01231                v-&gt;<a class="code" href="structast__variable.html#a8cfde6331bd59eb2ac96f8911c4b666">object</a> = 1;
<a name="l01232"></a>01232             <a class="code" href="config_8c.html#6b8deaf1a9df252e014d697e09cb68b9">ast_variable_append</a>(category, v);
<a name="l01233"></a>01233          }
<a name="l01234"></a>01234       }
<a name="l01235"></a>01235    }
<a name="l01236"></a>01236 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="ge5f94d60aa1b0c445a48748f89b2a78d"></a><!-- doxytag: member="manager.c::json_escape" ref="ge5f94d60aa1b0c445a48748f89b2a78d" args="(char *out, const char *in)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void json_escape           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>out</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>in</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The amount of space in out must be at least ( 2 * strlen(in) + 1 ) 
<p>
Definition at line <a class="el" href="manager_8c-source.html#l01097">1097</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l01114">action_getconfigjson()</a>.<div class="fragment"><pre class="fragment"><a name="l01098"></a>01098 {
<a name="l01099"></a>01099    <span class="keywordflow">for</span> (; *in; in++) {
<a name="l01100"></a>01100       <span class="keywordflow">if</span> (*in == <span class="charliteral">'\\'</span> || *in == <span class="charliteral">'\"'</span>)
<a name="l01101"></a>01101          *out++ = <span class="charliteral">'\\'</span>;
<a name="l01102"></a>01102       *out++ = *in;
<a name="l01103"></a>01103    }
<a name="l01104"></a>01104    *out = <span class="charliteral">'\0'</span>;
<a name="l01105"></a>01105 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="gff6bb88658011308f835d9278cf7f4b5"></a><!-- doxytag: member="manager.c::manager_state_cb" ref="gff6bb88658011308f835d9278cf7f4b5" args="(char *context, char *exten, int state, void *data)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int manager_state_cb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>data</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02654">2654</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="pbx_8c-source.html#l02166">ast_get_hint()</a>, <a class="el" href="manager_8h-source.html#l00052">EVENT_FLAG_CALL</a>, and <a class="el" href="manager_8h-source.html#l00163">manager_event</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.<div class="fragment"><pre class="fragment"><a name="l02655"></a>02655 {
<a name="l02656"></a>02656    <span class="comment">/* Notify managers of change */</span>
<a name="l02657"></a>02657    <span class="keywordtype">char</span> hint[BUFSIZ];
<a name="l02658"></a>02658    <a class="code" href="pbx_8c.html#b654f3264742a57f212c38761672a6c0">ast_get_hint</a>(hint, <span class="keyword">sizeof</span>(hint), NULL, 0, NULL, <a class="code" href="chan__alsa_8c.html#c1ae8ba118483c4c23841d72b5e7ebbb">context</a>, <a class="code" href="chan__alsa_8c.html#5aedfeaeaac21e5e5f297360633ea9a3">exten</a>);
<a name="l02659"></a>02659 
<a name="l02660"></a>02660    <a class="code" href="manager_8h.html#17a8c809d5b2d04cbb8969a209134c2b">manager_event</a>(<a class="code" href="manager_8h.html#c81a36aac6503176bd649993386b23e4">EVENT_FLAG_CALL</a>, <span class="stringliteral">"ExtensionStatus"</span>, <span class="stringliteral">"Exten: %s\r\nContext: %s\r\nHint: %s\r\nStatus: %d\r\n"</span>, <a class="code" href="chan__alsa_8c.html#5aedfeaeaac21e5e5f297360633ea9a3">exten</a>, <a class="code" href="chan__alsa_8c.html#c1ae8ba118483c4c23841d72b5e7ebbb">context</a>, hint, <a class="code" href="structstate.html">state</a>);
<a name="l02661"></a>02661    <span class="keywordflow">return</span> 0;
<a name="l02662"></a>02662 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g83b7cdf115b0fd94f4417d71e9f3abe2"></a><!-- doxytag: member="manager.c::process_events" ref="g83b7cdf115b0fd94f4417d71e9f3abe2" args="(struct mansession *s)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int process_events           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>s</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Send any applicable events to the client listening on this socket. Wait only for a finite time on each event, and drop all events whether they are successfully sent or not. 
<p>
Definition at line <a class="el" href="manager_8c-source.html#l02146">2146</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00141">mansession::__lock</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="manager_8c-source.html#l00153">mansession::authenticated</a>, <a class="el" href="manager_8c-source.html#l00144">mansession::f</a>, <a class="el" href="manager_8c-source.html#l00160">mansession::last_ev</a>, <a class="el" href="manager_8c-source.html#l00165">NEW_EVENT</a>, <a class="el" href="manager_8c-source.html#l00154">mansession::readperm</a>, <a class="el" href="manager_8c-source.html#l00685">ref_event()</a>, <a class="el" href="manager_8c-source.html#l00159">mansession::send_events</a>, <a class="el" href="manager_8c-source.html#l00767">send_string()</a>, and <a class="el" href="manager_8c-source.html#l00679">unref_event()</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l02416">do_message()</a>, and <a class="el" href="manager_8c-source.html#l02288">process_message()</a>.<div class="fragment"><pre class="fragment"><a name="l02147"></a>02147 {
<a name="l02148"></a>02148    <span class="keywordtype">int</span> ret = 0;
<a name="l02149"></a>02149 
<a name="l02150"></a>02150    <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02151"></a>02151    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structmansession.html#8fa14cdd754f91cc6554c9e71929cce7">f</a> != NULL) {
<a name="l02152"></a>02152       <span class="keyword">struct </span><a class="code" href="structeventqent.html">eventqent</a> *eqe;
<a name="l02153"></a>02153 
<a name="l02154"></a>02154       <span class="keywordflow">while</span> ( (eqe = <a class="code" href="group__Group__AMI.html#gf074edf91f83d1f06f7e1bb384bb050a">NEW_EVENT</a>(s)) ) {
<a name="l02155"></a>02155          <a class="code" href="group__Group__AMI.html#ga640283e96a4cdde5b36633464a1318a">ref_event</a>(eqe);
<a name="l02156"></a>02156          <span class="keywordflow">if</span> (!ret &amp;&amp; s-&gt;<a class="code" href="structmansession.html#700633a1b0f65fa8456a18bd6053193c">authenticated</a> &amp;&amp;
<a name="l02157"></a>02157              (s-&gt;<a class="code" href="structmansession.html#e12b8f9551a73d6196648b62754aa9e1">readperm</a> &amp; eqe-&gt;<a class="code" href="structeventqent.html#c4ef352f74e502ef5e7bc98e6f4e493d">category</a>) == eqe-&gt;<a class="code" href="structeventqent.html#c4ef352f74e502ef5e7bc98e6f4e493d">category</a> &amp;&amp;
<a name="l02158"></a>02158              (s-&gt;<a class="code" href="structmansession.html#7f0871bb51563c57440b9ba3875cdaa1">send_events</a> &amp; eqe-&gt;<a class="code" href="structeventqent.html#c4ef352f74e502ef5e7bc98e6f4e493d">category</a>) == eqe-&gt;<a class="code" href="structeventqent.html#c4ef352f74e502ef5e7bc98e6f4e493d">category</a>) {
<a name="l02159"></a>02159             <span class="keywordflow">if</span> (<a class="code" href="group__Group__AMI.html#g28148bd9372a54210c67afe221c2141a">send_string</a>(s, eqe-&gt;eventdata) &lt; 0)
<a name="l02160"></a>02160                ret = -1;   <span class="comment">/* don't send more */</span>
<a name="l02161"></a>02161          }
<a name="l02162"></a>02162          s-&gt;<a class="code" href="structmansession.html#272f831d79581a3d16783a36da17e10c">last_ev</a> = <a class="code" href="group__Group__AMI.html#gfb5ee4f215d8a2bd0f91355e21f53df5">unref_event</a>(s-&gt;<a class="code" href="structmansession.html#272f831d79581a3d16783a36da17e10c">last_ev</a>);
<a name="l02163"></a>02163       }
<a name="l02164"></a>02164    }
<a name="l02165"></a>02165    <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02166"></a>02166    <span class="keywordflow">return</span> ret;
<a name="l02167"></a>02167 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g4b975e0463cced020259b711bb8481e2"></a><!-- doxytag: member="manager.c::process_message" ref="g4b975e0463cced020259b711bb8481e2" args="(struct mansession *s, const struct message *m)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int process_message           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02288">2288</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00141">mansession::__lock</a>, <a class="el" href="manager_8h-source.html#l00102">manager_action::action</a>, <a class="el" href="manager_8c-source.html#l00114">allowmultiplelogin</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="lock_8h-source.html#l00642">ast_rwlock_rdlock()</a>, <a class="el" href="lock_8h-source.html#l00637">ast_rwlock_unlock()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="manager_8c-source.html#l00713">astman_get_header()</a>, <a class="el" href="manager_8c-source.html#l00859">astman_send_error()</a>, <a class="el" href="manager_8c-source.html#l00153">mansession::authenticated</a>, <a class="el" href="manager_8h-source.html#l00108">manager_action::authority</a>, <a class="el" href="manager_8c-source.html#l00426">check_manager_session_inuse()</a>, <a class="el" href="manager_8c-source.html#l00191">first_action</a>, <a class="el" href="structmanager__action.html#b9de002f6fa5a7254b767f219f6a5d42">manager_action::func</a>, <a class="el" href="logger_8h-source.html#l00094">LOG_DEBUG</a>, <a class="el" href="manager_8h-source.html#l00112">manager_action::next</a>, <a class="el" href="asterisk_8c-source.html#l00164">option_debug</a>, <a class="el" href="manager_8c-source.html#l02146">process_events()</a>, and <a class="el" href="manager_8c-source.html#l00155">mansession::writeperm</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l02416">do_message()</a>, and <a class="el" href="manager_8c-source.html#l02988">generic_http_callback()</a>.<div class="fragment"><pre class="fragment"><a name="l02289"></a>02289 {
<a name="l02290"></a>02290    <span class="keywordtype">char</span> action[80] = <span class="stringliteral">""</span>;
<a name="l02291"></a>02291    <span class="keywordtype">int</span> ret = 0;
<a name="l02292"></a>02292    <span class="keyword">struct </span><a class="code" href="structmanager__action.html">manager_action</a> *tmp;
<a name="l02293"></a>02293    <span class="keyword">const</span> <span class="keywordtype">char</span> *user = <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Username"</span>);
<a name="l02294"></a>02294 
<a name="l02295"></a>02295    ast_copy_string(action, <a class="code" href="group__Group__AMI.html#gd208abe83c7bd47d8004134de94d1b4b">astman_get_header</a>(m, <span class="stringliteral">"Action"</span>), <span class="keyword">sizeof</span>(action));
<a name="l02296"></a>02296    <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a>)
<a name="l02297"></a>02297       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"Manager received command '%s'\n"</span>, action);
<a name="l02298"></a>02298 
<a name="l02299"></a>02299    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(action)) {
<a name="l02300"></a>02300       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Missing action in request"</span>);
<a name="l02301"></a>02301       <span class="keywordflow">return</span> 0;
<a name="l02302"></a>02302    }
<a name="l02303"></a>02303 
<a name="l02304"></a>02304    <span class="keywordflow">if</span> (!s-&gt;<a class="code" href="structmansession.html#700633a1b0f65fa8456a18bd6053193c">authenticated</a> &amp;&amp; strcasecmp(action, <span class="stringliteral">"Login"</span>) &amp;&amp; strcasecmp(action, <span class="stringliteral">"Logoff"</span>) &amp;&amp; strcasecmp(action, <span class="stringliteral">"Challenge"</span>)) {
<a name="l02305"></a>02305       <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02306"></a>02306       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Permission denied"</span>);
<a name="l02307"></a>02307       <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02308"></a>02308       <span class="keywordflow">return</span> 0;
<a name="l02309"></a>02309    }
<a name="l02310"></a>02310 
<a name="l02311"></a>02311    <span class="keywordflow">if</span> (!<a class="code" href="group__Group__AMI.html#g96f294e808841cbd886011c9d0192687">allowmultiplelogin</a> &amp;&amp; !s-&gt;<a class="code" href="structmansession.html#700633a1b0f65fa8456a18bd6053193c">authenticated</a> &amp;&amp; user &amp;&amp;
<a name="l02312"></a>02312       (!strcasecmp(action, <span class="stringliteral">"Login"</span>) || !strcasecmp(action, <span class="stringliteral">"Challenge"</span>))) {
<a name="l02313"></a>02313       <span class="keywordflow">if</span> (<a class="code" href="group__Group__AMI.html#g1889b1316d12271fa30e9f302c0da675">check_manager_session_inuse</a>(user)) {
<a name="l02314"></a>02314          sleep(1);
<a name="l02315"></a>02315          <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Login Already In Use"</span>);
<a name="l02316"></a>02316          <span class="keywordflow">return</span> -1;
<a name="l02317"></a>02317       }
<a name="l02318"></a>02318    }
<a name="l02319"></a>02319 
<a name="l02320"></a>02320    <a class="code" href="lock_8h.html#f4b8158bcd471d4f28b380768e3ee073">ast_rwlock_rdlock</a>(&amp;actionlock);  
<a name="l02321"></a>02321    <span class="keywordflow">for</span> (tmp = <a class="code" href="group__Group__AMI.html#gb9fdf2c32a9e1ffe8bea294eb2132fe6">first_action</a> ; tmp; tmp = tmp-&gt;<a class="code" href="structmanager__action.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>) {
<a name="l02322"></a>02322       <span class="keywordflow">if</span> (strcasecmp(action, tmp-&gt;<a class="code" href="structmanager__action.html#418c5509e2171d55b0aee5c2ea4442b5">action</a>))
<a name="l02323"></a>02323          <span class="keywordflow">continue</span>;
<a name="l02324"></a>02324       <span class="keywordflow">if</span> ((s-&gt;<a class="code" href="structmansession.html#1cc72854e73b9b510a12e993d6479e86">writeperm</a> &amp; tmp-&gt;<a class="code" href="structmanager__action.html#873e9c0b50183b613336eea1020f4369">authority</a>) == tmp-&gt;<a class="code" href="structmanager__action.html#873e9c0b50183b613336eea1020f4369">authority</a>)
<a name="l02325"></a>02325          ret = tmp-&gt;<a class="code" href="structmanager__action.html#b9de002f6fa5a7254b767f219f6a5d42">func</a>(s, m);
<a name="l02326"></a>02326       <span class="keywordflow">else</span>
<a name="l02327"></a>02327          <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Permission denied"</span>);
<a name="l02328"></a>02328       <span class="keywordflow">break</span>;
<a name="l02329"></a>02329    }
<a name="l02330"></a>02330    <a class="code" href="lock_8h.html#97ed909ef0a0582cf3870dd0629852c8">ast_rwlock_unlock</a>(&amp;actionlock);
<a name="l02331"></a>02331    <span class="keywordflow">if</span> (!tmp) {
<a name="l02332"></a>02332       <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02333"></a>02333       <a class="code" href="group__Group__AMI.html#g23a27dba104a8df4bb1c6a217a71e7e7">astman_send_error</a>(s, m, <span class="stringliteral">"Invalid/unknown command. Use Action: ListCommands to show available commands."</span>);
<a name="l02334"></a>02334       <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02335"></a>02335    }
<a name="l02336"></a>02336    <span class="keywordflow">if</span> (ret)
<a name="l02337"></a>02337       <span class="keywordflow">return</span> ret;
<a name="l02338"></a>02338    <span class="comment">/* Once done with our message, deliver any pending events */</span>
<a name="l02339"></a>02339    <span class="keywordflow">return</span> <a class="code" href="group__Group__AMI.html#g83b7cdf115b0fd94f4417d71e9f3abe2">process_events</a>(s);
<a name="l02340"></a>02340 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g50cd338ac6ba658c88ad6a7752b556e8"></a><!-- doxytag: member="manager.c::purge_events" ref="g50cd338ac6ba658c88ad6a7752b556e8" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void purge_events           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Purge unused events. Remove elements from the head as long as their usecount is 0 and there is a next element. 
<p>
Definition at line <a class="el" href="manager_8c-source.html#l00290">290</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="linkedlists_8h-source.html#l00385">AST_LIST_FIRST</a>, <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00403">AST_LIST_NEXT</a>, <a class="el" href="linkedlists_8h-source.html#l00710">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, and <a class="el" href="manager_8c-source.html#l00104">eventqent::usecount</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03187">purge_old_stuff()</a>.<div class="fragment"><pre class="fragment"><a name="l00291"></a>00291 {
<a name="l00292"></a>00292    <span class="keyword">struct </span><a class="code" href="structeventqent.html">eventqent</a> *ev;
<a name="l00293"></a>00293 
<a name="l00294"></a>00294    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;all_events);
<a name="l00295"></a>00295    <span class="keywordflow">while</span> ( (ev = <a class="code" href="linkedlists_8h.html#e4deb7f32ef480cbc3b2e9b7e4ceff6c">AST_LIST_FIRST</a>(&amp;all_events)) &amp;&amp;
<a name="l00296"></a>00296        ev-&gt;<a class="code" href="structeventqent.html#2bc03f11219aa0e7a3ea1e303a9f0c9a">usecount</a> == 0 &amp;&amp; <a class="code" href="linkedlists_8h.html#ab7d30c78fda9982ddc59f746adf8a69">AST_LIST_NEXT</a>(ev, eq_next)) {
<a name="l00297"></a>00297       <a class="code" href="linkedlists_8h.html#beec347da29fe6b0d7fdb3e80b851f90">AST_LIST_REMOVE_HEAD</a>(&amp;all_events, eq_next);
<a name="l00298"></a>00298       <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(ev);
<a name="l00299"></a>00299    }
<a name="l00300"></a>00300    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;all_events);
<a name="l00301"></a>00301 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g4051b884ed44c7d2b8b79ed1ffb0cd26"></a><!-- doxytag: member="manager.c::purge_sessions" ref="g4051b884ed44c7d2b8b79ed1ffb0cd26" args="(int n_max)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void purge_sessions           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>n_max</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
remove at most n_max stale session from the list. 
<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02509">2509</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="utils_8c-source.html#l00493">ast_inet_ntoa()</a>, <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00516">AST_LIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h-source.html#l00491">AST_LIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h-source.html#l00554">AST_LIST_TRAVERSE_SAFE_END</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, <a class="el" href="logger_8c-source.html#l00989">ast_verbose()</a>, <a class="el" href="manager_8c-source.html#l00153">mansession::authenticated</a>, <a class="el" href="manager_8c-source.html#l00693">free_session()</a>, <a class="el" href="manager_8c-source.html#l00146">mansession::inuse</a>, <a class="el" href="manager_8c-source.html#l00121">num_sessions</a>, <a class="el" href="asterisk_8c-source.html#l00163">option_verbose</a>, <a class="el" href="aesopt_8h-source.html#l00399">s</a>, <a class="el" href="manager_8c-source.html#l00150">mansession::sessiontimeout</a>, <a class="el" href="manager_8c-source.html#l00143">mansession::sin</a>, <a class="el" href="manager_8c-source.html#l00151">mansession::username</a>, and <a class="el" href="logger_8h-source.html#l00044">VERBOSE_PREFIX_2</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03187">purge_old_stuff()</a>.<div class="fragment"><pre class="fragment"><a name="l02510"></a>02510 {
<a name="l02511"></a>02511    <span class="keyword">struct </span><a class="code" href="structmansession.html">mansession</a> *<a class="code" href="aesopt_8h.html#8d6242bc80162ac99dd4d368eabe77cc">s</a>;
<a name="l02512"></a>02512    time_t now = time(NULL);
<a name="l02513"></a>02513 
<a name="l02514"></a>02514    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>);
<a name="l02515"></a>02515    <a class="code" href="linkedlists_8h.html#915e438a9528c8d6316c617b5bd84487">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>, s, list) {
<a name="l02516"></a>02516       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structmansession.html#cc09d7a7585e6c67ce40707760dd8ba2">sessiontimeout</a> &amp;&amp; (now &gt; s-&gt;<a class="code" href="structmansession.html#cc09d7a7585e6c67ce40707760dd8ba2">sessiontimeout</a>) &amp;&amp; !s-&gt;<a class="code" href="structmansession.html#9ac84af00bd68fa1e4441a101c6b6305">inuse</a>) {
<a name="l02517"></a>02517          <a class="code" href="linkedlists_8h.html#37f99379dafa45c921f95bf7235eb91d">AST_LIST_REMOVE_CURRENT</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>, list);
<a name="l02518"></a>02518          ast_atomic_fetchadd_int(&amp;<a class="code" href="group__Group__AMI.html#g16d027da9851b664ff9336caf28769e8">num_sessions</a>, -1);
<a name="l02519"></a>02519          <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structmansession.html#700633a1b0f65fa8456a18bd6053193c">authenticated</a> &amp;&amp; (<a class="code" href="group__main__options.html#ge36cdd7167e060bff70d00fbd82809eb">option_verbose</a> &gt; 1) &amp;&amp; <a class="code" href="group__Group__AMI.html#ga3b408e54a36d8024f4861b84f8648fb">displayconnects</a>) {
<a name="l02520"></a>02520             <a class="code" href="logger_8c.html#6a1ef0a194bcc79fccfb662192954477">ast_verbose</a>(<a class="code" href="logger_8h.html#6e3640436a97291b451a8d264b5ab15d">VERBOSE_PREFIX_2</a> <span class="stringliteral">"HTTP Manager '%s' timed out from %s\n"</span>,
<a name="l02521"></a>02521                s-&gt;<a class="code" href="structmansession.html#5aec535b6e1a39142c62cb283d7f9268">username</a>, <a class="code" href="utils_8c.html#d5490a9b672272bd2f20ee1e5b72c11e">ast_inet_ntoa</a>(s-&gt;<a class="code" href="structmansession.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_addr));
<a name="l02522"></a>02522          }
<a name="l02523"></a>02523          <a class="code" href="group__Group__AMI.html#g1ea5536cdcef90f22613b5db2ee59b0d">free_session</a>(s);  <span class="comment">/* XXX outside ? */</span>
<a name="l02524"></a>02524          <span class="keywordflow">if</span> (--n_max &lt;= 0)
<a name="l02525"></a>02525             <span class="keywordflow">break</span>;
<a name="l02526"></a>02526       }
<a name="l02527"></a>02527    }
<a name="l02528"></a>02528    <a class="code" href="linkedlists_8h.html#a93fdadc00a2a090968004b7d9c79630">AST_LIST_TRAVERSE_SAFE_END</a>
<a name="l02529"></a>02529    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>);
<a name="l02530"></a>02530 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="ga640283e96a4cdde5b36633464a1318a"></a><!-- doxytag: member="manager.c::ref_event" ref="ga640283e96a4cdde5b36633464a1318a" args="(struct eventqent *e)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void ref_event           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structeventqent.html">eventqent</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>e</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00685">685</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00104">eventqent::usecount</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l01291">action_waitevent()</a>, and <a class="el" href="manager_8c-source.html#l02146">process_events()</a>.<div class="fragment"><pre class="fragment"><a name="l00686"></a>00686 {
<a name="l00687"></a>00687    ast_atomic_fetchadd_int(&amp;e-&gt;<a class="code" href="structeventqent.html#2bc03f11219aa0e7a3ea1e303a9f0c9a">usecount</a>, 1);
<a name="l00688"></a>00688 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g28148bd9372a54210c67afe221c2141a"></a><!-- doxytag: member="manager.c::send_string" ref="g28148bd9372a54210c67afe221c2141a" args="(struct mansession *s, char *string)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int send_string           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>string</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
helper function to send a string to the socket. Return -1 on error (e.g. buffer full). 
<p>
Definition at line <a class="el" href="manager_8c-source.html#l00767">767</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="poll-compat_8h-source.html#l00092">pollfd::events</a>, <a class="el" href="manager_8c-source.html#l00144">mansession::f</a>, <a class="el" href="manager_8c-source.html#l00145">mansession::fd</a>, <a class="el" href="poll-compat_8h-source.html#l00091">pollfd::fd</a>, <a class="el" href="utils_8h-source.html#l00386">len</a>, <a class="el" href="poll_8c-source.html#l00264">poll()</a>, <a class="el" href="poll-compat_8h-source.html#l00084">POLLOUT</a>, and <a class="el" href="manager_8c-source.html#l00161">mansession::writetimeout</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l00802">astman_append()</a>, and <a class="el" href="manager_8c-source.html#l02146">process_events()</a>.<div class="fragment"><pre class="fragment"><a name="l00768"></a>00768 {
<a name="l00769"></a>00769    <span class="keywordtype">int</span> <a class="code" href="utils_8h.html#f5a8e923f8cd24b56b3bab32358cc58a">len</a> = strlen(string);  <span class="comment">/* residual length */</span>
<a name="l00770"></a>00770    <span class="keywordtype">char</span> *src = string;
<a name="l00771"></a>00771    <span class="keyword">struct </span>timeval start = ast_tvnow();
<a name="l00772"></a>00772    <span class="keywordtype">int</span> n = 0;
<a name="l00773"></a>00773 
<a name="l00774"></a>00774    <span class="keywordflow">for</span> (;;) {
<a name="l00775"></a>00775       <span class="keywordtype">int</span> elapsed;
<a name="l00776"></a>00776       <span class="keyword">struct </span><a class="code" href="structpollfd.html">pollfd</a> fd;
<a name="l00777"></a>00777       n = fwrite(src, 1, len, s-&gt;<a class="code" href="structmansession.html#8fa14cdd754f91cc6554c9e71929cce7">f</a>);   <span class="comment">/* try to write the string, non blocking */</span>
<a name="l00778"></a>00778       <span class="keywordflow">if</span> (n == len <span class="comment">/* ok */</span> || n &lt; 0 <span class="comment">/* error */</span>)
<a name="l00779"></a>00779          <span class="keywordflow">break</span>;
<a name="l00780"></a>00780       len -= n;   <span class="comment">/* skip already written data */</span>
<a name="l00781"></a>00781       src += n;
<a name="l00782"></a>00782       fd.<a class="code" href="structpollfd.html#36eba1e1e343279857ea7f69a597324e">fd</a> = s-&gt;<a class="code" href="structmansession.html#36eba1e1e343279857ea7f69a597324e">fd</a>;
<a name="l00783"></a>00783       fd.<a class="code" href="structpollfd.html#16908b0605f2645dfcb4c3a8d248cef3">events</a> = <a class="code" href="poll-compat_8h.html#f82197ce47846604f4f9727bf258b1e1">POLLOUT</a>;
<a name="l00784"></a>00784       n = -1;     <span class="comment">/* error marker */</span>
<a name="l00785"></a>00785       elapsed = ast_tvdiff_ms(ast_tvnow(), start);
<a name="l00786"></a>00786       <span class="keywordflow">if</span> (elapsed &gt; s-&gt;<a class="code" href="structmansession.html#8aa2aeb656bfe257d9d8c38188f42041">writetimeout</a>)
<a name="l00787"></a>00787          <span class="keywordflow">break</span>;
<a name="l00788"></a>00788       <span class="keywordflow">if</span> (<a class="code" href="poll_8c.html#490c34aebc91a7dfe2524a13104fd13e">poll</a>(&amp;fd, 1, s-&gt;<a class="code" href="structmansession.html#8aa2aeb656bfe257d9d8c38188f42041">writetimeout</a> - elapsed) &lt; 1)
<a name="l00789"></a>00789          <span class="keywordflow">break</span>;
<a name="l00790"></a>00790    }
<a name="l00791"></a>00791    fflush(s-&gt;<a class="code" href="structmansession.html#8fa14cdd754f91cc6554c9e71929cce7">f</a>);
<a name="l00792"></a>00792    <span class="keywordflow">return</span> n &lt; 0 ? -1 : 0;
<a name="l00793"></a>00793 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g5014c646ffd1bd67b43210a9a22c136a"></a><!-- doxytag: member="manager.c::session_do" ref="g5014c646ffd1bd67b43210a9a22c136a" args="(void *data)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static void* session_do           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>data</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The body of the individual manager session. Call <a class="el" href="group__Group__AMI.html#gf6b259125b17075ea07ee9939d7fdbf5">get_input()</a> to read one line at a time (or be woken up on new events), collect the lines in a message until found an empty line, and execute the request. In any case, deliver events asynchronously through <a class="el" href="group__Group__AMI.html#g83b7cdf115b0fd94f4417d71e9f3abe2">process_events()</a> (called from here if no line is available, or at the end of <a class="el" href="group__Group__AMI.html#g4b975e0463cced020259b711bb8481e2">process_message()</a>. ). 
<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02448">2448</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8h-source.html#l00048">AMI_VERSION</a>, <a class="el" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>, <a class="el" href="utils_8c-source.html#l00493">ast_inet_ntoa()</a>, <a class="el" href="linkedlists_8h-source.html#l00650">AST_LIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="lock_8h-source.html#l00508">ast_mutex_init()</a>, <a class="el" href="lock_8h-source.html#l00074">AST_PTHREADT_NULL</a>, <a class="el" href="logger_8c-source.html#l00989">ast_verbose()</a>, <a class="el" href="manager_8c-source.html#l00802">astman_append()</a>, <a class="el" href="manager_8c-source.html#l00120">block_sockets</a>, <a class="el" href="manager_8c-source.html#l00703">destroy_session()</a>, <a class="el" href="manager_8c-source.html#l02416">do_message()</a>, <a class="el" href="http_8h-source.html#l00111">server_instance::f</a>, <a class="el" href="http_8h-source.html#l00112">server_instance::fd</a>, <a class="el" href="channel_8h-source.html#l00471">ast_channel::flags</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="manager_8c-source.html#l00271">grab_last()</a>, <a class="el" href="logger_8h-source.html#l00100">LOG_EVENT</a>, <a class="el" href="manager_8c-source.html#l00121">num_sessions</a>, <a class="el" href="asterisk_8c-source.html#l00163">option_verbose</a>, <a class="el" href="http_8h-source.html#l00114">server_instance::requestor</a>, <a class="el" href="aesopt_8h-source.html#l00399">s</a>, and <a class="el" href="logger_8h-source.html#l00044">VERBOSE_PREFIX_2</a>.<div class="fragment"><pre class="fragment"><a name="l02449"></a>02449 {
<a name="l02450"></a>02450    <span class="keyword">struct </span><a class="code" href="structserver__instance.html">server_instance</a> *ser = data;
<a name="l02451"></a>02451    <span class="keyword">struct </span><a class="code" href="structmansession.html">mansession</a> *<a class="code" href="aesopt_8h.html#8d6242bc80162ac99dd4d368eabe77cc">s</a> = <a class="code" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*s));
<a name="l02452"></a>02452    <span class="keywordtype">int</span> flags;
<a name="l02453"></a>02453    <span class="keywordtype">int</span> res;
<a name="l02454"></a>02454 
<a name="l02455"></a>02455    <span class="keywordflow">if</span> (s == NULL)
<a name="l02456"></a>02456       <span class="keywordflow">goto</span> done;
<a name="l02457"></a>02457 
<a name="l02458"></a>02458    s-&gt;<a class="code" href="structmansession.html#8aa2aeb656bfe257d9d8c38188f42041">writetimeout</a> = 100;
<a name="l02459"></a>02459    s-&gt;<a class="code" href="structmansession.html#6ab67d39209330f594dbe0828ca5ac80">waiting_thread</a> = <a class="code" href="lock_8h.html#84e4b34008de83ea9d1fa44057758022">AST_PTHREADT_NULL</a>;
<a name="l02460"></a>02460 
<a name="l02461"></a>02461    flags = fcntl(ser-&gt;<a class="code" href="structserver__instance.html#36eba1e1e343279857ea7f69a597324e">fd</a>, F_GETFL);
<a name="l02462"></a>02462    <span class="keywordflow">if</span> (!<a class="code" href="group__Group__AMI.html#g58780e565b16019054545fbf6ba26a24">block_sockets</a>) <span class="comment">/* make sure socket is non-blocking */</span>
<a name="l02463"></a>02463       flags |= O_NONBLOCK;
<a name="l02464"></a>02464    <span class="keywordflow">else</span>
<a name="l02465"></a>02465       flags &amp;= ~O_NONBLOCK;
<a name="l02466"></a>02466    fcntl(ser-&gt;<a class="code" href="structserver__instance.html#36eba1e1e343279857ea7f69a597324e">fd</a>, F_SETFL, flags);
<a name="l02467"></a>02467 
<a name="l02468"></a>02468    <a class="code" href="lock_8h.html#33e99ac90b0ca47211841b5cab79ffc4">ast_mutex_init</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l02469"></a>02469    s-&gt;<a class="code" href="structmansession.html#7f0871bb51563c57440b9ba3875cdaa1">send_events</a> = -1;
<a name="l02470"></a>02470    <span class="comment">/* these fields duplicate those in the 'ser' structure */</span>
<a name="l02471"></a>02471    s-&gt;<a class="code" href="structmansession.html#36eba1e1e343279857ea7f69a597324e">fd</a> = ser-&gt;<a class="code" href="structserver__instance.html#36eba1e1e343279857ea7f69a597324e">fd</a>;
<a name="l02472"></a>02472    s-&gt;<a class="code" href="structmansession.html#8fa14cdd754f91cc6554c9e71929cce7">f</a> = ser-&gt;<a class="code" href="structserver__instance.html#8fa14cdd754f91cc6554c9e71929cce7">f</a>;
<a name="l02473"></a>02473    s-&gt;<a class="code" href="structmansession.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a> = ser-&gt;<a class="code" href="structserver__instance.html#560115e15fdc6b37096d514904104a57">requestor</a>;
<a name="l02474"></a>02474 
<a name="l02475"></a>02475    ast_atomic_fetchadd_int(&amp;<a class="code" href="group__Group__AMI.html#g16d027da9851b664ff9336caf28769e8">num_sessions</a>, 1);
<a name="l02476"></a>02476    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>);
<a name="l02477"></a>02477    <a class="code" href="linkedlists_8h.html#5df56040a8838bdc841ef8eb179b7609">AST_LIST_INSERT_HEAD</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>, s, list);
<a name="l02478"></a>02478    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="chan__skinny_8c.html#161bca2e917335e125291a00fd76a80f">sessions</a>);
<a name="l02479"></a>02479    <span class="comment">/* Hook to the tail of the event queue */</span>
<a name="l02480"></a>02480    s-&gt;<a class="code" href="structmansession.html#272f831d79581a3d16783a36da17e10c">last_ev</a> = <a class="code" href="group__Group__AMI.html#g3bc926ccadf91a299fff3f875979895f">grab_last</a>();
<a name="l02481"></a>02481    s-&gt;<a class="code" href="structmansession.html#8fa14cdd754f91cc6554c9e71929cce7">f</a> = ser-&gt;<a class="code" href="structserver__instance.html#8fa14cdd754f91cc6554c9e71929cce7">f</a>;
<a name="l02482"></a>02482    <a class="code" href="group__Group__AMI.html#gb743ac558357307ea2fdd322561e371b">astman_append</a>(s, <span class="stringliteral">"Asterisk Call Manager/%s\r\n"</span>, <a class="code" href="manager_8h.html#f3dd4f0a97fca03a8648f607708dafe5">AMI_VERSION</a>); <span class="comment">/* welcome prompt */</span>
<a name="l02483"></a>02483    <span class="keywordflow">for</span> (;;) {
<a name="l02484"></a>02484       <span class="keywordflow">if</span> ((res = <a class="code" href="group__Group__AMI.html#g9af7cd1eddf73300ec737507cdaee283">do_message</a>(s)) &lt; 0)
<a name="l02485"></a>02485          <span class="keywordflow">break</span>;
<a name="l02486"></a>02486    }
<a name="l02487"></a>02487    <span class="comment">/* session is over, explain why and terminate */</span>
<a name="l02488"></a>02488    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structmansession.html#700633a1b0f65fa8456a18bd6053193c">authenticated</a>) {
<a name="l02489"></a>02489       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ge36cdd7167e060bff70d00fbd82809eb">option_verbose</a> &gt; 1) {
<a name="l02490"></a>02490          <span class="keywordflow">if</span> (<a class="code" href="group__Group__AMI.html#ga3b408e54a36d8024f4861b84f8648fb">displayconnects</a>)
<a name="l02491"></a>02491             <a class="code" href="logger_8c.html#6a1ef0a194bcc79fccfb662192954477">ast_verbose</a>(<a class="code" href="logger_8h.html#6e3640436a97291b451a8d264b5ab15d">VERBOSE_PREFIX_2</a> <span class="stringliteral">"Manager '%s' logged off from %s\n"</span>, s-&gt;<a class="code" href="structmansession.html#5aec535b6e1a39142c62cb283d7f9268">username</a>, <a class="code" href="utils_8c.html#d5490a9b672272bd2f20ee1e5b72c11e">ast_inet_ntoa</a>(s-&gt;<a class="code" href="structmansession.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_addr));
<a name="l02492"></a>02492       }
<a name="l02493"></a>02493       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#4671d62857becc386bbe4cfdc0d96fdc">LOG_EVENT</a>, <span class="stringliteral">"Manager '%s' logged off from %s\n"</span>, s-&gt;<a class="code" href="structmansession.html#5aec535b6e1a39142c62cb283d7f9268">username</a>, <a class="code" href="utils_8c.html#d5490a9b672272bd2f20ee1e5b72c11e">ast_inet_ntoa</a>(s-&gt;<a class="code" href="structmansession.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_addr));
<a name="l02494"></a>02494    } <span class="keywordflow">else</span> {
<a name="l02495"></a>02495       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ge36cdd7167e060bff70d00fbd82809eb">option_verbose</a> &gt; 1) {
<a name="l02496"></a>02496          <span class="keywordflow">if</span> (<a class="code" href="group__Group__AMI.html#ga3b408e54a36d8024f4861b84f8648fb">displayconnects</a>)
<a name="l02497"></a>02497             <a class="code" href="logger_8c.html#6a1ef0a194bcc79fccfb662192954477">ast_verbose</a>(<a class="code" href="logger_8h.html#6e3640436a97291b451a8d264b5ab15d">VERBOSE_PREFIX_2</a> <span class="stringliteral">"Connect attempt from '%s' unable to authenticate\n"</span>, <a class="code" href="utils_8c.html#d5490a9b672272bd2f20ee1e5b72c11e">ast_inet_ntoa</a>(s-&gt;<a class="code" href="structmansession.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_addr));
<a name="l02498"></a>02498       }
<a name="l02499"></a>02499       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#4671d62857becc386bbe4cfdc0d96fdc">LOG_EVENT</a>, <span class="stringliteral">"Failed attempt from %s\n"</span>, <a class="code" href="utils_8c.html#d5490a9b672272bd2f20ee1e5b72c11e">ast_inet_ntoa</a>(s-&gt;<a class="code" href="structmansession.html#7d27e4a7ca7533a3bef4fad10a0c19c7">sin</a>.sin_addr));
<a name="l02500"></a>02500    }
<a name="l02501"></a>02501    <a class="code" href="group__Group__AMI.html#g2748014a620509eb30d57cd01d0218ce">destroy_session</a>(s);
<a name="l02502"></a>02502 
<a name="l02503"></a>02503 done:
<a name="l02504"></a>02504    <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(ser);
<a name="l02505"></a>02505    <span class="keywordflow">return</span> NULL;
<a name="l02506"></a>02506 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="gca4968afc65b84cc5b3781d465536b32"></a><!-- doxytag: member="manager.c::set_eventmask" ref="gca4968afc65b84cc5b3781d465536b32" args="(struct mansession *s, const char *eventmask)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int set_eventmask           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>eventmask</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Rather than braindead on,off this now can also accept a specific int mask value or a ',' delim list of mask strings (the same as manager.conf) -anthm. 
<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00884">884</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="manager_8c-source.html#l00141">mansession::__lock</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="manager_8c-source.html#l00159">mansession::send_events</a>, and <a class="el" href="manager_8c-source.html#l00385">strings_to_mask()</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l01416">action_events()</a>, and <a class="el" href="manager_8c-source.html#l00903">authenticate()</a>.<div class="fragment"><pre class="fragment"><a name="l00885"></a>00885 {
<a name="l00886"></a>00886    <span class="keywordtype">int</span> maskint = <a class="code" href="group__Group__AMI.html#g84442272098545210b360ac4f131f10f">strings_to_mask</a>(eventmask);
<a name="l00887"></a>00887 
<a name="l00888"></a>00888    <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l00889"></a>00889    <span class="keywordflow">if</span> (maskint &gt;= 0)
<a name="l00890"></a>00890       s-&gt;<a class="code" href="structmansession.html#7f0871bb51563c57440b9ba3875cdaa1">send_events</a> = maskint;
<a name="l00891"></a>00891    <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;s-&gt;<a class="code" href="structmansession.html#48281fd13118453275d6e66c62994356">__lock</a>);
<a name="l00892"></a>00892 
<a name="l00893"></a>00893    <span class="keywordflow">return</span> maskint;
<a name="l00894"></a>00894 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="g84442272098545210b360ac4f131f10f"></a><!-- doxytag: member="manager.c::strings_to_mask" ref="g84442272098545210b360ac4f131f10f" args="(const char *string)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static int strings_to_mask           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>string</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
A number returns itself, false returns 0, true returns all flags, other strings return the flags that are set. 
<p>
Definition at line <a class="el" href="manager_8c-source.html#l00385">385</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="utils_8c-source.html#l00741">ast_false()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="utils_8c-source.html#l00724">ast_true()</a>, <a class="el" href="manager_8c-source.html#l00366">get_perm()</a>, and <a class="el" href="group__Group__AMI.html#g94a45625d6a1e46563105bbad0c894f9">perms</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l00884">set_eventmask()</a>.<div class="fragment"><pre class="fragment"><a name="l00386"></a>00386 {
<a name="l00387"></a>00387    <span class="keyword">const</span> <span class="keywordtype">char</span> *p;
<a name="l00388"></a>00388 
<a name="l00389"></a>00389    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(string))
<a name="l00390"></a>00390       <span class="keywordflow">return</span> -1;
<a name="l00391"></a>00391 
<a name="l00392"></a>00392    <span class="keywordflow">for</span> (p = string; *p; p++)
<a name="l00393"></a>00393       <span class="keywordflow">if</span> (*p &lt; '0' || *p &gt; <span class="charliteral">'9'</span>)
<a name="l00394"></a>00394          <span class="keywordflow">break</span>;
<a name="l00395"></a>00395    <span class="keywordflow">if</span> (!p)  <span class="comment">/* all digits */</span>
<a name="l00396"></a>00396       <span class="keywordflow">return</span> atoi(string);
<a name="l00397"></a>00397    <span class="keywordflow">if</span> (<a class="code" href="utils_8c.html#b293ff11e14865b872f7430896646c2e">ast_false</a>(string))
<a name="l00398"></a>00398       <span class="keywordflow">return</span> 0;
<a name="l00399"></a>00399    <span class="keywordflow">if</span> (<a class="code" href="utils_8c.html#63bb02e4d6f18c1dbeca92dc63310685">ast_true</a>(string)) { <span class="comment">/* all permissions */</span>
<a name="l00400"></a>00400       <span class="keywordtype">int</span> x, ret = 0;
<a name="l00401"></a>00401       <span class="keywordflow">for</span> (x=0; x&lt;<span class="keyword">sizeof</span>(<a class="code" href="group__Group__AMI.html#g94a45625d6a1e46563105bbad0c894f9">perms</a>) / <span class="keyword">sizeof</span>(perms[0]); x++)
<a name="l00402"></a>00402          ret |= perms[x].num;
<a name="l00403"></a>00403       <span class="keywordflow">return</span> ret;
<a name="l00404"></a>00404    }
<a name="l00405"></a>00405    <span class="keywordflow">return</span> <a class="code" href="group__Group__AMI.html#g6bfcdc2d3a50cfc5be0ca0b6dbc622ea">get_perm</a>(string);
<a name="l00406"></a>00406 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="gfb5ee4f215d8a2bd0f91355e21f53df5"></a><!-- doxytag: member="manager.c::unref_event" ref="gfb5ee4f215d8a2bd0f91355e21f53df5" args="(struct eventqent *e)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">static struct <a class="el" href="structeventqent.html">eventqent</a>* unref_event           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structeventqent.html">eventqent</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>e</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00679">679</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
References <a class="el" href="linkedlists_8h-source.html#l00403">AST_LIST_NEXT</a>, and <a class="el" href="manager_8c-source.html#l00104">eventqent::usecount</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l01291">action_waitevent()</a>, <a class="el" href="manager_8c-source.html#l00693">free_session()</a>, and <a class="el" href="manager_8c-source.html#l02146">process_events()</a>.<div class="fragment"><pre class="fragment"><a name="l00680"></a>00680 {
<a name="l00681"></a>00681    ast_atomic_fetchadd_int(&amp;e-&gt;<a class="code" href="structeventqent.html#2bc03f11219aa0e7a3ea1e303a9f0c9a">usecount</a>, -1);
<a name="l00682"></a>00682    <span class="keywordflow">return</span> <a class="code" href="linkedlists_8h.html#ab7d30c78fda9982ddc59f746adf8a69">AST_LIST_NEXT</a>(e, eq_next);
<a name="l00683"></a>00683 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="g96f294e808841cbd886011c9d0192687"></a><!-- doxytag: member="manager.c::allowmultiplelogin" ref="g96f294e808841cbd886011c9d0192687" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="group__Group__AMI.html#g96f294e808841cbd886011c9d0192687">allowmultiplelogin</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00114">114</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>, and <a class="el" href="manager_8c-source.html#l02288">process_message()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g58780e565b16019054545fbf6ba26a24"></a><!-- doxytag: member="manager.c::block_sockets" ref="g58780e565b16019054545fbf6ba26a24" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="group__Group__AMI.html#g58780e565b16019054545fbf6ba26a24">block_sockets</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00120">120</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>, and <a class="el" href="manager_8c-source.html#l02448">session_do()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="gc63528124b8cf02a55bec42906b204ca"></a><!-- doxytag: member="manager.c::cli_manager" ref="gc63528124b8cf02a55bec42906b204ca" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> <a class="el" href="group__Group__AMI.html#gc63528124b8cf02a55bec42906b204ca">cli_manager</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00643">643</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g7c3e6bc8d40097fbec8dfa709b99eee1"></a><!-- doxytag: member="manager.c::command_blacklist" ref="g7c3e6bc8d40097fbec8dfa709b99eee1" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char* <a class="el" href="group__Group__AMI.html#g7c3e6bc8d40097fbec8dfa709b99eee1">command_blacklist</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
   <span class="stringliteral">"module load"</span>,
   <span class="stringliteral">"module unload"</span>,
}
</pre></div>Descriptor for a manager session, either on the AMI socket or over HTTP. 
<p>
<dl compact><dt><b>Note:</b></dt><dd>AMI session have managerid == 0; the entry is created upon a connect, and destroyed with the socket. HTTP sessions have managerid != 0, the value is used as a search key to lookup sessions (using the mansession_id cookie). </dd></dl>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00134">134</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l01797">action_command()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="ga3b408e54a36d8024f4861b84f8648fb"></a><!-- doxytag: member="manager.c::displayconnects" ref="ga3b408e54a36d8024f4861b84f8648fb" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="group__Group__AMI.html#ga3b408e54a36d8024f4861b84f8648fb">displayconnects</a> = 1<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00113">113</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="gb9fdf2c32a9e1ffe8bea294eb2132fe6"></a><!-- doxytag: member="manager.c::first_action" ref="gb9fdf2c32a9e1ffe8bea294eb2132fe6" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structmanager__action.html">manager_action</a>* <a class="el" href="group__Group__AMI.html#gb9fdf2c32a9e1ffe8bea294eb2132fe6">first_action</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
list of actions registered 
<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00191">191</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l01392">action_listcommands()</a>, <a class="el" href="manager_8c-source.html#l02664">ast_manager_register_struct()</a>, <a class="el" href="manager_8c-source.html#l02633">ast_manager_unregister()</a>, <a class="el" href="manager_8c-source.html#l00408">complete_show_mancmd()</a>, <a class="el" href="manager_8c-source.html#l00456">handle_showmancmd()</a>, <a class="el" href="manager_8c-source.html#l00566">handle_showmancmds()</a>, and <a class="el" href="manager_8c-source.html#l02288">process_message()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="gff966934ba065051f34a94a400e43b17"></a><!-- doxytag: member="manager.c::httptimeout" ref="gff966934ba065051f34a94a400e43b17" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="group__Group__AMI.html#gff966934ba065051f34a94a400e43b17">httptimeout</a> = 60<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00116">116</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l02988">generic_http_callback()</a>, and <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g065d88d3234671acf0f5980f9228b827"></a><!-- doxytag: member="manager.c::manager_debug" ref="g065d88d3234671acf0f5980f9228b827" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="group__Group__AMI.html#g065d88d3234671acf0f5980f9228b827">manager_debug</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
enable some debugging code in the manager 
<p>
Definition at line <a class="el" href="manager_8c-source.html#l00123">123</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l02563">__manager_event()</a>, <a class="el" href="manager_8c-source.html#l00479">handle_mandebug()</a>, and <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g7fa4f9f44eb840da897cd6df25e71ea4"></a><!-- doxytag: member="manager.c::manager_enabled" ref="g7fa4f9f44eb840da897cd6df25e71ea4" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="group__Group__AMI.html#g7fa4f9f44eb840da897cd6df25e71ea4">manager_enabled</a> = 0<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00117">117</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l00257">check_manager_enabled()</a>, <a class="el" href="manager_8c-source.html#l00262">check_webmanager_enabled()</a>, and <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g7ef45bd71ec09dcb2c7e6b8d6e48e57f"></a><!-- doxytag: member="manager.c::mandescr_command" ref="g7ef45bd71ec09dcb2c7e6b8d6e48e57f" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#g7ef45bd71ec09dcb2c7e6b8d6e48e57f">mandescr_command</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
<span class="stringliteral">"Description: Run a CLI command.\n"</span>
<span class="stringliteral">"Variables: (Names marked with * are required)\n"</span>
<span class="stringliteral">"  *Command: Asterisk CLI command to run\n"</span>
<span class="stringliteral">"  ActionID: Optional Action id for message matching.\n"</span>
</pre></div>
<p>
Definition at line <a class="el" href="manager_8c-source.html#l01790">1790</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="ge402cc29f5a0d8a9001d5071152b1281"></a><!-- doxytag: member="manager.c::mandescr_coresettings" ref="ge402cc29f5a0d8a9001d5071152b1281" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#ge402cc29f5a0d8a9001d5071152b1281">mandescr_coresettings</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
<span class="stringliteral">"Description: Query for Core PBX settings.\n"</span>
<span class="stringliteral">"Variables: (Names marked with * are optional)\n"</span>
<span class="stringliteral">"       *ActionID: ActionID of this transaction\n"</span>
</pre></div>
<p>
Definition at line <a class="el" href="manager_8c-source.html#l02194">2194</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g54e903fbbc11dec18a6971c0b9f89df1"></a><!-- doxytag: member="manager.c::mandescr_corestatus" ref="g54e903fbbc11dec18a6971c0b9f89df1" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#g54e903fbbc11dec18a6971c0b9f89df1">mandescr_corestatus</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
<span class="stringliteral">"Description: Query for Core PBX status.\n"</span>
<span class="stringliteral">"Variables: (Names marked with * are optional)\n"</span>
<span class="stringliteral">"       *ActionID: ActionID of this transaction\n"</span>
</pre></div>
<p>
Definition at line <a class="el" href="manager_8c-source.html#l02238">2238</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="gadfa58476f08d0f14e4209140d4ddf57"></a><!-- doxytag: member="manager.c::mandescr_events" ref="gadfa58476f08d0f14e4209140d4ddf57" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#gadfa58476f08d0f14e4209140d4ddf57">mandescr_events</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01408">1408</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="gc23a0e40c449c0ff093ebb890078ccd7"></a><!-- doxytag: member="manager.c::mandescr_extensionstate" ref="gc23a0e40c449c0ff093ebb890078ccd7" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#gc23a0e40c449c0ff093ebb890078ccd7">mandescr_extensionstate</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02074">2074</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g47ba7bebfd930c7ba1797e460b0c261b"></a><!-- doxytag: member="manager.c::mandescr_getconfig" ref="g47ba7bebfd930c7ba1797e460b0c261b" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#g47ba7bebfd930c7ba1797e460b0c261b">mandescr_getconfig</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
<span class="stringliteral">"Description: A 'GetConfig' action will dump the contents of a configuration\n"</span>
<span class="stringliteral">"file by category and contents.\n"</span>
<span class="stringliteral">"Variables:\n"</span>
<span class="stringliteral">"   Filename: Configuration filename (e.g. foo.conf)\n"</span>
</pre></div>
<p>
Definition at line <a class="el" href="manager_8c-source.html#l01059">1059</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="gd3137ad18fefbbb17e1e3848b7423d16"></a><!-- doxytag: member="manager.c::mandescr_getconfigjson" ref="gd3137ad18fefbbb17e1e3848b7423d16" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#gd3137ad18fefbbb17e1e3848b7423d16">mandescr_getconfigjson</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01107">1107</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g7e44f6255d335a2c07e5a08424d9ab47"></a><!-- doxytag: member="manager.c::mandescr_getvar" ref="g7e44f6255d335a2c07e5a08424d9ab47" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#g7e44f6255d335a2c07e5a08424d9ab47">mandescr_getvar</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01541">1541</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="gcd3c210737ab7a7dea258825b16345a4"></a><!-- doxytag: member="manager.c::mandescr_hangup" ref="gcd3c210737ab7a7dea258825b16345a4" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#gcd3c210737ab7a7dea258825b16345a4">mandescr_hangup</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
<span class="stringliteral">"Description: Hangup a channel\n"</span>
<span class="stringliteral">"Variables: \n"</span>
<span class="stringliteral">"  Channel: The channel name to be hungup\n"</span>
</pre></div>
<p>
Definition at line <a class="el" href="manager_8c-source.html#l01475">1475</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g8ff25cb8fe76a131a2401ce3e51ee07e"></a><!-- doxytag: member="manager.c::mandescr_listcommands" ref="g8ff25cb8fe76a131a2401ce3e51ee07e" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#g8ff25cb8fe76a131a2401ce3e51ee07e">mandescr_listcommands</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
<span class="stringliteral">"Description: Returns the action name and synopsis for every\n"</span>
<span class="stringliteral">"  action that is available to the user\n"</span>
<span class="stringliteral">"Variables: NONE\n"</span>
</pre></div>
<p>
Definition at line <a class="el" href="manager_8c-source.html#l01386">1386</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g4eb25b527bf76f2c94ee7f6a1727706c"></a><!-- doxytag: member="manager.c::mandescr_logoff" ref="g4eb25b527bf76f2c94ee7f6a1727706c" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#g4eb25b527bf76f2c94ee7f6a1727706c">mandescr_logoff</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
<span class="stringliteral">"Description: Logoff this manager session\n"</span>
<span class="stringliteral">"Variables: NONE\n"</span>
</pre></div>
<p>
Definition at line <a class="el" href="manager_8c-source.html#l01430">1430</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g4c3b52b7ac90a43027758d2aaf218202"></a><!-- doxytag: member="manager.c::mandescr_mailboxcount" ref="g4c3b52b7ac90a43027758d2aaf218202" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#g4c3b52b7ac90a43027758d2aaf218202">mandescr_mailboxcount</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02043">2043</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="gfbeefe3f5b56dfe8f2379f93f8699b13"></a><!-- doxytag: member="manager.c::mandescr_mailboxstatus" ref="gfbeefe3f5b56dfe8f2379f93f8699b13" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#gfbeefe3f5b56dfe8f2379f93f8699b13">mandescr_mailboxstatus</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Help text for manager command mailboxstatus. 
<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02015">2015</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="gb8d0d86508e429319171f702da06978f"></a><!-- doxytag: member="manager.c::mandescr_originate" ref="gb8d0d86508e429319171f702da06978f" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#gb8d0d86508e429319171f702da06978f">mandescr_originate</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01896">1896</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="gd19fc2f4e2bf2f2b6e916f370a345957"></a><!-- doxytag: member="manager.c::mandescr_ping" ref="gd19fc2f4e2bf2f2b6e916f370a345957" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#gd19fc2f4e2bf2f2b6e916f370a345957">mandescr_ping</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
<span class="stringliteral">"Description: A 'Ping' action will ellicit a 'Pong' response.  Used to keep the\n"</span>
<span class="stringliteral">"  manager connection open.\n"</span>
<span class="stringliteral">"Variables: NONE\n"</span>
</pre></div>Manager PING. 
<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01048">1048</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="gac91809519e0b430f42ce4cfdf5c5a2a"></a><!-- doxytag: member="manager.c::mandescr_redirect" ref="gac91809519e0b430f42ce4cfdf5c5a2a" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#gac91809519e0b430f42ce4cfdf5c5a2a">mandescr_redirect</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01715">1715</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g718ec14078a25254e40cb5ea875d4955"></a><!-- doxytag: member="manager.c::mandescr_sendtext" ref="g718ec14078a25254e40cb5ea875d4955" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#g718ec14078a25254e40cb5ea875d4955">mandescr_sendtext</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01674">1674</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g011be8a601adfe631d2040fd2b3e347d"></a><!-- doxytag: member="manager.c::mandescr_setvar" ref="g011be8a601adfe631d2040fd2b3e347d" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#g011be8a601adfe631d2040fd2b3e347d">mandescr_setvar</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01499">1499</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="gd5b2a1a9f5c7c824e21d0345f08ad0d4"></a><!-- doxytag: member="manager.c::mandescr_timeout" ref="gd5b2a1a9f5c7c824e21d0345f08ad0d4" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#gd5b2a1a9f5c7c824e21d0345f08ad0d4">mandescr_timeout</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02109">2109</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="gb327aa5c1fa62b6a6ea1eff221976639"></a><!-- doxytag: member="manager.c::mandescr_updateconfig" ref="gb327aa5c1fa62b6a6ea1eff221976639" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#gb327aa5c1fa62b6a6ea1eff221976639">mandescr_updateconfig</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01238">1238</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g6c5c4b2a4fc6e25aac2fbc21cbbe12e4"></a><!-- doxytag: member="manager.c::mandescr_userevent" ref="g6c5c4b2a4fc6e25aac2fbc21cbbe12e4" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#g6c5c4b2a4fc6e25aac2fbc21cbbe12e4">mandescr_userevent</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l02169">2169</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g5ac7170aaf87a7b17bc4b85f93facd3a"></a><!-- doxytag: member="manager.c::mandescr_waitevent" ref="g5ac7170aaf87a7b17bc4b85f93facd3a" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#g5ac7170aaf87a7b17bc4b85f93facd3a">mandescr_waitevent</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Manager WAITEVENT. 
<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l01284">1284</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g16d027da9851b664ff9336caf28769e8"></a><!-- doxytag: member="manager.c::num_sessions" ref="g16d027da9851b664ff9336caf28769e8" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="group__Group__AMI.html#g16d027da9851b664ff9336caf28769e8">num_sessions</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00121">121</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l02563">__manager_event()</a>, <a class="el" href="manager_8c-source.html#l00703">destroy_session()</a>, <a class="el" href="manager_8c-source.html#l02988">generic_http_callback()</a>, <a class="el" href="manager_8c-source.html#l02509">purge_sessions()</a>, and <a class="el" href="manager_8c-source.html#l02448">session_do()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g94a45625d6a1e46563105bbad0c894f9"></a><!-- doxytag: member="manager.c::perms" ref="g94a45625d6a1e46563105bbad0c894f9" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structpermalias.html">permalias</a>  <a class="el" href="group__Group__AMI.html#g94a45625d6a1e46563105bbad0c894f9">perms</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
helper functions to convert back and forth between string and numeric representation of set of flags 
<p>
Referenced by <a class="el" href="manager_8c-source.html#l00325">authority_to_str()</a>, <a class="el" href="manager_8c-source.html#l00366">get_perm()</a>, and <a class="el" href="manager_8c-source.html#l00385">strings_to_mask()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="gea495796afbed327cab82112a7b06e91"></a><!-- doxytag: member="manager.c::showmanager_help" ref="gea495796afbed327cab82112a7b06e91" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#gea495796afbed327cab82112a7b06e91">showmanager_help</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
<span class="stringliteral">" Usage: manager show user &lt;user&gt;\n"</span>
<span class="stringliteral">"        Display all information related to the manager user specified.\n"</span>
</pre></div>
<p>
Definition at line <a class="el" href="manager_8c-source.html#l00639">639</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g6629e3faec13dd829b44497132cd264c"></a><!-- doxytag: member="manager.c::showmanagers_help" ref="g6629e3faec13dd829b44497132cd264c" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#g6629e3faec13dd829b44497132cd264c">showmanagers_help</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
<span class="stringliteral">"Usage: manager show users\n"</span>
<span class="stringliteral">"       Prints a listing of all managers that are currently configured on that\n"</span>
<span class="stringliteral">" system.\n"</span>
</pre></div>
<p>
Definition at line <a class="el" href="manager_8c-source.html#l00634">634</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g293b0679af0df6d889fa669b0c0cbdf2"></a><!-- doxytag: member="manager.c::showmancmd_help" ref="g293b0679af0df6d889fa669b0c0cbdf2" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#g293b0679af0df6d889fa669b0c0cbdf2">showmancmd_help</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
<span class="stringliteral">"Usage: manager show command &lt;actionname&gt;\n"</span>
<span class="stringliteral">"  Shows the detailed description for a specific Asterisk manager interface command.\n"</span>
</pre></div>
<p>
Definition at line <a class="el" href="manager_8c-source.html#l00616">616</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g9547e3c81ba49eaa71b260516bf756f2"></a><!-- doxytag: member="manager.c::showmancmds_help" ref="g9547e3c81ba49eaa71b260516bf756f2" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#g9547e3c81ba49eaa71b260516bf756f2">showmancmds_help</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
<span class="stringliteral">"Usage: manager show commands\n"</span>
<span class="stringliteral">"  Prints a listing of all the available Asterisk manager interface commands.\n"</span>
</pre></div>
<p>
Definition at line <a class="el" href="manager_8c-source.html#l00620">620</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g14d45ff06ab8d3edb8c57d75dd7cd939"></a><!-- doxytag: member="manager.c::showmanconn_help" ref="g14d45ff06ab8d3edb8c57d75dd7cd939" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#g14d45ff06ab8d3edb8c57d75dd7cd939">showmanconn_help</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
<span class="stringliteral">"Usage: manager show connected\n"</span>
<span class="stringliteral">"  Prints a listing of the users that are currently connected to the\n"</span>
<span class="stringliteral">"Asterisk manager interface.\n"</span>
</pre></div>
<p>
Definition at line <a class="el" href="manager_8c-source.html#l00624">624</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="gcafda953885f99fc273e3097cdc36867"></a><!-- doxytag: member="manager.c::showmaneventq_help" ref="gcafda953885f99fc273e3097cdc36867" args="[]" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char <a class="el" href="group__Group__AMI.html#gcafda953885f99fc273e3097cdc36867">showmaneventq_help</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><div class="fragment"><pre class="fragment">
<span class="stringliteral">"Usage: manager show eventq\n"</span>
<span class="stringliteral">"  Prints a listing of all events pending in the Asterisk manger\n"</span>
<span class="stringliteral">"event queue.\n"</span>
</pre></div>
<p>
Definition at line <a class="el" href="manager_8c-source.html#l00629">629</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="g846e7158f3a1a166b993bbea7e34c1e0"></a><!-- doxytag: member="manager.c::timestampevents" ref="g846e7158f3a1a166b993bbea7e34c1e0" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="group__Group__AMI.html#g846e7158f3a1a166b993bbea7e34c1e0">timestampevents</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00115">115</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l02563">__manager_event()</a>, and <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="ge48c16ca333fc1529958ca58131fd875"></a><!-- doxytag: member="manager.c::webmanager_enabled" ref="ge48c16ca333fc1529958ca58131fd875" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="group__Group__AMI.html#ge48c16ca333fc1529958ca58131fd875">webmanager_enabled</a> = 0<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="manager_8c-source.html#l00118">118</a> of file <a class="el" href="manager_8c-source.html">manager.c</a>.
<p>
Referenced by <a class="el" href="manager_8c-source.html#l00262">check_webmanager_enabled()</a>, and <a class="el" href="manager_8c-source.html#l03215">init_manager()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu May 24 22:27:57 2007 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.5 </small></address>
</body>
</html>
