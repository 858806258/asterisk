<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (24 May 2007)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Thu May 24 22:27:27 2007</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Finclude_2F.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Finclude_2Fasterisk_2F.html">asterisk</a></div>
<h1>enum.h File Reference</h1>DNS and ENUM functions. <a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="channel_8h-source.html">asterisk/channel.h</a>&quot;</code><br>

<p>
<a href="enum_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structenum__context.html">enum_context</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structenum__naptr__rr.html">enum_naptr_rr</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnaptr.html">naptr</a></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="enum_8h.html#38b0f30a351c03e99bcf678c23a412db">ast_enum_init</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize the ENUM support subsystem.  <a href="#38b0f30a351c03e99bcf678c23a412db"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="enum_8h.html#4b5c4efdd790567bb9c84cc7d0a798c0">ast_enum_reload</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="enum_8h.html#1285cd8643914b719307ab424d3c1f56">ast_get_enum</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#26c322652770620e64ac90682eb6504c">chan</a>, const char *<a class="el" href="structnumber.html">number</a>, char *location, int maxloc, char *technology, int maxtech, char *suffix, char *options, unsigned int record, struct <a class="el" href="structenum__context.html">enum_context</a> **argcontext)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Lookup entry in ENUM Returns 1 if found, 0 if not found, -1 on hangup.  <a href="#1285cd8643914b719307ab424d3c1f56"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="enum_8h.html#a68bc9971f5c3ac92ac453120de5efce">ast_get_txt</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#26c322652770620e64ac90682eb6504c">chan</a>, const char *<a class="el" href="structnumber.html">number</a>, char *location, int maxloc, char *technology, int maxtech, char *txt, int maxtxt)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Lookup DNS TXT record (used by app TXTCIDnum.  <a href="#a68bc9971f5c3ac92ac453120de5efce"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structnaptr.html">naptr</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="enum_8h.html#393f3257ea9b94b21e3c922927ca7130">__packed__</a></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
DNS and ENUM functions. 
<p>

<p>
Definition in file <a class="el" href="enum_8h-source.html">enum.h</a>.<hr><h2>Function Documentation</h2>
<a class="anchor" name="38b0f30a351c03e99bcf678c23a412db"></a><!-- doxytag: member="enum.h::ast_enum_init" ref="38b0f30a351c03e99bcf678c23a412db" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_enum_init           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initialize the ENUM support subsystem. 
<p>

<p>
Definition at line <a class="el" href="enum_8c-source.html#l00613">613</a> of file <a class="el" href="enum_8c-source.html">enum.c</a>.
<p>
References <a class="el" href="config_8c-source.html#l00555">ast_config_destroy()</a>, <a class="el" href="config_8c-source.html#l01278">ast_config_load()</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="config_8c-source.html#l00222">ast_variable_browse()</a>, <a class="el" href="enum_8c-source.html#l00602">enum_newtoplev()</a>, <a class="el" href="enum_8c-source.html#l00090">enumver</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="config_8h-source.html#l00039">ast_variable::name</a>, <a class="el" href="config_8h-source.html#l00046">ast_variable::next</a>, <a class="el" href="enum_8c-source.html#l00087">enum_search::next</a>, <a class="el" href="aesopt_8h-source.html#l00399">s</a>, <a class="el" href="enum_8c-source.html#l00082">TOPLEV</a>, <a class="el" href="enum_8c.html#26a79dec4884d639255f89fba90ecc82">toplevs</a>, and <a class="el" href="config_8h-source.html#l00040">ast_variable::value</a>.
<p>
Referenced by <a class="el" href="enum_8c-source.html#l00654">ast_enum_reload()</a>, and <a class="el" href="asterisk_8c-source.html#l02570">main()</a>.<div class="fragment"><pre class="fragment"><a name="l00614"></a>00614 {
<a name="l00615"></a>00615    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg;
<a name="l00616"></a>00616    <span class="keyword">struct </span><a class="code" href="structenum__search.html">enum_search</a> *<a class="code" href="aesopt_8h.html#8d6242bc80162ac99dd4d368eabe77cc">s</a>, *sl;
<a name="l00617"></a>00617    <span class="keyword">struct </span><a class="code" href="structast__variable.html">ast_variable</a> *v;
<a name="l00618"></a>00618 
<a name="l00619"></a>00619    <span class="comment">/* Destroy existing list */</span>
<a name="l00620"></a>00620    <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;enumlock);
<a name="l00621"></a>00621    s = <a class="code" href="enum_8c.html#26a79dec4884d639255f89fba90ecc82">toplevs</a>;
<a name="l00622"></a>00622    <span class="keywordflow">while</span> (s) {
<a name="l00623"></a>00623       sl = s;
<a name="l00624"></a>00624       s = s-&gt;<a class="code" href="structenum__search.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>;
<a name="l00625"></a>00625       <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(sl);
<a name="l00626"></a>00626    }
<a name="l00627"></a>00627    <a class="code" href="enum_8c.html#26a79dec4884d639255f89fba90ecc82">toplevs</a> = NULL;
<a name="l00628"></a>00628    cfg = <a class="code" href="config_8c.html#0ea8bde5422fa0db50302e0f710e18c1">ast_config_load</a>(<span class="stringliteral">"enum.conf"</span>);
<a name="l00629"></a>00629    <span class="keywordflow">if</span> (cfg) {
<a name="l00630"></a>00630       sl = NULL;
<a name="l00631"></a>00631       v = <a class="code" href="config_8c.html#65ed813ca973e0e5dd3426804249db4f">ast_variable_browse</a>(cfg, <span class="stringliteral">"general"</span>);
<a name="l00632"></a>00632       <span class="keywordflow">while</span> (v) {
<a name="l00633"></a>00633          <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#b068931cc450442b63f5b3d276ea4297">name</a>, <span class="stringliteral">"search"</span>)) {
<a name="l00634"></a>00634             s = <a class="code" href="enum_8c.html#a6adcdb1292b83c88aba50586b6b2a98">enum_newtoplev</a>(v-&gt;<a class="code" href="structast__variable.html#2063c1608d6e0baf80249c42e2be5804">value</a>);
<a name="l00635"></a>00635             <span class="keywordflow">if</span> (s) {
<a name="l00636"></a>00636                <span class="keywordflow">if</span> (sl)
<a name="l00637"></a>00637                   sl-&gt;next = s;
<a name="l00638"></a>00638                <span class="keywordflow">else</span>
<a name="l00639"></a>00639                   <a class="code" href="enum_8c.html#26a79dec4884d639255f89fba90ecc82">toplevs</a> = s;
<a name="l00640"></a>00640                sl = s;
<a name="l00641"></a>00641             }
<a name="l00642"></a>00642          }
<a name="l00643"></a>00643          v = v-&gt;<a class="code" href="structast__variable.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>;
<a name="l00644"></a>00644       }
<a name="l00645"></a>00645       <a class="code" href="config_8c.html#ad84c9d29ca53758c2a113d057e221a0">ast_config_destroy</a>(cfg);
<a name="l00646"></a>00646    } <span class="keywordflow">else</span> {
<a name="l00647"></a>00647       <a class="code" href="enum_8c.html#26a79dec4884d639255f89fba90ecc82">toplevs</a> = <a class="code" href="enum_8c.html#a6adcdb1292b83c88aba50586b6b2a98">enum_newtoplev</a>(<a class="code" href="enum_8c.html#16e1fac00538171b399441662981db4a">TOPLEV</a>);
<a name="l00648"></a>00648    }
<a name="l00649"></a>00649    <a class="code" href="enum_8c.html#52d62262f7c3f83f6b7e085044dcbfeb">enumver</a>++;
<a name="l00650"></a>00650    <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;enumlock);
<a name="l00651"></a>00651    <span class="keywordflow">return</span> 0;
<a name="l00652"></a>00652 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="4b5c4efdd790567bb9c84cc7d0a798c0"></a><!-- doxytag: member="enum.h::ast_enum_reload" ref="4b5c4efdd790567bb9c84cc7d0a798c0" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_enum_reload           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="enum_8c-source.html#l00654">654</a> of file <a class="el" href="enum_8c-source.html">enum.c</a>.
<p>
References <a class="el" href="enum_8c-source.html#l00613">ast_enum_init()</a>.<div class="fragment"><pre class="fragment"><a name="l00655"></a>00655 {
<a name="l00656"></a>00656    <span class="keywordflow">return</span> <a class="code" href="enum_8c.html#38b0f30a351c03e99bcf678c23a412db">ast_enum_init</a>();
<a name="l00657"></a>00657 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="1285cd8643914b719307ab424d3c1f56"></a><!-- doxytag: member="enum.h::ast_get_enum" ref="1285cd8643914b719307ab424d3c1f56" args="(struct ast_channel *chan, const char *number, char *location, int maxloc, char *technology, int maxtech, char *suffix, char *options, unsigned int record, struct enum_context **argcontext)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_get_enum           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>number</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>location</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>maxloc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>technology</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>maxtech</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>suffix</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>options</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int&nbsp;</td>
          <td class="mdname" nowrap> <em>record</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct <a class="el" href="structenum__context.html">enum_context</a> **&nbsp;</td>
          <td class="mdname" nowrap> <em>argcontext</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Lookup entry in ENUM Returns 1 if found, 0 if not found, -1 on hangup. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>number</em>&nbsp;</td><td>E164 number with or without the leading + </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>location</em>&nbsp;</td><td>Number returned (or SIP uri) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>maxloc</em>&nbsp;</td><td>Max length </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>technology</em>&nbsp;</td><td>Technology (from url scheme in response) You can set it to get particular answer RR, if there are many techs in DNS response, example: "sip" If you need any record, then set it to empty string </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>maxtech</em>&nbsp;</td><td>Max length </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>suffix</em>&nbsp;</td><td>Zone suffix (if is NULL then use enum.conf 'search' variable) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>options</em>&nbsp;</td><td>Options ('c' to count number of NAPTR RR) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>record</em>&nbsp;</td><td>The position of required RR in the answer list </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>argcontext</em>&nbsp;</td><td>Argument for caching results into an <a class="el" href="structenum__context.html">enum_context</a> pointer (NULL is used for not caching) </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="enum_8c-source.html#l00367">367</a> of file <a class="el" href="enum_8c-source.html">enum.c</a>.
<p>
References <a class="el" href="autoservice_8c-source.html#l00096">ast_autoservice_start()</a>, <a class="el" href="autoservice_8c-source.html#l00130">ast_autoservice_stop()</a>, <a class="el" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="dns_8c-source.html#l00201">ast_search_dns()</a>, <a class="el" href="enum_8c-source.html#l00330">enum_callback()</a>, <a class="el" href="enum_8c-source.html#l00294">ENUMLOOKUP_OPTIONS_COUNT</a>, <a class="el" href="enum_8c-source.html#l00090">enumver</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="logger_8h-source.html#l00094">LOG_DEBUG</a>, <a class="el" href="enum_8h-source.html#l00047">enum_context::naptrinput</a>, <a class="el" href="enum_8c-source.html#l00087">enum_search::next</a>, <a class="el" href="asterisk_8c-source.html#l00164">option_debug</a>, <a class="el" href="aesopt_8h-source.html#l00399">s</a>, <a class="el" href="enum_8c-source.html#l00086">enum_search::toplev</a>, and <a class="el" href="enum_8c.html#26a79dec4884d639255f89fba90ecc82">toplevs</a>.
<p>
Referenced by <a class="el" href="func__enum_8c-source.html#l00155">enum_query_read()</a>, and <a class="el" href="func__enum_8c-source.html#l00057">function_enum()</a>.<div class="fragment"><pre class="fragment"><a name="l00368"></a>00368 {
<a name="l00369"></a>00369    <span class="keyword">struct </span><a class="code" href="structenum__context.html">enum_context</a> *<a class="code" href="chan__alsa_8c.html#c1ae8ba118483c4c23841d72b5e7ebbb">context</a>;
<a name="l00370"></a>00370    <span class="keywordtype">char</span> tmp[259 + 512];
<a name="l00371"></a>00371    <span class="keywordtype">char</span> <a class="code" href="structenum__context.html#c8ecfcb421364b9d2037aa1d9304ca80">naptrinput</a>[512];
<a name="l00372"></a>00372    <span class="keywordtype">int</span> pos = strlen(<a class="code" href="structnumber.html">number</a>) - 1;
<a name="l00373"></a>00373    <span class="keywordtype">int</span> newpos = 0;
<a name="l00374"></a>00374    <span class="keywordtype">int</span> ret = -1;
<a name="l00375"></a>00375    <span class="keyword">struct </span><a class="code" href="structenum__search.html">enum_search</a> *<a class="code" href="aesopt_8h.html#8d6242bc80162ac99dd4d368eabe77cc">s</a> = NULL;
<a name="l00376"></a>00376    <span class="keywordtype">int</span> version = -1;
<a name="l00377"></a>00377    <span class="comment">/* for ISN rewrite */</span>
<a name="l00378"></a>00378    <span class="keywordtype">char</span> *p1 = NULL;
<a name="l00379"></a>00379    <span class="keywordtype">char</span> *p2 = NULL;
<a name="l00380"></a>00380    <span class="keywordtype">int</span> k = 0;
<a name="l00381"></a>00381    <span class="keywordtype">int</span> i = 0;
<a name="l00382"></a>00382    <span class="keywordtype">int</span> z = 0;
<a name="l00383"></a>00383 
<a name="l00384"></a>00384    <span class="keywordflow">if</span> (!(context = <a class="code" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*context))))
<a name="l00385"></a>00385       <span class="keywordflow">return</span> -1;
<a name="l00386"></a>00386 
<a name="l00387"></a>00387    ast_copy_string(naptrinput, <a class="code" href="structnumber.html">number</a>[0] == <span class="charliteral">'n'</span> ? <a class="code" href="structnumber.html">number</a>+1 : <a class="code" href="structnumber.html">number</a>, <span class="keyword">sizeof</span>(naptrinput));
<a name="l00388"></a>00388 
<a name="l00389"></a>00389    context-&gt;naptrinput = naptrinput;   <span class="comment">/* The number */</span>
<a name="l00390"></a>00390    context-&gt;dst = dst;        <span class="comment">/* Return string */</span>
<a name="l00391"></a>00391    context-&gt;dstlen = dstlen;
<a name="l00392"></a>00392    context-&gt;tech = tech;
<a name="l00393"></a>00393    context-&gt;techlen = techlen;
<a name="l00394"></a>00394    context-&gt;options = 0;
<a name="l00395"></a>00395    context-&gt;position = record;
<a name="l00396"></a>00396    context-&gt;naptr_rrs = NULL;
<a name="l00397"></a>00397    context-&gt;naptr_rrs_count = 0;
<a name="l00398"></a>00398 
<a name="l00399"></a>00399    <span class="keywordflow">if</span> (options != NULL) {
<a name="l00400"></a>00400       <span class="keywordflow">if</span> (*options == <span class="charliteral">'c'</span>) {
<a name="l00401"></a>00401          context-&gt;options = <a class="code" href="enum_8c.html#83bd02551d0d85f5573c8aa214aa8ee1">ENUMLOOKUP_OPTIONS_COUNT</a>;
<a name="l00402"></a>00402          context-&gt;position = 0;
<a name="l00403"></a>00403       }
<a name="l00404"></a>00404    }
<a name="l00405"></a>00405 
<a name="l00406"></a>00406    <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"ast_get_enum(): n='%s', tech='%s', suffix='%s', options='%d', record='%d'\n"</span>,
<a name="l00407"></a>00407          <a class="code" href="structnumber.html">number</a>, tech, suffix, context-&gt;options, context-&gt;position);
<a name="l00408"></a>00408 
<a name="l00409"></a>00409    <span class="keywordflow">if</span> (pos &gt; 128)
<a name="l00410"></a>00410       pos = 128;
<a name="l00411"></a>00411 
<a name="l00412"></a>00412    <span class="comment">/* ISN rewrite */</span>
<a name="l00413"></a>00413    p1 = strchr(<a class="code" href="structnumber.html">number</a>, <span class="charliteral">'*'</span>);
<a name="l00414"></a>00414 
<a name="l00415"></a>00415    <span class="keywordflow">if</span> (<a class="code" href="structnumber.html">number</a>[0] == <span class="charliteral">'n'</span>) { <span class="comment">/* do not perform ISN rewrite ('n' is testing flag) */</span>
<a name="l00416"></a>00416       p1 = NULL;
<a name="l00417"></a>00417       k = 1; <span class="comment">/* strip 'n' from number */</span>
<a name="l00418"></a>00418    }
<a name="l00419"></a>00419 
<a name="l00420"></a>00420    <span class="keywordflow">if</span> (p1 != NULL) {
<a name="l00421"></a>00421       p2 = p1+1;
<a name="l00422"></a>00422       <span class="keywordflow">while</span> (p1 &gt; <a class="code" href="structnumber.html">number</a>){
<a name="l00423"></a>00423          p1--;
<a name="l00424"></a>00424          tmp[newpos++] = *p1;
<a name="l00425"></a>00425          tmp[newpos++] = <span class="charliteral">'.'</span>;
<a name="l00426"></a>00426       }
<a name="l00427"></a>00427       <span class="keywordflow">if</span> (*p2) {
<a name="l00428"></a>00428          <span class="keywordflow">while</span> (*p2 &amp;&amp; newpos &lt; 128){
<a name="l00429"></a>00429             tmp[newpos++] = *p2;
<a name="l00430"></a>00430             p2++;
<a name="l00431"></a>00431          }
<a name="l00432"></a>00432          tmp[newpos++] = <span class="charliteral">'.'</span>;
<a name="l00433"></a>00433       }
<a name="l00434"></a>00434 
<a name="l00435"></a>00435    } <span class="keywordflow">else</span> {
<a name="l00436"></a>00436       <span class="keywordflow">while</span> (pos &gt;= k) {
<a name="l00437"></a>00437          <span class="keywordflow">if</span> (isdigit(<a class="code" href="structnumber.html">number</a>[pos])) {
<a name="l00438"></a>00438             tmp[newpos++] = <a class="code" href="structnumber.html">number</a>[pos];
<a name="l00439"></a>00439             tmp[newpos++] = <span class="charliteral">'.'</span>;
<a name="l00440"></a>00440          }
<a name="l00441"></a>00441          pos--;
<a name="l00442"></a>00442       }
<a name="l00443"></a>00443    }
<a name="l00444"></a>00444 
<a name="l00445"></a>00445    <span class="keywordflow">if</span> (chan &amp;&amp; <a class="code" href="autoservice_8c.html#50d164d68da7c101dd0eadd519069afd">ast_autoservice_start</a>(chan) &lt; 0) {
<a name="l00446"></a>00446       <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(context);
<a name="l00447"></a>00447       <span class="keywordflow">return</span> -1;
<a name="l00448"></a>00448    }
<a name="l00449"></a>00449 
<a name="l00450"></a>00450    <span class="keywordflow">if</span> (suffix) {
<a name="l00451"></a>00451       ast_copy_string(tmp + newpos, suffix, <span class="keyword">sizeof</span>(tmp) - newpos);
<a name="l00452"></a>00452       ret = <a class="code" href="dns_8c.html#336c75db464da83f0de567a19d26c64d">ast_search_dns</a>(context, tmp, C_IN, T_NAPTR, <a class="code" href="enum_8c.html#142880f81dc26c3ab290fa2b58e162e0">enum_callback</a>);
<a name="l00453"></a>00453       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"ast_get_enum: ast_search_dns(%s) returned %d\n"</span>, tmp, ret);
<a name="l00454"></a>00454    } <span class="keywordflow">else</span> {
<a name="l00455"></a>00455       ret = -1;      <span class="comment">/* this is actually dead code since the demise of app_enum.c */</span>
<a name="l00456"></a>00456       <span class="keywordflow">for</span> (;;) {
<a name="l00457"></a>00457          <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;enumlock);
<a name="l00458"></a>00458          <span class="keywordflow">if</span> (version != <a class="code" href="enum_8c.html#52d62262f7c3f83f6b7e085044dcbfeb">enumver</a>) {
<a name="l00459"></a>00459             <span class="comment">/* Ooh, a reload... */</span>
<a name="l00460"></a>00460             s = <a class="code" href="enum_8c.html#26a79dec4884d639255f89fba90ecc82">toplevs</a>;
<a name="l00461"></a>00461             version = <a class="code" href="enum_8c.html#52d62262f7c3f83f6b7e085044dcbfeb">enumver</a>;
<a name="l00462"></a>00462          } <span class="keywordflow">else</span> {
<a name="l00463"></a>00463             s = s-&gt;<a class="code" href="structenum__search.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>;
<a name="l00464"></a>00464          }
<a name="l00465"></a>00465          <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;enumlock);
<a name="l00466"></a>00466 
<a name="l00467"></a>00467          <span class="keywordflow">if</span> (!s)
<a name="l00468"></a>00468             <span class="keywordflow">break</span>;
<a name="l00469"></a>00469    
<a name="l00470"></a>00470          ast_copy_string(tmp + newpos, s-&gt;<a class="code" href="structenum__search.html#b0dd6c59bbba66963fdc96642fec39c6">toplev</a>, <span class="keyword">sizeof</span>(tmp) - newpos);
<a name="l00471"></a>00471          ret = <a class="code" href="dns_8c.html#336c75db464da83f0de567a19d26c64d">ast_search_dns</a>(&amp;context, tmp, C_IN, T_NAPTR, <a class="code" href="enum_8c.html#142880f81dc26c3ab290fa2b58e162e0">enum_callback</a>);
<a name="l00472"></a>00472          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"ast_get_enum: ast_search_dns(%s) returned %d\n"</span>, tmp, ret);
<a name="l00473"></a>00473          <span class="keywordflow">if</span> (ret &gt; 0)
<a name="l00474"></a>00474             <span class="keywordflow">break</span>;
<a name="l00475"></a>00475       }
<a name="l00476"></a>00476    }
<a name="l00477"></a>00477 
<a name="l00478"></a>00478    <span class="keywordflow">if</span> (ret &lt; 0) {
<a name="l00479"></a>00479       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a>)
<a name="l00480"></a>00480          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"No such number found: %s (%s)\n"</span>, tmp, strerror(errno));
<a name="l00481"></a>00481       strcpy(dst, <span class="stringliteral">"0"</span>);
<a name="l00482"></a>00482       ret = 0;
<a name="l00483"></a>00483    }
<a name="l00484"></a>00484 
<a name="l00485"></a>00485    <span class="keywordflow">if</span> (context-&gt;naptr_rrs_count &gt;= context-&gt;position &amp;&amp; ! (context-&gt;options &amp; <a class="code" href="enum_8c.html#83bd02551d0d85f5573c8aa214aa8ee1">ENUMLOOKUP_OPTIONS_COUNT</a>)) {
<a name="l00486"></a>00486       <span class="comment">/* sort array by NAPTR order/preference */</span>
<a name="l00487"></a>00487       <span class="keywordflow">for</span> (k = 0; k &lt; context-&gt;naptr_rrs_count; k++) {
<a name="l00488"></a>00488          <span class="keywordflow">for</span> (i = 0; i &lt; context-&gt;naptr_rrs_count; i++) {
<a name="l00489"></a>00489             <span class="comment">/* use order first and then preference to compare */</span>
<a name="l00490"></a>00490             <span class="keywordflow">if</span> ((ntohs(context-&gt;naptr_rrs[k].naptr.order) &lt; ntohs(context-&gt;naptr_rrs[i].naptr.order)
<a name="l00491"></a>00491                   &amp;&amp; context-&gt;naptr_rrs[k].sort_pos &gt; context-&gt;naptr_rrs[i].sort_pos)
<a name="l00492"></a>00492                || (ntohs(context-&gt;naptr_rrs[k].naptr.order) &gt; ntohs(context-&gt;naptr_rrs[i].naptr.order)
<a name="l00493"></a>00493                   &amp;&amp; context-&gt;naptr_rrs[k].sort_pos &lt; context-&gt;naptr_rrs[i].sort_pos)){
<a name="l00494"></a>00494                z = context-&gt;naptr_rrs[k].sort_pos;
<a name="l00495"></a>00495                context-&gt;naptr_rrs[k].sort_pos = context-&gt;naptr_rrs[i].sort_pos;
<a name="l00496"></a>00496                context-&gt;naptr_rrs[i].sort_pos = z;
<a name="l00497"></a>00497                <span class="keywordflow">continue</span>;
<a name="l00498"></a>00498             }
<a name="l00499"></a>00499             <span class="keywordflow">if</span> (ntohs(context-&gt;naptr_rrs[k].naptr.order) == ntohs(context-&gt;naptr_rrs[i].naptr.order)) {
<a name="l00500"></a>00500                <span class="keywordflow">if</span> ((ntohs(context-&gt;naptr_rrs[k].naptr.pref) &lt; ntohs(context-&gt;naptr_rrs[i].naptr.pref)
<a name="l00501"></a>00501                      &amp;&amp; context-&gt;naptr_rrs[k].sort_pos &gt; context-&gt;naptr_rrs[i].sort_pos)
<a name="l00502"></a>00502                   || (ntohs(context-&gt;naptr_rrs[k].naptr.pref) &gt; ntohs(context-&gt;naptr_rrs[i].naptr.pref)
<a name="l00503"></a>00503                      &amp;&amp; context-&gt;naptr_rrs[k].sort_pos &lt; context-&gt;naptr_rrs[i].sort_pos)){
<a name="l00504"></a>00504                   z = context-&gt;naptr_rrs[k].sort_pos;
<a name="l00505"></a>00505                   context-&gt;naptr_rrs[k].sort_pos = context-&gt;naptr_rrs[i].sort_pos;
<a name="l00506"></a>00506                   context-&gt;naptr_rrs[i].sort_pos = z;
<a name="l00507"></a>00507                }
<a name="l00508"></a>00508             }
<a name="l00509"></a>00509          }
<a name="l00510"></a>00510       }
<a name="l00511"></a>00511       <span class="keywordflow">for</span> (k = 0; k &lt; context-&gt;naptr_rrs_count; k++) {
<a name="l00512"></a>00512          <span class="keywordflow">if</span> (context-&gt;naptr_rrs[k].sort_pos == context-&gt;position-1) {
<a name="l00513"></a>00513             ast_copy_string(context-&gt;dst, context-&gt;naptr_rrs[k].result, dstlen);
<a name="l00514"></a>00514             ast_copy_string(context-&gt;tech, context-&gt;naptr_rrs[k].tech, techlen);
<a name="l00515"></a>00515             <span class="keywordflow">break</span>;
<a name="l00516"></a>00516          }
<a name="l00517"></a>00517       }
<a name="l00518"></a>00518    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(context-&gt;options &amp; <a class="code" href="enum_8c.html#83bd02551d0d85f5573c8aa214aa8ee1">ENUMLOOKUP_OPTIONS_COUNT</a>)) {
<a name="l00519"></a>00519       context-&gt;dst[0] = 0;
<a name="l00520"></a>00520    }
<a name="l00521"></a>00521    <span class="keywordflow">if</span> (chan)
<a name="l00522"></a>00522       ret |= <a class="code" href="autoservice_8c.html#f982194640c676dffb9052dacb2b21fd">ast_autoservice_stop</a>(chan);
<a name="l00523"></a>00523 
<a name="l00524"></a>00524    <span class="keywordflow">if</span> (!argcontext) {
<a name="l00525"></a>00525       <span class="keywordflow">for</span> (k = 0; k &lt; context-&gt;naptr_rrs_count; k++) {
<a name="l00526"></a>00526          <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(context-&gt;naptr_rrs[k].result);
<a name="l00527"></a>00527          <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(context-&gt;naptr_rrs[k].tech);
<a name="l00528"></a>00528       }
<a name="l00529"></a>00529       <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(context-&gt;naptr_rrs);
<a name="l00530"></a>00530       <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(context);
<a name="l00531"></a>00531    } <span class="keywordflow">else</span>
<a name="l00532"></a>00532       *argcontext = context;
<a name="l00533"></a>00533 
<a name="l00534"></a>00534    <span class="keywordflow">return</span> ret;
<a name="l00535"></a>00535 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a68bc9971f5c3ac92ac453120de5efce"></a><!-- doxytag: member="enum.h::ast_get_txt" ref="a68bc9971f5c3ac92ac453120de5efce" args="(struct ast_channel *chan, const char *number, char *location, int maxloc, char *technology, int maxtech, char *txt, int maxtxt)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_get_txt           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>number</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>location</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>maxloc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>technology</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>maxtech</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>txt</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>maxtxt</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Lookup DNS TXT record (used by app TXTCIDnum. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>number</em>&nbsp;</td><td>E164 number with or without the leading + </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>location</em>&nbsp;</td><td>Number returned (or SIP uri) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>maxloc</em>&nbsp;</td><td>Max length of number </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>technology</em>&nbsp;</td><td>Technology (not used in TXT records) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>maxtech</em>&nbsp;</td><td>Max length </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>txt</em>&nbsp;</td><td>Text string (return value) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>maxtxt</em>&nbsp;</td><td>Max length of "txt" </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="enum_8c-source.html#l00540">540</a> of file <a class="el" href="enum_8c-source.html">enum.c</a>.
<p>
References <a class="el" href="autoservice_8c-source.html#l00096">ast_autoservice_start()</a>, <a class="el" href="autoservice_8c-source.html#l00130">ast_autoservice_stop()</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="dns_8c-source.html#l00201">ast_search_dns()</a>, <a class="el" href="enum_8h-source.html#l00041">enum_context::dst</a>, <a class="el" href="enum_8h-source.html#l00042">enum_context::dstlen</a>, <a class="el" href="enum_8c-source.html#l00090">enumver</a>, <a class="el" href="logger_8h-source.html#l00094">LOG_DEBUG</a>, <a class="el" href="enum_8h-source.html#l00047">enum_context::naptrinput</a>, <a class="el" href="enum_8c-source.html#l00087">enum_search::next</a>, <a class="el" href="asterisk_8c-source.html#l00164">option_debug</a>, <a class="el" href="aesopt_8h-source.html#l00399">s</a>, <a class="el" href="enum_8h-source.html#l00043">enum_context::tech</a>, <a class="el" href="enum_8h-source.html#l00044">enum_context::techlen</a>, <a class="el" href="enum_8c-source.html#l00086">enum_search::toplev</a>, <a class="el" href="enum_8c.html#26a79dec4884d639255f89fba90ecc82">toplevs</a>, <a class="el" href="enum_8h-source.html#l00045">enum_context::txt</a>, <a class="el" href="enum_8c-source.html#l00298">txt_callback()</a>, and <a class="el" href="enum_8h-source.html#l00046">enum_context::txtlen</a>.
<p>
Referenced by <a class="el" href="func__enum_8c-source.html#l00346">function_txtcidname()</a>.<div class="fragment"><pre class="fragment"><a name="l00541"></a>00541 {
<a name="l00542"></a>00542    <span class="keyword">struct </span><a class="code" href="structenum__context.html">enum_context</a> context;
<a name="l00543"></a>00543    <span class="keywordtype">char</span> tmp[259 + 512];
<a name="l00544"></a>00544    <span class="keywordtype">char</span> <a class="code" href="structenum__context.html#c8ecfcb421364b9d2037aa1d9304ca80">naptrinput</a>[512] = <span class="stringliteral">"+"</span>;
<a name="l00545"></a>00545    <span class="keywordtype">int</span> pos = strlen(<a class="code" href="structnumber.html">number</a>) - 1;
<a name="l00546"></a>00546    <span class="keywordtype">int</span> newpos = 0;
<a name="l00547"></a>00547    <span class="keywordtype">int</span> ret = -1;
<a name="l00548"></a>00548    <span class="keyword">struct </span><a class="code" href="structenum__search.html">enum_search</a> *<a class="code" href="aesopt_8h.html#8d6242bc80162ac99dd4d368eabe77cc">s</a> = NULL;
<a name="l00549"></a>00549    <span class="keywordtype">int</span> version = -1;
<a name="l00550"></a>00550 
<a name="l00551"></a>00551    strncat(naptrinput, <a class="code" href="structnumber.html">number</a>, <span class="keyword">sizeof</span>(naptrinput) - 2);
<a name="l00552"></a>00552 
<a name="l00553"></a>00553    context.<a class="code" href="structenum__context.html#c8ecfcb421364b9d2037aa1d9304ca80">naptrinput</a> = naptrinput;
<a name="l00554"></a>00554    context.<a class="code" href="structenum__context.html#28e3d688a3c077b887921cea3fb1dbc7">dst</a> = dst;
<a name="l00555"></a>00555    context.<a class="code" href="structenum__context.html#24a6f272aa2ede869d96392164f49ab7">dstlen</a> = dstlen;
<a name="l00556"></a>00556    context.<a class="code" href="structenum__context.html#d9f9133fb120cd6096870bc2b496805b">tech</a> = tech;
<a name="l00557"></a>00557    context.<a class="code" href="structenum__context.html#cda08beed7cf3165d9c9b01582f0b72e">techlen</a> = techlen;
<a name="l00558"></a>00558    context.<a class="code" href="structenum__context.html#c7824f3d4d5f7b2f22d034758c1e9454">txt</a> = txt;
<a name="l00559"></a>00559    context.<a class="code" href="structenum__context.html#313fa57a116718d78e518390ce2bb1c1">txtlen</a> = txtlen;
<a name="l00560"></a>00560 
<a name="l00561"></a>00561    <span class="keywordflow">if</span> (pos &gt; 128)
<a name="l00562"></a>00562       pos = 128;
<a name="l00563"></a>00563    <span class="keywordflow">while</span> (pos &gt;= 0) {
<a name="l00564"></a>00564       tmp[newpos++] = <a class="code" href="structnumber.html">number</a>[pos--];
<a name="l00565"></a>00565       tmp[newpos++] = <span class="charliteral">'.'</span>;
<a name="l00566"></a>00566    }
<a name="l00567"></a>00567 
<a name="l00568"></a>00568    <span class="keywordflow">if</span> (chan &amp;&amp; <a class="code" href="autoservice_8c.html#50d164d68da7c101dd0eadd519069afd">ast_autoservice_start</a>(chan) &lt; 0)
<a name="l00569"></a>00569       <span class="keywordflow">return</span> -1;
<a name="l00570"></a>00570 
<a name="l00571"></a>00571    <span class="keywordflow">for</span> (;;) {
<a name="l00572"></a>00572       <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;enumlock);
<a name="l00573"></a>00573       <span class="keywordflow">if</span> (version != <a class="code" href="enum_8c.html#52d62262f7c3f83f6b7e085044dcbfeb">enumver</a>) {
<a name="l00574"></a>00574          <span class="comment">/* Ooh, a reload... */</span>
<a name="l00575"></a>00575          s = <a class="code" href="enum_8c.html#26a79dec4884d639255f89fba90ecc82">toplevs</a>;
<a name="l00576"></a>00576          version = <a class="code" href="enum_8c.html#52d62262f7c3f83f6b7e085044dcbfeb">enumver</a>;
<a name="l00577"></a>00577       } <span class="keywordflow">else</span> {
<a name="l00578"></a>00578          s = s-&gt;<a class="code" href="structenum__search.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>;
<a name="l00579"></a>00579       }
<a name="l00580"></a>00580       <span class="keywordflow">if</span> (s) {
<a name="l00581"></a>00581          ast_copy_string(tmp + newpos, s-&gt;<a class="code" href="structenum__search.html#b0dd6c59bbba66963fdc96642fec39c6">toplev</a>, <span class="keyword">sizeof</span>(tmp) - newpos);
<a name="l00582"></a>00582       }
<a name="l00583"></a>00583       <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;enumlock);
<a name="l00584"></a>00584       <span class="keywordflow">if</span> (!s)
<a name="l00585"></a>00585          <span class="keywordflow">break</span>;
<a name="l00586"></a>00586 
<a name="l00587"></a>00587       ret = <a class="code" href="dns_8c.html#336c75db464da83f0de567a19d26c64d">ast_search_dns</a>(&amp;context, tmp, C_IN, T_TXT, <a class="code" href="enum_8c.html#bb82156bb23a604afde8db589e7c6a51">txt_callback</a>);
<a name="l00588"></a>00588       <span class="keywordflow">if</span> (ret &gt; 0)
<a name="l00589"></a>00589          <span class="keywordflow">break</span>;
<a name="l00590"></a>00590    }
<a name="l00591"></a>00591    <span class="keywordflow">if</span> (ret &lt; 0) {
<a name="l00592"></a>00592       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a> &gt; 1)
<a name="l00593"></a>00593          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"No such number found in ENUM: %s (%s)\n"</span>, tmp, strerror(errno));
<a name="l00594"></a>00594       ret = 0;
<a name="l00595"></a>00595    }
<a name="l00596"></a>00596    <span class="keywordflow">if</span> (chan)
<a name="l00597"></a>00597       ret |= <a class="code" href="autoservice_8c.html#f982194640c676dffb9052dacb2b21fd">ast_autoservice_stop</a>(chan);
<a name="l00598"></a>00598    <span class="keywordflow">return</span> ret;
<a name="l00599"></a>00599 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="393f3257ea9b94b21e3c922927ca7130"></a><!-- doxytag: member="enum.h::__packed__" ref="393f3257ea9b94b21e3c922927ca7130" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structnaptr.html">naptr</a> <a class="el" href="iax2_8h.html#393f3257ea9b94b21e3c922927ca7130">__packed__</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu May 24 22:27:28 2007 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.5 </small></address>
</body>
</html>
