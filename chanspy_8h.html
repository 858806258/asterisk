<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (24 May 2007)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Thu May 24 22:27:24 2007</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Finclude_2F.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Finclude_2Fasterisk_2F.html">asterisk</a></div>
<h1>chanspy.h File Reference</h1>Asterisk PBX channel spy definitions. <a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="linkedlists_8h-source.html">asterisk/linkedlists.h</a>&quot;</code><br>

<p>
<a href="chanspy_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__channel__spy.html">ast_channel_spy</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__channel__spy__queue.html">ast_channel_spy_queue</a></td></tr>

<tr><td colspan="2"><br><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65">chanspy_flags</a> { <br>
&nbsp;&nbsp;<a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce651f319c5d4c24864a434e56ab93c72e72">CHANSPY_MIXAUDIO</a> =  (1 &lt;&lt; 0), 
<a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65182be74692abc8f01ed538bc4e42629c">CHANSPY_READ_VOLADJUST</a> =  (1 &lt;&lt; 1), 
<a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce650cddca71a0efa3c6c9f94e1b276046bd">CHANSPY_WRITE_VOLADJUST</a> =  (1 &lt;&lt; 2), 
<a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65332bb902feb367d081da3c78c1e57341">CHANSPY_FORMAT_AUDIO</a> =  (1 &lt;&lt; 3), 
<br>
&nbsp;&nbsp;<a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65ea04baee2d87b4e411e069984bbea6d2">CHANSPY_TRIGGER_MODE</a> =  (3 &lt;&lt; 4), 
<a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce657ac2f35629f6a422837ce4fc6eed040a">CHANSPY_TRIGGER_READ</a> =  (1 &lt;&lt; 4), 
<a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65419ab3aa5960e1f296e9f4ab481a0741">CHANSPY_TRIGGER_WRITE</a> =  (2 &lt;&lt; 4), 
<a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65eea652b43493a4b39fb3895177943685">CHANSPY_TRIGGER_NONE</a> =  (3 &lt;&lt; 4), 
<br>
&nbsp;&nbsp;<a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce6560bd57b07eeb3eb997c1a0fb15e2cdf1">CHANSPY_TRIGGER_FLUSH</a> =  (1 &lt;&lt; 6)
<br>
 }</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chanspy_8h.html#304d7c9f7a8c99380ef1fe3c955adf3f">chanspy_states</a> { <a class="el" href="chanspy_8h.html#304d7c9f7a8c99380ef1fe3c955adf3fc437cef4752995f363914a2e4d327780">CHANSPY_NEW</a> =  0, 
<a class="el" href="chanspy_8h.html#304d7c9f7a8c99380ef1fe3c955adf3f5166c25d27285982f469175514888813">CHANSPY_RUNNING</a> =  1, 
<a class="el" href="chanspy_8h.html#304d7c9f7a8c99380ef1fe3c955adf3f93c19bb62ffd2ffa5386b754ca90e136">CHANSPY_DONE</a> =  2, 
<a class="el" href="chanspy_8h.html#304d7c9f7a8c99380ef1fe3c955adf3f54afba7a99f3a23e26f20f13434c5b8b">CHANSPY_STOP</a> =  3
 }</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chanspy_8h.html#591849511705fdcff3f838155dadc90a">ast_channel_spy_add</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#26c322652770620e64ac90682eb6504c">chan</a>, struct <a class="el" href="structast__channel__spy.html">ast_channel_spy</a> *spy)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Adds a spy to a channel, to begin receiving copies of the channel's audio frames.  <a href="#591849511705fdcff3f838155dadc90a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chanspy_8h.html#52f8fa2ea810b99986edab442ed4e2f6">ast_channel_spy_free</a> (struct <a class="el" href="structast__channel__spy.html">ast_channel_spy</a> *spy)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free a spy.  <a href="#52f8fa2ea810b99986edab442ed4e2f6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chanspy_8h.html#35d3e31fe12732e028f01173e83c2228">ast_channel_spy_read_frame</a> (struct <a class="el" href="structast__channel__spy.html">ast_channel_spy</a> *spy, unsigned int samples)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read one (or more) frames of audio from a channel being spied upon.  <a href="#35d3e31fe12732e028f01173e83c2228"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chanspy_8h.html#cde5ef271aa7cb6fa771ffe14e91e0d2">ast_channel_spy_remove</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#26c322652770620e64ac90682eb6504c">chan</a>, struct <a class="el" href="structast__channel__spy.html">ast_channel_spy</a> *spy)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove a spy from a channel.  <a href="#cde5ef271aa7cb6fa771ffe14e91e0d2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chanspy_8h.html#0730397c6530683a40c8162da49fd69e">ast_channel_spy_stop_by_type</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#26c322652770620e64ac90682eb6504c">chan</a>, const char *<a class="el" href="chan__nbs_8c.html#a73364531569a868150462e5a44f29c8">type</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find all spies of a particular type on a channel and stop them.  <a href="#0730397c6530683a40c8162da49fd69e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chanspy_8h.html#c9e9dc4c1549186228a46272aa69650d">ast_channel_spy_trigger_wait</a> (struct <a class="el" href="structast__channel__spy.html">ast_channel_spy</a> *spy)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Efficiently wait until audio is available for a spy, or an exception occurs.  <a href="#c9e9dc4c1549186228a46272aa69650d"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Asterisk PBX channel spy definitions. 
<p>

<p>
Definition in file <a class="el" href="chanspy_8h-source.html">chanspy.h</a>.<hr><h2>Enumeration Type Documentation</h2>
<a class="anchor" name="0531fc877d377d51e324d7afd13cce65"></a><!-- doxytag: member="chanspy.h::chanspy_flags" ref="0531fc877d377d51e324d7afd13cce65" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">enum <a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65">chanspy_flags</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Enumerator: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" name="0531fc877d377d51e324d7afd13cce651f319c5d4c24864a434e56ab93c72e72"></a><!-- doxytag: member="CHANSPY_MIXAUDIO" ref="0531fc877d377d51e324d7afd13cce651f319c5d4c24864a434e56ab93c72e72" args="" -->CHANSPY_MIXAUDIO</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" name="0531fc877d377d51e324d7afd13cce65182be74692abc8f01ed538bc4e42629c"></a><!-- doxytag: member="CHANSPY_READ_VOLADJUST" ref="0531fc877d377d51e324d7afd13cce65182be74692abc8f01ed538bc4e42629c" args="" -->CHANSPY_READ_VOLADJUST</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" name="0531fc877d377d51e324d7afd13cce650cddca71a0efa3c6c9f94e1b276046bd"></a><!-- doxytag: member="CHANSPY_WRITE_VOLADJUST" ref="0531fc877d377d51e324d7afd13cce650cddca71a0efa3c6c9f94e1b276046bd" args="" -->CHANSPY_WRITE_VOLADJUST</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" name="0531fc877d377d51e324d7afd13cce65332bb902feb367d081da3c78c1e57341"></a><!-- doxytag: member="CHANSPY_FORMAT_AUDIO" ref="0531fc877d377d51e324d7afd13cce65332bb902feb367d081da3c78c1e57341" args="" -->CHANSPY_FORMAT_AUDIO</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" name="0531fc877d377d51e324d7afd13cce65ea04baee2d87b4e411e069984bbea6d2"></a><!-- doxytag: member="CHANSPY_TRIGGER_MODE" ref="0531fc877d377d51e324d7afd13cce65ea04baee2d87b4e411e069984bbea6d2" args="" -->CHANSPY_TRIGGER_MODE</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" name="0531fc877d377d51e324d7afd13cce657ac2f35629f6a422837ce4fc6eed040a"></a><!-- doxytag: member="CHANSPY_TRIGGER_READ" ref="0531fc877d377d51e324d7afd13cce657ac2f35629f6a422837ce4fc6eed040a" args="" -->CHANSPY_TRIGGER_READ</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" name="0531fc877d377d51e324d7afd13cce65419ab3aa5960e1f296e9f4ab481a0741"></a><!-- doxytag: member="CHANSPY_TRIGGER_WRITE" ref="0531fc877d377d51e324d7afd13cce65419ab3aa5960e1f296e9f4ab481a0741" args="" -->CHANSPY_TRIGGER_WRITE</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" name="0531fc877d377d51e324d7afd13cce65eea652b43493a4b39fb3895177943685"></a><!-- doxytag: member="CHANSPY_TRIGGER_NONE" ref="0531fc877d377d51e324d7afd13cce65eea652b43493a4b39fb3895177943685" args="" -->CHANSPY_TRIGGER_NONE</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" name="0531fc877d377d51e324d7afd13cce6560bd57b07eeb3eb997c1a0fb15e2cdf1"></a><!-- doxytag: member="CHANSPY_TRIGGER_FLUSH" ref="0531fc877d377d51e324d7afd13cce6560bd57b07eeb3eb997c1a0fb15e2cdf1" args="" -->CHANSPY_TRIGGER_FLUSH</em>&nbsp;</td><td>
</td></tr>
</table>
</dl>

<p>
Definition at line <a class="el" href="chanspy_8h-source.html#l00039">39</a> of file <a class="el" href="chanspy_8h-source.html">chanspy.h</a>.<div class="fragment"><pre class="fragment"><a name="l00039"></a>00039                    {
<a name="l00040"></a>00040    <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce651f319c5d4c24864a434e56ab93c72e72">CHANSPY_MIXAUDIO</a> = (1 &lt;&lt; 0),
<a name="l00041"></a>00041    <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65182be74692abc8f01ed538bc4e42629c">CHANSPY_READ_VOLADJUST</a> = (1 &lt;&lt; 1),
<a name="l00042"></a>00042    <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce650cddca71a0efa3c6c9f94e1b276046bd">CHANSPY_WRITE_VOLADJUST</a> = (1 &lt;&lt; 2),
<a name="l00043"></a>00043    <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65332bb902feb367d081da3c78c1e57341">CHANSPY_FORMAT_AUDIO</a> = (1 &lt;&lt; 3),
<a name="l00044"></a>00044    <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65ea04baee2d87b4e411e069984bbea6d2">CHANSPY_TRIGGER_MODE</a> = (3 &lt;&lt; 4),
<a name="l00045"></a>00045    <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce657ac2f35629f6a422837ce4fc6eed040a">CHANSPY_TRIGGER_READ</a> = (1 &lt;&lt; 4),
<a name="l00046"></a>00046    <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65419ab3aa5960e1f296e9f4ab481a0741">CHANSPY_TRIGGER_WRITE</a> = (2 &lt;&lt; 4),
<a name="l00047"></a>00047    <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65eea652b43493a4b39fb3895177943685">CHANSPY_TRIGGER_NONE</a> = (3 &lt;&lt; 4),
<a name="l00048"></a>00048    <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce6560bd57b07eeb3eb997c1a0fb15e2cdf1">CHANSPY_TRIGGER_FLUSH</a> = (1 &lt;&lt; 6),
<a name="l00049"></a>00049 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="304d7c9f7a8c99380ef1fe3c955adf3f"></a><!-- doxytag: member="chanspy.h::chanspy_states" ref="304d7c9f7a8c99380ef1fe3c955adf3f" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">enum <a class="el" href="chanspy_8h.html#304d7c9f7a8c99380ef1fe3c955adf3f">chanspy_states</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Enumerator: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" name="304d7c9f7a8c99380ef1fe3c955adf3fc437cef4752995f363914a2e4d327780"></a><!-- doxytag: member="CHANSPY_NEW" ref="304d7c9f7a8c99380ef1fe3c955adf3fc437cef4752995f363914a2e4d327780" args="" -->CHANSPY_NEW</em>&nbsp;</td><td>
spy not yet operating </td></tr>
<tr><td valign="top"><em><a class="anchor" name="304d7c9f7a8c99380ef1fe3c955adf3f5166c25d27285982f469175514888813"></a><!-- doxytag: member="CHANSPY_RUNNING" ref="304d7c9f7a8c99380ef1fe3c955adf3f5166c25d27285982f469175514888813" args="" -->CHANSPY_RUNNING</em>&nbsp;</td><td>
normal operation, spy is still operating </td></tr>
<tr><td valign="top"><em><a class="anchor" name="304d7c9f7a8c99380ef1fe3c955adf3f93c19bb62ffd2ffa5386b754ca90e136"></a><!-- doxytag: member="CHANSPY_DONE" ref="304d7c9f7a8c99380ef1fe3c955adf3f93c19bb62ffd2ffa5386b754ca90e136" args="" -->CHANSPY_DONE</em>&nbsp;</td><td>
spy is stopped and already removed from channel </td></tr>
<tr><td valign="top"><em><a class="anchor" name="304d7c9f7a8c99380ef1fe3c955adf3f54afba7a99f3a23e26f20f13434c5b8b"></a><!-- doxytag: member="CHANSPY_STOP" ref="304d7c9f7a8c99380ef1fe3c955adf3f54afba7a99f3a23e26f20f13434c5b8b" args="" -->CHANSPY_STOP</em>&nbsp;</td><td>
spy requested to stop, still attached to channel </td></tr>
</table>
</dl>

<p>
Definition at line <a class="el" href="chanspy_8h-source.html#l00032">32</a> of file <a class="el" href="chanspy_8h-source.html">chanspy.h</a>.<div class="fragment"><pre class="fragment"><a name="l00032"></a>00032                     {
<a name="l00033"></a>00033    <a class="code" href="chanspy_8h.html#304d7c9f7a8c99380ef1fe3c955adf3fc437cef4752995f363914a2e4d327780">CHANSPY_NEW</a> = 0,     <span class="comment">/*!&lt; spy not yet operating */</span>
<a name="l00034"></a>00034    <a class="code" href="chanspy_8h.html#304d7c9f7a8c99380ef1fe3c955adf3f5166c25d27285982f469175514888813">CHANSPY_RUNNING</a> = 1,    <span class="comment">/*!&lt; normal operation, spy is still operating */</span>
<a name="l00035"></a>00035    <a class="code" href="chanspy_8h.html#304d7c9f7a8c99380ef1fe3c955adf3f93c19bb62ffd2ffa5386b754ca90e136">CHANSPY_DONE</a> = 2,    <span class="comment">/*!&lt; spy is stopped and already removed from channel */</span>
<a name="l00036"></a>00036    <a class="code" href="chanspy_8h.html#304d7c9f7a8c99380ef1fe3c955adf3f54afba7a99f3a23e26f20f13434c5b8b">CHANSPY_STOP</a> = 3,    <span class="comment">/*!&lt; spy requested to stop, still attached to channel */</span>
<a name="l00037"></a>00037 };
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="591849511705fdcff3f838155dadc90a"></a><!-- doxytag: member="chanspy.h::ast_channel_spy_add" ref="591849511705fdcff3f838155dadc90a" args="(struct ast_channel *chan, struct ast_channel_spy *spy)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_channel_spy_add           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct <a class="el" href="structast__channel__spy.html">ast_channel_spy</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>spy</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Adds a spy to a channel, to begin receiving copies of the channel's audio frames. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>The channel to add the spy to. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>spy</em>&nbsp;</td><td>A pointer to <a class="el" href="structast__channel__spy.html">ast_channel_spy</a> structure describing how the spy is to be used. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>0 for success, non-zero for failure</dd></dl>
Note: This function performs no locking; you must hold the channel's lock before calling this function. 
<p>
Definition at line <a class="el" href="channel_8c-source.html#l01264">1264</a> of file <a class="el" href="channel_8c-source.html">channel.c</a>.
<p>
References <a class="el" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>, <a class="el" href="utils_8h-source.html#l00081">ast_clear_flag</a>, <a class="el" href="lock_8h-source.html#l00542">ast_cond_init()</a>, <a class="el" href="frame_8h-source.html#l00233">AST_FORMAT_SLINEAR</a>, <a class="el" href="frame_8c-source.html#l00532">ast_getformatname()</a>, <a class="el" href="linkedlists_8h-source.html#l00620">AST_LIST_HEAD_INIT_NOLOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00650">AST_LIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h-source.html#l00670">AST_LIST_INSERT_TAIL</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="utils_8h-source.html#l00074">ast_set_flag</a>, <a class="el" href="utils_8h-source.html#l00067">ast_test_flag</a>, <a class="el" href="chanspy_8h-source.html#l00061">ast_channel_spy::chan</a>, <a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65332bb902feb367d081da3c78c1e57341">CHANSPY_FORMAT_AUDIO</a>, <a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce651f319c5d4c24864a434e56ab93c72e72">CHANSPY_MIXAUDIO</a>, <a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65182be74692abc8f01ed538bc4e42629c">CHANSPY_READ_VOLADJUST</a>, <a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65ea04baee2d87b4e411e069984bbea6d2">CHANSPY_TRIGGER_MODE</a>, <a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65eea652b43493a4b39fb3895177943685">CHANSPY_TRIGGER_NONE</a>, <a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce657ac2f35629f6a422837ce4fc6eed040a">CHANSPY_TRIGGER_READ</a>, <a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65419ab3aa5960e1f296e9f4ab481a0741">CHANSPY_TRIGGER_WRITE</a>, <a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce650cddca71a0efa3c6c9f94e1b276046bd">CHANSPY_WRITE_VOLADJUST</a>, <a class="el" href="chanspy_8h-source.html#l00054">ast_channel_spy_queue::format</a>, <a class="el" href="logger_8h-source.html#l00094">LOG_DEBUG</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="asterisk_8c-source.html#l00164">option_debug</a>, <a class="el" href="chanspy_8h-source.html#l00062">ast_channel_spy::read_queue</a>, <a class="el" href="channel_8h-source.html#l00484">ast_channel::spies</a>, <a class="el" href="chanspy_8h-source.html#l00060">ast_channel_spy::trigger</a>, <a class="el" href="chanspy_8h-source.html#l00066">ast_channel_spy::type</a>, and <a class="el" href="chanspy_8h-source.html#l00063">ast_channel_spy::write_queue</a>.
<p>
Referenced by <a class="el" href="app__chanspy_8c-source.html#l00220">start_spying()</a>, and <a class="el" href="app__mixmonitor_8c-source.html#l00126">startmon()</a>.<div class="fragment"><pre class="fragment"><a name="l01265"></a>01265 {
<a name="l01266"></a>01266    <span class="comment">/* Link the owner channel to the spy */</span>
<a name="l01267"></a>01267    spy-&gt;<a class="code" href="structast__channel__spy.html#26c322652770620e64ac90682eb6504c">chan</a> = chan;
<a name="l01268"></a>01268 
<a name="l01269"></a>01269    <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#d26671e9d352536be0df3d41a800bb83">ast_test_flag</a>(spy, <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65332bb902feb367d081da3c78c1e57341">CHANSPY_FORMAT_AUDIO</a>)) {
<a name="l01270"></a>01270       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Could not add channel spy '%s' to channel '%s', only audio format spies are supported.\n"</span>,
<a name="l01271"></a>01271          spy-&gt;<a class="code" href="structast__channel__spy.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>, chan-&gt;name);
<a name="l01272"></a>01272       <span class="keywordflow">return</span> -1;
<a name="l01273"></a>01273    }
<a name="l01274"></a>01274 
<a name="l01275"></a>01275    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#d26671e9d352536be0df3d41a800bb83">ast_test_flag</a>(spy, <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65182be74692abc8f01ed538bc4e42629c">CHANSPY_READ_VOLADJUST</a>) &amp;&amp; (spy-&gt;<a class="code" href="structast__channel__spy.html#6fc28b06536d6947665598be732383aa">read_queue</a>.<a class="code" href="structast__channel__spy__queue.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a> != <a class="code" href="frame_8h.html#ce4d062ff9a85be84b636e7ec67a068b">AST_FORMAT_SLINEAR</a>)) {
<a name="l01276"></a>01276       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Cannot provide volume adjustment on '%s' format spies\n"</span>,
<a name="l01277"></a>01277          <a class="code" href="frame_8c.html#fc9ce4e422290b7bda33cc8685094a97">ast_getformatname</a>(spy-&gt;<a class="code" href="structast__channel__spy.html#6fc28b06536d6947665598be732383aa">read_queue</a>.<a class="code" href="structast__channel__spy__queue.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a>));
<a name="l01278"></a>01278       <span class="keywordflow">return</span> -1;
<a name="l01279"></a>01279    }
<a name="l01280"></a>01280 
<a name="l01281"></a>01281    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#d26671e9d352536be0df3d41a800bb83">ast_test_flag</a>(spy, <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce650cddca71a0efa3c6c9f94e1b276046bd">CHANSPY_WRITE_VOLADJUST</a>) &amp;&amp; (spy-&gt;<a class="code" href="structast__channel__spy.html#13e9b2fb4e074ff362693715b23ab877">write_queue</a>.<a class="code" href="structast__channel__spy__queue.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a> != <a class="code" href="frame_8h.html#ce4d062ff9a85be84b636e7ec67a068b">AST_FORMAT_SLINEAR</a>)) {
<a name="l01282"></a>01282       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Cannot provide volume adjustment on '%s' format spies\n"</span>,
<a name="l01283"></a>01283          <a class="code" href="frame_8c.html#fc9ce4e422290b7bda33cc8685094a97">ast_getformatname</a>(spy-&gt;<a class="code" href="structast__channel__spy.html#13e9b2fb4e074ff362693715b23ab877">write_queue</a>.<a class="code" href="structast__channel__spy__queue.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a>));
<a name="l01284"></a>01284       <span class="keywordflow">return</span> -1;
<a name="l01285"></a>01285    }
<a name="l01286"></a>01286 
<a name="l01287"></a>01287    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#d26671e9d352536be0df3d41a800bb83">ast_test_flag</a>(spy, <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce651f319c5d4c24864a434e56ab93c72e72">CHANSPY_MIXAUDIO</a>) &amp;&amp;
<a name="l01288"></a>01288        ((spy-&gt;<a class="code" href="structast__channel__spy.html#6fc28b06536d6947665598be732383aa">read_queue</a>.<a class="code" href="structast__channel__spy__queue.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a> != <a class="code" href="frame_8h.html#ce4d062ff9a85be84b636e7ec67a068b">AST_FORMAT_SLINEAR</a>) ||
<a name="l01289"></a>01289         (spy-&gt;<a class="code" href="structast__channel__spy.html#13e9b2fb4e074ff362693715b23ab877">write_queue</a>.<a class="code" href="structast__channel__spy__queue.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a> != <a class="code" href="frame_8h.html#ce4d062ff9a85be84b636e7ec67a068b">AST_FORMAT_SLINEAR</a>))) {
<a name="l01290"></a>01290       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Cannot provide audio mixing on '%s'-'%s' format spies\n"</span>,
<a name="l01291"></a>01291          <a class="code" href="frame_8c.html#fc9ce4e422290b7bda33cc8685094a97">ast_getformatname</a>(spy-&gt;<a class="code" href="structast__channel__spy.html#6fc28b06536d6947665598be732383aa">read_queue</a>.<a class="code" href="structast__channel__spy__queue.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a>), <a class="code" href="frame_8c.html#fc9ce4e422290b7bda33cc8685094a97">ast_getformatname</a>(spy-&gt;<a class="code" href="structast__channel__spy.html#13e9b2fb4e074ff362693715b23ab877">write_queue</a>.<a class="code" href="structast__channel__spy__queue.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a>));
<a name="l01292"></a>01292       <span class="keywordflow">return</span> -1;
<a name="l01293"></a>01293    }
<a name="l01294"></a>01294 
<a name="l01295"></a>01295    <span class="keywordflow">if</span> (!chan-&gt;<a class="code" href="structast__channel.html#5e6a55de0bea527db5f05883c77f39a6">spies</a>) {
<a name="l01296"></a>01296       <span class="keywordflow">if</span> (!(chan-&gt;<a class="code" href="structast__channel.html#5e6a55de0bea527db5f05883c77f39a6">spies</a> = <a class="code" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*chan-&gt;<a class="code" href="structast__channel.html#5e6a55de0bea527db5f05883c77f39a6">spies</a>)))) {
<a name="l01297"></a>01297          <span class="keywordflow">return</span> -1;
<a name="l01298"></a>01298       }
<a name="l01299"></a>01299 
<a name="l01300"></a>01300       <a class="code" href="linkedlists_8h.html#0ae37ea56ca862f6504390fd49b9839f">AST_LIST_HEAD_INIT_NOLOCK</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#5e6a55de0bea527db5f05883c77f39a6">spies</a>-&gt;list);
<a name="l01301"></a>01301       <a class="code" href="linkedlists_8h.html#5df56040a8838bdc841ef8eb179b7609">AST_LIST_INSERT_HEAD</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#5e6a55de0bea527db5f05883c77f39a6">spies</a>-&gt;list, spy, list);
<a name="l01302"></a>01302    } <span class="keywordflow">else</span> {
<a name="l01303"></a>01303       <a class="code" href="linkedlists_8h.html#8de6ce8a3b9d59e7e7fddee6b62b32a7">AST_LIST_INSERT_TAIL</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#5e6a55de0bea527db5f05883c77f39a6">spies</a>-&gt;list, spy, list);
<a name="l01304"></a>01304    }
<a name="l01305"></a>01305 
<a name="l01306"></a>01306    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#d26671e9d352536be0df3d41a800bb83">ast_test_flag</a>(spy, <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65ea04baee2d87b4e411e069984bbea6d2">CHANSPY_TRIGGER_MODE</a>) != <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65eea652b43493a4b39fb3895177943685">CHANSPY_TRIGGER_NONE</a>) {
<a name="l01307"></a>01307       <a class="code" href="lock_8h.html#26b556000e9ba452b40f732a86644de6">ast_cond_init</a>(&amp;spy-&gt;<a class="code" href="structast__channel__spy.html#c7d08e09a44d2b453e7eeecebf0a8daf">trigger</a>, NULL);
<a name="l01308"></a>01308       <a class="code" href="utils_8h.html#3208623241ff7b4c93907944487502a1">ast_set_flag</a>(spy, <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce657ac2f35629f6a422837ce4fc6eed040a">CHANSPY_TRIGGER_READ</a>);
<a name="l01309"></a>01309       <a class="code" href="utils_8h.html#c2399a33be6ffb658bcf7c6a35531732">ast_clear_flag</a>(spy, <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65419ab3aa5960e1f296e9f4ab481a0741">CHANSPY_TRIGGER_WRITE</a>);
<a name="l01310"></a>01310    }
<a name="l01311"></a>01311 
<a name="l01312"></a>01312    <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a>)
<a name="l01313"></a>01313       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"Spy %s added to channel %s\n"</span>,
<a name="l01314"></a>01314          spy-&gt;<a class="code" href="structast__channel__spy.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>, chan-&gt;name);
<a name="l01315"></a>01315 
<a name="l01316"></a>01316    <span class="keywordflow">return</span> 0;
<a name="l01317"></a>01317 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="52f8fa2ea810b99986edab442ed4e2f6"></a><!-- doxytag: member="chanspy.h::ast_channel_spy_free" ref="52f8fa2ea810b99986edab442ed4e2f6" args="(struct ast_channel_spy *spy)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_channel_spy_free           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel__spy.html">ast_channel_spy</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>spy</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Free a spy. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>spy</em>&nbsp;</td><td>The spy to free </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>nothing</dd></dl>
Note: This function MUST NOT be called with the spy locked. 
<p>
Definition at line <a class="el" href="channel_8c-source.html#l01399">1399</a> of file <a class="el" href="channel_8c-source.html">channel.c</a>.
<p>
References <a class="el" href="lock_8h-source.html#l00557">ast_cond_destroy()</a>, <a class="el" href="frame_8h-source.html#l00396">ast_frfree()</a>, <a class="el" href="linkedlists_8h-source.html#l00710">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="lock_8h-source.html#l00525">ast_mutex_destroy()</a>, <a class="el" href="utils_8h-source.html#l00067">ast_test_flag</a>, <a class="el" href="chanspy_8h.html#304d7c9f7a8c99380ef1fe3c955adf3f93c19bb62ffd2ffa5386b754ca90e136">CHANSPY_DONE</a>, <a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65ea04baee2d87b4e411e069984bbea6d2">CHANSPY_TRIGGER_MODE</a>, <a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65eea652b43493a4b39fb3895177943685">CHANSPY_TRIGGER_NONE</a>, <a class="el" href="format__g726_8c-source.html#l00193">f</a>, <a class="el" href="chanspy_8h-source.html#l00059">ast_channel_spy::lock</a>, <a class="el" href="chanspy_8h-source.html#l00062">ast_channel_spy::read_queue</a>, <a class="el" href="chanspy_8h-source.html#l00065">ast_channel_spy::status</a>, <a class="el" href="chanspy_8h-source.html#l00060">ast_channel_spy::trigger</a>, and <a class="el" href="chanspy_8h-source.html#l00063">ast_channel_spy::write_queue</a>.
<p>
Referenced by <a class="el" href="app__chanspy_8c-source.html#l00266">channel_spy()</a>, and <a class="el" href="app__mixmonitor_8c-source.html#l00146">mixmonitor_thread()</a>.<div class="fragment"><pre class="fragment"><a name="l01400"></a>01400 {
<a name="l01401"></a>01401    <span class="keyword">struct </span><a class="code" href="structast__frame.html">ast_frame</a> *<a class="code" href="format__g726_8c.html#85b9b17a7dd34a3638c560bc9152473b">f</a> = NULL;
<a name="l01402"></a>01402 
<a name="l01403"></a>01403    <span class="keywordflow">if</span> (spy-&gt;<a class="code" href="structast__channel__spy.html#9acb44549b41563697bb490144ec6258">status</a> == <a class="code" href="chanspy_8h.html#304d7c9f7a8c99380ef1fe3c955adf3f93c19bb62ffd2ffa5386b754ca90e136">CHANSPY_DONE</a>)
<a name="l01404"></a>01404       <span class="keywordflow">return</span>;
<a name="l01405"></a>01405 
<a name="l01406"></a>01406    <span class="comment">/* Switch status to done in case we get called twice */</span>
<a name="l01407"></a>01407    spy-&gt;<a class="code" href="structast__channel__spy.html#9acb44549b41563697bb490144ec6258">status</a> = <a class="code" href="chanspy_8h.html#304d7c9f7a8c99380ef1fe3c955adf3f93c19bb62ffd2ffa5386b754ca90e136">CHANSPY_DONE</a>;
<a name="l01408"></a>01408 
<a name="l01409"></a>01409    <span class="comment">/* Drop any frames in the queue */</span>
<a name="l01410"></a>01410    <span class="keywordflow">while</span> ((f = <a class="code" href="linkedlists_8h.html#beec347da29fe6b0d7fdb3e80b851f90">AST_LIST_REMOVE_HEAD</a>(&amp;spy-&gt;<a class="code" href="structast__channel__spy.html#13e9b2fb4e074ff362693715b23ab877">write_queue</a>.list, frame_list)))
<a name="l01411"></a>01411       <a class="code" href="frame_8h.html#506c759ec4950e7f7465e8f090a6252b">ast_frfree</a>(f);
<a name="l01412"></a>01412    <span class="keywordflow">while</span> ((f = <a class="code" href="linkedlists_8h.html#beec347da29fe6b0d7fdb3e80b851f90">AST_LIST_REMOVE_HEAD</a>(&amp;spy-&gt;<a class="code" href="structast__channel__spy.html#6fc28b06536d6947665598be732383aa">read_queue</a>.list, frame_list)))
<a name="l01413"></a>01413       <a class="code" href="frame_8h.html#506c759ec4950e7f7465e8f090a6252b">ast_frfree</a>(f);
<a name="l01414"></a>01414 
<a name="l01415"></a>01415    <span class="comment">/* Destroy the condition if in use */</span>
<a name="l01416"></a>01416    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#d26671e9d352536be0df3d41a800bb83">ast_test_flag</a>(spy, <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65ea04baee2d87b4e411e069984bbea6d2">CHANSPY_TRIGGER_MODE</a>) != <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65eea652b43493a4b39fb3895177943685">CHANSPY_TRIGGER_NONE</a>)
<a name="l01417"></a>01417       <a class="code" href="lock_8h.html#137771c8825678eeb6d67193572919d1">ast_cond_destroy</a>(&amp;spy-&gt;<a class="code" href="structast__channel__spy.html#c7d08e09a44d2b453e7eeecebf0a8daf">trigger</a>);
<a name="l01418"></a>01418 
<a name="l01419"></a>01419    <span class="comment">/* Destroy our mutex since it is no longer in use */</span>
<a name="l01420"></a>01420    <a class="code" href="lock_8h.html#1b27af7774f46859ffe2b1340ee7c082">ast_mutex_destroy</a>(&amp;spy-&gt;<a class="code" href="structast__channel__spy.html#dce7c4174ce9323904a934a486c41288">lock</a>);
<a name="l01421"></a>01421 
<a name="l01422"></a>01422    <span class="keywordflow">return</span>;
<a name="l01423"></a>01423 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="35d3e31fe12732e028f01173e83c2228"></a><!-- doxytag: member="chanspy.h::ast_channel_spy_read_frame" ref="35d3e31fe12732e028f01173e83c2228" args="(struct ast_channel_spy *spy, unsigned int samples)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__frame.html">ast_frame</a>* ast_channel_spy_read_frame           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel__spy.html">ast_channel_spy</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>spy</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>unsigned int&nbsp;</td>
          <td class="mdname" nowrap> <em>samples</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Read one (or more) frames of audio from a channel being spied upon. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>spy</em>&nbsp;</td><td>The spy to operate on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>samples</em>&nbsp;</td><td>The number of audio samples to read </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>NULL for failure, one <a class="el" href="structast__frame.html">ast_frame</a> pointer, or a chain of <a class="el" href="structast__frame.html">ast_frame</a> pointers</dd></dl>
This function can return multiple frames if the spy structure needs to be 'flushed' due to mismatched queue lengths, or if the spy structure is configured to return unmixed audio (in which case each call to this function will return a frame of audio from each side of channel).<p>
Note: This function performs no locking; you must hold the spy's lock before calling this function. You must <b>not</b> hold the channel's lock at the same time. 
<p>
Definition at line <a class="el" href="channel_8c-source.html#l04522">4522</a> of file <a class="el" href="channel_8c-source.html">channel.c</a>.
<p>
References <a class="el" href="utils_8h-source.html#l00081">ast_clear_flag</a>, <a class="el" href="frame_8c-source.html#l01404">ast_codec_get_len()</a>, <a class="el" href="frame_8c-source.html#l01441">ast_frame_adjust_volume()</a>, <a class="el" href="frame_8c-source.html#l01464">ast_frame_slinear_sum()</a>, <a class="el" href="frame_8h.html#006fc84d03b57b7c7d571d6c0db69f9264fc4720a7b3982e2d4bf246fe3d9924">AST_FRAME_VOICE</a>, <a class="el" href="frame_8c-source.html#l00439">ast_frdup()</a>, <a class="el" href="frame_8h-source.html#l00396">ast_frfree()</a>, <a class="el" href="linkedlists_8h-source.html#l00385">AST_LIST_FIRST</a>, <a class="el" href="linkedlists_8h-source.html#l00352">AST_LIST_HEAD_SET_NOLOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00403">AST_LIST_NEXT</a>, <a class="el" href="linkedlists_8h-source.html#l00710">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="linkedlists_8h-source.html#l00453">AST_LIST_TRAVERSE</a>, <a class="el" href="utils_8h-source.html#l00067">ast_test_flag</a>, <a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce651f319c5d4c24864a434e56ab93c72e72">CHANSPY_MIXAUDIO</a>, <a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65182be74692abc8f01ed538bc4e42629c">CHANSPY_READ_VOLADJUST</a>, <a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce6560bd57b07eeb3eb997c1a0fb15e2cdf1">CHANSPY_TRIGGER_FLUSH</a>, <a class="el" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce650cddca71a0efa3c6c9f94e1b276046bd">CHANSPY_WRITE_VOLADJUST</a>, <a class="el" href="channel_8c-source.html#l04494">copy_data_from_queue()</a>, <a class="el" href="chanspy_8h-source.html#l00054">ast_channel_spy_queue::format</a>, <a class="el" href="frame_8h-source.html#l00131">ast_frame::frametype</a>, <a class="el" href="chanspy_8h-source.html#l00062">ast_channel_spy::read_queue</a>, <a class="el" href="chanspy_8h-source.html#l00071">ast_channel_spy::read_vol_adjustment</a>, <a class="el" href="cdr__pgsql_8c-source.html#l00071">result</a>, <a class="el" href="chanspy_8h-source.html#l00053">ast_channel_spy_queue::samples</a>, <a class="el" href="chanspy_8h-source.html#l00063">ast_channel_spy::write_queue</a>, and <a class="el" href="chanspy_8h-source.html#l00072">ast_channel_spy::write_vol_adjustment</a>.
<p>
Referenced by <a class="el" href="app__mixmonitor_8c-source.html#l00146">mixmonitor_thread()</a>, and <a class="el" href="app__chanspy_8c-source.html#l00185">spy_generate()</a>.<div class="fragment"><pre class="fragment"><a name="l04523"></a>04523 {
<a name="l04524"></a>04524    <span class="keyword">struct </span><a class="code" href="structast__frame.html">ast_frame</a> *<a class="code" href="cdr__pgsql_8c.html#b4a88417b3d0170d754c647c30b7216a">result</a>;
<a name="l04525"></a>04525    <span class="comment">/* buffers are allocated to hold SLINEAR, which is the largest format */</span>
<a name="l04526"></a>04526         <span class="keywordtype">short</span> read_buf[<a class="code" href="structast__frame.html#6ef9161b900632671022358216c7dfe7">samples</a>];
<a name="l04527"></a>04527         <span class="keywordtype">short</span> write_buf[<a class="code" href="structast__frame.html#6ef9161b900632671022358216c7dfe7">samples</a>];
<a name="l04528"></a>04528    <span class="keyword">struct </span><a class="code" href="structast__frame.html">ast_frame</a> *read_frame;
<a name="l04529"></a>04529    <span class="keyword">struct </span><a class="code" href="structast__frame.html">ast_frame</a> *write_frame;
<a name="l04530"></a>04530    <span class="keywordtype">int</span> need_dup;
<a name="l04531"></a>04531    <span class="keyword">struct </span><a class="code" href="structast__frame.html">ast_frame</a> stack_read_frame = { .<a class="code" href="structast__frame.html#9574009b02f8256934a1a25cbac10e1d">frametype</a> = <a class="code" href="frame_8h.html#006fc84d03b57b7c7d571d6c0db69f9264fc4720a7b3982e2d4bf246fe3d9924">AST_FRAME_VOICE</a>,
<a name="l04532"></a>04532                      .subclass = spy-&gt;<a class="code" href="structast__channel__spy.html#6fc28b06536d6947665598be732383aa">read_queue</a>.<a class="code" href="structast__channel__spy__queue.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a>,
<a name="l04533"></a>04533                      .data = read_buf,
<a name="l04534"></a>04534                      .samples = <a class="code" href="structast__frame.html#6ef9161b900632671022358216c7dfe7">samples</a>,
<a name="l04535"></a>04535                      .datalen = <a class="code" href="frame_8c.html#86a66efeb5a412e9c1cae13f92043c47">ast_codec_get_len</a>(spy-&gt;<a class="code" href="structast__channel__spy.html#6fc28b06536d6947665598be732383aa">read_queue</a>.<a class="code" href="structast__channel__spy__queue.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a>, <a class="code" href="structast__frame.html#6ef9161b900632671022358216c7dfe7">samples</a>),
<a name="l04536"></a>04536    };
<a name="l04537"></a>04537    <span class="keyword">struct </span><a class="code" href="structast__frame.html">ast_frame</a> stack_write_frame = { .<a class="code" href="structast__frame.html#9574009b02f8256934a1a25cbac10e1d">frametype</a> = <a class="code" href="frame_8h.html#006fc84d03b57b7c7d571d6c0db69f9264fc4720a7b3982e2d4bf246fe3d9924">AST_FRAME_VOICE</a>,
<a name="l04538"></a>04538                       .subclass = spy-&gt;<a class="code" href="structast__channel__spy.html#13e9b2fb4e074ff362693715b23ab877">write_queue</a>.<a class="code" href="structast__channel__spy__queue.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a>,
<a name="l04539"></a>04539                       .data = write_buf,
<a name="l04540"></a>04540                       .samples = <a class="code" href="structast__frame.html#6ef9161b900632671022358216c7dfe7">samples</a>,
<a name="l04541"></a>04541                       .datalen = <a class="code" href="frame_8c.html#86a66efeb5a412e9c1cae13f92043c47">ast_codec_get_len</a>(spy-&gt;<a class="code" href="structast__channel__spy.html#13e9b2fb4e074ff362693715b23ab877">write_queue</a>.<a class="code" href="structast__channel__spy__queue.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a>, <a class="code" href="structast__frame.html#6ef9161b900632671022358216c7dfe7">samples</a>),
<a name="l04542"></a>04542    };
<a name="l04543"></a>04543 
<a name="l04544"></a>04544    <span class="comment">/* if a flush has been requested, dump everything in whichever queue is larger */</span>
<a name="l04545"></a>04545    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#d26671e9d352536be0df3d41a800bb83">ast_test_flag</a>(spy, <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce6560bd57b07eeb3eb997c1a0fb15e2cdf1">CHANSPY_TRIGGER_FLUSH</a>)) {
<a name="l04546"></a>04546       <span class="keywordflow">if</span> (spy-&gt;<a class="code" href="structast__channel__spy.html#6fc28b06536d6947665598be732383aa">read_queue</a>.<a class="code" href="structast__channel__spy__queue.html#6ef9161b900632671022358216c7dfe7">samples</a> &gt; spy-&gt;<a class="code" href="structast__channel__spy.html#13e9b2fb4e074ff362693715b23ab877">write_queue</a>.<a class="code" href="structast__channel__spy__queue.html#6ef9161b900632671022358216c7dfe7">samples</a>) {
<a name="l04547"></a>04547          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#d26671e9d352536be0df3d41a800bb83">ast_test_flag</a>(spy, <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65182be74692abc8f01ed538bc4e42629c">CHANSPY_READ_VOLADJUST</a>)) {
<a name="l04548"></a>04548             <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;spy-&gt;<a class="code" href="structast__channel__spy.html#6fc28b06536d6947665598be732383aa">read_queue</a>.list, result, frame_list)
<a name="l04549"></a>04549                <a class="code" href="frame_8c.html#0f5d115410bf7f582584378b94d8d37b">ast_frame_adjust_volume</a>(result, spy-&gt;read_vol_adjustment);
<a name="l04550"></a>04550          }
<a name="l04551"></a>04551          result = <a class="code" href="linkedlists_8h.html#e4deb7f32ef480cbc3b2e9b7e4ceff6c">AST_LIST_FIRST</a>(&amp;spy-&gt;read_queue.list);
<a name="l04552"></a>04552          <a class="code" href="linkedlists_8h.html#96c2ff3700d9bb6033bdf522c7984566">AST_LIST_HEAD_SET_NOLOCK</a>(&amp;spy-&gt;read_queue.list, NULL);
<a name="l04553"></a>04553          spy-&gt;read_queue.<a class="code" href="structast__frame.html#6ef9161b900632671022358216c7dfe7">samples</a> = 0;
<a name="l04554"></a>04554       } else {
<a name="l04555"></a>04555          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#d26671e9d352536be0df3d41a800bb83">ast_test_flag</a>(spy, <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce650cddca71a0efa3c6c9f94e1b276046bd">CHANSPY_WRITE_VOLADJUST</a>)) {
<a name="l04556"></a>04556             <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;spy-&gt;<a class="code" href="structast__channel__spy.html#13e9b2fb4e074ff362693715b23ab877">write_queue</a>.list, result, frame_list)
<a name="l04557"></a>04557                <a class="code" href="frame_8c.html#0f5d115410bf7f582584378b94d8d37b">ast_frame_adjust_volume</a>(result, spy-&gt;write_vol_adjustment);
<a name="l04558"></a>04558          }
<a name="l04559"></a>04559          result = <a class="code" href="linkedlists_8h.html#e4deb7f32ef480cbc3b2e9b7e4ceff6c">AST_LIST_FIRST</a>(&amp;spy-&gt;write_queue.list);
<a name="l04560"></a>04560          <a class="code" href="linkedlists_8h.html#96c2ff3700d9bb6033bdf522c7984566">AST_LIST_HEAD_SET_NOLOCK</a>(&amp;spy-&gt;write_queue.list, NULL);
<a name="l04561"></a>04561          spy-&gt;write_queue.samples = 0;
<a name="l04562"></a>04562       }
<a name="l04563"></a>04563       <a class="code" href="utils_8h.html#c2399a33be6ffb658bcf7c6a35531732">ast_clear_flag</a>(spy, <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce6560bd57b07eeb3eb997c1a0fb15e2cdf1">CHANSPY_TRIGGER_FLUSH</a>);
<a name="l04564"></a>04564       return result;
<a name="l04565"></a>04565    }
<a name="l04566"></a>04566 
<a name="l04567"></a>04567    if ((spy-&gt;read_queue.samples &lt; samples) || (spy-&gt;write_queue.samples &lt; samples))
<a name="l04568"></a>04568       return NULL;
<a name="l04569"></a>04569 
<a name="l04570"></a>04570    <span class="comment">/* short-circuit if both head frames have exactly what we want */</span>
<a name="l04571"></a>04571    if ((<a class="code" href="linkedlists_8h.html#e4deb7f32ef480cbc3b2e9b7e4ceff6c">AST_LIST_FIRST</a>(&amp;spy-&gt;read_queue.list)-&gt;samples == samples) &amp;&amp;
<a name="l04572"></a>04572        (<a class="code" href="linkedlists_8h.html#e4deb7f32ef480cbc3b2e9b7e4ceff6c">AST_LIST_FIRST</a>(&amp;spy-&gt;write_queue.list)-&gt;samples == samples)) {
<a name="l04573"></a>04573       read_frame = <a class="code" href="linkedlists_8h.html#beec347da29fe6b0d7fdb3e80b851f90">AST_LIST_REMOVE_HEAD</a>(&amp;spy-&gt;read_queue.list, frame_list);
<a name="l04574"></a>04574       write_frame = <a class="code" href="linkedlists_8h.html#beec347da29fe6b0d7fdb3e80b851f90">AST_LIST_REMOVE_HEAD</a>(&amp;spy-&gt;write_queue.list, frame_list);
<a name="l04575"></a>04575 
<a name="l04576"></a>04576       spy-&gt;read_queue.samples -= samples;
<a name="l04577"></a>04577       spy-&gt;write_queue.samples -= samples;
<a name="l04578"></a>04578 
<a name="l04579"></a>04579       need_dup = 0;
<a name="l04580"></a>04580    } <span class="keywordflow">else</span> {
<a name="l04581"></a>04581       <a class="code" href="channel_8c.html#ce1d4e7d0dec35a7cefdedbc14bc356a">copy_data_from_queue</a>(&amp;spy-&gt;<a class="code" href="structast__channel__spy.html#6fc28b06536d6947665598be732383aa">read_queue</a>, read_buf, samples);
<a name="l04582"></a>04582       <a class="code" href="channel_8c.html#ce1d4e7d0dec35a7cefdedbc14bc356a">copy_data_from_queue</a>(&amp;spy-&gt;<a class="code" href="structast__channel__spy.html#13e9b2fb4e074ff362693715b23ab877">write_queue</a>, write_buf, samples);
<a name="l04583"></a>04583 
<a name="l04584"></a>04584       read_frame = &amp;stack_read_frame;
<a name="l04585"></a>04585       write_frame = &amp;stack_write_frame;
<a name="l04586"></a>04586       need_dup = 1;
<a name="l04587"></a>04587    }
<a name="l04588"></a>04588    
<a name="l04589"></a>04589    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#d26671e9d352536be0df3d41a800bb83">ast_test_flag</a>(spy, <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce65182be74692abc8f01ed538bc4e42629c">CHANSPY_READ_VOLADJUST</a>))
<a name="l04590"></a>04590       <a class="code" href="frame_8c.html#0f5d115410bf7f582584378b94d8d37b">ast_frame_adjust_volume</a>(read_frame, spy-&gt;<a class="code" href="structast__channel__spy.html#a2809e43a74b947388f86f57ab866476">read_vol_adjustment</a>);
<a name="l04591"></a>04591 
<a name="l04592"></a>04592    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#d26671e9d352536be0df3d41a800bb83">ast_test_flag</a>(spy, <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce650cddca71a0efa3c6c9f94e1b276046bd">CHANSPY_WRITE_VOLADJUST</a>))
<a name="l04593"></a>04593       <a class="code" href="frame_8c.html#0f5d115410bf7f582584378b94d8d37b">ast_frame_adjust_volume</a>(write_frame, spy-&gt;<a class="code" href="structast__channel__spy.html#905842b829622d5a7a4f83c1441aadbc">write_vol_adjustment</a>);
<a name="l04594"></a>04594 
<a name="l04595"></a>04595    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#d26671e9d352536be0df3d41a800bb83">ast_test_flag</a>(spy, <a class="code" href="chanspy_8h.html#0531fc877d377d51e324d7afd13cce651f319c5d4c24864a434e56ab93c72e72">CHANSPY_MIXAUDIO</a>)) {
<a name="l04596"></a>04596       <a class="code" href="frame_8c.html#8a78ed734b1cafea2ab42e1363a330d0">ast_frame_slinear_sum</a>(read_frame, write_frame);
<a name="l04597"></a>04597 
<a name="l04598"></a>04598       <span class="keywordflow">if</span> (need_dup)
<a name="l04599"></a>04599          result = <a class="code" href="frame_8c.html#e7f7f3d8f817e56bbaf43b0b1ecf8997">ast_frdup</a>(read_frame);
<a name="l04600"></a>04600       <span class="keywordflow">else</span> {
<a name="l04601"></a>04601          result = read_frame;
<a name="l04602"></a>04602          <a class="code" href="frame_8h.html#506c759ec4950e7f7465e8f090a6252b">ast_frfree</a>(write_frame);
<a name="l04603"></a>04603       }
<a name="l04604"></a>04604    } <span class="keywordflow">else</span> {
<a name="l04605"></a>04605       <span class="keywordflow">if</span> (need_dup) {
<a name="l04606"></a>04606          result = <a class="code" href="frame_8c.html#e7f7f3d8f817e56bbaf43b0b1ecf8997">ast_frdup</a>(read_frame);
<a name="l04607"></a>04607          <a class="code" href="linkedlists_8h.html#ab7d30c78fda9982ddc59f746adf8a69">AST_LIST_NEXT</a>(result, frame_list) = <a class="code" href="frame_8c.html#e7f7f3d8f817e56bbaf43b0b1ecf8997">ast_frdup</a>(write_frame);
<a name="l04608"></a>04608       } <span class="keywordflow">else</span> {
<a name="l04609"></a>04609          result = read_frame;
<a name="l04610"></a>04610          <a class="code" href="linkedlists_8h.html#ab7d30c78fda9982ddc59f746adf8a69">AST_LIST_NEXT</a>(result, frame_list) = write_frame;
<a name="l04611"></a>04611       }
<a name="l04612"></a>04612    }
<a name="l04613"></a>04613 
<a name="l04614"></a>04614    <span class="keywordflow">return</span> result;
<a name="l04615"></a>04615 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="cde5ef271aa7cb6fa771ffe14e91e0d2"></a><!-- doxytag: member="chanspy.h::ast_channel_spy_remove" ref="cde5ef271aa7cb6fa771ffe14e91e0d2" args="(struct ast_channel *chan, struct ast_channel_spy *spy)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_channel_spy_remove           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct <a class="el" href="structast__channel__spy.html">ast_channel_spy</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>spy</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Remove a spy from a channel. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>The channel to remove the spy from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>spy</em>&nbsp;</td><td>The spy to be removed </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>nothing</dd></dl>
Note: This function performs no locking; you must hold the channel's lock before calling this function. 
<p>
Definition at line <a class="el" href="channel_8c-source.html#l01389">1389</a> of file <a class="el" href="channel_8c-source.html">channel.c</a>.
<p>
References <a class="el" href="linkedlists_8h-source.html#l00731">AST_LIST_REMOVE</a>, <a class="el" href="channel_8h-source.html#l00484">ast_channel::spies</a>, <a class="el" href="channel_8c-source.html#l01320">spy_cleanup()</a>, and <a class="el" href="channel_8c-source.html#l01334">spy_detach()</a>.
<p>
Referenced by <a class="el" href="app__chanspy_8c-source.html#l00266">channel_spy()</a>.<div class="fragment"><pre class="fragment"><a name="l01390"></a>01390 {
<a name="l01391"></a>01391    <span class="keywordflow">if</span> (!chan-&gt;<a class="code" href="structast__channel.html#5e6a55de0bea527db5f05883c77f39a6">spies</a>)
<a name="l01392"></a>01392       <span class="keywordflow">return</span>;
<a name="l01393"></a>01393 
<a name="l01394"></a>01394    <a class="code" href="linkedlists_8h.html#d4a4c53d3b264b4e1c5e3fdd84cd8b5a">AST_LIST_REMOVE</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#5e6a55de0bea527db5f05883c77f39a6">spies</a>-&gt;list, spy, list);
<a name="l01395"></a>01395    <a class="code" href="channel_8c.html#42536bea214e15b5d74b7a56c0cc304b">spy_detach</a>(spy, chan);
<a name="l01396"></a>01396    <a class="code" href="channel_8c.html#c00847a39b3ef850c25d058ac59264cc">spy_cleanup</a>(chan);
<a name="l01397"></a>01397 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="0730397c6530683a40c8162da49fd69e"></a><!-- doxytag: member="chanspy.h::ast_channel_spy_stop_by_type" ref="0730397c6530683a40c8162da49fd69e" args="(struct ast_channel *chan, const char *type)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_channel_spy_stop_by_type           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>type</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Find all spies of a particular type on a channel and stop them. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>The channel to operate on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>A character string identifying the type of spies to be stopped </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>nothing</dd></dl>
Note: This function performs no locking; you must hold the channel's lock before calling this function. 
<p>
Definition at line <a class="el" href="channel_8c-source.html#l01357">1357</a> of file <a class="el" href="channel_8c-source.html">channel.c</a>.
<p>
References <a class="el" href="linkedlists_8h-source.html#l00516">AST_LIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h-source.html#l00491">AST_LIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h-source.html#l00554">AST_LIST_TRAVERSE_SAFE_END</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="chanspy_8h.html#304d7c9f7a8c99380ef1fe3c955adf3f5166c25d27285982f469175514888813">CHANSPY_RUNNING</a>, <a class="el" href="chanspy_8h-source.html#l00059">ast_channel_spy::lock</a>, <a class="el" href="channel_8h-source.html#l00484">ast_channel::spies</a>, <a class="el" href="channel_8c-source.html#l01320">spy_cleanup()</a>, <a class="el" href="channel_8c-source.html#l01334">spy_detach()</a>, <a class="el" href="chanspy_8h-source.html#l00065">ast_channel_spy::status</a>, and <a class="el" href="chanspy_8h-source.html#l00066">ast_channel_spy::type</a>.
<p>
Referenced by <a class="el" href="app__mixmonitor_8c-source.html#l00399">mixmonitor_cli()</a>, and <a class="el" href="app__mixmonitor_8c-source.html#l00384">stop_mixmonitor_exec()</a>.<div class="fragment"><pre class="fragment"><a name="l01358"></a>01358 {
<a name="l01359"></a>01359    <span class="keyword">struct </span><a class="code" href="structast__channel__spy.html">ast_channel_spy</a> *spy = NULL;
<a name="l01360"></a>01360    
<a name="l01361"></a>01361    <span class="keywordflow">if</span> (!chan-&gt;<a class="code" href="structast__channel.html#5e6a55de0bea527db5f05883c77f39a6">spies</a>)
<a name="l01362"></a>01362       <span class="keywordflow">return</span>;
<a name="l01363"></a>01363 
<a name="l01364"></a>01364    <a class="code" href="linkedlists_8h.html#915e438a9528c8d6316c617b5bd84487">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#5e6a55de0bea527db5f05883c77f39a6">spies</a>-&gt;list, spy, list) {
<a name="l01365"></a>01365       <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;spy-&gt;<a class="code" href="structast__channel__spy.html#dce7c4174ce9323904a934a486c41288">lock</a>);
<a name="l01366"></a>01366       <span class="keywordflow">if</span> ((spy-&gt;<a class="code" href="structast__channel__spy.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a> == <a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>) &amp;&amp; (spy-&gt;<a class="code" href="structast__channel__spy.html#9acb44549b41563697bb490144ec6258">status</a> == <a class="code" href="chanspy_8h.html#304d7c9f7a8c99380ef1fe3c955adf3f5166c25d27285982f469175514888813">CHANSPY_RUNNING</a>)) {
<a name="l01367"></a>01367          <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;spy-&gt;<a class="code" href="structast__channel__spy.html#dce7c4174ce9323904a934a486c41288">lock</a>);
<a name="l01368"></a>01368          <a class="code" href="linkedlists_8h.html#37f99379dafa45c921f95bf7235eb91d">AST_LIST_REMOVE_CURRENT</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#5e6a55de0bea527db5f05883c77f39a6">spies</a>-&gt;list, list);
<a name="l01369"></a>01369          <a class="code" href="channel_8c.html#42536bea214e15b5d74b7a56c0cc304b">spy_detach</a>(spy, chan);
<a name="l01370"></a>01370       } <span class="keywordflow">else</span>
<a name="l01371"></a>01371          <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;spy-&gt;<a class="code" href="structast__channel__spy.html#dce7c4174ce9323904a934a486c41288">lock</a>);
<a name="l01372"></a>01372    }
<a name="l01373"></a>01373    <a class="code" href="linkedlists_8h.html#a93fdadc00a2a090968004b7d9c79630">AST_LIST_TRAVERSE_SAFE_END</a>
<a name="l01374"></a>01374    <a class="code" href="channel_8c.html#c00847a39b3ef850c25d058ac59264cc">spy_cleanup</a>(chan);
<a name="l01375"></a>01375 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="c9e9dc4c1549186228a46272aa69650d"></a><!-- doxytag: member="chanspy.h::ast_channel_spy_trigger_wait" ref="c9e9dc4c1549186228a46272aa69650d" args="(struct ast_channel_spy *spy)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_channel_spy_trigger_wait           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel__spy.html">ast_channel_spy</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>spy</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Efficiently wait until audio is available for a spy, or an exception occurs. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>spy</em>&nbsp;</td><td>The spy to wait on </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>nothing</dd></dl>
Note: The locking rules for this function are non-obvious... first, you must <b>not</b> hold the channel's lock when calling this function. Second, you must hold the spy's lock before making the function call; while the function runs the lock will be released, and when the trigger event occurs, the lock will be re-obtained. This means that when control returns to your code, you will again hold the spy's lock. 
<p>
Definition at line <a class="el" href="channel_8c-source.html#l01377">1377</a> of file <a class="el" href="channel_8c-source.html">channel.c</a>.
<p>
References <a class="el" href="lock_8h-source.html#l00567">ast_cond_timedwait()</a>, <a class="el" href="utils_8c-source.html#l00778">ast_tvadd()</a>, <a class="el" href="chanspy_8h-source.html#l00059">ast_channel_spy::lock</a>, and <a class="el" href="chanspy_8h-source.html#l00060">ast_channel_spy::trigger</a>.
<p>
Referenced by <a class="el" href="app__mixmonitor_8c-source.html#l00146">mixmonitor_thread()</a>.<div class="fragment"><pre class="fragment"><a name="l01378"></a>01378 {
<a name="l01379"></a>01379    <span class="keyword">struct </span>timeval tv;
<a name="l01380"></a>01380    <span class="keyword">struct </span>timespec ts;
<a name="l01381"></a>01381 
<a name="l01382"></a>01382    tv = <a class="code" href="utils_8c.html#f3d6e948bdc914615d61b50418162c81">ast_tvadd</a>(ast_tvnow(), ast_samp2tv(50000, 1000));
<a name="l01383"></a>01383    ts.tv_sec = tv.tv_sec;
<a name="l01384"></a>01384    ts.tv_nsec = tv.tv_usec * 1000;
<a name="l01385"></a>01385 
<a name="l01386"></a>01386    <a class="code" href="lock_8h.html#4e0093c0ebed37e7f2836835cd83a560">ast_cond_timedwait</a>(&amp;spy-&gt;<a class="code" href="structast__channel__spy.html#c7d08e09a44d2b453e7eeecebf0a8daf">trigger</a>, &amp;spy-&gt;<a class="code" href="structast__channel__spy.html#dce7c4174ce9323904a934a486c41288">lock</a>, &amp;ts);
<a name="l01387"></a>01387 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu May 24 22:27:24 2007 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.5 </small></address>
</body>
</html>
