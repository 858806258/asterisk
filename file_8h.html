<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (24 May 2007)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Thu May 24 22:27:29 2007</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Finclude_2F.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Finclude_2Fasterisk_2F.html">asterisk</a></div>
<h1>file.h File Reference</h1>Generic File Format Support. <a href="#_details">More...</a>
<p>
<code>#include &quot;<a class="el" href="channel_8h-source.html">asterisk/channel.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="frame_8h-source.html">asterisk/frame.h</a>&quot;</code><br>
<code>#include &lt;fcntl.h&gt;</code><br>

<p>
<a href="file_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__filestream.html">ast_filestream</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__format.html">ast_format</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__format__lock.html">ast_format_lock</a></td></tr>

<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#4da2b9e8d896d755e4003168efa23b45">AST_DIGIT_ANY</a>&nbsp;&nbsp;&nbsp;&quot;0123456789#*ABCD&quot;</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#0e34acd0336a2f590edd93ad887f05be">AST_DIGIT_ANYNUM</a>&nbsp;&nbsp;&nbsp;&quot;0123456789&quot;</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#546700b1dc000dae7ed61721fa362bf8">ast_format_register</a>(<a class="el" href="format__g726_8c.html#85b9b17a7dd34a3638c560bc9152473b">f</a>)&nbsp;&nbsp;&nbsp;__ast_format_register(<a class="el" href="format__g726_8c.html#85b9b17a7dd34a3638c560bc9152473b">f</a>, <a class="el" href="structast__module__info.html">ast_module_info</a>-&gt;self)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#0c68a323cdb0e44364ab025c264ed168">AST_RESERVED_POINTERS</a>&nbsp;&nbsp;&nbsp;20</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#c499fc238ba5577289a5455d9118a510">SEEK_FORCECUR</a>&nbsp;&nbsp;&nbsp;10</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#b6a20976ddfd8c7397485265fe9819de">__ast_format_register</a> (const struct <a class="el" href="structast__format.html">ast_format</a> *<a class="el" href="format__g726_8c.html#85b9b17a7dd34a3638c560bc9152473b">f</a>, struct <a class="el" href="structast__module.html">ast_module</a> *mod)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#47ae0cfaee0f98a97bf732081a55fcdc">ast_applystream</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#26c322652770620e64ac90682eb6504c">chan</a>, struct <a class="el" href="structast__filestream.html">ast_filestream</a> *s)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#8d18ac7b6bb79201e6321c4b5cfadde2">ast_closestream</a> (struct <a class="el" href="structast__filestream.html">ast_filestream</a> *<a class="el" href="format__g726_8c.html#85b9b17a7dd34a3638c560bc9152473b">f</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#c9bd705c9a99609486cdfdd5208f0a44">ast_file_init</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#12ac68f6ca092814c52a43b112dee2a9">ast_filecopy</a> (const char *oldname, const char *newname, const char *<a class="el" href="strings_8h.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#5a0cbe1f8c9ff2126997209a785679d5">ast_filedelete</a> (const char *filename, const char *<a class="el" href="strings_8h.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#5a3ec0398dc377f7850e62edc9e093df">ast_fileexists</a> (const char *filename, const char *<a class="el" href="strings_8h.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>, const char *preflang)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#f207ae9d1c93732bef5546c288efb3ff">ast_filerename</a> (const char *oldname, const char *newname, const char *<a class="el" href="strings_8h.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#153a6a52d4750b28e5b3a3f1a7a93b7f">ast_format_unregister</a> (const char *<a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#0bcbc0f6cab0bf6be159f0d5844e1b4b">ast_openstream</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#26c322652770620e64ac90682eb6504c">chan</a>, const char *filename, const char *preflang)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#b3c8b25cffdb8cddd9ece4671da30b03">ast_openstream_full</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#26c322652770620e64ac90682eb6504c">chan</a>, const char *filename, const char *preflang, int asis)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#226c58342b830e85eb5c359c6ab5a65f">ast_openvstream</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#26c322652770620e64ac90682eb6504c">chan</a>, const char *filename, const char *preflang)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#96615b28d77eef740ce76e209aad7424">ast_playstream</a> (struct <a class="el" href="structast__filestream.html">ast_filestream</a> *s)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#e87a1a55e2031e34919c906b497a554c">ast_readfile</a> (const char *filename, const char *<a class="el" href="chan__nbs_8c.html#a73364531569a868150462e5a44f29c8">type</a>, const char *comment, int flags, int check, mode_t mode)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#adedd7e446f209ba9d3f1ce00ea08697">ast_readframe</a> (struct <a class="el" href="structast__filestream.html">ast_filestream</a> *s)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#02e10962dcfcb69e23bfaf15dce32393">ast_seekstream</a> (struct <a class="el" href="structast__filestream.html">ast_filestream</a> *fs, off_t sample_offset, int whence)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#fa668f420defbe69e951881e41c47041">ast_stopstream</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#65052c94377323821185d04e2600dda2">ast_stream_and_wait</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#26c322652770620e64ac90682eb6504c">chan</a>, const char *<a class="el" href="utils_8h.html#8c7dd922ad47494fc02c388e12c00eac">file</a>, const char *digits)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#a89ae22b0f4ddc671b516808ebfc0679">ast_stream_fastforward</a> (struct <a class="el" href="structast__filestream.html">ast_filestream</a> *fs, off_t ms)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#3a2eb1ab87bc99265738281b25fc6999">ast_stream_rewind</a> (struct <a class="el" href="structast__filestream.html">ast_filestream</a> *fs, off_t ms)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#89903498f31ba12bb2f3cdbf1634bc3c">ast_streamfile</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, const char *filename, const char *preflang)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">off_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#f71d7aa8f7ce1c8a5e60fe235ad4ea01">ast_tellstream</a> (struct <a class="el" href="structast__filestream.html">ast_filestream</a> *fs)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#ce29e5d0bdd4ecde2928bc9055507bc0">ast_truncstream</a> (struct <a class="el" href="structast__filestream.html">ast_filestream</a> *fs)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#634a25400a6a724d278b9129b9b5181b">ast_waitstream</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, const char *breakon)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#24c25c9a9f196587f0ad5f466c059d22">ast_waitstream_exten</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, const char *<a class="el" href="cdr__tds_8c.html#5c18ef72771564b7f43c497dc507aeab">context</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#0db2bacb7cd7648486a6eb2b679d64db">ast_waitstream_fr</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, const char *breakon, const char *forward, const char *rewind, int ms)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#48738f94ec3e73352f212b993090910b">ast_waitstream_full</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, const char *breakon, int audiofd, int monfd)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#863a5fc977919f88d566c68efc408f7a">ast_writefile</a> (const char *filename, const char *<a class="el" href="chan__nbs_8c.html#a73364531569a868150462e5a44f29c8">type</a>, const char *comment, int flags, int check, mode_t mode)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#89845762896f1b8df8786e386b3a7493">ast_writestream</a> (struct <a class="el" href="structast__filestream.html">ast_filestream</a> *fs, struct <a class="el" href="structast__frame.html">ast_frame</a> *<a class="el" href="format__g726_8c.html#85b9b17a7dd34a3638c560bc9152473b">f</a>)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Generic File Format Support. 
<p>

<p>
Definition in file <a class="el" href="file_8h-source.html">file.h</a>.<hr><h2>Define Documentation</h2>
<a class="anchor" name="4da2b9e8d896d755e4003168efa23b45"></a><!-- doxytag: member="file.h::AST_DIGIT_ANY" ref="4da2b9e8d896d755e4003168efa23b45" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define AST_DIGIT_ANY&nbsp;&nbsp;&nbsp;&quot;0123456789#*ABCD&quot;          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Convenient for waiting 
<p>
Definition at line <a class="el" href="file_8h-source.html#l00040">40</a> of file <a class="el" href="file_8h-source.html">file.h</a>.
<p>
Referenced by <a class="el" href="chan__agent_8c-source.html#l01763">__login_exec()</a>, <a class="el" href="app_8c-source.html#l01253">ast_ivr_menu_run_internal()</a>, <a class="el" href="app_8c-source.html#l00479">ast_play_and_wait()</a>, <a class="el" href="channel_8c-source.html#l03161">ast_readstring_full()</a>, <a class="el" href="app_8c-source.html#l01046">ast_record_review()</a>, <a class="el" href="app__queue_8c-source.html#l01855">background_file()</a>, <a class="el" href="channel_8c-source.html#l03763">bridge_playfile()</a>, <a class="el" href="res__features_8c-source.html#l00776">builtin_atxfer()</a>, <a class="el" href="res__features_8c-source.html#l00673">builtin_blindtransfer()</a>, <a class="el" href="app__meetme_8c-source.html#l02485">conf_exec()</a>, <a class="el" href="app__meetme_8c-source.html#l01350">conf_run()</a>, <a class="el" href="app__dial_8c-source.html#l01184">dial_exec_full()</a>, <a class="el" href="app__dictate_8c-source.html#l00079">dictate_exec()</a>, <a class="el" href="app__directory_8c-source.html#l00570">directory_exec()</a>, <a class="el" href="app__festival_8c-source.html#l00286">festival_exec()</a>, <a class="el" href="app__voicemail_8c-source.html#l03926">get_folder()</a>, <a class="el" href="app_8c-source.html#l01149">ivr_dispatch()</a>, <a class="el" href="pbx_8c-source.html#l05642">pbx_builtin_background()</a>, <a class="el" href="app__queue_8c-source.html#l01307">play_file()</a>, <a class="el" href="app__directory_8c-source.html#l00261">play_mailbox_owner()</a>, <a class="el" href="app__voicemail_8c-source.html#l04694">play_message()</a>, <a class="el" href="app__voicemail_8c-source.html#l04466">play_message_callerid()</a>, <a class="el" href="app__voicemail_8c-source.html#l04396">play_message_datetime()</a>, <a class="el" href="app__voicemail_8c-source.html#l04533">play_message_duration()</a>, <a class="el" href="app__minivm_8c-source.html#l01278">play_record_review()</a>, <a class="el" href="app__dial_8c-source.html#l01747">retrydial_exec()</a>, <a class="el" href="app__voicemail_8c-source.html#l03376">say_and_wait()</a>, <a class="el" href="app__queue_8c-source.html#l01352">say_position()</a>, <a class="el" href="app__sayunixtime_8c-source.html#l00069">sayunixtime_exec()</a>, <a class="el" href="app__queue_8c-source.html#l02421">try_calling()</a>, <a class="el" href="app__voicemail_8c-source.html#l05117">vm_intro_gr()</a>, <a class="el" href="app__voicemail_8c-source.html#l05637">vm_intro_pt()</a>, <a class="el" href="app__voicemail_8c-source.html#l05495">vm_intro_pt_BR()</a>, and <a class="el" href="app__voicemail_8c-source.html#l04368">wait_file2()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="0e34acd0336a2f590edd93ad887f05be"></a><!-- doxytag: member="file.h::AST_DIGIT_ANYNUM" ref="0e34acd0336a2f590edd93ad887f05be" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define AST_DIGIT_ANYNUM&nbsp;&nbsp;&nbsp;&quot;0123456789&quot;          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="file_8h-source.html#l00041">41</a> of file <a class="el" href="file_8h-source.html">file.h</a>.
<p>
Referenced by <a class="el" href="chan__sip_8c-source.html#l07307">initreqprep()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="546700b1dc000dae7ed61721fa362bf8"></a><!-- doxytag: member="file.h::ast_format_register" ref="546700b1dc000dae7ed61721fa362bf8" args="(f)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define ast_format_register          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="format__g726_8c.html#85b9b17a7dd34a3638c560bc9152473b">f</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;__ast_format_register(<a class="el" href="format__g726_8c.html#85b9b17a7dd34a3638c560bc9152473b">f</a>, <a class="el" href="structast__module__info.html">ast_module_info</a>-&gt;self)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="file_8h-source.html#l00145">145</a> of file <a class="el" href="file_8h-source.html">file.h</a>.
<p>
Referenced by <a class="el" href="format__g723_8c-source.html#l00153">load_module()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="0c68a323cdb0e44364ab025c264ed168"></a><!-- doxytag: member="file.h::AST_RESERVED_POINTERS" ref="0c68a323cdb0e44364ab025c264ed168" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define AST_RESERVED_POINTERS&nbsp;&nbsp;&nbsp;20          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="file_8h-source.html#l00400">400</a> of file <a class="el" href="file_8h-source.html">file.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="c499fc238ba5577289a5455d9118a510"></a><!-- doxytag: member="file.h::SEEK_FORCECUR" ref="c499fc238ba5577289a5455d9118a510" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define SEEK_FORCECUR&nbsp;&nbsp;&nbsp;10          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="file_8h-source.html#l00138">138</a> of file <a class="el" href="file_8h-source.html">file.h</a>.
<p>
Referenced by <a class="el" href="channel_8c-source.html#l02060">__ast_read()</a>, <a class="el" href="channel_8c-source.html#l02660">ast_write()</a>, <a class="el" href="format__pcm_8c-source.html#l00380">au_seek()</a>, <a class="el" href="format__g729_8c-source.html#l00097">g729_seek()</a>, <a class="el" href="format__gsm_8c-source.html#l00118">gsm_seek()</a>, <a class="el" href="format__ilbc_8c-source.html#l00095">ilbc_seek()</a>, <a class="el" href="format__pcm_8c-source.html#l00109">pcm_seek()</a>, <a class="el" href="format__sln_8c-source.html#l00086">slinear_seek()</a>, <a class="el" href="format__vox_8c-source.html#l00088">vox_seek()</a>, and <a class="el" href="format__wav_8c-source.html#l00438">wav_seek()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="b6a20976ddfd8c7397485265fe9819de"></a><!-- doxytag: member="file.h::__ast_format_register" ref="b6a20976ddfd8c7397485265fe9819de" args="(const struct ast_format *f, struct ast_module *mod)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int __ast_format_register           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const struct <a class="el" href="structast__format.html">ast_format</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>f</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct <a class="el" href="structast__module.html">ast_module</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>mod</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Register a new file format capability Adds a format to Asterisk's format abilities. returns 0 on success, -1 on failure 
<p>
Definition at line <a class="el" href="file_8c-source.html#l00068">68</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="linkedlists_8h-source.html#l00657">AST_RWLIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h-source.html#l00456">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h-source.html#l00115">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00049">AST_RWLIST_WRLOCK</a>, <a class="el" href="logger_8c-source.html#l00989">ast_verbose()</a>, <a class="el" href="file_8h-source.html#l00106">ast_format::buf_size</a>, <a class="el" href="file_8h-source.html#l00066">ast_format::exts</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="file_8h-source.html#l00109">ast_format::module</a>, <a class="el" href="file_8h-source.html#l00065">ast_format::name</a>, <a class="el" href="asterisk_8c-source.html#l00163">option_verbose</a>, and <a class="el" href="logger_8h-source.html#l00044">VERBOSE_PREFIX_2</a>.<div class="fragment"><pre class="fragment"><a name="l00069"></a>00069 {
<a name="l00070"></a>00070    <span class="keyword">struct </span><a class="code" href="structast__format.html">ast_format</a> *tmp;
<a name="l00071"></a>00071 
<a name="l00072"></a>00072    <a class="code" href="linkedlists_8h.html#a8a78c1cb0b68179bb2e44d27216a5af">AST_RWLIST_WRLOCK</a>(&amp;formats);
<a name="l00073"></a>00073    <a class="code" href="linkedlists_8h.html#36b8c64a6c62cb77baa726f81dcaa7f5">AST_RWLIST_TRAVERSE</a>(&amp;formats, tmp, list) {
<a name="l00074"></a>00074       <span class="keywordflow">if</span> (!strcasecmp(f-&gt;<a class="code" href="structast__format.html#23d5c5772e05e09c87f6323a95732f89">name</a>, tmp-&gt;<a class="code" href="structast__format.html#23d5c5772e05e09c87f6323a95732f89">name</a>)) {
<a name="l00075"></a>00075          <a class="code" href="linkedlists_8h.html#470215c8af4ffcdb09701e5d092a9205">AST_RWLIST_UNLOCK</a>(&amp;formats);
<a name="l00076"></a>00076          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Tried to register '%s' format, already registered\n"</span>, f-&gt;<a class="code" href="structast__format.html#23d5c5772e05e09c87f6323a95732f89">name</a>);
<a name="l00077"></a>00077          <span class="keywordflow">return</span> -1;
<a name="l00078"></a>00078       }
<a name="l00079"></a>00079    }
<a name="l00080"></a>00080    <span class="keywordflow">if</span> (!(tmp = <a class="code" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*tmp)))) {
<a name="l00081"></a>00081       <a class="code" href="linkedlists_8h.html#470215c8af4ffcdb09701e5d092a9205">AST_RWLIST_UNLOCK</a>(&amp;formats);
<a name="l00082"></a>00082       <span class="keywordflow">return</span> -1;
<a name="l00083"></a>00083    }
<a name="l00084"></a>00084    *tmp = *f;
<a name="l00085"></a>00085    tmp-&gt;<a class="code" href="structast__format.html#22884db148f0ffb0d830ba431102b0b5">module</a> = mod;
<a name="l00086"></a>00086    <span class="keywordflow">if</span> (tmp-&gt;buf_size) {
<a name="l00087"></a>00087       <span class="comment">/*</span>
<a name="l00088"></a>00088 <span class="comment">       * Align buf_size properly, rounding up to the machine-specific</span>
<a name="l00089"></a>00089 <span class="comment">       * alignment for pointers.</span>
<a name="l00090"></a>00090 <span class="comment">       */</span>
<a name="l00091"></a>00091       <span class="keyword">struct </span>_test_align { <span class="keywordtype">void</span> *a, *b; } p;
<a name="l00092"></a>00092       <span class="keywordtype">int</span> align = (<span class="keywordtype">char</span> *)&amp;p.b - (<span class="keywordtype">char</span> *)&amp;p.a;
<a name="l00093"></a>00093       tmp-&gt;buf_size = ((f-&gt;<a class="code" href="structast__format.html#278a7af3130e71a3c38651b19a88592f">buf_size</a> + align - 1)/align)*align;
<a name="l00094"></a>00094    }
<a name="l00095"></a>00095    
<a name="l00096"></a>00096    memset(&amp;tmp-&gt;list, 0, <span class="keyword">sizeof</span>(tmp-&gt;list));
<a name="l00097"></a>00097 
<a name="l00098"></a>00098    <a class="code" href="linkedlists_8h.html#b4592c522c6b3831f739508553316599">AST_RWLIST_INSERT_HEAD</a>(&amp;formats, tmp, list);
<a name="l00099"></a>00099    <a class="code" href="linkedlists_8h.html#470215c8af4ffcdb09701e5d092a9205">AST_RWLIST_UNLOCK</a>(&amp;formats);
<a name="l00100"></a>00100    <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ge36cdd7167e060bff70d00fbd82809eb">option_verbose</a> &gt; 1)
<a name="l00101"></a>00101       <a class="code" href="logger_8c.html#6a1ef0a194bcc79fccfb662192954477">ast_verbose</a>( <a class="code" href="logger_8h.html#6e3640436a97291b451a8d264b5ab15d">VERBOSE_PREFIX_2</a> <span class="stringliteral">"Registered file format %s, extension(s) %s\n"</span>, f-&gt;<a class="code" href="structast__format.html#23d5c5772e05e09c87f6323a95732f89">name</a>, f-&gt;<a class="code" href="structast__format.html#6d9c71cd7b5d178eff3ceaba74c32897">exts</a>);
<a name="l00102"></a>00102 
<a name="l00103"></a>00103    <span class="keywordflow">return</span> 0;
<a name="l00104"></a>00104 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="47ae0cfaee0f98a97bf732081a55fcdc"></a><!-- doxytag: member="file.h::ast_applystream" ref="47ae0cfaee0f98a97bf732081a55fcdc" args="(struct ast_channel *chan, struct ast_filestream *s)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_applystream           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to work </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td><a class="el" href="structast__filestream.html">ast_filestream</a> to apply Returns 0 for success, -1 on failure </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l00661">661</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="file_8h-source.html#l00131">ast_filestream::owner</a>.
<p>
Referenced by <a class="el" href="file_8c-source.html#l00781">ast_streamfile()</a>, <a class="el" href="res__agi_8c-source.html#l00621">handle_getoption()</a>, <a class="el" href="res__agi_8c-source.html#l00889">handle_recordfile()</a>, <a class="el" href="res__agi_8c-source.html#l00561">handle_streamfile()</a>, and <a class="el" href="app__speech__utils_8c-source.html#l00526">speech_streamfile()</a>.<div class="fragment"><pre class="fragment"><a name="l00662"></a>00662 {
<a name="l00663"></a>00663    s-&gt;<a class="code" href="structast__filestream.html#72122ce96bfec66e2396d2e25225d70a">owner</a> = chan;
<a name="l00664"></a>00664    <span class="keywordflow">return</span> 0;
<a name="l00665"></a>00665 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="8d18ac7b6bb79201e6321c4b5cfadde2"></a><!-- doxytag: member="file.h::ast_closestream" ref="8d18ac7b6bb79201e6321c4b5cfadde2" args="(struct ast_filestream *f)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_closestream           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>f</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>f</em>&nbsp;</td><td>filestream to close Close a playback or recording stream Returns 0 on success, -1 on failure </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l00701">701</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="file_8c-source.html#l00701">ast_closestream()</a>, <a class="el" href="frame_8h-source.html#l00247">AST_FORMAT_MAX_AUDIO</a>, <a class="el" href="loader_8c-source.html#l00947">ast_module_unref()</a>, <a class="el" href="asterisk_8c-source.html#l00746">ast_safe_system()</a>, <a class="el" href="sched_8c-source.html#l00259">ast_sched_del()</a>, <a class="el" href="channel_8c-source.html#l01968">ast_settimeout()</a>, <a class="el" href="translate_8c-source.html#l00245">ast_translator_free_path()</a>, <a class="el" href="structast__format.html#474d8ca4cf587f836fe15026852f7ed5">ast_format::close</a>, <a class="el" href="file_8h-source.html#l00132">ast_filestream::f</a>, <a class="el" href="file_8h-source.html#l00122">ast_filestream::filename</a>, <a class="el" href="file_8h-source.html#l00119">ast_filestream::fmt</a>, <a class="el" href="file_8h-source.html#l00068">ast_format::format</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="file_8h-source.html#l00109">ast_format::module</a>, <a class="el" href="file_8h-source.html#l00131">ast_filestream::owner</a>, <a class="el" href="file_8h-source.html#l00123">ast_filestream::realfilename</a>, <a class="el" href="channel_8h-source.html#l00424">ast_channel::sched</a>, <a class="el" href="channel_8h-source.html#l00426">ast_channel::stream</a>, <a class="el" href="channel_8h-source.html#l00425">ast_channel::streamid</a>, <a class="el" href="file_8h-source.html#l00127">ast_filestream::trans</a>, <a class="el" href="file_8h-source.html#l00125">ast_filestream::vfs</a>, <a class="el" href="channel_8h-source.html#l00428">ast_channel::vstream</a>, and <a class="el" href="channel_8h-source.html#l00427">ast_channel::vstreamid</a>.
<p>
Referenced by <a class="el" href="app_8c-source.html#l00509">__ast_play_and_record()</a>, <a class="el" href="file_8c-source.html#l00701">ast_closestream()</a>, <a class="el" href="file_8c-source.html#l00349">ast_filehelper()</a>, <a class="el" href="channel_8c-source.html#l01598">ast_hangup()</a>, <a class="el" href="res__musiconhold_8c-source.html#l00216">ast_moh_files_next()</a>, <a class="el" href="res__monitor_8c-source.html#l00127">ast_monitor_start()</a>, <a class="el" href="res__monitor_8c-source.html#l00254">ast_monitor_stop()</a>, <a class="el" href="file_8c-source.html#l00131">ast_stopstream()</a>, <a class="el" href="app__chanspy_8c-source.html#l00266">channel_spy()</a>, <a class="el" href="res__convert_8c-source.html#l00057">cli_audio_convert()</a>, <a class="el" href="app__externalivr_8c-source.html#l00124">gen_closestream()</a>, <a class="el" href="res__agi_8c-source.html#l00889">handle_recordfile()</a>, <a class="el" href="res__musiconhold_8c-source.html#l00993">local_ast_moh_stop()</a>, <a class="el" href="app__mixmonitor_8c-source.html#l00146">mixmonitor_thread()</a>, <a class="el" href="res__musiconhold_8c-source.html#l00196">moh_files_release()</a>, <a class="el" href="app__record_8c-source.html#l00078">record_exec()</a>, and <a class="el" href="app__meetme_8c-source.html#l03045">recordthread()</a>.<div class="fragment"><pre class="fragment"><a name="l00702"></a>00702 {
<a name="l00703"></a>00703    <span class="keywordtype">char</span> *cmd = NULL;
<a name="l00704"></a>00704    size_t size = 0;
<a name="l00705"></a>00705    <span class="comment">/* Stop a running stream if there is one */</span>
<a name="l00706"></a>00706    <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__filestream.html#72122ce96bfec66e2396d2e25225d70a">owner</a>) {
<a name="l00707"></a>00707       <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__filestream.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>-&gt;<a class="code" href="structast__format.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a> &lt; <a class="code" href="frame_8h.html#165e3a55e2cf1a685ccaab3e4ecab88c">AST_FORMAT_MAX_AUDIO</a>) {
<a name="l00708"></a>00708          f-&gt;<a class="code" href="structast__filestream.html#72122ce96bfec66e2396d2e25225d70a">owner</a>-&gt;<a class="code" href="structast__channel.html#f7b44cfafd5c52223d5498196c8a2e7b">stream</a> = NULL;
<a name="l00709"></a>00709          <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__filestream.html#72122ce96bfec66e2396d2e25225d70a">owner</a>-&gt;<a class="code" href="structast__channel.html#087aaf86312ca1817642c650010e8439">streamid</a> &gt; -1)
<a name="l00710"></a>00710             <a class="code" href="sched_8c.html#4a0b784f64b9caf71932a3344c9c7c49">ast_sched_del</a>(f-&gt;<a class="code" href="structast__filestream.html#72122ce96bfec66e2396d2e25225d70a">owner</a>-&gt;<a class="code" href="structast__channel.html#47721f99ae60cbec027428e52ad7ca39">sched</a>, f-&gt;<a class="code" href="structast__filestream.html#72122ce96bfec66e2396d2e25225d70a">owner</a>-&gt;<a class="code" href="structast__channel.html#087aaf86312ca1817642c650010e8439">streamid</a>);
<a name="l00711"></a>00711          f-&gt;<a class="code" href="structast__filestream.html#72122ce96bfec66e2396d2e25225d70a">owner</a>-&gt;<a class="code" href="structast__channel.html#087aaf86312ca1817642c650010e8439">streamid</a> = -1;
<a name="l00712"></a>00712 <span class="preprocessor">#ifdef HAVE_ZAPTEL</span>
<a name="l00713"></a>00713 <span class="preprocessor"></span>         <a class="code" href="channel_8c.html#031ef8a01f979ba2f40451d97a515e80">ast_settimeout</a>(f-&gt;<a class="code" href="structast__filestream.html#72122ce96bfec66e2396d2e25225d70a">owner</a>, 0, NULL, NULL);
<a name="l00714"></a>00714 <span class="preprocessor">#endif         </span>
<a name="l00715"></a>00715 <span class="preprocessor"></span>      } <span class="keywordflow">else</span> {
<a name="l00716"></a>00716          f-&gt;<a class="code" href="structast__filestream.html#72122ce96bfec66e2396d2e25225d70a">owner</a>-&gt;<a class="code" href="structast__channel.html#a4853768f8d245b7d0d327cb620b8f52">vstream</a> = NULL;
<a name="l00717"></a>00717          <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__filestream.html#72122ce96bfec66e2396d2e25225d70a">owner</a>-&gt;<a class="code" href="structast__channel.html#790c2cf72cbd5f4fd647896a75a06570">vstreamid</a> &gt; -1)
<a name="l00718"></a>00718             <a class="code" href="sched_8c.html#4a0b784f64b9caf71932a3344c9c7c49">ast_sched_del</a>(f-&gt;<a class="code" href="structast__filestream.html#72122ce96bfec66e2396d2e25225d70a">owner</a>-&gt;<a class="code" href="structast__channel.html#47721f99ae60cbec027428e52ad7ca39">sched</a>, f-&gt;<a class="code" href="structast__filestream.html#72122ce96bfec66e2396d2e25225d70a">owner</a>-&gt;<a class="code" href="structast__channel.html#790c2cf72cbd5f4fd647896a75a06570">vstreamid</a>);
<a name="l00719"></a>00719          f-&gt;<a class="code" href="structast__filestream.html#72122ce96bfec66e2396d2e25225d70a">owner</a>-&gt;<a class="code" href="structast__channel.html#790c2cf72cbd5f4fd647896a75a06570">vstreamid</a> = -1;
<a name="l00720"></a>00720       }
<a name="l00721"></a>00721    }
<a name="l00722"></a>00722    <span class="comment">/* destroy the translator on exit */</span>
<a name="l00723"></a>00723    <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__filestream.html#4738019ef434f24099319565cd5185e5">trans</a>)
<a name="l00724"></a>00724       <a class="code" href="translate_8c.html#8f7ccc974f6f91b750a59c4353700191">ast_translator_free_path</a>(f-&gt;<a class="code" href="structast__filestream.html#4738019ef434f24099319565cd5185e5">trans</a>);
<a name="l00725"></a>00725 
<a name="l00726"></a>00726    <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__filestream.html#6964b5d4fdb02bab8cefc323bda1b18c">realfilename</a> &amp;&amp; f-&gt;<a class="code" href="structast__filestream.html#435ed7e9f07f740abf511a62c00eef6e">filename</a>) {
<a name="l00727"></a>00727          size = strlen(f-&gt;<a class="code" href="structast__filestream.html#435ed7e9f07f740abf511a62c00eef6e">filename</a>) + strlen(f-&gt;<a class="code" href="structast__filestream.html#6964b5d4fdb02bab8cefc323bda1b18c">realfilename</a>) + 15;
<a name="l00728"></a>00728          cmd = alloca(size);
<a name="l00729"></a>00729          memset(cmd,0,size);
<a name="l00730"></a>00730          snprintf(cmd,size,<span class="stringliteral">"/bin/mv -f %s %s"</span>,f-&gt;<a class="code" href="structast__filestream.html#435ed7e9f07f740abf511a62c00eef6e">filename</a>,f-&gt;<a class="code" href="structast__filestream.html#6964b5d4fdb02bab8cefc323bda1b18c">realfilename</a>);
<a name="l00731"></a>00731          <a class="code" href="asterisk_8c.html#ceb3925bf8c3e3d21d9246872548f5df">ast_safe_system</a>(cmd);
<a name="l00732"></a>00732    }
<a name="l00733"></a>00733 
<a name="l00734"></a>00734    <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__filestream.html#435ed7e9f07f740abf511a62c00eef6e">filename</a>)
<a name="l00735"></a>00735       <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(f-&gt;<a class="code" href="structast__filestream.html#435ed7e9f07f740abf511a62c00eef6e">filename</a>);
<a name="l00736"></a>00736    <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__filestream.html#6964b5d4fdb02bab8cefc323bda1b18c">realfilename</a>)
<a name="l00737"></a>00737       <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(f-&gt;<a class="code" href="structast__filestream.html#6964b5d4fdb02bab8cefc323bda1b18c">realfilename</a>);
<a name="l00738"></a>00738    <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__filestream.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>-&gt;<a class="code" href="structast__format.html#474d8ca4cf587f836fe15026852f7ed5">close</a>)
<a name="l00739"></a>00739       f-&gt;<a class="code" href="structast__filestream.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>-&gt;<a class="code" href="structast__format.html#474d8ca4cf587f836fe15026852f7ed5">close</a>(f);
<a name="l00740"></a>00740    fclose(f-&gt;<a class="code" href="structast__filestream.html#8fa14cdd754f91cc6554c9e71929cce7">f</a>);
<a name="l00741"></a>00741    <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__filestream.html#ab2eb9f5e144510f91fcdbae6fdd4465">vfs</a>)
<a name="l00742"></a>00742       <a class="code" href="file_8c.html#8d18ac7b6bb79201e6321c4b5cfadde2">ast_closestream</a>(f-&gt;<a class="code" href="structast__filestream.html#ab2eb9f5e144510f91fcdbae6fdd4465">vfs</a>);
<a name="l00743"></a>00743    <a class="code" href="loader_8c.html#593d1afacbd4c5bd89aac5a810e50f6e">ast_module_unref</a>(f-&gt;<a class="code" href="structast__filestream.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>-&gt;<a class="code" href="structast__format.html#22884db148f0ffb0d830ba431102b0b5">module</a>);
<a name="l00744"></a>00744    <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(f);
<a name="l00745"></a>00745    <span class="keywordflow">return</span> 0;
<a name="l00746"></a>00746 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="c9bd705c9a99609486cdfdd5208f0a44"></a><!-- doxytag: member="file.h::ast_file_init" ref="c9bd705c9a99609486cdfdd5208f0a44" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_file_init           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initializes all the various file stuff. Basically just registers the cli stuff Returns 0 all the time 
<p>
Definition at line <a class="el" href="file_8c-source.html#l01160">1160</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="cli_8c-source.html#l01352">ast_cli_register_multiple()</a>.
<p>
Referenced by <a class="el" href="asterisk_8c-source.html#l02570">main()</a>.<div class="fragment"><pre class="fragment"><a name="l01161"></a>01161 {
<a name="l01162"></a>01162    <a class="code" href="cli_8c.html#a334dfd903e83eea3729ff37aa372781">ast_cli_register_multiple</a>(<a class="code" href="file_8c.html#188b0beae77a44ae432b57872262344c">cli_file</a>, <span class="keyword">sizeof</span>(cli_file) / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html">ast_cli_entry</a>));
<a name="l01163"></a>01163    <span class="keywordflow">return</span> 0;
<a name="l01164"></a>01164 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="12ac68f6ca092814c52a43b112dee2a9"></a><!-- doxytag: member="file.h::ast_filecopy" ref="12ac68f6ca092814c52a43b112dee2a9" args="(const char *oldname, const char *newname, const char *fmt)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_filecopy           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>oldname</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>newname</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>fmt</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>oldname</em>&nbsp;</td><td>name of the file you wish to copy (minus extension) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>newname</em>&nbsp;</td><td>name you wish the file to be copied to (minus extension) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fmt</em>&nbsp;</td><td>the format of the file Copy a given file in a given format, or if fmt is NULL, then do so for all </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l00776">776</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="file_8c.html#c37d135e7f5cdb7c1b3c07bf28bb086ef75888a4f5d73bd7c461038d57e3aee7">ACTION_COPY</a>, and <a class="el" href="file_8c-source.html#l00349">ast_filehelper()</a>.
<p>
Referenced by <a class="el" href="app__voicemail_8c-source.html#l01679">copy_file()</a>.<div class="fragment"><pre class="fragment"><a name="l00777"></a>00777 {
<a name="l00778"></a>00778    <span class="keywordflow">return</span> <a class="code" href="file_8c.html#a079af1212fcb54690cd26c4e127e578">ast_filehelper</a>(filename, filename2, <a class="code" href="manager_8h.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>, <a class="code" href="file_8c.html#c37d135e7f5cdb7c1b3c07bf28bb086ef75888a4f5d73bd7c461038d57e3aee7">ACTION_COPY</a>);
<a name="l00779"></a>00779 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="5a0cbe1f8c9ff2126997209a785679d5"></a><!-- doxytag: member="file.h::ast_filedelete" ref="5a0cbe1f8c9ff2126997209a785679d5" args="(const char *filename, const char *fmt)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_filedelete           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>filename</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>fmt</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>name of the file you wish to delete (minus the extension) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fmt</em>&nbsp;</td><td>of the file Delete a given file in a given format, or if fmt is NULL, then do so for all </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l00766">766</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="file_8c.html#c37d135e7f5cdb7c1b3c07bf28bb086e8234d4d7a93eb89c19a8ee395a301fa3">ACTION_DELETE</a>, and <a class="el" href="file_8c-source.html#l00349">ast_filehelper()</a>.
<p>
Referenced by <a class="el" href="app_8c-source.html#l00509">__ast_play_and_record()</a>, <a class="el" href="res__monitor_8c-source.html#l00127">ast_monitor_start()</a>, <a class="el" href="res__monitor_8c-source.html#l00254">ast_monitor_stop()</a>, <a class="el" href="res__convert_8c-source.html#l00057">cli_audio_convert()</a>, <a class="el" href="app__minivm_8c-source.html#l01501">leave_voicemail()</a>, <a class="el" href="app__directory_8c-source.html#l00261">play_mailbox_owner()</a>, and <a class="el" href="app__minivm_8c-source.html#l01264">vm_delete()</a>.<div class="fragment"><pre class="fragment"><a name="l00767"></a>00767 {
<a name="l00768"></a>00768    <span class="keywordflow">return</span> <a class="code" href="file_8c.html#a079af1212fcb54690cd26c4e127e578">ast_filehelper</a>(filename, NULL, <a class="code" href="manager_8h.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>, <a class="code" href="file_8c.html#c37d135e7f5cdb7c1b3c07bf28bb086e8234d4d7a93eb89c19a8ee395a301fa3">ACTION_DELETE</a>);
<a name="l00769"></a>00769 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="5a3ec0398dc377f7850e62edc9e093df"></a><!-- doxytag: member="file.h::ast_fileexists" ref="5a3ec0398dc377f7850e62edc9e093df" args="(const char *filename, const char *fmt, const char *preflang)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_fileexists           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>filename</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>preflang</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>name of the file you wish to check, minus the extension </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fmt</em>&nbsp;</td><td>the format you wish to check (the extension) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>preflang</em>&nbsp;</td><td>(the preferred language you wisht to find the file in) See if a given file exists in a given format. If fmt is NULL, any format is accepted. Returns -1 if file does not exist, non-zero positive otherwise. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l00752">752</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="file_8c-source.html#l00475">fileexists_core()</a>.
<p>
Referenced by <a class="el" href="app__externalivr_8c-source.html#l00244">app_exec()</a>, <a class="el" href="res__musiconhold_8c-source.html#l00216">ast_moh_files_next()</a>, <a class="el" href="res__monitor_8c-source.html#l00127">ast_monitor_start()</a>, <a class="el" href="res__monitor_8c-source.html#l00254">ast_monitor_stop()</a>, <a class="el" href="app__chanspy_8c-source.html#l00465">common_exec()</a>, <a class="el" href="app__meetme_8c-source.html#l01350">conf_run()</a>, <a class="el" href="app__minivm_8c-source.html#l01205">invent_message()</a>, <a class="el" href="app__minivm_8c-source.html#l01501">leave_voicemail()</a>, <a class="el" href="app__minivm_8c-source.html#l02021">minivm_delete_exec()</a>, <a class="el" href="app__directory_8c-source.html#l00261">play_mailbox_owner()</a>, <a class="el" href="app__voicemail_8c-source.html#l04466">play_message_callerid()</a>, <a class="el" href="app__record_8c-source.html#l00078">record_exec()</a>, <a class="el" href="app__voicemail_8c-source.html#l05833">vm_intro()</a>, <a class="el" href="app__voicemail_8c-source.html#l05923">vm_newuser()</a>, and <a class="el" href="app__voicemail_8c-source.html#l06109">vm_tempgreeting()</a>.<div class="fragment"><pre class="fragment"><a name="l00753"></a>00753 {
<a name="l00754"></a>00754    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>;
<a name="l00755"></a>00755    <span class="keywordtype">int</span> buflen;
<a name="l00756"></a>00756 
<a name="l00757"></a>00757    <span class="keywordflow">if</span> (preflang == NULL)
<a name="l00758"></a>00758       preflang = <span class="stringliteral">""</span>;
<a name="l00759"></a>00759    buflen = strlen(preflang) + strlen(filename) + 2;  <span class="comment">/* room for everything */</span>
<a name="l00760"></a>00760    buf = alloca(buflen);
<a name="l00761"></a>00761    <span class="keywordflow">if</span> (buf == NULL)
<a name="l00762"></a>00762       <span class="keywordflow">return</span> 0;
<a name="l00763"></a>00763    <span class="keywordflow">return</span> <a class="code" href="file_8c.html#f4b88c55b7c7df1e88b865fae06bd48b">fileexists_core</a>(filename, <a class="code" href="manager_8h.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>, preflang, buf, buflen);
<a name="l00764"></a>00764 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="f207ae9d1c93732bef5546c288efb3ff"></a><!-- doxytag: member="file.h::ast_filerename" ref="f207ae9d1c93732bef5546c288efb3ff" args="(const char *oldname, const char *newname, const char *fmt)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_filerename           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>oldname</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>newname</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>fmt</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>oldname</em>&nbsp;</td><td>the name of the file you wish to act upon (minus the extension) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>newname</em>&nbsp;</td><td>the name you wish to rename the file to (minus the extension) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fmt</em>&nbsp;</td><td>the format of the file Rename a given file in a given format, or if fmt is NULL, then do so for all Returns -1 on failure </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l00771">771</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="file_8c.html#c37d135e7f5cdb7c1b3c07bf28bb086e6e34a74c158c47d152d471615f885447">ACTION_RENAME</a>, and <a class="el" href="file_8c-source.html#l00349">ast_filehelper()</a>.
<p>
Referenced by <a class="el" href="app_8c-source.html#l00509">__ast_play_and_record()</a>, <a class="el" href="res__monitor_8c-source.html#l00254">ast_monitor_stop()</a>, <a class="el" href="app__voicemail_8c-source.html#l02956">leave_voicemail()</a>, and <a class="el" href="app__voicemail_8c-source.html#l01616">rename_file()</a>.<div class="fragment"><pre class="fragment"><a name="l00772"></a>00772 {
<a name="l00773"></a>00773    <span class="keywordflow">return</span> <a class="code" href="file_8c.html#a079af1212fcb54690cd26c4e127e578">ast_filehelper</a>(filename, filename2, <a class="code" href="manager_8h.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>, <a class="code" href="file_8c.html#c37d135e7f5cdb7c1b3c07bf28bb086e6e34a74c158c47d152d471615f885447">ACTION_RENAME</a>);
<a name="l00774"></a>00774 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="153a6a52d4750b28e5b3a3f1a7a93b7f"></a><!-- doxytag: member="file.h::ast_format_unregister" ref="153a6a52d4750b28e5b3a3f1a7a93b7f" args="(const char *name)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_format_unregister           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>name</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>the name of the format you wish to unregister Unregisters a format based on the name of the format. Returns 0 on success, -1 on failure to unregister </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l00106">106</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="linkedlists_8h-source.html#l00526">AST_RWLIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h-source.html#l00503">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h-source.html#l00556">AST_RWLIST_TRAVERSE_SAFE_END</a>, <a class="el" href="linkedlists_8h-source.html#l00115">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00049">AST_RWLIST_WRLOCK</a>, <a class="el" href="logger_8c-source.html#l00989">ast_verbose()</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="file_8h-source.html#l00065">ast_format::name</a>, <a class="el" href="asterisk_8c-source.html#l00163">option_verbose</a>, and <a class="el" href="logger_8h-source.html#l00044">VERBOSE_PREFIX_2</a>.
<p>
Referenced by <a class="el" href="format__g723_8c-source.html#l00158">unload_module()</a>.<div class="fragment"><pre class="fragment"><a name="l00107"></a>00107 {
<a name="l00108"></a>00108    <span class="keyword">struct </span><a class="code" href="structast__format.html">ast_format</a> *tmp;
<a name="l00109"></a>00109    <span class="keywordtype">int</span> res = -1;
<a name="l00110"></a>00110 
<a name="l00111"></a>00111    <a class="code" href="linkedlists_8h.html#a8a78c1cb0b68179bb2e44d27216a5af">AST_RWLIST_WRLOCK</a>(&amp;formats);
<a name="l00112"></a>00112    <a class="code" href="linkedlists_8h.html#b564f1f262db6464e1644462c38d61e3">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>(&amp;formats, tmp, list) {
<a name="l00113"></a>00113       <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>, tmp-&gt;<a class="code" href="structast__format.html#23d5c5772e05e09c87f6323a95732f89">name</a>)) {
<a name="l00114"></a>00114          <a class="code" href="linkedlists_8h.html#93783e4cad722e705630e975d2e8d7f9">AST_RWLIST_REMOVE_CURRENT</a>(&amp;formats, list);
<a name="l00115"></a>00115          <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(tmp);
<a name="l00116"></a>00116          res = 0;
<a name="l00117"></a>00117       }
<a name="l00118"></a>00118    }
<a name="l00119"></a>00119    <a class="code" href="linkedlists_8h.html#e5be717f6b8c1586fa30a060b56403fe">AST_RWLIST_TRAVERSE_SAFE_END</a>
<a name="l00120"></a>00120    <a class="code" href="linkedlists_8h.html#470215c8af4ffcdb09701e5d092a9205">AST_RWLIST_UNLOCK</a>(&amp;formats);
<a name="l00121"></a>00121 
<a name="l00122"></a>00122    <span class="keywordflow">if</span> (!res) {
<a name="l00123"></a>00123       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ge36cdd7167e060bff70d00fbd82809eb">option_verbose</a> &gt; 1)
<a name="l00124"></a>00124          <a class="code" href="logger_8c.html#6a1ef0a194bcc79fccfb662192954477">ast_verbose</a>( <a class="code" href="logger_8h.html#6e3640436a97291b451a8d264b5ab15d">VERBOSE_PREFIX_2</a> <span class="stringliteral">"Unregistered format %s\n"</span>, <a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>);
<a name="l00125"></a>00125    } <span class="keywordflow">else</span>
<a name="l00126"></a>00126       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Tried to unregister format %s, already unregistered\n"</span>, <a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>);
<a name="l00127"></a>00127 
<a name="l00128"></a>00128    <span class="keywordflow">return</span> res;
<a name="l00129"></a>00129 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="0bcbc0f6cab0bf6be159f0d5844e1b4b"></a><!-- doxytag: member="file.h::ast_openstream" ref="0bcbc0f6cab0bf6be159f0d5844e1b4b" args="(struct ast_channel *chan, const char *filename, const char *preflang)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__filestream.html">ast_filestream</a>* ast_openstream           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>filename</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>preflang</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to work with </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>to use </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>preflang</em>&nbsp;</td><td>prefered language to use Returns a <a class="el" href="structast__filestream.html">ast_filestream</a> pointer if it opens the file, NULL on error </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l00524">524</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="file_8c-source.html#l00529">ast_openstream_full()</a>.
<p>
Referenced by <a class="el" href="file_8c-source.html#l00781">ast_streamfile()</a>, <a class="el" href="res__agi_8c-source.html#l00621">handle_getoption()</a>, <a class="el" href="res__agi_8c-source.html#l00561">handle_streamfile()</a>, and <a class="el" href="app__speech__utils_8c-source.html#l00526">speech_streamfile()</a>.<div class="fragment"><pre class="fragment"><a name="l00525"></a>00525 {
<a name="l00526"></a>00526    <span class="keywordflow">return</span> <a class="code" href="file_8c.html#b3c8b25cffdb8cddd9ece4671da30b03">ast_openstream_full</a>(chan, filename, preflang, 0);
<a name="l00527"></a>00527 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b3c8b25cffdb8cddd9ece4671da30b03"></a><!-- doxytag: member="file.h::ast_openstream_full" ref="b3c8b25cffdb8cddd9ece4671da30b03" args="(struct ast_channel *chan, const char *filename, const char *preflang, int asis)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__filestream.html">ast_filestream</a>* ast_openstream_full           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>filename</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>preflang</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>asis</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to work with </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>to use </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>preflang</em>&nbsp;</td><td>prefered language to use </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>asis</em>&nbsp;</td><td>if set, don't clear generators Returns a <a class="el" href="structast__filestream.html">ast_filestream</a> pointer if it opens the file, NULL on error </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l00529">529</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="file_8c.html#c37d135e7f5cdb7c1b3c07bf28bb086ee7fa34859ffb18159e586e7e88ec0b03">ACTION_OPEN</a>, <a class="el" href="channel_8c-source.html#l01729">ast_deactivate_generator()</a>, <a class="el" href="file_8c-source.html#l00349">ast_filehelper()</a>, <a class="el" href="frame_8h-source.html#l00249">AST_FORMAT_AUDIO_MASK</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="channel_8c-source.html#l02926">ast_set_write_format()</a>, <a class="el" href="file_8c-source.html#l00131">ast_stopstream()</a>, <a class="el" href="file_8c-source.html#l00475">fileexists_core()</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="channel_8h-source.html#l00429">ast_channel::oldwriteformat</a>, <a class="el" href="channel_8h-source.html#l00426">ast_channel::stream</a>, and <a class="el" href="channel_8h-source.html#l00478">ast_channel::writeformat</a>.
<p>
Referenced by <a class="el" href="res__musiconhold_8c-source.html#l00216">ast_moh_files_next()</a>, <a class="el" href="file_8c-source.html#l00524">ast_openstream()</a>, <a class="el" href="app__chanspy_8c-source.html#l00266">channel_spy()</a>, and <a class="el" href="app__externalivr_8c-source.html#l00143">gen_nextfile()</a>.<div class="fragment"><pre class="fragment"><a name="l00530"></a>00530 {
<a name="l00531"></a>00531    <span class="comment">/* </span>
<a name="l00532"></a>00532 <span class="comment">    * Use fileexists_core() to find a file in a compatible</span>
<a name="l00533"></a>00533 <span class="comment">    * language and format, set up a suitable translator,</span>
<a name="l00534"></a>00534 <span class="comment">    * and open the stream.</span>
<a name="l00535"></a>00535 <span class="comment">    */</span>
<a name="l00536"></a>00536    <span class="keywordtype">int</span> fmts, res, buflen;
<a name="l00537"></a>00537    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>;
<a name="l00538"></a>00538 
<a name="l00539"></a>00539    <span class="keywordflow">if</span> (!asis) {
<a name="l00540"></a>00540       <span class="comment">/* do this first, otherwise we detect the wrong writeformat */</span>
<a name="l00541"></a>00541       <a class="code" href="file_8c.html#460c61941bbb0132a2513ec9d5529e0c">ast_stopstream</a>(chan);
<a name="l00542"></a>00542       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#dac9630aec642a428cd73f4be0a03569">generator</a>)
<a name="l00543"></a>00543          <a class="code" href="channel_8c.html#e4e0e5c1767576b38fb1a893dfd8cb2b">ast_deactivate_generator</a>(chan);
<a name="l00544"></a>00544    }
<a name="l00545"></a>00545    <span class="keywordflow">if</span> (preflang == NULL)
<a name="l00546"></a>00546       preflang = <span class="stringliteral">""</span>;
<a name="l00547"></a>00547    buflen = strlen(preflang) + strlen(filename) + 2;
<a name="l00548"></a>00548    buf = alloca(buflen);
<a name="l00549"></a>00549    <span class="keywordflow">if</span> (buf == NULL)
<a name="l00550"></a>00550       <span class="keywordflow">return</span> NULL;
<a name="l00551"></a>00551    fmts = <a class="code" href="file_8c.html#f4b88c55b7c7df1e88b865fae06bd48b">fileexists_core</a>(filename, NULL, preflang, buf, buflen);
<a name="l00552"></a>00552    <span class="keywordflow">if</span> (fmts &gt; 0)
<a name="l00553"></a>00553       fmts &amp;= <a class="code" href="frame_8h.html#71a0a9732267760506de172c34d7a625">AST_FORMAT_AUDIO_MASK</a>;
<a name="l00554"></a>00554    <span class="keywordflow">if</span> (fmts &lt; 1) {
<a name="l00555"></a>00555       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"File %s does not exist in any format\n"</span>, filename);
<a name="l00556"></a>00556       <span class="keywordflow">return</span> NULL;
<a name="l00557"></a>00557    }
<a name="l00558"></a>00558    chan-&gt;<a class="code" href="structast__channel.html#dafa2f4e9ac82af6909c0d9f14ab8b04">oldwriteformat</a> = chan-&gt;<a class="code" href="structast__channel.html#45a38ca474a4f1df88fe13d68bbb0b44">writeformat</a>;
<a name="l00559"></a>00559    <span class="comment">/* Set the channel to a format we can work with */</span>
<a name="l00560"></a>00560    res = <a class="code" href="channel_8c.html#ebcd70a10759c189c265a97b5a9f78c3">ast_set_write_format</a>(chan, fmts);
<a name="l00561"></a>00561    res = <a class="code" href="file_8c.html#a079af1212fcb54690cd26c4e127e578">ast_filehelper</a>(buf, chan, NULL, <a class="code" href="file_8c.html#c37d135e7f5cdb7c1b3c07bf28bb086ee7fa34859ffb18159e586e7e88ec0b03">ACTION_OPEN</a>);
<a name="l00562"></a>00562    <span class="keywordflow">if</span> (res &gt;= 0)
<a name="l00563"></a>00563       <span class="keywordflow">return</span> chan-&gt;<a class="code" href="structast__channel.html#f7b44cfafd5c52223d5498196c8a2e7b">stream</a>;
<a name="l00564"></a>00564    <span class="keywordflow">return</span> NULL;
<a name="l00565"></a>00565 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="226c58342b830e85eb5c359c6ab5a65f"></a><!-- doxytag: member="file.h::ast_openvstream" ref="226c58342b830e85eb5c359c6ab5a65f" args="(struct ast_channel *chan, const char *filename, const char *preflang)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__filestream.html">ast_filestream</a>* ast_openvstream           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>filename</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>preflang</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to work with </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>to use </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>preflang</em>&nbsp;</td><td>prefered language to use Returns a <a class="el" href="structast__filestream.html">ast_filestream</a> pointer if it opens the file, NULL on error </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l00567">567</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="file_8c.html#c37d135e7f5cdb7c1b3c07bf28bb086ee7fa34859ffb18159e586e7e88ec0b03">ACTION_OPEN</a>, <a class="el" href="file_8c-source.html#l00349">ast_filehelper()</a>, <a class="el" href="frame_8h-source.html#l00247">AST_FORMAT_MAX_AUDIO</a>, <a class="el" href="frame_8h-source.html#l00265">AST_FORMAT_MAX_VIDEO</a>, <a class="el" href="frame_8c-source.html#l00532">ast_getformatname()</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="file_8c-source.html#l00475">fileexists_core()</a>, <a class="el" href="chan__alsa_8c-source.html#l00103">format</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="channel_8h-source.html#l00476">ast_channel::nativeformats</a>, and <a class="el" href="channel_8h-source.html#l00428">ast_channel::vstream</a>.
<p>
Referenced by <a class="el" href="file_8c-source.html#l00781">ast_streamfile()</a>, <a class="el" href="res__agi_8c-source.html#l00621">handle_getoption()</a>, and <a class="el" href="res__agi_8c-source.html#l00561">handle_streamfile()</a>.<div class="fragment"><pre class="fragment"><a name="l00568"></a>00568 {
<a name="l00569"></a>00569    <span class="comment">/* As above, but for video. But here we don't have translators</span>
<a name="l00570"></a>00570 <span class="comment">    * so we must enforce a format.</span>
<a name="l00571"></a>00571 <span class="comment">    */</span>
<a name="l00572"></a>00572    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="chan__alsa_8c.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a>;
<a name="l00573"></a>00573    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a>;
<a name="l00574"></a>00574    <span class="keywordtype">int</span> buflen;
<a name="l00575"></a>00575 
<a name="l00576"></a>00576    <span class="keywordflow">if</span> (preflang == NULL)
<a name="l00577"></a>00577       preflang = <span class="stringliteral">""</span>;
<a name="l00578"></a>00578    buflen = strlen(preflang) + strlen(filename) + 2;
<a name="l00579"></a>00579    buf = alloca(buflen);
<a name="l00580"></a>00580    <span class="keywordflow">if</span> (buf == NULL)
<a name="l00581"></a>00581       <span class="keywordflow">return</span> NULL;
<a name="l00582"></a>00582 
<a name="l00583"></a>00583    <span class="keywordflow">for</span> (format = <a class="code" href="frame_8h.html#165e3a55e2cf1a685ccaab3e4ecab88c">AST_FORMAT_MAX_AUDIO</a> &lt;&lt; 1; format &lt;= <a class="code" href="frame_8h.html#c3eeac0a86246d4b2b2c9ea6881d56b4">AST_FORMAT_MAX_VIDEO</a>; format = format &lt;&lt; 1) {
<a name="l00584"></a>00584       <span class="keywordtype">int</span> fd;
<a name="l00585"></a>00585       <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="manager_8h.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>;
<a name="l00586"></a>00586 
<a name="l00587"></a>00587       <span class="keywordflow">if</span> (!(chan-&gt;<a class="code" href="structast__channel.html#adbc0bbfec600539582f92b30ed1ecd7">nativeformats</a> &amp; format))
<a name="l00588"></a>00588          <span class="keywordflow">continue</span>;
<a name="l00589"></a>00589       fmt = <a class="code" href="frame_8c.html#fc9ce4e422290b7bda33cc8685094a97">ast_getformatname</a>(format);
<a name="l00590"></a>00590       <span class="keywordflow">if</span> ( <a class="code" href="file_8c.html#f4b88c55b7c7df1e88b865fae06bd48b">fileexists_core</a>(filename, fmt, preflang, buf, buflen) &lt; 1)   <span class="comment">/* no valid format */</span>
<a name="l00591"></a>00591          <span class="keywordflow">continue</span>;
<a name="l00592"></a>00592       fd = <a class="code" href="file_8c.html#a079af1212fcb54690cd26c4e127e578">ast_filehelper</a>(buf, chan, fmt, <a class="code" href="file_8c.html#c37d135e7f5cdb7c1b3c07bf28bb086ee7fa34859ffb18159e586e7e88ec0b03">ACTION_OPEN</a>);
<a name="l00593"></a>00593       <span class="keywordflow">if</span> (fd &gt;= 0)
<a name="l00594"></a>00594          <span class="keywordflow">return</span> chan-&gt;<a class="code" href="structast__channel.html#a4853768f8d245b7d0d327cb620b8f52">vstream</a>;
<a name="l00595"></a>00595       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"File %s has video but couldn't be opened\n"</span>, filename);
<a name="l00596"></a>00596    }
<a name="l00597"></a>00597    <span class="keywordflow">return</span> NULL;
<a name="l00598"></a>00598 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="96615b28d77eef740ce76e209aad7424"></a><!-- doxytag: member="file.h::ast_playstream" ref="96615b28d77eef740ce76e209aad7424" args="(struct ast_filestream *s)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_playstream           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>s</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>filestream to play Returns 0 for success, -1 on failure </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l00667">667</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="frame_8h-source.html#l00247">AST_FORMAT_MAX_AUDIO</a>, <a class="el" href="file_8c-source.html#l00609">ast_readaudio_callback()</a>, <a class="el" href="file_8c-source.html#l00639">ast_readvideo_callback()</a>, <a class="el" href="file_8h-source.html#l00119">ast_filestream::fmt</a>, and <a class="el" href="file_8h-source.html#l00068">ast_format::format</a>.
<p>
Referenced by <a class="el" href="file_8c-source.html#l00781">ast_streamfile()</a>, <a class="el" href="res__agi_8c-source.html#l00621">handle_getoption()</a>, <a class="el" href="res__agi_8c-source.html#l00561">handle_streamfile()</a>, and <a class="el" href="app__speech__utils_8c-source.html#l00526">speech_streamfile()</a>.<div class="fragment"><pre class="fragment"><a name="l00668"></a>00668 {
<a name="l00669"></a>00669    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structast__filestream.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>-&gt;<a class="code" href="structast__format.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a> &lt; <a class="code" href="frame_8h.html#165e3a55e2cf1a685ccaab3e4ecab88c">AST_FORMAT_MAX_AUDIO</a>)
<a name="l00670"></a>00670       <a class="code" href="file_8c.html#f5a98694d07d96552824ea26af9c6dbf">ast_readaudio_callback</a>(s);
<a name="l00671"></a>00671    <span class="keywordflow">else</span>
<a name="l00672"></a>00672       <a class="code" href="file_8c.html#d362f43c8af328f5120e3a4cb7d75ac2">ast_readvideo_callback</a>(s);
<a name="l00673"></a>00673    <span class="keywordflow">return</span> 0;
<a name="l00674"></a>00674 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="e87a1a55e2031e34919c906b497a554c"></a><!-- doxytag: member="file.h::ast_readfile" ref="e87a1a55e2031e34919c906b497a554c" args="(const char *filename, const char *type, const char *comment, int flags, int check, mode_t mode)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__filestream.html">ast_filestream</a>* ast_readfile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>filename</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>comment</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>check</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>mode_t&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>the name of the file to read from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>format of file you wish to read from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>comment</em>&nbsp;</td><td>comment to go with </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flags</em>&nbsp;</td><td>file flags </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>check</em>&nbsp;</td><td>(unimplemented, hence negligible) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mode</em>&nbsp;</td><td>Open mode Open an incoming file stream. flags are flags for the open() command, and if check is non-zero, then it will not read a file if there are any files that start with that name and have an extension Please note, this is a blocking function. Program execution will not return until ast_waitstream completes it's execution. Returns a struct <a class="el" href="structast__filestream.html">ast_filestream</a> on success, NULL on failure </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l00812">812</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="utils_8h-source.html#l00344">ast_free</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="linkedlists_8h-source.html#l00060">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00456">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h-source.html#l00115">AST_RWLIST_UNLOCK</a>, <a class="el" href="file_8c-source.html#l00250">build_filename()</a>, <a class="el" href="file_8h-source.html#l00066">ast_format::exts</a>, <a class="el" href="file_8c-source.html#l00267">exts_compare()</a>, <a class="el" href="format__g726_8c-source.html#l00193">f</a>, <a class="el" href="file_8h-source.html#l00122">ast_filestream::filename</a>, <a class="el" href="file_8h-source.html#l00120">ast_filestream::flags</a>, <a class="el" href="file_8h-source.html#l00119">ast_filestream::fmt</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="file_8c-source.html#l00281">get_filestream()</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="file_8h-source.html#l00121">ast_filestream::mode</a>, <a class="el" href="file_8c-source.html#l00327">open_wrapper()</a>, <a class="el" href="astmm_8h-source.html#l00075">strdup</a>, <a class="el" href="file_8h-source.html#l00127">ast_filestream::trans</a>, and <a class="el" href="file_8h-source.html#l00125">ast_filestream::vfs</a>.
<p>
Referenced by <a class="el" href="app_8c-source.html#l00509">__ast_play_and_record()</a>, and <a class="el" href="res__convert_8c-source.html#l00057">cli_audio_convert()</a>.<div class="fragment"><pre class="fragment"><a name="l00813"></a>00813 {
<a name="l00814"></a>00814    FILE *bfile;
<a name="l00815"></a>00815    <span class="keyword">struct </span><a class="code" href="structast__format.html">ast_format</a> *<a class="code" href="format__g726_8c.html#85b9b17a7dd34a3638c560bc9152473b">f</a>;
<a name="l00816"></a>00816    <span class="keyword">struct </span><a class="code" href="structast__filestream.html">ast_filestream</a> *fs = NULL;
<a name="l00817"></a>00817    <span class="keywordtype">char</span> *fn;
<a name="l00818"></a>00818 
<a name="l00819"></a>00819    <a class="code" href="linkedlists_8h.html#23c0c844e5abcb474854867b408e3be8">AST_RWLIST_RDLOCK</a>(&amp;formats);
<a name="l00820"></a>00820 
<a name="l00821"></a>00821    <a class="code" href="linkedlists_8h.html#36b8c64a6c62cb77baa726f81dcaa7f5">AST_RWLIST_TRAVERSE</a>(&amp;formats, f, list) {
<a name="l00822"></a>00822       fs = NULL;
<a name="l00823"></a>00823       <span class="keywordflow">if</span> (!<a class="code" href="file_8c.html#46aa3799ad5f3db1475d2aa5ae38ce66">exts_compare</a>(f-&gt;<a class="code" href="structast__format.html#6d9c71cd7b5d178eff3ceaba74c32897">exts</a>, <a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>))
<a name="l00824"></a>00824          <span class="keywordflow">continue</span>;
<a name="l00825"></a>00825 
<a name="l00826"></a>00826       fn = <a class="code" href="file_8c.html#93f2088ee46454d79eb83cf4c12d4439">build_filename</a>(<a class="code" href="structast__filestream.html#435ed7e9f07f740abf511a62c00eef6e">filename</a>, <a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>);
<a name="l00827"></a>00827       errno = 0;
<a name="l00828"></a>00828       bfile = fopen(fn, <span class="stringliteral">"r"</span>);
<a name="l00829"></a>00829       <span class="keywordflow">if</span> (!bfile || (fs = <a class="code" href="file_8c.html#8b2a601d4c35ad931eb1d5031961d8d7">get_filestream</a>(f, bfile)) == NULL ||
<a name="l00830"></a>00830           <a class="code" href="file_8c.html#9349c61165431c507acc86e1f40d8382">open_wrapper</a>(fs) ) {
<a name="l00831"></a>00831          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Unable to open %s\n"</span>, fn);
<a name="l00832"></a>00832          <span class="keywordflow">if</span> (fs)
<a name="l00833"></a>00833             <a class="code" href="utils_8h.html#801d8022c2922d0d4f73ba9e72c93865">ast_free</a>(fs);
<a name="l00834"></a>00834          <span class="keywordflow">if</span> (bfile)
<a name="l00835"></a>00835             fclose(bfile);
<a name="l00836"></a>00836          <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(fn);
<a name="l00837"></a>00837          <span class="keywordflow">continue</span>;
<a name="l00838"></a>00838       }
<a name="l00839"></a>00839       <span class="comment">/* found it */</span>
<a name="l00840"></a>00840       fs-&gt;<a class="code" href="structast__filestream.html#4738019ef434f24099319565cd5185e5">trans</a> = NULL;
<a name="l00841"></a>00841       fs-&gt;<a class="code" href="structast__filestream.html#7631454338ff70b1a6b1262f5f36beac">fmt</a> = f;
<a name="l00842"></a>00842       fs-&gt;<a class="code" href="structast__filestream.html#4e5868d676cb634aa75b125a0f741abf">flags</a> = <a class="code" href="structast__filestream.html#4e5868d676cb634aa75b125a0f741abf">flags</a>;
<a name="l00843"></a>00843       fs-&gt;<a class="code" href="structast__filestream.html#15d61712450a686a7f365adf4fef581f">mode</a> = <a class="code" href="structast__filestream.html#15d61712450a686a7f365adf4fef581f">mode</a>;
<a name="l00844"></a>00844       fs-&gt;<a class="code" href="structast__filestream.html#435ed7e9f07f740abf511a62c00eef6e">filename</a> = <a class="code" href="astmm_8h.html#17881997a89ddffd239268f0476567d0">strdup</a>(<a class="code" href="structast__filestream.html#435ed7e9f07f740abf511a62c00eef6e">filename</a>);
<a name="l00845"></a>00845       fs-&gt;<a class="code" href="structast__filestream.html#ab2eb9f5e144510f91fcdbae6fdd4465">vfs</a> = NULL;
<a name="l00846"></a>00846       <span class="keywordflow">break</span>;
<a name="l00847"></a>00847    }
<a name="l00848"></a>00848 
<a name="l00849"></a>00849    <a class="code" href="linkedlists_8h.html#470215c8af4ffcdb09701e5d092a9205">AST_RWLIST_UNLOCK</a>(&amp;formats);
<a name="l00850"></a>00850    <span class="keywordflow">if</span> (!fs) 
<a name="l00851"></a>00851       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"No such format '%s'\n"</span>, <a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>);
<a name="l00852"></a>00852 
<a name="l00853"></a>00853    <span class="keywordflow">return</span> fs;
<a name="l00854"></a>00854 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="adedd7e446f209ba9d3f1ce00ea08697"></a><!-- doxytag: member="file.h::ast_readframe" ref="adedd7e446f209ba9d3f1ce00ea08697" args="(struct ast_filestream *s)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__frame.html">ast_frame</a>* ast_readframe           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>s</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td><a class="el" href="structast__filestream.html">ast_filestream</a> to act on Returns a frame or NULL if read failed </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l00600">600</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="format__g726_8c-source.html#l00193">f</a>, <a class="el" href="file_8h-source.html#l00119">ast_filestream::fmt</a>, and <a class="el" href="structast__format.html#93ecff7ef453f32514e255a0ff2554da">ast_format::read</a>.
<p>
Referenced by <a class="el" href="app_8c-source.html#l00509">__ast_play_and_record()</a>, <a class="el" href="app__chanspy_8c-source.html#l00266">channel_spy()</a>, <a class="el" href="res__convert_8c-source.html#l00057">cli_audio_convert()</a>, <a class="el" href="app__externalivr_8c-source.html#l00174">gen_readframe()</a>, and <a class="el" href="res__musiconhold_8c-source.html#l00263">moh_files_readframe()</a>.<div class="fragment"><pre class="fragment"><a name="l00601"></a>00601 {
<a name="l00602"></a>00602    <span class="keyword">struct </span><a class="code" href="structast__frame.html">ast_frame</a> *<a class="code" href="format__g726_8c.html#85b9b17a7dd34a3638c560bc9152473b">f</a> = NULL;
<a name="l00603"></a>00603    <span class="keywordtype">int</span> whennext = 0; 
<a name="l00604"></a>00604    <span class="keywordflow">if</span> (s &amp;&amp; s-&gt;<a class="code" href="structast__filestream.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>)
<a name="l00605"></a>00605       f = s-&gt;<a class="code" href="structast__filestream.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>-&gt;<a class="code" href="structast__format.html#93ecff7ef453f32514e255a0ff2554da">read</a>(s, &amp;whennext);
<a name="l00606"></a>00606    <span class="keywordflow">return</span> f;
<a name="l00607"></a>00607 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="02e10962dcfcb69e23bfaf15dce32393"></a><!-- doxytag: member="file.h::ast_seekstream" ref="02e10962dcfcb69e23bfaf15dce32393" args="(struct ast_filestream *fs, off_t sample_offset, int whence)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_seekstream           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>fs</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>off_t&nbsp;</td>
          <td class="mdname" nowrap> <em>sample_offset</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>whence</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fs</em>&nbsp;</td><td><a class="el" href="structast__filestream.html">ast_filestream</a> to perform seek on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sample_offset</em>&nbsp;</td><td>numbers of samples to seek </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>whence</em>&nbsp;</td><td>SEEK_SET, SEEK_CUR, SEEK_END Returns 0 for success, or -1 for error </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l00676">676</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="file_8h-source.html#l00119">ast_filestream::fmt</a>, and <a class="el" href="structast__format.html#1ecca7b8374382e647398ed939b6ab8d">ast_format::seek</a>.
<p>
Referenced by <a class="el" href="channel_8c-source.html#l02060">__ast_read()</a>, <a class="el" href="app_8c-source.html#l00384">ast_control_streamfile()</a>, <a class="el" href="res__musiconhold_8c-source.html#l00216">ast_moh_files_next()</a>, <a class="el" href="file_8c-source.html#l00691">ast_stream_fastforward()</a>, <a class="el" href="file_8c-source.html#l00696">ast_stream_rewind()</a>, <a class="el" href="channel_8c-source.html#l02660">ast_write()</a>, <a class="el" href="app__dictate_8c-source.html#l00079">dictate_exec()</a>, <a class="el" href="res__agi_8c-source.html#l00621">handle_getoption()</a>, <a class="el" href="res__agi_8c-source.html#l00889">handle_recordfile()</a>, and <a class="el" href="res__agi_8c-source.html#l00561">handle_streamfile()</a>.<div class="fragment"><pre class="fragment"><a name="l00677"></a>00677 {
<a name="l00678"></a>00678    <span class="keywordflow">return</span> fs-&gt;<a class="code" href="structast__filestream.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>-&gt;<a class="code" href="structast__format.html#1ecca7b8374382e647398ed939b6ab8d">seek</a>(fs, sample_offset, whence);
<a name="l00679"></a>00679 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="fa668f420defbe69e951881e41c47041"></a><!-- doxytag: member="file.h::ast_stopstream" ref="fa668f420defbe69e951881e41c47041" args="(struct ast_channel *c)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_stopstream           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>c</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>The channel you wish to stop playback on Stop playback of a stream Returns 0 regardless </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l00131">131</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="file_8c-source.html#l00701">ast_closestream()</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="channel_8c-source.html#l02926">ast_set_write_format()</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="channel_8h-source.html#l00429">ast_channel::oldwriteformat</a>, <a class="el" href="channel_8h-source.html#l00426">ast_channel::stream</a>, and <a class="el" href="channel_8h-source.html#l00428">ast_channel::vstream</a>.
<p>
Referenced by <a class="el" href="res__adsi_8c-source.html#l00370">_ast_adsi_transmit_message_full()</a>, <a class="el" href="app__followme_8c-source.html#l00909">app_exec()</a>, <a class="el" href="app_8c-source.html#l00384">ast_control_streamfile()</a>, <a class="el" href="file_8c-source.html#l00529">ast_openstream_full()</a>, <a class="el" href="app_8c-source.html#l00479">ast_play_and_wait()</a>, <a class="el" href="channel_8c-source.html#l03161">ast_readstring_full()</a>, <a class="el" href="say_8c-source.html#l02482">ast_say_enumeration_full_da()</a>, <a class="el" href="say_8c-source.html#l02646">ast_say_enumeration_full_de()</a>, <a class="el" href="say_8c-source.html#l02383">ast_say_enumeration_full_en()</a>, <a class="el" href="say_8c-source.html#l00548">ast_say_number_full_cz()</a>, <a class="el" href="say_8c-source.html#l00646">ast_say_number_full_da()</a>, <a class="el" href="say_8c-source.html#l00760">ast_say_number_full_de()</a>, <a class="el" href="say_8c-source.html#l00454">ast_say_number_full_en()</a>, <a class="el" href="say_8c-source.html#l00896">ast_say_number_full_en_GB()</a>, <a class="el" href="say_8c-source.html#l00975">ast_say_number_full_es()</a>, <a class="el" href="say_8c-source.html#l01080">ast_say_number_full_fr()</a>, <a class="el" href="say_8c-source.html#l06919">ast_say_number_full_ge()</a>, <a class="el" href="say_8c-source.html#l06372">ast_say_number_full_gr()</a>, <a class="el" href="say_8c-source.html#l01214">ast_say_number_full_he()</a>, <a class="el" href="say_8c-source.html#l01322">ast_say_number_full_hu()</a>, <a class="el" href="say_8c-source.html#l01399">ast_say_number_full_it()</a>, <a class="el" href="say_8c-source.html#l01555">ast_say_number_full_nl()</a>, <a class="el" href="say_8c-source.html#l01634">ast_say_number_full_no()</a>, <a class="el" href="say_8c-source.html#l02023">ast_say_number_full_pt()</a>, <a class="el" href="say_8c-source.html#l02285">ast_say_number_full_ru()</a>, <a class="el" href="say_8c-source.html#l02119">ast_say_number_full_se()</a>, <a class="el" href="say_8c-source.html#l02192">ast_say_number_full_tw()</a>, <a class="el" href="app__talkdetect_8c-source.html#l00063">background_detect_exec()</a>, <a class="el" href="app__queue_8c-source.html#l01855">background_file()</a>, <a class="el" href="res__features_8c-source.html#l00673">builtin_blindtransfer()</a>, <a class="el" href="app__meetme_8c-source.html#l02485">conf_exec()</a>, <a class="el" href="app__meetme_8c-source.html#l01350">conf_run()</a>, <a class="el" href="app__directory_8c-source.html#l00570">directory_exec()</a>, <a class="el" href="res__agi_8c-source.html#l00621">handle_getoption()</a>, <a class="el" href="res__agi_8c-source.html#l00561">handle_streamfile()</a>, <a class="el" href="app__ices_8c-source.html#l00104">ices_exec()</a>, <a class="el" href="app_8c-source.html#l01149">ivr_dispatch()</a>, <a class="el" href="app__voicemail_8c-source.html#l02956">leave_voicemail()</a>, <a class="el" href="app__minivm_8c-source.html#l01818">minivm_greet_exec()</a>, <a class="el" href="app__mp3_8c-source.html#l00125">mp3_exec()</a>, <a class="el" href="app__nbscat_8c-source.html#l00116">NBScat_exec()</a>, <a class="el" href="pbx_8c-source.html#l05642">pbx_builtin_background()</a>, <a class="el" href="say_8c-source.html#l01753">pl_odtworz_plik()</a>, <a class="el" href="app__queue_8c-source.html#l01307">play_file()</a>, <a class="el" href="app__directory_8c-source.html#l00261">play_mailbox_owner()</a>, <a class="el" href="app__playback_8c-source.html#l00378">playback_exec()</a>, <a class="el" href="app__queue_8c-source.html#l03443">queue_exec()</a>, <a class="el" href="app__read_8c-source.html#l00087">read_exec()</a>, <a class="el" href="app__record_8c-source.html#l00078">record_exec()</a>, <a class="el" href="app__meetme_8c-source.html#l03045">recordthread()</a>, <a class="el" href="app__playback_8c-source.html#l00129">s_streamwait3()</a>, <a class="el" href="say_8c-source.html#l00062">say_character_str_full()</a>, <a class="el" href="say_8c-source.html#l00211">say_digit_str_full()</a>, <a class="el" href="say_8c-source.html#l00137">say_phonetic_str_full()</a>, <a class="el" href="app__rpt_8c-source.html#l01686">saycharstr()</a>, <a class="el" href="app__rpt_8c-source.html#l01711">saydigits()</a>, <a class="el" href="app__rpt_8c-source.html#l01673">sayfile()</a>, <a class="el" href="app__rpt_8c-source.html#l01699">saynum()</a>, <a class="el" href="app__rpt_8c-source.html#l01461">send_morse()</a>, <a class="el" href="app__rpt_8c-source.html#l01622">send_tone_telemetry()</a>, <a class="el" href="app__festival_8c-source.html#l00171">send_waveform_to_channel()</a>, <a class="el" href="app__speech__utils_8c-source.html#l00543">speech_background()</a>, <a class="el" href="app__voicemail_8c-source.html#l06295">vm_authenticate()</a>, <a class="el" href="app__voicemail_8c-source.html#l06398">vm_execmain()</a>, <a class="el" href="app__followme_8c-source.html#l00470">wait_for_winner()</a>, <a class="el" href="file_8c-source.html#l00983">waitstream_core()</a>, and <a class="el" href="app__zapateller_8c-source.html#l00059">zapateller_exec()</a>.<div class="fragment"><pre class="fragment"><a name="l00132"></a>00132 {
<a name="l00133"></a>00133    <span class="comment">/* Stop a running stream if there is one */</span>
<a name="l00134"></a>00134    <span class="keywordflow">if</span> (tmp-&gt;stream) {
<a name="l00135"></a>00135       <a class="code" href="file_8c.html#8d18ac7b6bb79201e6321c4b5cfadde2">ast_closestream</a>(tmp-&gt;stream);
<a name="l00136"></a>00136       tmp-&gt;stream = NULL;
<a name="l00137"></a>00137       <span class="keywordflow">if</span> (tmp-&gt;oldwriteformat &amp;&amp; <a class="code" href="channel_8c.html#ebcd70a10759c189c265a97b5a9f78c3">ast_set_write_format</a>(tmp, tmp-&gt;oldwriteformat))
<a name="l00138"></a>00138          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Unable to restore format back to %d\n"</span>, tmp-&gt;oldwriteformat);
<a name="l00139"></a>00139    }
<a name="l00140"></a>00140    <span class="comment">/* Stop the video stream too */</span>
<a name="l00141"></a>00141    <span class="keywordflow">if</span> (tmp-&gt;vstream != NULL) {
<a name="l00142"></a>00142       <a class="code" href="file_8c.html#8d18ac7b6bb79201e6321c4b5cfadde2">ast_closestream</a>(tmp-&gt;vstream);
<a name="l00143"></a>00143       tmp-&gt;vstream = NULL;
<a name="l00144"></a>00144    }
<a name="l00145"></a>00145    <span class="keywordflow">return</span> 0;
<a name="l00146"></a>00146 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="65052c94377323821185d04e2600dda2"></a><!-- doxytag: member="file.h::ast_stream_and_wait" ref="65052c94377323821185d04e2600dda2" args="(struct ast_channel *chan, const char *file, const char *digits)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_stream_and_wait           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>file</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>digits</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="file_8c-source.html#l01116">1116</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="file_8c-source.html#l00781">ast_streamfile()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, and <a class="el" href="file_8c-source.html#l01089">ast_waitstream()</a>.
<p>
Referenced by <a class="el" href="app_8c-source.html#l00509">__ast_play_and_record()</a>, <a class="el" href="app__followme_8c-source.html#l00909">app_exec()</a>, <a class="el" href="app_8c-source.html#l01046">ast_record_review()</a>, <a class="el" href="channel_8c-source.html#l03763">bridge_playfile()</a>, <a class="el" href="res__features_8c-source.html#l00776">builtin_atxfer()</a>, <a class="el" href="res__features_8c-source.html#l00562">builtin_automonitor()</a>, <a class="el" href="res__features_8c-source.html#l00673">builtin_blindtransfer()</a>, <a class="el" href="app__directory_8c-source.html#l00570">directory_exec()</a>, <a class="el" href="app__voicemail_8c-source.html#l02263">invent_message()</a>, <a class="el" href="app_8c-source.html#l01149">ivr_dispatch()</a>, <a class="el" href="app__voicemail_8c-source.html#l02956">leave_voicemail()</a>, <a class="el" href="app__directory_8c-source.html#l00261">play_mailbox_owner()</a>, <a class="el" href="app__voicemail_8c-source.html#l04466">play_message_callerid()</a>, <a class="el" href="app__voicemail_8c-source.html#l08429">play_record_review()</a>, and <a class="el" href="app__voicemail_8c-source.html#l04368">wait_file2()</a>.<div class="fragment"><pre class="fragment"><a name="l01117"></a>01117 {
<a name="l01118"></a>01118         <span class="keywordtype">int</span> res = 0;
<a name="l01119"></a>01119         <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(<a class="code" href="manager_8h.html#8c7dd922ad47494fc02c388e12c00eac">file</a>)) {
<a name="l01120"></a>01120                 res = <a class="code" href="file_8c.html#323e58584ef6ab2486be5b347b23ebe0">ast_streamfile</a>(chan, <a class="code" href="manager_8h.html#8c7dd922ad47494fc02c388e12c00eac">file</a>, chan-&gt;language);
<a name="l01121"></a>01121                 <span class="keywordflow">if</span> (!res)
<a name="l01122"></a>01122                         res = <a class="code" href="file_8c.html#634a25400a6a724d278b9129b9b5181b">ast_waitstream</a>(chan, digits);
<a name="l01123"></a>01123         }
<a name="l01124"></a>01124         <span class="keywordflow">return</span> res;
<a name="l01125"></a>01125 } 
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a89ae22b0f4ddc671b516808ebfc0679"></a><!-- doxytag: member="file.h::ast_stream_fastforward" ref="a89ae22b0f4ddc671b516808ebfc0679" args="(struct ast_filestream *fs, off_t ms)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_stream_fastforward           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>fs</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>off_t&nbsp;</td>
          <td class="mdname" nowrap> <em>ms</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fs</em>&nbsp;</td><td>filestream to act on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ms</em>&nbsp;</td><td>milliseconds to move Returns 0 for success, or -1 for error </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l00691">691</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="file_8c-source.html#l00676">ast_seekstream()</a>, and <a class="el" href="asterisk_8h-source.html#l00047">DEFAULT_SAMPLES_PER_MS</a>.
<p>
Referenced by <a class="el" href="file_8c-source.html#l00983">waitstream_core()</a>.<div class="fragment"><pre class="fragment"><a name="l00692"></a>00692 {
<a name="l00693"></a>00693    <span class="keywordflow">return</span> <a class="code" href="file_8c.html#02e10962dcfcb69e23bfaf15dce32393">ast_seekstream</a>(fs, ms * <a class="code" href="asterisk_8h.html#35d9207ec8638d71f1e25e0299f1f48d">DEFAULT_SAMPLES_PER_MS</a>, SEEK_CUR);
<a name="l00694"></a>00694 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="3a2eb1ab87bc99265738281b25fc6999"></a><!-- doxytag: member="file.h::ast_stream_rewind" ref="3a2eb1ab87bc99265738281b25fc6999" args="(struct ast_filestream *fs, off_t ms)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_stream_rewind           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>fs</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>off_t&nbsp;</td>
          <td class="mdname" nowrap> <em>ms</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fs</em>&nbsp;</td><td>filestream to act on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ms</em>&nbsp;</td><td>milliseconds to move Returns 0 for success, or -1 for error </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l00696">696</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="file_8c-source.html#l00676">ast_seekstream()</a>, and <a class="el" href="asterisk_8h-source.html#l00047">DEFAULT_SAMPLES_PER_MS</a>.
<p>
Referenced by <a class="el" href="app_8c-source.html#l00509">__ast_play_and_record()</a>, <a class="el" href="res__agi_8c-source.html#l00889">handle_recordfile()</a>, <a class="el" href="app__record_8c-source.html#l00078">record_exec()</a>, and <a class="el" href="file_8c-source.html#l00983">waitstream_core()</a>.<div class="fragment"><pre class="fragment"><a name="l00697"></a>00697 {
<a name="l00698"></a>00698    <span class="keywordflow">return</span> <a class="code" href="file_8c.html#02e10962dcfcb69e23bfaf15dce32393">ast_seekstream</a>(fs, -ms * <a class="code" href="asterisk_8h.html#35d9207ec8638d71f1e25e0299f1f48d">DEFAULT_SAMPLES_PER_MS</a>, SEEK_CUR);
<a name="l00699"></a>00699 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="89903498f31ba12bb2f3cdbf1634bc3c"></a><!-- doxytag: member="file.h::ast_streamfile" ref="89903498f31ba12bb2f3cdbf1634bc3c" args="(struct ast_channel *c, const char *filename, const char *preflang)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_streamfile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>filename</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>preflang</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>channel to stream the file to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>the name of the file you wish to stream, minus the extension </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>preflang</em>&nbsp;</td><td>the preferred language you wish to have the file streamed to you in Prepares a channel for the streaming of a file. To start the stream, afterward do a <a class="el" href="file_8c.html#634a25400a6a724d278b9129b9b5181b">ast_waitstream()</a> on the channel Also, it will stop any existing streams on the channel. Returns 0 on success, or -1 on failure. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l00781">781</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="file_8c-source.html#l00661">ast_applystream()</a>, <a class="el" href="frame_8c-source.html#l00532">ast_getformatname()</a>, <a class="el" href="frame_8c-source.html#l00545">ast_getformatname_multiple()</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="file_8c-source.html#l00524">ast_openstream()</a>, <a class="el" href="file_8c-source.html#l00567">ast_openvstream()</a>, <a class="el" href="file_8c-source.html#l00667">ast_playstream()</a>, <a class="el" href="logger_8c-source.html#l00989">ast_verbose()</a>, <a class="el" href="file_8h-source.html#l00119">ast_filestream::fmt</a>, <a class="el" href="file_8h-source.html#l00068">ast_format::format</a>, <a class="el" href="logger_8h-source.html#l00094">LOG_DEBUG</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="channel_8h-source.html#l00476">ast_channel::nativeformats</a>, <a class="el" href="asterisk_8c-source.html#l00164">option_debug</a>, <a class="el" href="asterisk_8c-source.html#l00163">option_verbose</a>, <a class="el" href="logger_8h-source.html#l00045">VERBOSE_PREFIX_3</a>, and <a class="el" href="file_8h-source.html#l00125">ast_filestream::vfs</a>.
<p>
Referenced by <a class="el" href="chan__agent_8c-source.html#l01763">__login_exec()</a>, <a class="el" href="res__features_8c-source.html#l02163">action_bridge()</a>, <a class="el" href="chan__agent_8c-source.html#l00622">agent_call()</a>, <a class="el" href="app__followme_8c-source.html#l00909">app_exec()</a>, <a class="el" href="app_8c-source.html#l00107">ast_app_getdata()</a>, <a class="el" href="app_8c-source.html#l00152">ast_app_getdata_full()</a>, <a class="el" href="app_8c-source.html#l00384">ast_control_streamfile()</a>, <a class="el" href="app_8c-source.html#l00479">ast_play_and_wait()</a>, <a class="el" href="say_8c-source.html#l02864">ast_say_date_da()</a>, <a class="el" href="say_8c-source.html#l02912">ast_say_date_de()</a>, <a class="el" href="say_8c-source.html#l02836">ast_say_date_en()</a>, <a class="el" href="say_8c-source.html#l02992">ast_say_date_fr()</a>, <a class="el" href="say_8c-source.html#l06996">ast_say_date_ge()</a>, <a class="el" href="say_8c-source.html#l06454">ast_say_date_gr()</a>, <a class="el" href="say_8c-source.html#l02961">ast_say_date_hu()</a>, <a class="el" href="say_8c-source.html#l03020">ast_say_date_nl()</a>, <a class="el" href="say_8c-source.html#l06575">ast_say_date_with_format_gr()</a>, <a class="el" href="say_8c-source.html#l05891">ast_say_datetime_en()</a>, <a class="el" href="say_8c-source.html#l05981">ast_say_datetime_fr()</a>, <a class="el" href="say_8c-source.html#l06188">ast_say_datetime_from_now_en()</a>, <a class="el" href="say_8c-source.html#l06228">ast_say_datetime_from_now_fr()</a>, <a class="el" href="say_8c-source.html#l07081">ast_say_datetime_from_now_ge()</a>, <a class="el" href="say_8c-source.html#l06544">ast_say_datetime_gr()</a>, <a class="el" href="say_8c-source.html#l06020">ast_say_datetime_nl()</a>, <a class="el" href="say_8c-source.html#l06037">ast_say_datetime_pt()</a>, <a class="el" href="say_8c-source.html#l06114">ast_say_datetime_tw()</a>, <a class="el" href="say_8c-source.html#l02482">ast_say_enumeration_full_da()</a>, <a class="el" href="say_8c-source.html#l02646">ast_say_enumeration_full_de()</a>, <a class="el" href="say_8c-source.html#l02383">ast_say_enumeration_full_en()</a>, <a class="el" href="say_8c-source.html#l00548">ast_say_number_full_cz()</a>, <a class="el" href="say_8c-source.html#l00646">ast_say_number_full_da()</a>, <a class="el" href="say_8c-source.html#l00760">ast_say_number_full_de()</a>, <a class="el" href="say_8c-source.html#l00454">ast_say_number_full_en()</a>, <a class="el" href="say_8c-source.html#l00896">ast_say_number_full_en_GB()</a>, <a class="el" href="say_8c-source.html#l00975">ast_say_number_full_es()</a>, <a class="el" href="say_8c-source.html#l01080">ast_say_number_full_fr()</a>, <a class="el" href="say_8c-source.html#l06919">ast_say_number_full_ge()</a>, <a class="el" href="say_8c-source.html#l06372">ast_say_number_full_gr()</a>, <a class="el" href="say_8c-source.html#l01214">ast_say_number_full_he()</a>, <a class="el" href="say_8c-source.html#l01322">ast_say_number_full_hu()</a>, <a class="el" href="say_8c-source.html#l01399">ast_say_number_full_it()</a>, <a class="el" href="say_8c-source.html#l01555">ast_say_number_full_nl()</a>, <a class="el" href="say_8c-source.html#l01634">ast_say_number_full_no()</a>, <a class="el" href="say_8c-source.html#l02023">ast_say_number_full_pt()</a>, <a class="el" href="say_8c-source.html#l02285">ast_say_number_full_ru()</a>, <a class="el" href="say_8c-source.html#l02119">ast_say_number_full_se()</a>, <a class="el" href="say_8c-source.html#l02192">ast_say_number_full_tw()</a>, <a class="el" href="say_8c-source.html#l05694">ast_say_time_de()</a>, <a class="el" href="say_8c-source.html#l05647">ast_say_time_en()</a>, <a class="el" href="say_8c-source.html#l05733">ast_say_time_fr()</a>, <a class="el" href="say_8c-source.html#l07035">ast_say_time_ge()</a>, <a class="el" href="say_8c-source.html#l06497">ast_say_time_gr()</a>, <a class="el" href="say_8c-source.html#l05712">ast_say_time_hu()</a>, <a class="el" href="say_8c-source.html#l05750">ast_say_time_nl()</a>, <a class="el" href="say_8c-source.html#l05823">ast_say_time_tw()</a>, <a class="el" href="file_8c-source.html#l01116">ast_stream_and_wait()</a>, <a class="el" href="app__authenticate_8c-source.html#l00094">auth_exec()</a>, <a class="el" href="app__talkdetect_8c-source.html#l00063">background_detect_exec()</a>, <a class="el" href="app__queue_8c-source.html#l01855">background_file()</a>, <a class="el" href="res__features_8c-source.html#l02716">bridge_exec()</a>, <a class="el" href="chan__agent_8c-source.html#l01153">check_availability()</a>, <a class="el" href="chan__agent_8c-source.html#l01227">check_beep()</a>, <a class="el" href="app__chanspy_8c-source.html#l00465">common_exec()</a>, <a class="el" href="app__meetme_8c-source.html#l02485">conf_exec()</a>, <a class="el" href="app__meetme_8c-source.html#l01350">conf_run()</a>, <a class="el" href="app__dial_8c-source.html#l01184">dial_exec_full()</a>, <a class="el" href="app__directory_8c-source.html#l00400">do_directory()</a>, <a class="el" href="app__voicemail_8c-source.html#l04129">forward_message()</a>, <a class="el" href="say_8c-source.html#l06326">gr_say_number_female()</a>, <a class="el" href="res__agi_8c-source.html#l00889">handle_recordfile()</a>, <a class="el" href="app__minivm_8c-source.html#l01205">invent_message()</a>, <a class="el" href="app__minivm_8c-source.html#l01501">leave_voicemail()</a>, <a class="el" href="app__minivm_8c-source.html#l01818">minivm_greet_exec()</a>, <a class="el" href="app__page_8c-source.html#l00085">page_exec()</a>, <a class="el" href="pbx_8c-source.html#l05642">pbx_builtin_background()</a>, <a class="el" href="say_8c-source.html#l01753">pl_odtworz_plik()</a>, <a class="el" href="app__dictate_8c-source.html#l00070">play_and_wait()</a>, <a class="el" href="app__queue_8c-source.html#l01307">play_file()</a>, <a class="el" href="app__minivm_8c-source.html#l01278">play_record_review()</a>, <a class="el" href="app__playback_8c-source.html#l00378">playback_exec()</a>, <a class="el" href="app__privacy_8c-source.html#l00078">privacy_exec()</a>, <a class="el" href="app__record_8c-source.html#l00078">record_exec()</a>, <a class="el" href="app__dial_8c-source.html#l01747">retrydial_exec()</a>, <a class="el" href="app__playback_8c-source.html#l00129">s_streamwait3()</a>, <a class="el" href="say_8c-source.html#l00062">say_character_str_full()</a>, <a class="el" href="say_8c-source.html#l00211">say_digit_str_full()</a>, <a class="el" href="say_8c-source.html#l00137">say_phonetic_str_full()</a>, <a class="el" href="app__rpt_8c-source.html#l01673">sayfile()</a>, <a class="el" href="chan__zap_8c-source.html#l05744">ss_thread()</a>, <a class="el" href="app__voicemail_8c-source.html#l06295">vm_authenticate()</a>, <a class="el" href="say_8c-source.html#l00394">wait_file()</a>, and <a class="el" href="app__followme_8c-source.html#l00470">wait_for_winner()</a>.<div class="fragment"><pre class="fragment"><a name="l00782"></a>00782 {
<a name="l00783"></a>00783    <span class="keyword">struct </span><a class="code" href="structast__filestream.html">ast_filestream</a> *fs;
<a name="l00784"></a>00784    <span class="keyword">struct </span><a class="code" href="structast__filestream.html">ast_filestream</a> *<a class="code" href="structast__filestream.html#ab2eb9f5e144510f91fcdbae6fdd4465">vfs</a>=NULL;
<a name="l00785"></a>00785    <span class="keywordtype">char</span> <a class="code" href="manager_8h.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>[256];
<a name="l00786"></a>00786 
<a name="l00787"></a>00787    fs = <a class="code" href="file_8c.html#0bcbc0f6cab0bf6be159f0d5844e1b4b">ast_openstream</a>(<a class="code" href="adsistub_8c.html#26c322652770620e64ac90682eb6504c">chan</a>, <a class="code" href="structast__filestream.html#435ed7e9f07f740abf511a62c00eef6e">filename</a>, preflang);
<a name="l00788"></a>00788    <span class="keywordflow">if</span> (fs)
<a name="l00789"></a>00789       vfs = <a class="code" href="file_8c.html#226c58342b830e85eb5c359c6ab5a65f">ast_openvstream</a>(<a class="code" href="adsistub_8c.html#26c322652770620e64ac90682eb6504c">chan</a>, <a class="code" href="structast__filestream.html#435ed7e9f07f740abf511a62c00eef6e">filename</a>, preflang);
<a name="l00790"></a>00790    <span class="keywordflow">if</span> (vfs) {
<a name="l00791"></a>00791       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a>)
<a name="l00792"></a>00792          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"Ooh, found a video stream, too, format %s\n"</span>, <a class="code" href="frame_8c.html#fc9ce4e422290b7bda33cc8685094a97">ast_getformatname</a>(vfs-&gt;<a class="code" href="structast__filestream.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>-&gt;<a class="code" href="structast__format.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a>));
<a name="l00793"></a>00793    }
<a name="l00794"></a>00794    <span class="keywordflow">if</span> (fs){
<a name="l00795"></a>00795       <span class="keywordflow">if</span> (<a class="code" href="file_8c.html#47ae0cfaee0f98a97bf732081a55fcdc">ast_applystream</a>(<a class="code" href="adsistub_8c.html#26c322652770620e64ac90682eb6504c">chan</a>, fs))
<a name="l00796"></a>00796          <span class="keywordflow">return</span> -1;
<a name="l00797"></a>00797       <span class="keywordflow">if</span> (vfs &amp;&amp; <a class="code" href="file_8c.html#47ae0cfaee0f98a97bf732081a55fcdc">ast_applystream</a>(chan, vfs))
<a name="l00798"></a>00798          <span class="keywordflow">return</span> -1;
<a name="l00799"></a>00799       <span class="keywordflow">if</span> (<a class="code" href="file_8c.html#96615b28d77eef740ce76e209aad7424">ast_playstream</a>(fs))
<a name="l00800"></a>00800          <span class="keywordflow">return</span> -1;
<a name="l00801"></a>00801       <span class="keywordflow">if</span> (vfs &amp;&amp; <a class="code" href="file_8c.html#96615b28d77eef740ce76e209aad7424">ast_playstream</a>(vfs))
<a name="l00802"></a>00802          <span class="keywordflow">return</span> -1;
<a name="l00803"></a>00803       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ge36cdd7167e060bff70d00fbd82809eb">option_verbose</a> &gt; 2)
<a name="l00804"></a>00804          <a class="code" href="logger_8c.html#6a1ef0a194bcc79fccfb662192954477">ast_verbose</a>(<a class="code" href="logger_8h.html#aefd5a67b7464040f5352e4ecdc535ca">VERBOSE_PREFIX_3</a> <span class="stringliteral">"&lt;%s&gt; Playing '%s.%s' (language '%s')\n"</span>, chan-&gt;name, <a class="code" href="structast__filestream.html#435ed7e9f07f740abf511a62c00eef6e">filename</a>, <a class="code" href="frame_8c.html#fc9ce4e422290b7bda33cc8685094a97">ast_getformatname</a>(chan-&gt;writeformat), preflang ? preflang : <span class="stringliteral">"default"</span>);
<a name="l00805"></a>00805 
<a name="l00806"></a>00806       <span class="keywordflow">return</span> 0;
<a name="l00807"></a>00807    }
<a name="l00808"></a>00808    <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Unable to open %s (format %s): %s\n"</span>, <a class="code" href="structast__filestream.html#435ed7e9f07f740abf511a62c00eef6e">filename</a>, <a class="code" href="frame_8c.html#98f2e5f4c4b2d13cb63057889cc0b743">ast_getformatname_multiple</a>(fmt, <span class="keyword">sizeof</span>(fmt), chan-&gt;nativeformats), strerror(errno));
<a name="l00809"></a>00809    <span class="keywordflow">return</span> -1;
<a name="l00810"></a>00810 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="f71d7aa8f7ce1c8a5e60fe235ad4ea01"></a><!-- doxytag: member="file.h::ast_tellstream" ref="f71d7aa8f7ce1c8a5e60fe235ad4ea01" args="(struct ast_filestream *fs)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">off_t ast_tellstream           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>fs</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fs</em>&nbsp;</td><td>fs to act on Returns a long as a sample offset into stream </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l00686">686</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="file_8h-source.html#l00119">ast_filestream::fmt</a>, and <a class="el" href="structast__format.html#a5c5c564c0fac936920dc29ed50f8bac">ast_format::tell</a>.
<p>
Referenced by <a class="el" href="app_8c-source.html#l00384">ast_control_streamfile()</a>, <a class="el" href="res__agi_8c-source.html#l00621">handle_getoption()</a>, <a class="el" href="res__agi_8c-source.html#l00889">handle_recordfile()</a>, and <a class="el" href="res__agi_8c-source.html#l00561">handle_streamfile()</a>.<div class="fragment"><pre class="fragment"><a name="l00687"></a>00687 {
<a name="l00688"></a>00688    <span class="keywordflow">return</span> fs-&gt;<a class="code" href="structast__filestream.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>-&gt;<a class="code" href="structast__format.html#a5c5c564c0fac936920dc29ed50f8bac">tell</a>(fs);
<a name="l00689"></a>00689 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="ce29e5d0bdd4ecde2928bc9055507bc0"></a><!-- doxytag: member="file.h::ast_truncstream" ref="ce29e5d0bdd4ecde2928bc9055507bc0" args="(struct ast_filestream *fs)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_truncstream           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>fs</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fs</em>&nbsp;</td><td>filestream to act on Returns 0 for success, or -1 for error </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l00681">681</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="file_8h-source.html#l00119">ast_filestream::fmt</a>, and <a class="el" href="structast__format.html#ca25eb0535d82c17027552e98e6b429e">ast_format::trunc</a>.
<p>
Referenced by <a class="el" href="app_8c-source.html#l00509">__ast_play_and_record()</a>, <a class="el" href="res__agi_8c-source.html#l00889">handle_recordfile()</a>, and <a class="el" href="app__record_8c-source.html#l00078">record_exec()</a>.<div class="fragment"><pre class="fragment"><a name="l00682"></a>00682 {
<a name="l00683"></a>00683    <span class="keywordflow">return</span> fs-&gt;<a class="code" href="structast__filestream.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>-&gt;<a class="code" href="structast__format.html#ca25eb0535d82c17027552e98e6b429e">trunc</a>(fs);
<a name="l00684"></a>00684 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="634a25400a6a724d278b9129b9b5181b"></a><!-- doxytag: member="file.h::ast_waitstream" ref="634a25400a6a724d278b9129b9b5181b" args="(struct ast_channel *c, const char *breakon)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_waitstream           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>breakon</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>channel to waitstream on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>breakon</em>&nbsp;</td><td>string of DTMF digits to break upon Begins playback of a stream... Wait for a stream to stop or for any one of a given digit to arrive, Returns 0 if the stream finishes, the character if it was interrupted, and -1 on error </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l01089">1089</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="file_8c-source.html#l00983">waitstream_core()</a>.
<p>
Referenced by <a class="el" href="chan__agent_8c-source.html#l01763">__login_exec()</a>, <a class="el" href="res__features_8c-source.html#l02163">action_bridge()</a>, <a class="el" href="chan__agent_8c-source.html#l00622">agent_call()</a>, <a class="el" href="app__followme_8c-source.html#l00909">app_exec()</a>, <a class="el" href="app_8c-source.html#l00479">ast_play_and_wait()</a>, <a class="el" href="say_8c-source.html#l02864">ast_say_date_da()</a>, <a class="el" href="say_8c-source.html#l02912">ast_say_date_de()</a>, <a class="el" href="say_8c-source.html#l02836">ast_say_date_en()</a>, <a class="el" href="say_8c-source.html#l02992">ast_say_date_fr()</a>, <a class="el" href="say_8c-source.html#l06996">ast_say_date_ge()</a>, <a class="el" href="say_8c-source.html#l06454">ast_say_date_gr()</a>, <a class="el" href="say_8c-source.html#l02961">ast_say_date_hu()</a>, <a class="el" href="say_8c-source.html#l03020">ast_say_date_nl()</a>, <a class="el" href="say_8c-source.html#l06575">ast_say_date_with_format_gr()</a>, <a class="el" href="say_8c-source.html#l05891">ast_say_datetime_en()</a>, <a class="el" href="say_8c-source.html#l05981">ast_say_datetime_fr()</a>, <a class="el" href="say_8c-source.html#l06188">ast_say_datetime_from_now_en()</a>, <a class="el" href="say_8c-source.html#l06228">ast_say_datetime_from_now_fr()</a>, <a class="el" href="say_8c-source.html#l07081">ast_say_datetime_from_now_ge()</a>, <a class="el" href="say_8c-source.html#l06544">ast_say_datetime_gr()</a>, <a class="el" href="say_8c-source.html#l06020">ast_say_datetime_nl()</a>, <a class="el" href="say_8c-source.html#l06037">ast_say_datetime_pt()</a>, <a class="el" href="say_8c-source.html#l06114">ast_say_datetime_tw()</a>, <a class="el" href="say_8c-source.html#l02482">ast_say_enumeration_full_da()</a>, <a class="el" href="say_8c-source.html#l02646">ast_say_enumeration_full_de()</a>, <a class="el" href="say_8c-source.html#l02383">ast_say_enumeration_full_en()</a>, <a class="el" href="say_8c-source.html#l00548">ast_say_number_full_cz()</a>, <a class="el" href="say_8c-source.html#l00646">ast_say_number_full_da()</a>, <a class="el" href="say_8c-source.html#l00760">ast_say_number_full_de()</a>, <a class="el" href="say_8c-source.html#l00454">ast_say_number_full_en()</a>, <a class="el" href="say_8c-source.html#l00896">ast_say_number_full_en_GB()</a>, <a class="el" href="say_8c-source.html#l00975">ast_say_number_full_es()</a>, <a class="el" href="say_8c-source.html#l01080">ast_say_number_full_fr()</a>, <a class="el" href="say_8c-source.html#l06919">ast_say_number_full_ge()</a>, <a class="el" href="say_8c-source.html#l06372">ast_say_number_full_gr()</a>, <a class="el" href="say_8c-source.html#l01214">ast_say_number_full_he()</a>, <a class="el" href="say_8c-source.html#l01322">ast_say_number_full_hu()</a>, <a class="el" href="say_8c-source.html#l01399">ast_say_number_full_it()</a>, <a class="el" href="say_8c-source.html#l01555">ast_say_number_full_nl()</a>, <a class="el" href="say_8c-source.html#l01634">ast_say_number_full_no()</a>, <a class="el" href="say_8c-source.html#l02023">ast_say_number_full_pt()</a>, <a class="el" href="say_8c-source.html#l02285">ast_say_number_full_ru()</a>, <a class="el" href="say_8c-source.html#l02119">ast_say_number_full_se()</a>, <a class="el" href="say_8c-source.html#l02192">ast_say_number_full_tw()</a>, <a class="el" href="say_8c-source.html#l05694">ast_say_time_de()</a>, <a class="el" href="say_8c-source.html#l05647">ast_say_time_en()</a>, <a class="el" href="say_8c-source.html#l07035">ast_say_time_ge()</a>, <a class="el" href="say_8c-source.html#l06497">ast_say_time_gr()</a>, <a class="el" href="say_8c-source.html#l05712">ast_say_time_hu()</a>, <a class="el" href="say_8c-source.html#l05750">ast_say_time_nl()</a>, <a class="el" href="say_8c-source.html#l05823">ast_say_time_tw()</a>, <a class="el" href="file_8c-source.html#l01116">ast_stream_and_wait()</a>, <a class="el" href="app__authenticate_8c-source.html#l00094">auth_exec()</a>, <a class="el" href="app__queue_8c-source.html#l01855">background_file()</a>, <a class="el" href="res__features_8c-source.html#l02716">bridge_exec()</a>, <a class="el" href="chan__agent_8c-source.html#l01153">check_availability()</a>, <a class="el" href="chan__agent_8c-source.html#l01227">check_beep()</a>, <a class="el" href="app__chanspy_8c-source.html#l00465">common_exec()</a>, <a class="el" href="app__meetme_8c-source.html#l02485">conf_exec()</a>, <a class="el" href="app__meetme_8c-source.html#l01350">conf_run()</a>, <a class="el" href="app__dial_8c-source.html#l01184">dial_exec_full()</a>, <a class="el" href="app__directory_8c-source.html#l00570">directory_exec()</a>, <a class="el" href="say_8c-source.html#l06326">gr_say_number_female()</a>, <a class="el" href="res__agi_8c-source.html#l00889">handle_recordfile()</a>, <a class="el" href="app__minivm_8c-source.html#l01205">invent_message()</a>, <a class="el" href="app__minivm_8c-source.html#l01501">leave_voicemail()</a>, <a class="el" href="app__minivm_8c-source.html#l01818">minivm_greet_exec()</a>, <a class="el" href="app__page_8c-source.html#l00085">page_exec()</a>, <a class="el" href="pbx_8c-source.html#l05642">pbx_builtin_background()</a>, <a class="el" href="say_8c-source.html#l01753">pl_odtworz_plik()</a>, <a class="el" href="app__dictate_8c-source.html#l00070">play_and_wait()</a>, <a class="el" href="app__queue_8c-source.html#l01307">play_file()</a>, <a class="el" href="app__minivm_8c-source.html#l01278">play_record_review()</a>, <a class="el" href="app__playback_8c-source.html#l00378">playback_exec()</a>, <a class="el" href="app__privacy_8c-source.html#l00078">privacy_exec()</a>, <a class="el" href="app__record_8c-source.html#l00078">record_exec()</a>, <a class="el" href="app__dial_8c-source.html#l01747">retrydial_exec()</a>, <a class="el" href="app__playback_8c-source.html#l00129">s_streamwait3()</a>, <a class="el" href="app__rpt_8c-source.html#l01686">saycharstr()</a>, <a class="el" href="app__rpt_8c-source.html#l01711">saydigits()</a>, <a class="el" href="app__rpt_8c-source.html#l01673">sayfile()</a>, <a class="el" href="app__rpt_8c-source.html#l01699">saynum()</a>, <a class="el" href="app__rpt_8c-source.html#l01461">send_morse()</a>, <a class="el" href="app__rpt_8c-source.html#l01622">send_tone_telemetry()</a>, <a class="el" href="chan__zap_8c-source.html#l05744">ss_thread()</a>, <a class="el" href="app__voicemail_8c-source.html#l06295">vm_authenticate()</a>, and <a class="el" href="say_8c-source.html#l00394">wait_file()</a>.<div class="fragment"><pre class="fragment"><a name="l01090"></a>01090 {
<a name="l01091"></a>01091    <span class="keywordflow">return</span> <a class="code" href="file_8c.html#b3bff587a0c584b73ef7131678e97f3e">waitstream_core</a>(c, breakon, NULL, NULL, 0, -1, -1, NULL);
<a name="l01092"></a>01092 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="24c25c9a9f196587f0ad5f466c059d22"></a><!-- doxytag: member="file.h::ast_waitstream_exten" ref="24c25c9a9f196587f0ad5f466c059d22" args="(struct ast_channel *c, const char *context)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_waitstream_exten           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>context</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>channel to waitstream on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>context</em>&nbsp;</td><td>string of context to match digits to break upon Begins playback of a stream... Wait for a stream to stop or for any one of a valid extension digit to arrive, Returns 0 if the stream finishes, the character if it was interrupted, and -1 on error </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l01100">1100</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="channel_8h-source.html#l00441">ast_channel::context</a>, and <a class="el" href="file_8c-source.html#l00983">waitstream_core()</a>.
<p>
Referenced by <a class="el" href="pbx_8c-source.html#l05642">pbx_builtin_background()</a>.<div class="fragment"><pre class="fragment"><a name="l01101"></a>01101 {
<a name="l01102"></a>01102    <span class="comment">/* Waitstream, with return in the case of a valid 1 digit extension */</span>
<a name="l01103"></a>01103    <span class="comment">/* in the current or specified context being pressed */</span>
<a name="l01104"></a>01104 
<a name="l01105"></a>01105    <span class="keywordflow">if</span> (!<a class="code" href="chan__alsa_8c.html#c1ae8ba118483c4c23841d72b5e7ebbb">context</a>)
<a name="l01106"></a>01106       <a class="code" href="chan__alsa_8c.html#c1ae8ba118483c4c23841d72b5e7ebbb">context</a> = c-&gt;<a class="code" href="structast__channel.html#c1ae8ba118483c4c23841d72b5e7ebbb">context</a>;
<a name="l01107"></a>01107    <span class="keywordflow">return</span> <a class="code" href="file_8c.html#b3bff587a0c584b73ef7131678e97f3e">waitstream_core</a>(c, NULL, NULL, NULL, 0,
<a name="l01108"></a>01108       -1, -1, <a class="code" href="chan__alsa_8c.html#c1ae8ba118483c4c23841d72b5e7ebbb">context</a>);
<a name="l01109"></a>01109 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="0db2bacb7cd7648486a6eb2b679d64db"></a><!-- doxytag: member="file.h::ast_waitstream_fr" ref="0db2bacb7cd7648486a6eb2b679d64db" args="(struct ast_channel *c, const char *breakon, const char *forward, const char *rewind, int ms)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_waitstream_fr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>breakon</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>forward</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>rewind</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>ms</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>channel to waitstream on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>breakon</em>&nbsp;</td><td>string of DTMF digits to break upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>forward</em>&nbsp;</td><td>DTMF digit to fast forward upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rewind</em>&nbsp;</td><td>DTMF digit to rewind upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ms</em>&nbsp;</td><td>How many miliseconds to skip forward/back Begins playback of a stream... Wait for a stream to stop or for any one of a given digit to arrive, Returns 0 if the stream finishes, the character if it was interrupted, and -1 on error </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l01083">1083</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="file_8c-source.html#l00983">waitstream_core()</a>.
<p>
Referenced by <a class="el" href="app_8c-source.html#l00384">ast_control_streamfile()</a>.<div class="fragment"><pre class="fragment"><a name="l01084"></a>01084 {
<a name="l01085"></a>01085    <span class="keywordflow">return</span> <a class="code" href="file_8c.html#b3bff587a0c584b73ef7131678e97f3e">waitstream_core</a>(c, breakon, forward, rewind, ms,
<a name="l01086"></a>01086       -1 <span class="comment">/* no audiofd */</span>, -1 <span class="comment">/* no cmdfd */</span>, NULL <span class="comment">/* no context */</span>);
<a name="l01087"></a>01087 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="48738f94ec3e73352f212b993090910b"></a><!-- doxytag: member="file.h::ast_waitstream_full" ref="48738f94ec3e73352f212b993090910b" args="(struct ast_channel *c, const char *breakon, int audiofd, int monfd)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_waitstream_full           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>breakon</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>audiofd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>monfd</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="file_8c-source.html#l01094">1094</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="file_8c-source.html#l00983">waitstream_core()</a>.
<p>
Referenced by <a class="el" href="channel_8c-source.html#l03161">ast_readstring_full()</a>, <a class="el" href="say_8c-source.html#l02482">ast_say_enumeration_full_da()</a>, <a class="el" href="say_8c-source.html#l02646">ast_say_enumeration_full_de()</a>, <a class="el" href="say_8c-source.html#l02383">ast_say_enumeration_full_en()</a>, <a class="el" href="say_8c-source.html#l00548">ast_say_number_full_cz()</a>, <a class="el" href="say_8c-source.html#l00646">ast_say_number_full_da()</a>, <a class="el" href="say_8c-source.html#l00760">ast_say_number_full_de()</a>, <a class="el" href="say_8c-source.html#l00454">ast_say_number_full_en()</a>, <a class="el" href="say_8c-source.html#l00896">ast_say_number_full_en_GB()</a>, <a class="el" href="say_8c-source.html#l00975">ast_say_number_full_es()</a>, <a class="el" href="say_8c-source.html#l01080">ast_say_number_full_fr()</a>, <a class="el" href="say_8c-source.html#l06919">ast_say_number_full_ge()</a>, <a class="el" href="say_8c-source.html#l06372">ast_say_number_full_gr()</a>, <a class="el" href="say_8c-source.html#l01214">ast_say_number_full_he()</a>, <a class="el" href="say_8c-source.html#l01322">ast_say_number_full_hu()</a>, <a class="el" href="say_8c-source.html#l01399">ast_say_number_full_it()</a>, <a class="el" href="say_8c-source.html#l01555">ast_say_number_full_nl()</a>, <a class="el" href="say_8c-source.html#l01634">ast_say_number_full_no()</a>, <a class="el" href="say_8c-source.html#l02023">ast_say_number_full_pt()</a>, <a class="el" href="say_8c-source.html#l02285">ast_say_number_full_ru()</a>, <a class="el" href="say_8c-source.html#l02119">ast_say_number_full_se()</a>, <a class="el" href="say_8c-source.html#l02192">ast_say_number_full_tw()</a>, <a class="el" href="res__agi_8c-source.html#l00621">handle_getoption()</a>, <a class="el" href="res__agi_8c-source.html#l00561">handle_streamfile()</a>, <a class="el" href="say_8c-source.html#l01753">pl_odtworz_plik()</a>, <a class="el" href="app__playback_8c-source.html#l00129">s_streamwait3()</a>, <a class="el" href="say_8c-source.html#l00062">say_character_str_full()</a>, <a class="el" href="say_8c-source.html#l00211">say_digit_str_full()</a>, and <a class="el" href="say_8c-source.html#l00137">say_phonetic_str_full()</a>.<div class="fragment"><pre class="fragment"><a name="l01095"></a>01095 {
<a name="l01096"></a>01096    <span class="keywordflow">return</span> <a class="code" href="file_8c.html#b3bff587a0c584b73ef7131678e97f3e">waitstream_core</a>(c, breakon, NULL, NULL, 0,
<a name="l01097"></a>01097       audiofd, cmdfd, NULL <span class="comment">/* no context */</span>);
<a name="l01098"></a>01098 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="863a5fc977919f88d566c68efc408f7a"></a><!-- doxytag: member="file.h::ast_writefile" ref="863a5fc977919f88d566c68efc408f7a" args="(const char *filename, const char *type, const char *comment, int flags, int check, mode_t mode)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__filestream.html">ast_filestream</a>* ast_writefile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>filename</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>comment</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>check</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>mode_t&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>the name of the file to write to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>format of file you wish to write out to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>comment</em>&nbsp;</td><td>comment to go with </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flags</em>&nbsp;</td><td>output file flags </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>check</em>&nbsp;</td><td>(unimplemented, hence negligible) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mode</em>&nbsp;</td><td>Open mode Create an outgoing file stream. oflags are flags for the open() command, and if check is non-zero, then it will not write a file if there are any files that start with that name and have an extension Please note, this is a blocking function. Program execution will not return until ast_waitstream completes it's execution. Returns a struct <a class="el" href="structast__filestream.html">ast_filestream</a> on success, NULL on failure </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l00856">856</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="utils_8h-source.html#l00344">ast_free</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="options_8h-source.html#l00099">ast_opt_cache_record_files</a>, <a class="el" href="linkedlists_8h-source.html#l00060">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00456">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h-source.html#l00115">AST_RWLIST_UNLOCK</a>, <a class="el" href="utils_8h.html#b38bbfc0f090d7e013ad805ff172a7d2">ast_strdupa</a>, <a class="el" href="file_8c-source.html#l00250">build_filename()</a>, <a class="el" href="file_8h-source.html#l00066">ast_format::exts</a>, <a class="el" href="file_8c-source.html#l00267">exts_compare()</a>, <a class="el" href="format__g726_8c-source.html#l00193">f</a>, <a class="el" href="file_8h-source.html#l00122">ast_filestream::filename</a>, <a class="el" href="file_8h-source.html#l00120">ast_filestream::flags</a>, <a class="el" href="file_8h-source.html#l00119">ast_filestream::fmt</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="file_8c-source.html#l00281">get_filestream()</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="file_8h-source.html#l00121">ast_filestream::mode</a>, <a class="el" href="file_8h-source.html#l00123">ast_filestream::realfilename</a>, <a class="el" href="asterisk_8c-source.html#l00175">record_cache_dir</a>, <a class="el" href="file_8c-source.html#l00322">rewrite_wrapper()</a>, <a class="el" href="structast__format.html#1ecca7b8374382e647398ed939b6ab8d">ast_format::seek</a>, <a class="el" href="astmm_8h-source.html#l00075">strdup</a>, <a class="el" href="file_8h-source.html#l00127">ast_filestream::trans</a>, and <a class="el" href="file_8h-source.html#l00125">ast_filestream::vfs</a>.
<p>
Referenced by <a class="el" href="app_8c-source.html#l00509">__ast_play_and_record()</a>, <a class="el" href="res__monitor_8c-source.html#l00127">ast_monitor_start()</a>, <a class="el" href="file_8c-source.html#l00148">ast_writestream()</a>, <a class="el" href="res__convert_8c-source.html#l00057">cli_audio_convert()</a>, <a class="el" href="app__dictate_8c-source.html#l00079">dictate_exec()</a>, <a class="el" href="res__agi_8c-source.html#l00889">handle_recordfile()</a>, <a class="el" href="app__mixmonitor_8c-source.html#l00146">mixmonitor_thread()</a>, <a class="el" href="app__record_8c-source.html#l00078">record_exec()</a>, and <a class="el" href="app__meetme_8c-source.html#l03045">recordthread()</a>.<div class="fragment"><pre class="fragment"><a name="l00857"></a>00857 {
<a name="l00858"></a>00858    <span class="keywordtype">int</span> fd, myflags = 0;
<a name="l00859"></a>00859    <span class="comment">/* compiler claims this variable can be used before initialization... */</span>
<a name="l00860"></a>00860    FILE *bfile = NULL;
<a name="l00861"></a>00861    <span class="keyword">struct </span><a class="code" href="structast__format.html">ast_format</a> *<a class="code" href="format__g726_8c.html#85b9b17a7dd34a3638c560bc9152473b">f</a>;
<a name="l00862"></a>00862    <span class="keyword">struct </span><a class="code" href="structast__filestream.html">ast_filestream</a> *fs = NULL;
<a name="l00863"></a>00863    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#cb7e52b21171fb9a53b498202607f0bd">buf</a> = NULL;
<a name="l00864"></a>00864    size_t size = 0;
<a name="l00865"></a>00865    <span class="keywordtype">int</span> format_found = 0;
<a name="l00866"></a>00866 
<a name="l00867"></a>00867    <a class="code" href="linkedlists_8h.html#23c0c844e5abcb474854867b408e3be8">AST_RWLIST_RDLOCK</a>(&amp;formats);
<a name="l00868"></a>00868 
<a name="l00869"></a>00869    <span class="comment">/* set the O_TRUNC flag if and only if there is no O_APPEND specified */</span>
<a name="l00870"></a>00870    <span class="comment">/* We really can't use O_APPEND as it will break WAV header updates */</span>
<a name="l00871"></a>00871    <span class="keywordflow">if</span> (<a class="code" href="structast__filestream.html#4e5868d676cb634aa75b125a0f741abf">flags</a> &amp; O_APPEND) { 
<a name="l00872"></a>00872       <a class="code" href="structast__filestream.html#4e5868d676cb634aa75b125a0f741abf">flags</a> &amp;= ~O_APPEND;
<a name="l00873"></a>00873    } <span class="keywordflow">else</span> {
<a name="l00874"></a>00874       myflags = O_TRUNC;
<a name="l00875"></a>00875    }
<a name="l00876"></a>00876    
<a name="l00877"></a>00877    myflags |= O_WRONLY | O_CREAT;
<a name="l00878"></a>00878 
<a name="l00879"></a>00879    <span class="comment">/* XXX need to fix this - we should just do the fopen,</span>
<a name="l00880"></a>00880 <span class="comment">    * not open followed by fdopen()</span>
<a name="l00881"></a>00881 <span class="comment">    */</span>
<a name="l00882"></a>00882    <a class="code" href="linkedlists_8h.html#36b8c64a6c62cb77baa726f81dcaa7f5">AST_RWLIST_TRAVERSE</a>(&amp;formats, f, list) {
<a name="l00883"></a>00883       <span class="keywordtype">char</span> *fn, *orig_fn = NULL;
<a name="l00884"></a>00884       <span class="keywordflow">if</span> (fs)
<a name="l00885"></a>00885          <span class="keywordflow">break</span>;
<a name="l00886"></a>00886 
<a name="l00887"></a>00887       <span class="keywordflow">if</span> (!<a class="code" href="file_8c.html#46aa3799ad5f3db1475d2aa5ae38ce66">exts_compare</a>(f-&gt;<a class="code" href="structast__format.html#6d9c71cd7b5d178eff3ceaba74c32897">exts</a>, <a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>))
<a name="l00888"></a>00888          <span class="keywordflow">continue</span>;
<a name="l00889"></a>00889       <span class="keywordflow">else</span>
<a name="l00890"></a>00890          format_found = 1;
<a name="l00891"></a>00891 
<a name="l00892"></a>00892       fn = <a class="code" href="file_8c.html#93f2088ee46454d79eb83cf4c12d4439">build_filename</a>(<a class="code" href="structast__filestream.html#435ed7e9f07f740abf511a62c00eef6e">filename</a>, <a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>);
<a name="l00893"></a>00893       fd = open(fn, <a class="code" href="structast__filestream.html#4e5868d676cb634aa75b125a0f741abf">flags</a> | myflags, <a class="code" href="structast__filestream.html#15d61712450a686a7f365adf4fef581f">mode</a>);
<a name="l00894"></a>00894       <span class="keywordflow">if</span> (fd &gt; -1) {
<a name="l00895"></a>00895          <span class="comment">/* fdopen() the resulting file stream */</span>
<a name="l00896"></a>00896          bfile = fdopen(fd, ((<a class="code" href="structast__filestream.html#4e5868d676cb634aa75b125a0f741abf">flags</a> | myflags) &amp; O_RDWR) ? <span class="stringliteral">"w+"</span> : <span class="stringliteral">"w"</span>);
<a name="l00897"></a>00897          <span class="keywordflow">if</span> (!bfile) {
<a name="l00898"></a>00898             <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Whoa, fdopen failed: %s!\n"</span>, strerror(errno));
<a name="l00899"></a>00899             close(fd);
<a name="l00900"></a>00900             fd = -1;
<a name="l00901"></a>00901          }
<a name="l00902"></a>00902       }
<a name="l00903"></a>00903       
<a name="l00904"></a>00904       <span class="keywordflow">if</span> (<a class="code" href="options_8h.html#1bfe8932f2a0e6ade384658f854f3a4a">ast_opt_cache_record_files</a> &amp;&amp; (fd &gt; -1)) {
<a name="l00905"></a>00905          <span class="keywordtype">char</span> *c;
<a name="l00906"></a>00906 
<a name="l00907"></a>00907          fclose(bfile); <span class="comment">/* this also closes fd */</span>
<a name="l00908"></a>00908          <span class="comment">/*</span>
<a name="l00909"></a>00909 <span class="comment">           We touch orig_fn just as a place-holder so other things (like vmail) see the file is there.</span>
<a name="l00910"></a>00910 <span class="comment">           What we are really doing is writing to record_cache_dir until we are done then we will mv the file into place.</span>
<a name="l00911"></a>00911 <span class="comment">         */</span>
<a name="l00912"></a>00912          orig_fn = <a class="code" href="utils_8h.html#b38bbfc0f090d7e013ad805ff172a7d2">ast_strdupa</a>(fn);
<a name="l00913"></a>00913          <span class="keywordflow">for</span> (c = fn; *c; c++)
<a name="l00914"></a>00914             <span class="keywordflow">if</span> (*c == <span class="charliteral">'/'</span>)
<a name="l00915"></a>00915                *c = <span class="charliteral">'_'</span>;
<a name="l00916"></a>00916 
<a name="l00917"></a>00917          size = strlen(fn) + strlen(<a class="code" href="asterisk_8c.html#6f132d1e4d85b029047386a70c024396">record_cache_dir</a>) + 2;
<a name="l00918"></a>00918          buf = alloca(size);
<a name="l00919"></a>00919          strcpy(buf, <a class="code" href="asterisk_8c.html#6f132d1e4d85b029047386a70c024396">record_cache_dir</a>);
<a name="l00920"></a>00920          strcat(buf, <span class="stringliteral">"/"</span>);
<a name="l00921"></a>00921          strcat(buf, fn);
<a name="l00922"></a>00922          <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(fn);
<a name="l00923"></a>00923          fn = buf;
<a name="l00924"></a>00924          fd = open(fn, <a class="code" href="structast__filestream.html#4e5868d676cb634aa75b125a0f741abf">flags</a> | myflags, <a class="code" href="structast__filestream.html#15d61712450a686a7f365adf4fef581f">mode</a>);
<a name="l00925"></a>00925          <span class="keywordflow">if</span> (fd &gt; -1) {
<a name="l00926"></a>00926             <span class="comment">/* fdopen() the resulting file stream */</span>
<a name="l00927"></a>00927             bfile = fdopen(fd, ((<a class="code" href="structast__filestream.html#4e5868d676cb634aa75b125a0f741abf">flags</a> | myflags) &amp; O_RDWR) ? <span class="stringliteral">"w+"</span> : <span class="stringliteral">"w"</span>);
<a name="l00928"></a>00928             <span class="keywordflow">if</span> (!bfile) {
<a name="l00929"></a>00929                <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Whoa, fdopen failed: %s!\n"</span>, strerror(errno));
<a name="l00930"></a>00930                close(fd);
<a name="l00931"></a>00931                fd = -1;
<a name="l00932"></a>00932             }
<a name="l00933"></a>00933          }
<a name="l00934"></a>00934       }
<a name="l00935"></a>00935       <span class="keywordflow">if</span> (fd &gt; -1) {
<a name="l00936"></a>00936          errno = 0;
<a name="l00937"></a>00937          fs = <a class="code" href="file_8c.html#8b2a601d4c35ad931eb1d5031961d8d7">get_filestream</a>(f, bfile);
<a name="l00938"></a>00938          <span class="keywordflow">if</span> (!fs || <a class="code" href="file_8c.html#5e0e182ed798d78b5951ffb839569c80">rewrite_wrapper</a>(fs, comment)) {
<a name="l00939"></a>00939             <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Unable to rewrite %s\n"</span>, fn);
<a name="l00940"></a>00940             close(fd);
<a name="l00941"></a>00941             <span class="keywordflow">if</span> (orig_fn) {
<a name="l00942"></a>00942                unlink(fn);
<a name="l00943"></a>00943                unlink(orig_fn);
<a name="l00944"></a>00944             }
<a name="l00945"></a>00945             <span class="keywordflow">if</span> (fs)
<a name="l00946"></a>00946                <a class="code" href="utils_8h.html#801d8022c2922d0d4f73ba9e72c93865">ast_free</a>(fs);
<a name="l00947"></a>00947          }
<a name="l00948"></a>00948          fs-&gt;<a class="code" href="structast__filestream.html#4738019ef434f24099319565cd5185e5">trans</a> = NULL;
<a name="l00949"></a>00949          fs-&gt;<a class="code" href="structast__filestream.html#7631454338ff70b1a6b1262f5f36beac">fmt</a> = f;
<a name="l00950"></a>00950          fs-&gt;<a class="code" href="structast__filestream.html#4e5868d676cb634aa75b125a0f741abf">flags</a> = <a class="code" href="structast__filestream.html#4e5868d676cb634aa75b125a0f741abf">flags</a>;
<a name="l00951"></a>00951          fs-&gt;<a class="code" href="structast__filestream.html#15d61712450a686a7f365adf4fef581f">mode</a> = <a class="code" href="structast__filestream.html#15d61712450a686a7f365adf4fef581f">mode</a>;
<a name="l00952"></a>00952          <span class="keywordflow">if</span> (orig_fn) {
<a name="l00953"></a>00953             fs-&gt;<a class="code" href="structast__filestream.html#6964b5d4fdb02bab8cefc323bda1b18c">realfilename</a> = <a class="code" href="astmm_8h.html#17881997a89ddffd239268f0476567d0">strdup</a>(orig_fn);
<a name="l00954"></a>00954             fs-&gt;<a class="code" href="structast__filestream.html#435ed7e9f07f740abf511a62c00eef6e">filename</a> = <a class="code" href="astmm_8h.html#17881997a89ddffd239268f0476567d0">strdup</a>(fn);
<a name="l00955"></a>00955          } <span class="keywordflow">else</span> {
<a name="l00956"></a>00956             fs-&gt;<a class="code" href="structast__filestream.html#6964b5d4fdb02bab8cefc323bda1b18c">realfilename</a> = NULL;
<a name="l00957"></a>00957             fs-&gt;<a class="code" href="structast__filestream.html#435ed7e9f07f740abf511a62c00eef6e">filename</a> = <a class="code" href="astmm_8h.html#17881997a89ddffd239268f0476567d0">strdup</a>(<a class="code" href="structast__filestream.html#435ed7e9f07f740abf511a62c00eef6e">filename</a>);
<a name="l00958"></a>00958          }
<a name="l00959"></a>00959          fs-&gt;<a class="code" href="structast__filestream.html#ab2eb9f5e144510f91fcdbae6fdd4465">vfs</a> = NULL;
<a name="l00960"></a>00960          <span class="comment">/* If truncated, we'll be at the beginning; if not truncated, then append */</span>
<a name="l00961"></a>00961          f-&gt;<a class="code" href="structast__format.html#1ecca7b8374382e647398ed939b6ab8d">seek</a>(fs, 0, SEEK_END);
<a name="l00962"></a>00962       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (errno != EEXIST) {
<a name="l00963"></a>00963          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Unable to open file %s: %s\n"</span>, fn, strerror(errno));
<a name="l00964"></a>00964          <span class="keywordflow">if</span> (orig_fn)
<a name="l00965"></a>00965             unlink(orig_fn);
<a name="l00966"></a>00966       }
<a name="l00967"></a>00967       <span class="comment">/* if buf != NULL then fn is already free and pointing to it */</span>
<a name="l00968"></a>00968       <span class="keywordflow">if</span> (!buf)
<a name="l00969"></a>00969          <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(fn);
<a name="l00970"></a>00970    }
<a name="l00971"></a>00971 
<a name="l00972"></a>00972    <a class="code" href="linkedlists_8h.html#470215c8af4ffcdb09701e5d092a9205">AST_RWLIST_UNLOCK</a>(&amp;formats);
<a name="l00973"></a>00973 
<a name="l00974"></a>00974    <span class="keywordflow">if</span> (!format_found)
<a name="l00975"></a>00975       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(LOG_WARNING, <span class="stringliteral">"No such format '%s'\n"</span>, <a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a>);
<a name="l00976"></a>00976 
<a name="l00977"></a>00977    <span class="keywordflow">return</span> fs;
<a name="l00978"></a>00978 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="89845762896f1b8df8786e386b3a7493"></a><!-- doxytag: member="file.h::ast_writestream" ref="89845762896f1b8df8786e386b3a7493" args="(struct ast_filestream *fs, struct ast_frame *f)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_writestream           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>fs</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>f</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fs</em>&nbsp;</td><td>filestream to write to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>f</em>&nbsp;</td><td>frame to write to the filestream Send a frame to a filestream -- note: does NOT free the frame, call ast_frfree manually Returns 0 on success, -1 on failure. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="file_8c-source.html#l00148">148</a> of file <a class="el" href="file_8c-source.html">file.c</a>.
<p>
References <a class="el" href="frame_8h-source.html#l00247">AST_FORMAT_MAX_AUDIO</a>, <a class="el" href="frame_8h.html#006fc84d03b57b7c7d571d6c0db69f92f3104666df07b461099e43be37983393">AST_FRAME_VIDEO</a>, <a class="el" href="frame_8h.html#006fc84d03b57b7c7d571d6c0db69f9264fc4720a7b3982e2d4bf246fe3d9924">AST_FRAME_VOICE</a>, <a class="el" href="frame_8c-source.html#l00532">ast_getformatname()</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="translate_8c-source.html#l00295">ast_translate()</a>, <a class="el" href="translate_8c-source.html#l00255">ast_translator_build_path()</a>, <a class="el" href="translate_8c-source.html#l00245">ast_translator_free_path()</a>, <a class="el" href="file_8c-source.html#l00856">ast_writefile()</a>, <a class="el" href="file_8c-source.html#l00148">ast_writestream()</a>, <a class="el" href="file_8h-source.html#l00122">ast_filestream::filename</a>, <a class="el" href="file_8h-source.html#l00120">ast_filestream::flags</a>, <a class="el" href="file_8h-source.html#l00119">ast_filestream::fmt</a>, <a class="el" href="file_8h-source.html#l00068">ast_format::format</a>, <a class="el" href="frame_8h-source.html#l00131">ast_frame::frametype</a>, <a class="el" href="file_8h-source.html#l00129">ast_filestream::lastwriteformat</a>, <a class="el" href="logger_8h-source.html#l00094">LOG_DEBUG</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="file_8h-source.html#l00121">ast_filestream::mode</a>, <a class="el" href="file_8h-source.html#l00065">ast_format::name</a>, <a class="el" href="asterisk_8c-source.html#l00164">option_debug</a>, <a class="el" href="frame_8h-source.html#l00133">ast_frame::subclass</a>, <a class="el" href="file_8h-source.html#l00127">ast_filestream::trans</a>, <a class="el" href="rtp_8c-source.html#l01410">type</a>, <a class="el" href="file_8h-source.html#l00125">ast_filestream::vfs</a>, and <a class="el" href="structast__format.html#9c7728d73131f696c66f90b5a06492c9">ast_format::write</a>.
<p>
Referenced by <a class="el" href="app_8c-source.html#l00509">__ast_play_and_record()</a>, <a class="el" href="channel_8c-source.html#l02060">__ast_read()</a>, <a class="el" href="channel_8c-source.html#l02660">ast_write()</a>, <a class="el" href="file_8c-source.html#l00148">ast_writestream()</a>, <a class="el" href="res__convert_8c-source.html#l00057">cli_audio_convert()</a>, <a class="el" href="res__agi_8c-source.html#l00889">handle_recordfile()</a>, <a class="el" href="app__mixmonitor_8c-source.html#l00146">mixmonitor_thread()</a>, <a class="el" href="app__record_8c-source.html#l00078">record_exec()</a>, and <a class="el" href="app__meetme_8c-source.html#l03045">recordthread()</a>.<div class="fragment"><pre class="fragment"><a name="l00149"></a>00149 {
<a name="l00150"></a>00150    <span class="keywordtype">int</span> res = -1;
<a name="l00151"></a>00151    <span class="keywordtype">int</span> alt = 0;
<a name="l00152"></a>00152    <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#9574009b02f8256934a1a25cbac10e1d">frametype</a> == <a class="code" href="frame_8h.html#006fc84d03b57b7c7d571d6c0db69f92f3104666df07b461099e43be37983393">AST_FRAME_VIDEO</a>) {
<a name="l00153"></a>00153       <span class="keywordflow">if</span> (fs-&gt;<a class="code" href="structast__filestream.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>-&gt;<a class="code" href="structast__format.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a> &lt; <a class="code" href="frame_8h.html#165e3a55e2cf1a685ccaab3e4ecab88c">AST_FORMAT_MAX_AUDIO</a>) {
<a name="l00154"></a>00154          <span class="comment">/* This is the audio portion.  Call the video one... */</span>
<a name="l00155"></a>00155          <span class="keywordflow">if</span> (!fs-&gt;<a class="code" href="structast__filestream.html#ab2eb9f5e144510f91fcdbae6fdd4465">vfs</a> &amp;&amp; fs-&gt;<a class="code" href="structast__filestream.html#435ed7e9f07f740abf511a62c00eef6e">filename</a>) {
<a name="l00156"></a>00156             <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="rtp_8c.html#599dcce2998a6b40b1e38e8c6006cb0a">type</a> = <a class="code" href="frame_8c.html#fc9ce4e422290b7bda33cc8685094a97">ast_getformatname</a>(f-&gt;<a class="code" href="structast__frame.html#c00578b472e008b51fd24237785fa428">subclass</a> &amp; ~0x1);
<a name="l00157"></a>00157             fs-&gt;<a class="code" href="structast__filestream.html#ab2eb9f5e144510f91fcdbae6fdd4465">vfs</a> = <a class="code" href="file_8c.html#863a5fc977919f88d566c68efc408f7a">ast_writefile</a>(fs-&gt;<a class="code" href="structast__filestream.html#435ed7e9f07f740abf511a62c00eef6e">filename</a>, type, NULL, fs-&gt;<a class="code" href="structast__filestream.html#4e5868d676cb634aa75b125a0f741abf">flags</a>, 0, fs-&gt;<a class="code" href="structast__filestream.html#15d61712450a686a7f365adf4fef581f">mode</a>);
<a name="l00158"></a>00158             <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a>)
<a name="l00159"></a>00159                <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"Opened video output file\n"</span>);
<a name="l00160"></a>00160          }
<a name="l00161"></a>00161          <span class="keywordflow">if</span> (fs-&gt;<a class="code" href="structast__filestream.html#ab2eb9f5e144510f91fcdbae6fdd4465">vfs</a>)
<a name="l00162"></a>00162             <span class="keywordflow">return</span> <a class="code" href="file_8c.html#89845762896f1b8df8786e386b3a7493">ast_writestream</a>(fs-&gt;<a class="code" href="structast__filestream.html#ab2eb9f5e144510f91fcdbae6fdd4465">vfs</a>, f);
<a name="l00163"></a>00163          <span class="comment">/* else ignore */</span>
<a name="l00164"></a>00164          <span class="keywordflow">return</span> 0;            
<a name="l00165"></a>00165       } <span class="keywordflow">else</span> {
<a name="l00166"></a>00166          <span class="comment">/* Might / might not have mark set */</span>
<a name="l00167"></a>00167          alt = 1;
<a name="l00168"></a>00168       }
<a name="l00169"></a>00169    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#9574009b02f8256934a1a25cbac10e1d">frametype</a> != <a class="code" href="frame_8h.html#006fc84d03b57b7c7d571d6c0db69f9264fc4720a7b3982e2d4bf246fe3d9924">AST_FRAME_VOICE</a>) {
<a name="l00170"></a>00170       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Tried to write non-voice frame\n"</span>);
<a name="l00171"></a>00171       <span class="keywordflow">return</span> -1;
<a name="l00172"></a>00172    }
<a name="l00173"></a>00173    <span class="keywordflow">if</span> (((fs-&gt;<a class="code" href="structast__filestream.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>-&gt;<a class="code" href="structast__format.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a> | alt) &amp; f-&gt;<a class="code" href="structast__frame.html#c00578b472e008b51fd24237785fa428">subclass</a>) == f-&gt;<a class="code" href="structast__frame.html#c00578b472e008b51fd24237785fa428">subclass</a>) {
<a name="l00174"></a>00174       res =  fs-&gt;<a class="code" href="structast__filestream.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>-&gt;<a class="code" href="structast__format.html#9c7728d73131f696c66f90b5a06492c9">write</a>(fs, f);
<a name="l00175"></a>00175       <span class="keywordflow">if</span> (res &lt; 0) 
<a name="l00176"></a>00176          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Natural write failed\n"</span>);
<a name="l00177"></a>00177       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res &gt; 0)
<a name="l00178"></a>00178          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Huh??\n"</span>);
<a name="l00179"></a>00179    } <span class="keywordflow">else</span> {
<a name="l00180"></a>00180       <span class="comment">/* XXX If they try to send us a type of frame that isn't the normal frame, and isn't</span>
<a name="l00181"></a>00181 <span class="comment">             the one we've setup a translator for, we do the "wrong thing" XXX */</span>
<a name="l00182"></a>00182       <span class="keywordflow">if</span> (fs-&gt;<a class="code" href="structast__filestream.html#4738019ef434f24099319565cd5185e5">trans</a> &amp;&amp; f-&gt;<a class="code" href="structast__frame.html#c00578b472e008b51fd24237785fa428">subclass</a> != fs-&gt;<a class="code" href="structast__filestream.html#36ba0a38d9ec42f9efd0400425b83214">lastwriteformat</a>) {
<a name="l00183"></a>00183          <a class="code" href="translate_8c.html#8f7ccc974f6f91b750a59c4353700191">ast_translator_free_path</a>(fs-&gt;<a class="code" href="structast__filestream.html#4738019ef434f24099319565cd5185e5">trans</a>);
<a name="l00184"></a>00184          fs-&gt;<a class="code" href="structast__filestream.html#4738019ef434f24099319565cd5185e5">trans</a> = NULL;
<a name="l00185"></a>00185       }
<a name="l00186"></a>00186       <span class="keywordflow">if</span> (!fs-&gt;<a class="code" href="structast__filestream.html#4738019ef434f24099319565cd5185e5">trans</a>) 
<a name="l00187"></a>00187          fs-&gt;<a class="code" href="structast__filestream.html#4738019ef434f24099319565cd5185e5">trans</a> = <a class="code" href="translate_8c.html#46306313154b293cae4c398153ef6f75">ast_translator_build_path</a>(fs-&gt;<a class="code" href="structast__filestream.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>-&gt;<a class="code" href="structast__format.html#1ddcb92ade31c8fbd370001f9b29a7d9">format</a>, f-&gt;<a class="code" href="structast__frame.html#c00578b472e008b51fd24237785fa428">subclass</a>);
<a name="l00188"></a>00188       <span class="keywordflow">if</span> (!fs-&gt;<a class="code" href="structast__filestream.html#4738019ef434f24099319565cd5185e5">trans</a>)
<a name="l00189"></a>00189          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Unable to translate to format %s, source format %s\n"</span>,
<a name="l00190"></a>00190             fs-&gt;<a class="code" href="structast__filestream.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>-&gt;<a class="code" href="structast__format.html#23d5c5772e05e09c87f6323a95732f89">name</a>, <a class="code" href="frame_8c.html#fc9ce4e422290b7bda33cc8685094a97">ast_getformatname</a>(f-&gt;<a class="code" href="structast__frame.html#c00578b472e008b51fd24237785fa428">subclass</a>));
<a name="l00191"></a>00191       <span class="keywordflow">else</span> {
<a name="l00192"></a>00192          <span class="keyword">struct </span><a class="code" href="structast__frame.html">ast_frame</a> *trf;
<a name="l00193"></a>00193          fs-&gt;<a class="code" href="structast__filestream.html#36ba0a38d9ec42f9efd0400425b83214">lastwriteformat</a> = f-&gt;<a class="code" href="structast__frame.html#c00578b472e008b51fd24237785fa428">subclass</a>;
<a name="l00194"></a>00194          <span class="comment">/* Get the translated frame but don't consume the original in case they're using it on another stream */</span>
<a name="l00195"></a>00195          trf = <a class="code" href="translate_8c.html#4c9e58469c9d65c1da8ecbe9cf52e749">ast_translate</a>(fs-&gt;<a class="code" href="structast__filestream.html#4738019ef434f24099319565cd5185e5">trans</a>, f, 0);
<a name="l00196"></a>00196          <span class="keywordflow">if</span> (trf) {
<a name="l00197"></a>00197             res = fs-&gt;<a class="code" href="structast__filestream.html#7631454338ff70b1a6b1262f5f36beac">fmt</a>-&gt;<a class="code" href="structast__format.html#9c7728d73131f696c66f90b5a06492c9">write</a>(fs, trf);
<a name="l00198"></a>00198             <span class="keywordflow">if</span> (res) 
<a name="l00199"></a>00199                <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Translated frame write failed\n"</span>);
<a name="l00200"></a>00200          } <span class="keywordflow">else</span>
<a name="l00201"></a>00201             res = 0;
<a name="l00202"></a>00202       }
<a name="l00203"></a>00203    }
<a name="l00204"></a>00204    <span class="keywordflow">return</span> res;
<a name="l00205"></a>00205 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu May 24 22:27:29 2007 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.5 </small></address>
</body>
</html>
