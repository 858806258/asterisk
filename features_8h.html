<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (24 May 2007)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Thu May 24 22:27:28 2007</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Finclude_2F.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Finclude_2Fasterisk_2F.html">asterisk</a></div>
<h1>features.h File Reference</h1>Call Parking and Pickup API Includes code and algorithms from the Zapata library. <a href="#_details">More...</a>
<p>

<p>
<a href="features_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__call__feature.html">ast_call_feature</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">main call feature structure  <a href="structast__call__feature.html#_details">More...</a><br></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#824ae0621aa2d0f059ee003b9d0c1984">FEATURE_APP_ARGS_LEN</a>&nbsp;&nbsp;&nbsp;256</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#313bef0c50a1046100eb9d8537d14a9f">FEATURE_APP_LEN</a>&nbsp;&nbsp;&nbsp;64</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#83573695a0ba2e3a1047aa3a06a4229e">FEATURE_EXTEN_LEN</a>&nbsp;&nbsp;&nbsp;32</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#9015c3c18d05709358864ff48e71223c">FEATURE_MAX_LEN</a>&nbsp;&nbsp;&nbsp;11</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#797af9710da9286abcc5f301f2656b07">FEATURE_MOH_LEN</a>&nbsp;&nbsp;&nbsp;80</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#2683fe658a7a4a8441eb3cb2674c1907">FEATURE_SNAME_LEN</a>&nbsp;&nbsp;&nbsp;32</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#61263ca8af831dbacdf11ec96ed61076">ast_bridge_call</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#26c322652770620e64ac90682eb6504c">chan</a>, struct <a class="el" href="structast__channel.html">ast_channel</a> *peer, struct <a class="el" href="structast__bridge__config.html">ast_bridge_config</a> *<a class="el" href="res__indications_8c.html#71d63bae4fa3507f57ae4e35f6de4c63">config</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Bridge a call, optionally allowing redirection.  <a href="#61263ca8af831dbacdf11ec96ed61076"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__call__feature.html">ast_call_feature</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#bce7613c9a8c4b637a579aa8aefba2f4">ast_find_call_feature</a> (const char *<a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">look for a call feature entry by its sname  <a href="#bce7613c9a8c4b637a579aa8aefba2f4"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#b0191433f37b2a33e542c9e4f7ededf9">ast_masq_park_call</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *rchan, struct <a class="el" href="structast__channel.html">ast_channel</a> *host, int timeout, int *extout)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Park a call via a masqueraded channel.  <a href="#b0191433f37b2a33e542c9e4f7ededf9"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#c9d53b3e6972e1cb4fd0153b648e204a">ast_park_call</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#26c322652770620e64ac90682eb6504c">chan</a>, struct <a class="el" href="structast__channel.html">ast_channel</a> *host, int timeout, int *extout)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Park a call and read back parked location.  <a href="#c9d53b3e6972e1cb4fd0153b648e204a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#592f5491321993926462dffa87ba0bab">ast_parking_ext</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Determine system parking extension Returns the call parking extension for drivers that provide special call parking help.  <a href="#592f5491321993926462dffa87ba0bab"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#a8e9ef5e6ec2534444a59331177bed20">ast_pickup_call</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#26c322652770620e64ac90682eb6504c">chan</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Pickup a call.  <a href="#a8e9ef5e6ec2534444a59331177bed20"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#907f86dbd402c7f215ba3047f8c54a94">ast_pickup_ext</a> (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Determine system call pickup extension.  <a href="#907f86dbd402c7f215ba3047f8c54a94"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#eda7b3ca1113877d673e72fdfe2b1649">ast_rdlock_call_features</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#f3669c57747d1ce65a0c6589e03386c0">ast_register_feature</a> (struct <a class="el" href="structast__call__feature.html">ast_call_feature</a> *feature)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">register new feature into feature_set  <a href="#f3669c57747d1ce65a0c6589e03386c0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#4dd763461ee81e87a7924033c30123bb">ast_unlock_call_features</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="features_8h.html#3a56dc06bcdf3fe4cba843356ef33b50">ast_unregister_feature</a> (struct <a class="el" href="structast__call__feature.html">ast_call_feature</a> *feature)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">unregister feature from feature_set  <a href="#3a56dc06bcdf3fe4cba843356ef33b50"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Call Parking and Pickup API Includes code and algorithms from the Zapata library. 
<p>

<p>
Definition in file <a class="el" href="features_8h-source.html">features.h</a>.<hr><h2>Define Documentation</h2>
<a class="anchor" name="824ae0621aa2d0f059ee003b9d0c1984"></a><!-- doxytag: member="features.h::FEATURE_APP_ARGS_LEN" ref="824ae0621aa2d0f059ee003b9d0c1984" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define FEATURE_APP_ARGS_LEN&nbsp;&nbsp;&nbsp;256          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="features_8h-source.html#l00029">29</a> of file <a class="el" href="features_8h-source.html">features.h</a>.
<p>
Referenced by <a class="el" href="res__features_8c-source.html#l02453">load_config()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="313bef0c50a1046100eb9d8537d14a9f"></a><!-- doxytag: member="features.h::FEATURE_APP_LEN" ref="313bef0c50a1046100eb9d8537d14a9f" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define FEATURE_APP_LEN&nbsp;&nbsp;&nbsp;64          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="features_8h-source.html#l00028">28</a> of file <a class="el" href="features_8h-source.html">features.h</a>.
<p>
Referenced by <a class="el" href="res__features_8c-source.html#l02453">load_config()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="83573695a0ba2e3a1047aa3a06a4229e"></a><!-- doxytag: member="features.h::FEATURE_EXTEN_LEN" ref="83573695a0ba2e3a1047aa3a06a4229e" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define FEATURE_EXTEN_LEN&nbsp;&nbsp;&nbsp;32          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="features_8h-source.html#l00031">31</a> of file <a class="el" href="features_8h-source.html">features.h</a>.
<p>
Referenced by <a class="el" href="res__features_8c-source.html#l02453">load_config()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="9015c3c18d05709358864ff48e71223c"></a><!-- doxytag: member="features.h::FEATURE_MAX_LEN" ref="9015c3c18d05709358864ff48e71223c" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define FEATURE_MAX_LEN&nbsp;&nbsp;&nbsp;11          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="features_8h-source.html#l00027">27</a> of file <a class="el" href="features_8h-source.html">features.h</a>.
<p>
Referenced by <a class="el" href="res__features_8c-source.html#l01478">ast_bridge_call()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="797af9710da9286abcc5f301f2656b07"></a><!-- doxytag: member="features.h::FEATURE_MOH_LEN" ref="797af9710da9286abcc5f301f2656b07" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define FEATURE_MOH_LEN&nbsp;&nbsp;&nbsp;80          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="features_8h-source.html#l00032">32</a> of file <a class="el" href="features_8h-source.html">features.h</a>.
<p>
Referenced by <a class="el" href="res__features_8c-source.html#l02453">load_config()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="2683fe658a7a4a8441eb3cb2674c1907"></a><!-- doxytag: member="features.h::FEATURE_SNAME_LEN" ref="2683fe658a7a4a8441eb3cb2674c1907" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define FEATURE_SNAME_LEN&nbsp;&nbsp;&nbsp;32          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="features_8h-source.html#l00030">30</a> of file <a class="el" href="features_8h-source.html">features.h</a>.
<p>
Referenced by <a class="el" href="res__features_8c-source.html#l02453">load_config()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="61263ca8af831dbacdf11ec96ed61076"></a><!-- doxytag: member="features.h::ast_bridge_call" ref="61263ca8af831dbacdf11ec96ed61076" args="(struct ast_channel *chan, struct ast_channel *peer, struct ast_bridge_config *config)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_bridge_call           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>peer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct <a class="el" href="structast__bridge__config.html">ast_bridge_config</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>config</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Bridge a call, optionally allowing redirection. 
<p>
append the event to featurecode. we rely on the string being zero-filled, and not overflowing it. <dl compact><dt><b><a class="el" href="todo.html#_todo000036">Todo:</a></b></dt><dd>XXX how do we guarantee the latter ? </dd></dl>

<p>
Definition at line <a class="el" href="res__features_8c-source.html#l01478">1478</a> of file <a class="el" href="res__features_8c-source.html">res_features.c</a>.
<p>
References <a class="el" href="channel_8h-source.html#l00421">ast_channel::appl</a>, <a class="el" href="channel_8c-source.html#l01724">ast_answer()</a>, <a class="el" href="cdr_8c-source.html#l00871">ast_cdr_appenduserfield()</a>, <a class="el" href="cdr_8c-source.html#l00859">ast_cdr_setuserfield()</a>, <a class="el" href="channel_8c-source.html#l03953">ast_channel_bridge()</a>, <a class="el" href="channel_8c-source.html#l04206">ast_channel_setoption()</a>, <a class="el" href="utils_8h-source.html#l00081">ast_clear_flag</a>, <a class="el" href="frame_8h.html#2d127e187c7a98c4396c337f2d76f3898c0ff5febeb7ff9d8880e2bc7f1d6ca1">AST_CONTROL_BUSY</a>, <a class="el" href="frame_8h.html#2d127e187c7a98c4396c337f2d76f389fafe5e503d0d74218854b57e66282419">AST_CONTROL_CONGESTION</a>, <a class="el" href="frame_8h.html#2d127e187c7a98c4396c337f2d76f3899da5863316de5e07e562d773bb39e94a">AST_CONTROL_FLASH</a>, <a class="el" href="frame_8h.html#2d127e187c7a98c4396c337f2d76f3896a1de835fbf024ef925569eb775de67f">AST_CONTROL_HANGUP</a>, <a class="el" href="frame_8h.html#2d127e187c7a98c4396c337f2d76f389e18699f69d7f0d792d74b5a50732765f">AST_CONTROL_OPTION</a>, <a class="el" href="frame_8h.html#2d127e187c7a98c4396c337f2d76f3895749da867c771f2391b19ce9e08f0149">AST_CONTROL_RINGING</a>, <a class="el" href="app_8c-source.html#l00236">ast_dtmf_stream()</a>, <a class="el" href="res__features_8c-source.html#l01194">ast_feature_interpret()</a>, <a class="el" href="channel_8h.html#02653d87b6fa8554fc0d1a3726fea2d04040ce118987e724063d0b58eafd9b4f">AST_FEATURE_PLAY_WARNING</a>, <a class="el" href="frame_8h.html#006fc84d03b57b7c7d571d6c0db69f92d7fbcef5adafabe47c2e42258e4f019e">AST_FRAME_CONTROL</a>, <a class="el" href="frame_8h-source.html#l00125">AST_FRAME_DTMF</a>, <a class="el" href="frame_8h.html#006fc84d03b57b7c7d571d6c0db69f923c709a87ba681b04d6a6285d6d0af892">AST_FRAME_DTMF_BEGIN</a>, <a class="el" href="frame_8h-source.html#l00396">ast_frfree()</a>, <a class="el" href="channel_8c-source.html#l02448">ast_indicate()</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="frame_8h-source.html#l00298">AST_OPTION_FLAG_REQUEST</a>, <a class="el" href="utils_8h.html#b38bbfc0f090d7e013ad805ff172a7d2">ast_strdupa</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="channel_8h-source.html#l00451">ast_channel::cdr</a>, <a class="el" href="channel_8h-source.html#l00422">ast_channel::data</a>, <a class="el" href="frame_8h-source.html#l00147">ast_frame::data</a>, <a class="el" href="frame_8h-source.html#l00358">ast_option_header::data</a>, <a class="el" href="frame_8h-source.html#l00135">ast_frame::datalen</a>, <a class="el" href="channel_8h-source.html#l00564">ast_bridge_config::end_sound</a>, <a class="el" href="format__g726_8c-source.html#l00193">f</a>, <a class="el" href="features_8h-source.html#l00027">FEATURE_MAX_LEN</a>, <a class="el" href="res__features_8c-source.html#l00506">FEATURE_RETURN_PASSDIGITS</a>, <a class="el" href="res__features_8c-source.html#l00508">FEATURE_RETURN_SUCCESS</a>, <a class="el" href="res__features_8c-source.html#l00510">FEATURE_SENSE_CHAN</a>, <a class="el" href="res__features_8c-source.html#l00511">FEATURE_SENSE_PEER</a>, <a class="el" href="channel_8h-source.html#l00559">ast_bridge_config::feature_timer</a>, <a class="el" href="app__followme_8c-source.html#l00153">featuredigittimeout</a>, <a class="el" href="channel_8h-source.html#l00557">ast_bridge_config::features_callee</a>, <a class="el" href="channel_8h-source.html#l00556">ast_bridge_config::features_caller</a>, <a class="el" href="channel_8h-source.html#l00566">ast_bridge_config::firstpass</a>, <a class="el" href="frame_8h-source.html#l00348">ast_option_header::flag</a>, <a class="el" href="frame_8h-source.html#l00131">ast_frame::frametype</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="logger_8h-source.html#l00094">LOG_DEBUG</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="res__features_8c-source.html#l00141">monitor_ok</a>, <a class="el" href="frame_8h-source.html#l00349">ast_option_header::option</a>, <a class="el" href="asterisk_8c-source.html#l00164">option_debug</a>, <a class="el" href="pbx_8c-source.html#l05762">pbx_builtin_getvar_helper()</a>, <a class="el" href="pbx_8c-source.html#l05821">pbx_builtin_setvar_helper()</a>, <a class="el" href="pbx_8c-source.html#l00509">pbx_exec()</a>, <a class="el" href="pbx_8c-source.html#l00547">pbx_findapp()</a>, <a class="el" href="channel_8h-source.html#l00561">ast_bridge_config::play_warning</a>, <a class="el" href="res__features_8c-source.html#l01252">set_config_flags()</a>, <a class="el" href="channel_8h-source.html#l00565">ast_bridge_config::start_sound</a>, <a class="el" href="channel_8h-source.html#l00558">ast_bridge_config::start_time</a>, <a class="el" href="frame_8h-source.html#l00133">ast_frame::subclass</a>, <a class="el" href="cdr_8h-source.html#l00090">ast_cdr::userfield</a>, <a class="el" href="channel_8h-source.html#l00562">ast_bridge_config::warning_freq</a>, and <a class="el" href="channel_8h-source.html#l00563">ast_bridge_config::warning_sound</a>.
<p>
Referenced by <a class="el" href="app__followme_8c-source.html#l00909">app_exec()</a>, <a class="el" href="res__features_8c-source.html#l00231">ast_bridge_call_thread()</a>, <a class="el" href="res__features_8c-source.html#l02716">bridge_exec()</a>, <a class="el" href="res__features_8c-source.html#l00776">builtin_atxfer()</a>, <a class="el" href="app__dial_8c-source.html#l01184">dial_exec_full()</a>, and <a class="el" href="app__queue_8c-source.html#l02421">try_calling()</a>.<div class="fragment"><pre class="fragment"><a name="l01479"></a>01479 {
<a name="l01480"></a>01480    <span class="comment">/* Copy voice back and forth between the two channels.  Give the peer</span>
<a name="l01481"></a>01481 <span class="comment">      the ability to transfer calls with '#&lt;extension' syntax. */</span>
<a name="l01482"></a>01482    <span class="keyword">struct </span><a class="code" href="structast__frame.html">ast_frame</a> *<a class="code" href="format__g726_8c.html#85b9b17a7dd34a3638c560bc9152473b">f</a>;
<a name="l01483"></a>01483    <span class="keyword">struct </span><a class="code" href="structast__channel.html">ast_channel</a> *who;
<a name="l01484"></a>01484    <span class="keywordtype">char</span> chan_featurecode[<a class="code" href="features_8h.html#9015c3c18d05709358864ff48e71223c">FEATURE_MAX_LEN</a> + 1]=<span class="stringliteral">""</span>;
<a name="l01485"></a>01485    <span class="keywordtype">char</span> peer_featurecode[<a class="code" href="features_8h.html#9015c3c18d05709358864ff48e71223c">FEATURE_MAX_LEN</a> + 1]=<span class="stringliteral">""</span>;
<a name="l01486"></a>01486    <span class="keywordtype">int</span> res;
<a name="l01487"></a>01487    <span class="keywordtype">int</span> diff;
<a name="l01488"></a>01488    <span class="keywordtype">int</span> hasfeatures=0;
<a name="l01489"></a>01489    <span class="keywordtype">int</span> hadfeatures=0;
<a name="l01490"></a>01490    <span class="keyword">struct </span><a class="code" href="structast__option__header.html">ast_option_header</a> *aoh;
<a name="l01491"></a>01491    <span class="keyword">struct </span><a class="code" href="structast__bridge__config.html">ast_bridge_config</a> backup_config;
<a name="l01492"></a>01492    <span class="keyword">struct </span><a class="code" href="structast__cdr.html">ast_cdr</a> *bridge_cdr;
<a name="l01493"></a>01493 
<a name="l01494"></a>01494    memset(&amp;backup_config, 0, <span class="keyword">sizeof</span>(backup_config));
<a name="l01495"></a>01495 
<a name="l01496"></a>01496    config-&gt;<a class="code" href="structast__bridge__config.html#c4d98dbd5badae901761ab6422fa3e70">start_time</a> = ast_tvnow();
<a name="l01497"></a>01497 
<a name="l01498"></a>01498    <span class="keywordflow">if</span> (chan &amp;&amp; peer) {
<a name="l01499"></a>01499       <a class="code" href="pbx_8c.html#64407c916a2de6ae3f0efeca471c1b1d">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">"BRIDGEPEER"</span>, peer-&gt;name);
<a name="l01500"></a>01500       <a class="code" href="pbx_8c.html#64407c916a2de6ae3f0efeca471c1b1d">pbx_builtin_setvar_helper</a>(peer, <span class="stringliteral">"BRIDGEPEER"</span>, chan-&gt;name);
<a name="l01501"></a>01501    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (chan)
<a name="l01502"></a>01502       <a class="code" href="pbx_8c.html#64407c916a2de6ae3f0efeca471c1b1d">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">"BLINDTRANSFER"</span>, NULL);
<a name="l01503"></a>01503 
<a name="l01504"></a>01504    <span class="keywordflow">if</span> (<a class="code" href="res__features_8c.html#a1f02527220665b8b661a7c62b1ae67c">monitor_ok</a>) {
<a name="l01505"></a>01505       <span class="keyword">const</span> <span class="keywordtype">char</span> *monitor_exec;
<a name="l01506"></a>01506       <span class="keyword">struct </span><a class="code" href="structast__channel.html">ast_channel</a> *src = NULL;
<a name="l01507"></a>01507       <span class="keywordflow">if</span> (!<a class="code" href="res__features_8c.html#efaecc331c9dfbb44692cc61faeeeb73">monitor_app</a>) { 
<a name="l01508"></a>01508          <span class="keywordflow">if</span> (!(<a class="code" href="res__features_8c.html#efaecc331c9dfbb44692cc61faeeeb73">monitor_app</a> = <a class="code" href="pbx_8c.html#d407cf204ec8fc50e5a578c8c17e0cb5">pbx_findapp</a>(<span class="stringliteral">"Monitor"</span>)))
<a name="l01509"></a>01509             <a class="code" href="res__features_8c.html#a1f02527220665b8b661a7c62b1ae67c">monitor_ok</a>=0;
<a name="l01510"></a>01510       }
<a name="l01511"></a>01511       <span class="keywordflow">if</span> ((monitor_exec = <a class="code" href="pbx_8c.html#944d18aa90701f025b30e63d9644e448">pbx_builtin_getvar_helper</a>(chan, <span class="stringliteral">"AUTO_MONITOR"</span>))) 
<a name="l01512"></a>01512          src = chan;
<a name="l01513"></a>01513       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((monitor_exec = <a class="code" href="pbx_8c.html#944d18aa90701f025b30e63d9644e448">pbx_builtin_getvar_helper</a>(peer, <span class="stringliteral">"AUTO_MONITOR"</span>)))
<a name="l01514"></a>01514          src = peer;
<a name="l01515"></a>01515       <span class="keywordflow">if</span> (<a class="code" href="res__features_8c.html#efaecc331c9dfbb44692cc61faeeeb73">monitor_app</a> &amp;&amp; src) {
<a name="l01516"></a>01516          <span class="keywordtype">char</span> *tmp = <a class="code" href="utils_8h.html#b38bbfc0f090d7e013ad805ff172a7d2">ast_strdupa</a>(monitor_exec);
<a name="l01517"></a>01517          <a class="code" href="pbx_8c.html#5970fbcb6a776848d11bf1c8ddb1c948">pbx_exec</a>(src, <a class="code" href="res__features_8c.html#efaecc331c9dfbb44692cc61faeeeb73">monitor_app</a>, tmp);
<a name="l01518"></a>01518       }
<a name="l01519"></a>01519    }
<a name="l01520"></a>01520    
<a name="l01521"></a>01521    <a class="code" href="res__features_8c.html#14bc492d1716a87183526f58266a6a37">set_config_flags</a>(chan, peer, config);
<a name="l01522"></a>01522    config-&gt;<a class="code" href="structast__bridge__config.html#b9313589eca257aaed154d3517ab7f0f">firstpass</a> = 1;
<a name="l01523"></a>01523 
<a name="l01524"></a>01524    <span class="comment">/* Answer if need be */</span>
<a name="l01525"></a>01525    <span class="keywordflow">if</span> (<a class="code" href="channel_8c.html#9e089c979b071a1df466a09497fdfa31">ast_answer</a>(chan))
<a name="l01526"></a>01526       <span class="keywordflow">return</span> -1;
<a name="l01527"></a>01527    peer-&gt;<a class="code" href="structast__channel.html#63469c3c4f19f07c737127a117296de4">appl</a> = <span class="stringliteral">"Bridged Call"</span>;
<a name="l01528"></a>01528    peer-&gt;<a class="code" href="structast__channel.html#8d777f385d3dfec8815d20f7496026dc">data</a> = chan-&gt;name;
<a name="l01529"></a>01529 
<a name="l01530"></a>01530    <span class="comment">/* copy the userfield from the B-leg to A-leg if applicable */</span>
<a name="l01531"></a>01531    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a> &amp;&amp; peer-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a> &amp;&amp; !<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(peer-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a>-&gt;<a class="code" href="structast__cdr.html#07c0f6b6a5bf53c1c68383f1f0c9398e">userfield</a>)) {
<a name="l01532"></a>01532       <span class="keywordtype">char</span> tmp[256];
<a name="l01533"></a>01533       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(chan-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a>-&gt;<a class="code" href="structast__cdr.html#07c0f6b6a5bf53c1c68383f1f0c9398e">userfield</a>)) {
<a name="l01534"></a>01534          snprintf(tmp, <span class="keyword">sizeof</span>(tmp), <span class="stringliteral">"%s;%s"</span>, chan-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a>-&gt;<a class="code" href="structast__cdr.html#07c0f6b6a5bf53c1c68383f1f0c9398e">userfield</a>, peer-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a>-&gt;<a class="code" href="structast__cdr.html#07c0f6b6a5bf53c1c68383f1f0c9398e">userfield</a>);
<a name="l01535"></a>01535          <a class="code" href="cdr_8c.html#4ba69b96a8d7733c5e70a5555e94306f">ast_cdr_appenduserfield</a>(chan, tmp);
<a name="l01536"></a>01536       } <span class="keywordflow">else</span>
<a name="l01537"></a>01537          <a class="code" href="cdr_8c.html#7faf485af47fef9299ce51da70c13c8b">ast_cdr_setuserfield</a>(chan, peer-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a>-&gt;<a class="code" href="structast__cdr.html#07c0f6b6a5bf53c1c68383f1f0c9398e">userfield</a>);
<a name="l01538"></a>01538       <span class="comment">/* free the peer's cdr without ast_cdr_free complaining */</span>
<a name="l01539"></a>01539       <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(peer-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a>);
<a name="l01540"></a>01540       peer-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a> = NULL;
<a name="l01541"></a>01541    }
<a name="l01542"></a>01542 
<a name="l01543"></a>01543    <span class="keywordflow">for</span> (;;) {
<a name="l01544"></a>01544       <span class="keyword">struct </span><a class="code" href="structast__channel.html">ast_channel</a> *other; <span class="comment">/* used later */</span>
<a name="l01545"></a>01545 
<a name="l01546"></a>01546       res = <a class="code" href="channel_8c.html#63ab4d8e95fedaabf03d0f492368e930">ast_channel_bridge</a>(chan, peer, config, &amp;f, &amp;who);
<a name="l01547"></a>01547 
<a name="l01548"></a>01548       <span class="keywordflow">if</span> (config-&gt;<a class="code" href="structast__bridge__config.html#dfe9693aa0a7a7c3ac9558a7fc78338f">feature_timer</a>) {
<a name="l01549"></a>01549          <span class="comment">/* Update time limit for next pass */</span>
<a name="l01550"></a>01550          diff = ast_tvdiff_ms(ast_tvnow(), config-&gt;<a class="code" href="structast__bridge__config.html#c4d98dbd5badae901761ab6422fa3e70">start_time</a>);
<a name="l01551"></a>01551          config-&gt;<a class="code" href="structast__bridge__config.html#dfe9693aa0a7a7c3ac9558a7fc78338f">feature_timer</a> -= diff;
<a name="l01552"></a>01552          <span class="keywordflow">if</span> (hasfeatures) {
<a name="l01553"></a>01553             <span class="comment">/* Running on backup config, meaning a feature might be being</span>
<a name="l01554"></a>01554 <span class="comment">               activated, but that's no excuse to keep things going </span>
<a name="l01555"></a>01555 <span class="comment">               indefinitely! */</span>
<a name="l01556"></a>01556             <span class="keywordflow">if</span> (backup_config.<a class="code" href="structast__bridge__config.html#dfe9693aa0a7a7c3ac9558a7fc78338f">feature_timer</a> &amp;&amp; ((backup_config.<a class="code" href="structast__bridge__config.html#dfe9693aa0a7a7c3ac9558a7fc78338f">feature_timer</a> -= diff) &lt;= 0)) {
<a name="l01557"></a>01557                <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a>)
<a name="l01558"></a>01558                   <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"Timed out, realtime this time!\n"</span>);
<a name="l01559"></a>01559                config-&gt;<a class="code" href="structast__bridge__config.html#dfe9693aa0a7a7c3ac9558a7fc78338f">feature_timer</a> = 0;
<a name="l01560"></a>01560                who = chan;
<a name="l01561"></a>01561                <span class="keywordflow">if</span> (f)
<a name="l01562"></a>01562                   <a class="code" href="frame_8h.html#506c759ec4950e7f7465e8f090a6252b">ast_frfree</a>(f);
<a name="l01563"></a>01563                f = NULL;
<a name="l01564"></a>01564                res = 0;
<a name="l01565"></a>01565             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (config-&gt;<a class="code" href="structast__bridge__config.html#dfe9693aa0a7a7c3ac9558a7fc78338f">feature_timer</a> &lt;= 0) {
<a name="l01566"></a>01566                <span class="comment">/* Not *really* out of time, just out of time for</span>
<a name="l01567"></a>01567 <span class="comment">                  digits to come in for features. */</span>
<a name="l01568"></a>01568                <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a>)
<a name="l01569"></a>01569                   <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"Timed out for feature!\n"</span>);
<a name="l01570"></a>01570                <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(peer_featurecode)) {
<a name="l01571"></a>01571                   <a class="code" href="app_8c.html#8199b7508395e37a031a6b4ff2ebe0a7">ast_dtmf_stream</a>(chan, peer, peer_featurecode, 0);
<a name="l01572"></a>01572                   memset(peer_featurecode, 0, <span class="keyword">sizeof</span>(peer_featurecode));
<a name="l01573"></a>01573                }
<a name="l01574"></a>01574                <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(chan_featurecode)) {
<a name="l01575"></a>01575                   <a class="code" href="app_8c.html#8199b7508395e37a031a6b4ff2ebe0a7">ast_dtmf_stream</a>(peer, chan, chan_featurecode, 0);
<a name="l01576"></a>01576                   memset(chan_featurecode, 0, <span class="keyword">sizeof</span>(chan_featurecode));
<a name="l01577"></a>01577                }
<a name="l01578"></a>01578                <span class="keywordflow">if</span> (f)
<a name="l01579"></a>01579                   <a class="code" href="frame_8h.html#506c759ec4950e7f7465e8f090a6252b">ast_frfree</a>(f);
<a name="l01580"></a>01580                hasfeatures = !<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(chan_featurecode) || !<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(peer_featurecode);
<a name="l01581"></a>01581                <span class="keywordflow">if</span> (!hasfeatures) {
<a name="l01582"></a>01582                   <span class="comment">/* Restore original (possibly time modified) bridge config */</span>
<a name="l01583"></a>01583                   memcpy(config, &amp;backup_config, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__bridge__config.html">ast_bridge_config</a>));
<a name="l01584"></a>01584                   memset(&amp;backup_config, 0, <span class="keyword">sizeof</span>(backup_config));
<a name="l01585"></a>01585                }
<a name="l01586"></a>01586                hadfeatures = hasfeatures;
<a name="l01587"></a>01587                <span class="comment">/* Continue as we were */</span>
<a name="l01588"></a>01588                <span class="keywordflow">continue</span>;
<a name="l01589"></a>01589             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!f) {
<a name="l01590"></a>01590                <span class="comment">/* The bridge returned without a frame and there is a feature in progress.</span>
<a name="l01591"></a>01591 <span class="comment">                * However, we don't think the feature has quite yet timed out, so just</span>
<a name="l01592"></a>01592 <span class="comment">                * go back into the bridge. */</span>
<a name="l01593"></a>01593                <span class="keywordflow">continue</span>;
<a name="l01594"></a>01594             }
<a name="l01595"></a>01595          } <span class="keywordflow">else</span> {
<a name="l01596"></a>01596             <span class="keywordflow">if</span> (config-&gt;<a class="code" href="structast__bridge__config.html#dfe9693aa0a7a7c3ac9558a7fc78338f">feature_timer</a> &lt;=0) {
<a name="l01597"></a>01597                <span class="comment">/* We ran out of time */</span>
<a name="l01598"></a>01598                config-&gt;<a class="code" href="structast__bridge__config.html#dfe9693aa0a7a7c3ac9558a7fc78338f">feature_timer</a> = 0;
<a name="l01599"></a>01599                who = chan;
<a name="l01600"></a>01600                <span class="keywordflow">if</span> (f)
<a name="l01601"></a>01601                   <a class="code" href="frame_8h.html#506c759ec4950e7f7465e8f090a6252b">ast_frfree</a>(f);
<a name="l01602"></a>01602                f = NULL;
<a name="l01603"></a>01603                res = 0;
<a name="l01604"></a>01604             }
<a name="l01605"></a>01605          }
<a name="l01606"></a>01606       }
<a name="l01607"></a>01607       <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l01608"></a>01608          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Bridge failed on channels %s and %s\n"</span>, chan-&gt;name, peer-&gt;name);
<a name="l01609"></a>01609          <span class="keywordflow">return</span> -1;
<a name="l01610"></a>01610       }
<a name="l01611"></a>01611       
<a name="l01612"></a>01612       <span class="keywordflow">if</span> (!f || (f-&gt;<a class="code" href="structast__frame.html#9574009b02f8256934a1a25cbac10e1d">frametype</a> == <a class="code" href="frame_8h.html#006fc84d03b57b7c7d571d6c0db69f92d7fbcef5adafabe47c2e42258e4f019e">AST_FRAME_CONTROL</a> &amp;&amp;
<a name="l01613"></a>01613             (f-&gt;<a class="code" href="structast__frame.html#c00578b472e008b51fd24237785fa428">subclass</a> == <a class="code" href="frame_8h.html#2d127e187c7a98c4396c337f2d76f3896a1de835fbf024ef925569eb775de67f">AST_CONTROL_HANGUP</a> || f-&gt;<a class="code" href="structast__frame.html#c00578b472e008b51fd24237785fa428">subclass</a> == <a class="code" href="frame_8h.html#2d127e187c7a98c4396c337f2d76f3898c0ff5febeb7ff9d8880e2bc7f1d6ca1">AST_CONTROL_BUSY</a> || 
<a name="l01614"></a>01614                f-&gt;<a class="code" href="structast__frame.html#c00578b472e008b51fd24237785fa428">subclass</a> == <a class="code" href="frame_8h.html#2d127e187c7a98c4396c337f2d76f389fafe5e503d0d74218854b57e66282419">AST_CONTROL_CONGESTION</a>))) {
<a name="l01615"></a>01615          res = -1;
<a name="l01616"></a>01616          <span class="keywordflow">break</span>;
<a name="l01617"></a>01617       }
<a name="l01618"></a>01618       <span class="comment">/* many things should be sent to the 'other' channel */</span>
<a name="l01619"></a>01619       other = (who == chan) ? peer : chan;
<a name="l01620"></a>01620       <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#9574009b02f8256934a1a25cbac10e1d">frametype</a> == <a class="code" href="frame_8h.html#006fc84d03b57b7c7d571d6c0db69f92d7fbcef5adafabe47c2e42258e4f019e">AST_FRAME_CONTROL</a>) {
<a name="l01621"></a>01621          <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#c00578b472e008b51fd24237785fa428">subclass</a> == <a class="code" href="frame_8h.html#2d127e187c7a98c4396c337f2d76f3895749da867c771f2391b19ce9e08f0149">AST_CONTROL_RINGING</a>)
<a name="l01622"></a>01622             <a class="code" href="channel_8c.html#90b88ba4c6f05bc0b655583c899c0269">ast_indicate</a>(other, <a class="code" href="frame_8h.html#2d127e187c7a98c4396c337f2d76f3895749da867c771f2391b19ce9e08f0149">AST_CONTROL_RINGING</a>);
<a name="l01623"></a>01623          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#c00578b472e008b51fd24237785fa428">subclass</a> == -1)
<a name="l01624"></a>01624             <a class="code" href="channel_8c.html#90b88ba4c6f05bc0b655583c899c0269">ast_indicate</a>(other, -1);
<a name="l01625"></a>01625          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#c00578b472e008b51fd24237785fa428">subclass</a> == <a class="code" href="frame_8h.html#2d127e187c7a98c4396c337f2d76f3899da5863316de5e07e562d773bb39e94a">AST_CONTROL_FLASH</a>)
<a name="l01626"></a>01626             <a class="code" href="channel_8c.html#90b88ba4c6f05bc0b655583c899c0269">ast_indicate</a>(other, <a class="code" href="frame_8h.html#2d127e187c7a98c4396c337f2d76f3899da5863316de5e07e562d773bb39e94a">AST_CONTROL_FLASH</a>);
<a name="l01627"></a>01627          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#c00578b472e008b51fd24237785fa428">subclass</a> == <a class="code" href="frame_8h.html#2d127e187c7a98c4396c337f2d76f389e18699f69d7f0d792d74b5a50732765f">AST_CONTROL_OPTION</a>) {
<a name="l01628"></a>01628             aoh = f-&gt;<a class="code" href="structast__frame.html#8d777f385d3dfec8815d20f7496026dc">data</a>;
<a name="l01629"></a>01629             <span class="comment">/* Forward option Requests */</span>
<a name="l01630"></a>01630             <span class="keywordflow">if</span> (aoh &amp;&amp; aoh-&gt;<a class="code" href="structast__option__header.html#327a6c4304ad5938eaf0efb6cc3e53dc">flag</a> == <a class="code" href="frame_8h.html#40fdb73aaab11ca6d798133d215ff1bd">AST_OPTION_FLAG_REQUEST</a>)
<a name="l01631"></a>01631                <a class="code" href="channel_8c.html#fd050188748d1697051e8176fb5fee36">ast_channel_setoption</a>(other, ntohs(aoh-&gt;<a class="code" href="structast__option__header.html#ef3e30e070f70244fd6578d88a6b77ac">option</a>), aoh-&gt;<a class="code" href="structast__option__header.html#59a6c49cfff82ce638c44fec9cd91ddb">data</a>, f-&gt;<a class="code" href="structast__frame.html#106553e2afb20bec4268dd6bd02c952d">datalen</a> - <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__option__header.html">ast_option_header</a>), 0);
<a name="l01632"></a>01632          }
<a name="l01633"></a>01633       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#9574009b02f8256934a1a25cbac10e1d">frametype</a> == <a class="code" href="frame_8h.html#006fc84d03b57b7c7d571d6c0db69f923c709a87ba681b04d6a6285d6d0af892">AST_FRAME_DTMF_BEGIN</a>) {
<a name="l01634"></a>01634          <span class="comment">/* eat it */</span>
<a name="l01635"></a>01635       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#9574009b02f8256934a1a25cbac10e1d">frametype</a> == <a class="code" href="frame_8h.html#41e7a80287a24ece13159c2d8b1b9375">AST_FRAME_DTMF</a>) {
<a name="l01636"></a>01636          <span class="keywordtype">char</span> *featurecode;
<a name="l01637"></a>01637          <span class="keywordtype">int</span> sense;
<a name="l01638"></a>01638 
<a name="l01639"></a>01639          hadfeatures = hasfeatures;
<a name="l01640"></a>01640          <span class="comment">/* This cannot overrun because the longest feature is one shorter than our buffer */</span>
<a name="l01641"></a>01641          <span class="keywordflow">if</span> (who == chan) {
<a name="l01642"></a>01642             sense = <a class="code" href="res__features_8c.html#bd2f1cd557108bff60f29245c9fd0b15">FEATURE_SENSE_CHAN</a>;
<a name="l01643"></a>01643             featurecode = chan_featurecode;
<a name="l01644"></a>01644          } <span class="keywordflow">else</span>  {
<a name="l01645"></a>01645             sense = <a class="code" href="res__features_8c.html#34918b66feeac9340849ed1c5a1e105d">FEATURE_SENSE_PEER</a>;
<a name="l01646"></a>01646             featurecode = peer_featurecode;
<a name="l01647"></a>01647          }<span class="comment"></span>
<a name="l01648"></a>01648 <span class="comment">         /*! append the event to featurecode. we rely on the string being zero-filled, and</span>
<a name="l01649"></a>01649 <span class="comment">          * not overflowing it. </span>
<a name="l01650"></a>01650 <span class="comment">          * \todo XXX how do we guarantee the latter ?</span>
<a name="l01651"></a>01651 <span class="comment">          */</span>
<a name="l01652"></a>01652          featurecode[strlen(featurecode)] = f-&gt;<a class="code" href="structast__frame.html#c00578b472e008b51fd24237785fa428">subclass</a>;
<a name="l01653"></a>01653          <span class="comment">/* Get rid of the frame before we start doing "stuff" with the channels */</span>
<a name="l01654"></a>01654          <a class="code" href="frame_8h.html#506c759ec4950e7f7465e8f090a6252b">ast_frfree</a>(f);
<a name="l01655"></a>01655          f = NULL;
<a name="l01656"></a>01656          config-&gt;<a class="code" href="structast__bridge__config.html#dfe9693aa0a7a7c3ac9558a7fc78338f">feature_timer</a> = backup_config.<a class="code" href="structast__bridge__config.html#dfe9693aa0a7a7c3ac9558a7fc78338f">feature_timer</a>;
<a name="l01657"></a>01657          res = <a class="code" href="res__features_8c.html#effe84690a12a8ac703528fd4ab6c1b7">ast_feature_interpret</a>(chan, peer, config, featurecode, sense);
<a name="l01658"></a>01658          <span class="keywordflow">switch</span>(res) {
<a name="l01659"></a>01659          <span class="keywordflow">case</span> FEATURE_RETURN_PASSDIGITS:
<a name="l01660"></a>01660             <a class="code" href="app_8c.html#8199b7508395e37a031a6b4ff2ebe0a7">ast_dtmf_stream</a>(other, who, featurecode, 0);
<a name="l01661"></a>01661             <span class="comment">/* Fall through */</span>
<a name="l01662"></a>01662          <span class="keywordflow">case</span> <a class="code" href="res__features_8c.html#5e030ad573431b2bda6282aa4351a449">FEATURE_RETURN_SUCCESS</a>:
<a name="l01663"></a>01663             memset(featurecode, 0, <span class="keyword">sizeof</span>(chan_featurecode));
<a name="l01664"></a>01664             <span class="keywordflow">break</span>;
<a name="l01665"></a>01665          }
<a name="l01666"></a>01666          <span class="keywordflow">if</span> (res &gt;= <a class="code" href="res__features_8c.html#1bc8fc72a69097020e846cba3ec9b836">FEATURE_RETURN_PASSDIGITS</a>) {
<a name="l01667"></a>01667             res = 0;
<a name="l01668"></a>01668          } <span class="keywordflow">else</span> 
<a name="l01669"></a>01669             <span class="keywordflow">break</span>;
<a name="l01670"></a>01670          hasfeatures = !<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(chan_featurecode) || !<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(peer_featurecode);
<a name="l01671"></a>01671          <span class="keywordflow">if</span> (hadfeatures &amp;&amp; !hasfeatures) {
<a name="l01672"></a>01672             <span class="comment">/* Restore backup */</span>
<a name="l01673"></a>01673             memcpy(config, &amp;backup_config, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__bridge__config.html">ast_bridge_config</a>));
<a name="l01674"></a>01674             memset(&amp;backup_config, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__bridge__config.html">ast_bridge_config</a>));
<a name="l01675"></a>01675          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hasfeatures) {
<a name="l01676"></a>01676             <span class="keywordflow">if</span> (!hadfeatures) {
<a name="l01677"></a>01677                <span class="comment">/* Backup configuration */</span>
<a name="l01678"></a>01678                memcpy(&amp;backup_config, config, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__bridge__config.html">ast_bridge_config</a>));
<a name="l01679"></a>01679                <span class="comment">/* Setup temporary config options */</span>
<a name="l01680"></a>01680                config-&gt;play_warning = 0;
<a name="l01681"></a>01681                <a class="code" href="utils_8h.html#c2399a33be6ffb658bcf7c6a35531732">ast_clear_flag</a>(&amp;(config-&gt;features_caller), <a class="code" href="channel_8h.html#02653d87b6fa8554fc0d1a3726fea2d04040ce118987e724063d0b58eafd9b4f">AST_FEATURE_PLAY_WARNING</a>);
<a name="l01682"></a>01682                <a class="code" href="utils_8h.html#c2399a33be6ffb658bcf7c6a35531732">ast_clear_flag</a>(&amp;(config-&gt;features_callee), <a class="code" href="channel_8h.html#02653d87b6fa8554fc0d1a3726fea2d04040ce118987e724063d0b58eafd9b4f">AST_FEATURE_PLAY_WARNING</a>);
<a name="l01683"></a>01683                config-&gt;warning_freq = 0;
<a name="l01684"></a>01684                config-&gt;warning_sound = NULL;
<a name="l01685"></a>01685                config-&gt;end_sound = NULL;
<a name="l01686"></a>01686                config-&gt;start_sound = NULL;
<a name="l01687"></a>01687                config-&gt;firstpass = 0;
<a name="l01688"></a>01688             }
<a name="l01689"></a>01689             config-&gt;start_time = ast_tvnow();
<a name="l01690"></a>01690             config-&gt;feature_timer = <a class="code" href="app__followme_8c.html#9c377c53990dd55a57a71e8b85d40e73">featuredigittimeout</a>;
<a name="l01691"></a>01691             <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a>)
<a name="l01692"></a>01692                <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"Set time limit to %ld\n"</span>, config-&gt;feature_timer);
<a name="l01693"></a>01693          }
<a name="l01694"></a>01694       }
<a name="l01695"></a>01695       <span class="keywordflow">if</span> (f)
<a name="l01696"></a>01696          <a class="code" href="frame_8h.html#506c759ec4950e7f7465e8f090a6252b">ast_frfree</a>(f);
<a name="l01697"></a>01697 
<a name="l01698"></a>01698    }
<a name="l01699"></a>01699    <span class="comment">/* arrange the cdrs */</span>
<a name="l01700"></a>01700    bridge_cdr = <a class="code" href="cdr_8c.html#0dd431954a27c67f78c6e13be8a0b136">ast_cdr_alloc</a>();
<a name="l01701"></a>01701    <span class="keywordflow">if</span> (bridge_cdr) {
<a name="l01702"></a>01702       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a> &amp;&amp; peer-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a>) { <span class="comment">/* both of them? merge */</span>
<a name="l01703"></a>01703          <a class="code" href="cdr_8c.html#4d85bb268956ffbf0b19df25915726e8">ast_cdr_init</a>(bridge_cdr,chan); <span class="comment">/* seems more logicaller to use the  destination as a base, but, really, it's random */</span>
<a name="l01704"></a>01704          <a class="code" href="cdr_8c.html#56e1b7b9d5acada4d22d345813710582">ast_cdr_start</a>(bridge_cdr); <span class="comment">/* now is the time to start */</span>
<a name="l01705"></a>01705          
<a name="l01706"></a>01706          <span class="comment">/* absorb the channel cdr */</span>
<a name="l01707"></a>01707          <a class="code" href="cdr_8c.html#b7fa0bd117aed5d3693e653d00985aa0">ast_cdr_merge</a>(bridge_cdr, chan-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a>);
<a name="l01708"></a>01708          <a class="code" href="cdr_8c.html#46e80e6b7ec200439ddd4fc6bdea4f5b">ast_cdr_discard</a>(chan-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a>); <span class="comment">/* no posting these guys */</span>
<a name="l01709"></a>01709          
<a name="l01710"></a>01710          <span class="comment">/* absorb the peer cdr */</span>
<a name="l01711"></a>01711          <a class="code" href="cdr_8c.html#b7fa0bd117aed5d3693e653d00985aa0">ast_cdr_merge</a>(bridge_cdr, peer-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a>);
<a name="l01712"></a>01712          <a class="code" href="cdr_8c.html#46e80e6b7ec200439ddd4fc6bdea4f5b">ast_cdr_discard</a>(peer-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a>); <span class="comment">/* no posting these guys */</span>
<a name="l01713"></a>01713          peer-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a> = NULL;
<a name="l01714"></a>01714          chan-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a> = bridge_cdr; <span class="comment">/* make this available to the rest of the world via the chan while the call is in progress */</span>
<a name="l01715"></a>01715       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a>) {
<a name="l01716"></a>01716          <span class="comment">/* take the cdr from the channel - literally */</span>
<a name="l01717"></a>01717          <a class="code" href="cdr_8c.html#4d85bb268956ffbf0b19df25915726e8">ast_cdr_init</a>(bridge_cdr,chan);
<a name="l01718"></a>01718          <span class="comment">/* absorb this data */</span>
<a name="l01719"></a>01719          <a class="code" href="cdr_8c.html#b7fa0bd117aed5d3693e653d00985aa0">ast_cdr_merge</a>(bridge_cdr, chan-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a>);
<a name="l01720"></a>01720          <a class="code" href="cdr_8c.html#46e80e6b7ec200439ddd4fc6bdea4f5b">ast_cdr_discard</a>(chan-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a>); <span class="comment">/* no posting these guys */</span>
<a name="l01721"></a>01721          chan-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a> = bridge_cdr; <span class="comment">/* make this available to the rest of the world via the chan while the call is in progress */</span>
<a name="l01722"></a>01722       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a>) {
<a name="l01723"></a>01723          <span class="comment">/* take the cdr from the peer - literally */</span>
<a name="l01724"></a>01724          <a class="code" href="cdr_8c.html#4d85bb268956ffbf0b19df25915726e8">ast_cdr_init</a>(bridge_cdr,peer);
<a name="l01725"></a>01725          <span class="comment">/* absorb this data */</span>
<a name="l01726"></a>01726          <a class="code" href="cdr_8c.html#b7fa0bd117aed5d3693e653d00985aa0">ast_cdr_merge</a>(bridge_cdr, peer-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a>);
<a name="l01727"></a>01727          <a class="code" href="cdr_8c.html#46e80e6b7ec200439ddd4fc6bdea4f5b">ast_cdr_discard</a>(peer-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a>); <span class="comment">/* no posting these guys */</span>
<a name="l01728"></a>01728          peer-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a> = NULL;
<a name="l01729"></a>01729          peer-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a> = bridge_cdr; <span class="comment">/* make this available to the rest of the world via the chan while the call is in progress */</span>
<a name="l01730"></a>01730       } <span class="keywordflow">else</span> {
<a name="l01731"></a>01731          <span class="comment">/* make up a new cdr */</span>
<a name="l01732"></a>01732          <a class="code" href="cdr_8c.html#4d85bb268956ffbf0b19df25915726e8">ast_cdr_init</a>(bridge_cdr,chan); <span class="comment">/* eh, just pick one of them */</span>
<a name="l01733"></a>01733          chan-&gt;<a class="code" href="structast__channel.html#30491931d0d510243046864dbc71a8c9">cdr</a> = bridge_cdr; <span class="comment">/*  */</span>
<a name="l01734"></a>01734       }
<a name="l01735"></a>01735       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#9ff13b69b0f16b02154ada5fb39a0845">dstchannel</a>)) {
<a name="l01736"></a>01736          <span class="keywordflow">if</span> (strcmp(bridge_cdr-&gt;<a class="code" href="structast__cdr.html#53688148c71d0e0eb1072fed5c2ea24a">channel</a>, peer-&gt;name) != 0)
<a name="l01737"></a>01737             <a class="code" href="cdr_8c.html#56172e6c8989e2325ed4c47c3d03f1fc">ast_cdr_setdestchan</a>(bridge_cdr, peer-&gt;name);
<a name="l01738"></a>01738          <span class="keywordflow">else</span>
<a name="l01739"></a>01739             <a class="code" href="cdr_8c.html#56172e6c8989e2325ed4c47c3d03f1fc">ast_cdr_setdestchan</a>(bridge_cdr, chan-&gt;name);
<a name="l01740"></a>01740       }
<a name="l01741"></a>01741    }
<a name="l01742"></a>01742    <span class="keywordflow">return</span> res;
<a name="l01743"></a>01743 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="bce7613c9a8c4b637a579aa8aefba2f4"></a><!-- doxytag: member="features.h::ast_find_call_feature" ref="bce7613c9a8c4b637a579aa8aefba2f4" args="(const char *name)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__call__feature.html">ast_call_feature</a>* ast_find_call_feature           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>name</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
look for a call feature entry by its sname 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>a string ptr, should match "automon", "blindxfer", "atxfer", etc. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="res__features_8c-source.html#l01087">1087</a> of file <a class="el" href="res__features_8c-source.html">res_features.c</a>.
<p>
References <a class="el" href="res__features_8c-source.html#l01008">FEATURES_COUNT</a>, and <a class="el" href="features_8h-source.html#l00038">ast_call_feature::sname</a>.
<p>
Referenced by <a class="el" href="chan__sip_8c-source.html#l11655">handle_request_info()</a>.<div class="fragment"><pre class="fragment"><a name="l01088"></a>01088 {
<a name="l01089"></a>01089    <span class="keywordtype">int</span> x;
<a name="l01090"></a>01090    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="res__features_8c.html#2d0d4837f1493a92f80f074c81a7a9fb">FEATURES_COUNT</a>; x++) {
<a name="l01091"></a>01091       <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>, <a class="code" href="res__features_8c.html#db954913384557d27f3c7d47c35d3508">builtin_features</a>[x].sname))
<a name="l01092"></a>01092          <span class="keywordflow">return</span> &amp;<a class="code" href="res__features_8c.html#db954913384557d27f3c7d47c35d3508">builtin_features</a>[x];
<a name="l01093"></a>01093    }
<a name="l01094"></a>01094    <span class="keywordflow">return</span> NULL;
<a name="l01095"></a>01095 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="b0191433f37b2a33e542c9e4f7ededf9"></a><!-- doxytag: member="features.h::ast_masq_park_call" ref="b0191433f37b2a33e542c9e4f7ededf9" args="(struct ast_channel *rchan, struct ast_channel *host, int timeout, int *extout)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_masq_park_call           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>rchan</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>host</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>extout</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Park a call via a masqueraded channel. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rchan</em>&nbsp;</td><td>the real channel to be parked </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>host</em>&nbsp;</td><td>the channel to have the parking read to Masquerade the channel rchan into a new, empty channel which is then parked with ast_park_call </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>timeout</em>&nbsp;</td><td>is a timeout in milliseconds </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>extout</em>&nbsp;</td><td>is a parameter to an int that will hold the parked location, or NULL if you want </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="res__features_8c-source.html#l00473">473</a> of file <a class="el" href="res__features_8c-source.html">res_features.c</a>.
<p>
References <a class="el" href="channel_8h-source.html#l00450">ast_channel::amaflags</a>, <a class="el" href="channel_8c-source.html#l00632">ast_channel_alloc()</a>, <a class="el" href="channel_8c-source.html#l03270">ast_channel_masquerade()</a>, <a class="el" href="frame_8h-source.html#l00396">ast_frfree()</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="res__features_8c-source.html#l00342">ast_park_call()</a>, <a class="el" href="channel_8c-source.html#l02438">ast_read()</a>, <a class="el" href="channel_8h.html#c04acac682ff0cff5eda96378318b87a3c9bf8b90a4d4f25fc98dd1360bba58b">AST_STATE_DOWN</a>, <a class="el" href="adsistub_8c-source.html#l00055">chan</a>, <a class="el" href="channel_8h-source.html#l00441">ast_channel::context</a>, <a class="el" href="channel_8h-source.html#l00442">ast_channel::exten</a>, <a class="el" href="format__g726_8c-source.html#l00193">f</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="channel_8h-source.html#l00443">ast_channel::priority</a>, <a class="el" href="channel_8h-source.html#l00477">ast_channel::readformat</a>, <a class="el" href="res__features_8c-source.html#l00185">set_c_e_p()</a>, and <a class="el" href="channel_8h-source.html#l00478">ast_channel::writeformat</a>.
<p>
Referenced by <a class="el" href="res__features_8c-source.html#l02348">manager_park()</a>, <a class="el" href="chan__mgcp_8c-source.html#l02638">mgcp_ss()</a>, <a class="el" href="app__rpt_8c-source.html#l06759">rpt_exec()</a>, and <a class="el" href="chan__zap_8c-source.html#l05744">ss_thread()</a>.<div class="fragment"><pre class="fragment"><a name="l00474"></a>00474 {
<a name="l00475"></a>00475    <span class="keyword">struct </span><a class="code" href="structast__channel.html">ast_channel</a> *<a class="code" href="adsistub_8c.html#26c322652770620e64ac90682eb6504c">chan</a>;
<a name="l00476"></a>00476    <span class="keyword">struct </span><a class="code" href="structast__frame.html">ast_frame</a> *<a class="code" href="format__g726_8c.html#85b9b17a7dd34a3638c560bc9152473b">f</a>;
<a name="l00477"></a>00477 
<a name="l00478"></a>00478    <span class="comment">/* Make a new, fake channel that we'll use to masquerade in the real one */</span>
<a name="l00479"></a>00479    <span class="keywordflow">if</span> (!(chan = <a class="code" href="channel_8c.html#3e12df96f6a8fc8b7293ad03b29c729f">ast_channel_alloc</a>(0, <a class="code" href="channel_8h.html#c04acac682ff0cff5eda96378318b87a3c9bf8b90a4d4f25fc98dd1360bba58b">AST_STATE_DOWN</a>, 0, 0, rchan-&gt;accountcode, rchan-&gt;<a class="code" href="structast__channel.html#5aedfeaeaac21e5e5f297360633ea9a3">exten</a>, rchan-&gt;<a class="code" href="structast__channel.html#c1ae8ba118483c4c23841d72b5e7ebbb">context</a>, rchan-&gt;<a class="code" href="structast__channel.html#d5aa4bb1461fe3d863bd95fb137e2284">amaflags</a>, <span class="stringliteral">"Parked/%s"</span>,rchan-&gt;name))) {
<a name="l00480"></a>00480       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Unable to create parked channel\n"</span>);
<a name="l00481"></a>00481       <span class="keywordflow">return</span> -1;
<a name="l00482"></a>00482    }
<a name="l00483"></a>00483 
<a name="l00484"></a>00484    <span class="comment">/* Make formats okay */</span>
<a name="l00485"></a>00485    chan-&gt;<a class="code" href="structast__channel.html#c9d2702466074da94d21f26822247ed8">readformat</a> = rchan-&gt;<a class="code" href="structast__channel.html#c9d2702466074da94d21f26822247ed8">readformat</a>;
<a name="l00486"></a>00486    chan-&gt;<a class="code" href="structast__channel.html#45a38ca474a4f1df88fe13d68bbb0b44">writeformat</a> = rchan-&gt;<a class="code" href="structast__channel.html#45a38ca474a4f1df88fe13d68bbb0b44">writeformat</a>;
<a name="l00487"></a>00487    <a class="code" href="channel_8c.html#8e30c09190bd2388188cd8bab35ba595">ast_channel_masquerade</a>(chan, rchan);
<a name="l00488"></a>00488 
<a name="l00489"></a>00489    <span class="comment">/* Setup the extensions and such */</span>
<a name="l00490"></a>00490    <a class="code" href="res__features_8c.html#9c0ecc5bd697a45c673ff75714458a83">set_c_e_p</a>(chan, rchan-&gt;<a class="code" href="structast__channel.html#c1ae8ba118483c4c23841d72b5e7ebbb">context</a>, rchan-&gt;<a class="code" href="structast__channel.html#5aedfeaeaac21e5e5f297360633ea9a3">exten</a>, rchan-&gt;<a class="code" href="structast__channel.html#b988295c268025b49dfb3df26171ddc3">priority</a>);
<a name="l00491"></a>00491 
<a name="l00492"></a>00492    <span class="comment">/* Make the masq execute */</span>
<a name="l00493"></a>00493    f = <a class="code" href="channel_8c.html#1446a8c0bddf626bf26b000fbeae117f">ast_read</a>(chan);
<a name="l00494"></a>00494    <span class="keywordflow">if</span> (f)
<a name="l00495"></a>00495       <a class="code" href="frame_8h.html#506c759ec4950e7f7465e8f090a6252b">ast_frfree</a>(f);
<a name="l00496"></a>00496 
<a name="l00497"></a>00497    <a class="code" href="features_8h.html#c9d53b3e6972e1cb4fd0153b648e204a">ast_park_call</a>(chan, peer, timeout, extout);
<a name="l00498"></a>00498    <span class="keywordflow">return</span> 0;
<a name="l00499"></a>00499 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="c9d53b3e6972e1cb4fd0153b648e204a"></a><!-- doxytag: member="features.h::ast_park_call" ref="c9d53b3e6972e1cb4fd0153b648e204a" args="(struct ast_channel *chan, struct ast_channel *host, int timeout, int *extout)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_park_call           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>peer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int *&nbsp;</td>
          <td class="mdname" nowrap> <em>extout</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Park a call and read back parked location. 
<p>
<dl compact><dt><b>Note:</b></dt><dd>We put the user in the parking list, then wake up the parking thread to be sure it looks after these channels too </dd></dl>

<p>
Definition at line <a class="el" href="res__features_8c-source.html#l00342">342</a> of file <a class="el" href="res__features_8c-source.html">res_features.c</a>.
<p>
References <a class="el" href="res__features_8c-source.html#l00291">adsi_announce_park()</a>, <a class="el" href="res__features_8c-source.html#l00103">adsipark</a>, <a class="el" href="channel_8h-source.html#l00421">ast_channel::appl</a>, <a class="el" href="pbx_8c-source.html#l04765">ast_add_extension2()</a>, <a class="el" href="adsi_8h.html#70400be4898ab6fbd733b93751dcc539">ast_adsi_available</a>, <a class="el" href="adsi_8h.html#2f8323d710716d7bb9c902fa47b29558">ast_adsi_unload_session</a>, <a class="el" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>, <a class="el" href="pbx_8c-source.html#l03913">ast_context_create()</a>, <a class="el" href="pbx_8c-source.html#l00889">ast_context_find()</a>, <a class="el" href="frame_8h.html#2d127e187c7a98c4396c337f2d76f389dcaa1b03a8c60073c53c1b662418697f">AST_CONTROL_HOLD</a>, <a class="el" href="pbx_8c-source.html#l02183">ast_exists_extension()</a>, <a class="el" href="utils_8h-source.html#l00344">ast_free</a>, <a class="el" href="channel_8c-source.html#l02453">ast_indicate_data()</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="channel_8c-source.html#l04849">ast_say_digits()</a>, <a class="el" href="strings_8h-source.html#l00037">ast_strlen_zero()</a>, <a class="el" href="logger_8c-source.html#l00989">ast_verbose()</a>, <a class="el" href="channel_8h-source.html#l00441">ast_channel::context</a>, <a class="el" href="channel_8h-source.html#l00422">ast_channel::data</a>, <a class="el" href="manager_8h-source.html#l00052">EVENT_FLAG_CALL</a>, <a class="el" href="channel_8h-source.html#l00442">ast_channel::exten</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="logger_8h-source.html#l00118">LOG_ERROR</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="channel_8h-source.html#l00444">ast_channel::macrocontext</a>, <a class="el" href="channel_8h-source.html#l00445">ast_channel::macroexten</a>, <a class="el" href="channel_8h-source.html#l00446">ast_channel::macropriority</a>, <a class="el" href="manager_8h-source.html#l00163">manager_event</a>, <a class="el" href="res__features_8c-source.html#l00155">parkeduser::next</a>, <a class="el" href="res__features_8c-source.html#l00307">notify_metermaids()</a>, <a class="el" href="res__features_8c-source.html#l00152">parkeduser::notquiteyet</a>, <a class="el" href="asterisk_8c-source.html#l00163">option_verbose</a>, <a class="el" href="res__features_8c-source.html#l00081">parkedcall</a>, <a class="el" href="res__features_8c-source.html#l00101">parkfindnext</a>, <a class="el" href="res__features_8c-source.html#l00087">parking_con</a>, <a class="el" href="res__features_8c-source.html#l00100">parking_offset</a>, <a class="el" href="res__features_8c-source.html#l00092">parking_start</a>, <a class="el" href="res__features_8c-source.html#l00093">parking_stop</a>, <a class="el" href="res__features_8c-source.html#l00162">parking_thread</a>, <a class="el" href="res__features_8c-source.html#l00086">parkingtime</a>, <a class="el" href="res__features_8c-source.html#l00091">parkmohclass</a>, <a class="el" href="pbx_8c-source.html#l05762">pbx_builtin_getvar_helper()</a>, <a class="el" href="channel_8h-source.html#l00443">ast_channel::priority</a>, <a class="el" href="pbx__ael_8c-source.html#l00061">registrar</a>, <a class="el" href="strings_8h-source.html#l00045">S_OR</a>, <a class="el" href="astmm_8h-source.html#l00075">strdup</a>, and <a class="el" href="logger_8h-source.html#l00044">VERBOSE_PREFIX_2</a>.
<p>
Referenced by <a class="el" href="res__features_8c-source.html#l00473">ast_masq_park_call()</a>, <a class="el" href="res__features_8c-source.html#l00673">builtin_blindtransfer()</a>, <a class="el" href="res__features_8c-source.html#l00529">builtin_parkcall()</a>, <a class="el" href="chan__iax2_8c-source.html#l06286">iax_park_thread()</a>, <a class="el" href="res__features_8c-source.html#l01938">park_call_exec()</a>, and <a class="el" href="chan__sip_8c-source.html#l13507">sip_park_thread()</a>.<div class="fragment"><pre class="fragment"><a name="l00343"></a>00343 {
<a name="l00344"></a>00344    <span class="keyword">struct </span><a class="code" href="structparkeduser.html">parkeduser</a> *pu, *cur;
<a name="l00345"></a>00345    <span class="keywordtype">int</span> i, x = -1, parking_range;
<a name="l00346"></a>00346    <span class="keyword">struct </span><a class="code" href="structast__context.html">ast_context</a> *con;
<a name="l00347"></a>00347    <span class="keyword">const</span> <span class="keywordtype">char</span> *parkingexten;
<a name="l00348"></a>00348    
<a name="l00349"></a>00349    <span class="comment">/* Allocate memory for parking data */</span>
<a name="l00350"></a>00350    <span class="keywordflow">if</span> (!(pu = <a class="code" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*pu)))) 
<a name="l00351"></a>00351       <span class="keywordflow">return</span> -1;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353    <span class="comment">/* Lock parking lot */</span>
<a name="l00354"></a>00354    <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;parking_lock);
<a name="l00355"></a>00355    <span class="comment">/* Check for channel variable PARKINGEXTEN */</span>
<a name="l00356"></a>00356    parkingexten = <a class="code" href="pbx_8c.html#944d18aa90701f025b30e63d9644e448">pbx_builtin_getvar_helper</a>(chan, <span class="stringliteral">"PARKINGEXTEN"</span>);
<a name="l00357"></a>00357    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(parkingexten)) {
<a name="l00358"></a>00358       <span class="keywordflow">if</span> (<a class="code" href="pbx_8c.html#90b58be34145fcfd99652f0c3ae7377d">ast_exists_extension</a>(NULL, <a class="code" href="res__features_8c.html#743e866266a3e8e07813ea74b9400fc9">parking_con</a>, parkingexten, 1, NULL)) {
<a name="l00359"></a>00359          <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;parking_lock);
<a name="l00360"></a>00360          <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(pu);
<a name="l00361"></a>00361          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Requested parking extension already exists: %s@%s\n"</span>, parkingexten, <a class="code" href="res__features_8c.html#743e866266a3e8e07813ea74b9400fc9">parking_con</a>);
<a name="l00362"></a>00362          <span class="keywordflow">return</span> 0;   <span class="comment">/* Continue execution if possible */</span>
<a name="l00363"></a>00363       }
<a name="l00364"></a>00364       ast_copy_string(pu-&gt;parkingexten, parkingexten, <span class="keyword">sizeof</span>(pu-&gt;parkingexten));
<a name="l00365"></a>00365       x = atoi(parkingexten);
<a name="l00366"></a>00366    } <span class="keywordflow">else</span> {
<a name="l00367"></a>00367       <span class="comment">/* Select parking space within range */</span>
<a name="l00368"></a>00368       parking_range = <a class="code" href="res__features_8c.html#8b29b99f16241c2b9ba71dd3a8fa6be7">parking_stop</a> - <a class="code" href="res__features_8c.html#b0afcd98c89216f6836dc9e09cd3551c">parking_start</a>+1;
<a name="l00369"></a>00369       <span class="keywordflow">for</span> (i = 0; i &lt; parking_range; i++) {
<a name="l00370"></a>00370          x = (i + <a class="code" href="res__features_8c.html#705d46cc57ca1e0bca847c76e2485b4c">parking_offset</a>) % parking_range + parking_start;
<a name="l00371"></a>00371          cur = <a class="code" href="res__features_8c.html#5854e71c08151ba6487b269e519ca1d4">parkinglot</a>;
<a name="l00372"></a>00372          <span class="keywordflow">while</span>(cur) {
<a name="l00373"></a>00373             <span class="keywordflow">if</span> (cur-&gt;parkingnum == x) 
<a name="l00374"></a>00374                <span class="keywordflow">break</span>;
<a name="l00375"></a>00375             cur = cur-&gt;<a class="code" href="structparkeduser.html#d0cab90d8d20d57e2f2b9be52f7dd25d">next</a>;
<a name="l00376"></a>00376          }
<a name="l00377"></a>00377          <span class="keywordflow">if</span> (!cur)
<a name="l00378"></a>00378             <span class="keywordflow">break</span>;
<a name="l00379"></a>00379       }
<a name="l00380"></a>00380 
<a name="l00381"></a>00381       <span class="keywordflow">if</span> (!(i &lt; parking_range)) {
<a name="l00382"></a>00382          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"No more parking spaces\n"</span>);
<a name="l00383"></a>00383          <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(pu);
<a name="l00384"></a>00384          <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;parking_lock);
<a name="l00385"></a>00385          <span class="keywordflow">return</span> -1;
<a name="l00386"></a>00386       }
<a name="l00387"></a>00387       <span class="comment">/* Set pointer for next parking */</span>
<a name="l00388"></a>00388       <span class="keywordflow">if</span> (<a class="code" href="res__features_8c.html#3307cc7b19dbe62fab2483af01449e20">parkfindnext</a>) 
<a name="l00389"></a>00389          <a class="code" href="res__features_8c.html#705d46cc57ca1e0bca847c76e2485b4c">parking_offset</a> = x - parking_start + 1;
<a name="l00390"></a>00390    }
<a name="l00391"></a>00391    
<a name="l00392"></a>00392    chan-&gt;<a class="code" href="structast__channel.html#63469c3c4f19f07c737127a117296de4">appl</a> = <span class="stringliteral">"Parked Call"</span>;
<a name="l00393"></a>00393    chan-&gt;<a class="code" href="structast__channel.html#8d777f385d3dfec8815d20f7496026dc">data</a> = NULL; 
<a name="l00394"></a>00394 
<a name="l00395"></a>00395    pu-&gt;chan = chan;
<a name="l00396"></a>00396    
<a name="l00397"></a>00397    <span class="comment">/* Put the parked channel on hold if we have two different channels */</span>
<a name="l00398"></a>00398    <span class="keywordflow">if</span> (chan != peer) {
<a name="l00399"></a>00399       <a class="code" href="channel_8c.html#f1b18b170d0068311ca47c2e0d0ede5c">ast_indicate_data</a>(pu-&gt;chan, <a class="code" href="frame_8h.html#2d127e187c7a98c4396c337f2d76f389dcaa1b03a8c60073c53c1b662418697f">AST_CONTROL_HOLD</a>, 
<a name="l00400"></a>00400          <a class="code" href="strings_8h.html#a5b939153ec133be2de0e3647df143f4">S_OR</a>(<a class="code" href="res__features_8c.html#5cd266893eca16634e9bd66eeb7a1c3a">parkmohclass</a>, NULL),
<a name="l00401"></a>00401          !<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(<a class="code" href="res__features_8c.html#5cd266893eca16634e9bd66eeb7a1c3a">parkmohclass</a>) ? strlen(<a class="code" href="res__features_8c.html#5cd266893eca16634e9bd66eeb7a1c3a">parkmohclass</a>) + 1 : 0);
<a name="l00402"></a>00402    }
<a name="l00403"></a>00403    
<a name="l00404"></a>00404    pu-&gt;start = ast_tvnow();
<a name="l00405"></a>00405    pu-&gt;parkingnum = x;
<a name="l00406"></a>00406    pu-&gt;parkingtime = (timeout &gt; 0) ? timeout : <a class="code" href="res__features_8c.html#c700875891439809b350a5e629558902">parkingtime</a>;
<a name="l00407"></a>00407    <span class="keywordflow">if</span> (extout)
<a name="l00408"></a>00408       *extout = x;
<a name="l00409"></a>00409 
<a name="l00410"></a>00410    <span class="keywordflow">if</span> (peer) 
<a name="l00411"></a>00411       ast_copy_string(pu-&gt;peername, peer-&gt;name, <span class="keyword">sizeof</span>(pu-&gt;peername));
<a name="l00412"></a>00412 
<a name="l00413"></a>00413    <span class="comment">/* Remember what had been dialed, so that if the parking</span>
<a name="l00414"></a>00414 <span class="comment">      expires, we try to come back to the same place */</span>
<a name="l00415"></a>00415    ast_copy_string(pu-&gt;context, <a class="code" href="strings_8h.html#a5b939153ec133be2de0e3647df143f4">S_OR</a>(chan-&gt;<a class="code" href="structast__channel.html#d26b4f540a5723a140b9836f73cf62a4">macrocontext</a>, chan-&gt;<a class="code" href="structast__channel.html#c1ae8ba118483c4c23841d72b5e7ebbb">context</a>), <span class="keyword">sizeof</span>(pu-&gt;context));
<a name="l00416"></a>00416    ast_copy_string(pu-&gt;exten, <a class="code" href="strings_8h.html#a5b939153ec133be2de0e3647df143f4">S_OR</a>(chan-&gt;<a class="code" href="structast__channel.html#abf9ad08121b2a624ad15e74c17f2b59">macroexten</a>, chan-&gt;<a class="code" href="structast__channel.html#5aedfeaeaac21e5e5f297360633ea9a3">exten</a>), <span class="keyword">sizeof</span>(pu-&gt;exten));
<a name="l00417"></a>00417    pu-&gt;priority = chan-&gt;<a class="code" href="structast__channel.html#eb0665337d177a3a6fb6076ee2d317bd">macropriority</a> ? chan-&gt;<a class="code" href="structast__channel.html#eb0665337d177a3a6fb6076ee2d317bd">macropriority</a> : chan-&gt;<a class="code" href="structast__channel.html#b988295c268025b49dfb3df26171ddc3">priority</a>;
<a name="l00418"></a>00418    pu-&gt;next = <a class="code" href="res__features_8c.html#5854e71c08151ba6487b269e519ca1d4">parkinglot</a>;
<a name="l00419"></a>00419    <a class="code" href="res__features_8c.html#5854e71c08151ba6487b269e519ca1d4">parkinglot</a> = pu;
<a name="l00420"></a>00420 
<a name="l00421"></a>00421    <span class="comment">/* If parking a channel directly, don't quiet yet get parking running on it */</span>
<a name="l00422"></a>00422    <span class="keywordflow">if</span> (peer == chan) 
<a name="l00423"></a>00423       pu-&gt;<a class="code" href="structparkeduser.html#abd25c1411415ae93a1a7ec80f270e3e">notquiteyet</a> = 1;
<a name="l00424"></a>00424    <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;parking_lock);
<a name="l00425"></a>00425    <span class="comment">/* Wake up the (presumably select()ing) thread */</span>
<a name="l00426"></a>00426    pthread_kill(<a class="code" href="res__features_8c.html#a1b4c23e2029d94fb9090c489fdb6bcf">parking_thread</a>, SIGURG);
<a name="l00427"></a>00427    <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ge36cdd7167e060bff70d00fbd82809eb">option_verbose</a> &gt; 1) 
<a name="l00428"></a>00428       <a class="code" href="logger_8c.html#6a1ef0a194bcc79fccfb662192954477">ast_verbose</a>(<a class="code" href="logger_8h.html#6e3640436a97291b451a8d264b5ab15d">VERBOSE_PREFIX_2</a> <span class="stringliteral">"Parked %s on %d@%s. Will timeout back to extension [%s] %s, %d in %d seconds\n"</span>, pu-&gt;chan-&gt;name, pu-&gt;parkingnum, <a class="code" href="res__features_8c.html#743e866266a3e8e07813ea74b9400fc9">parking_con</a>, pu-&gt;context, pu-&gt;exten, pu-&gt;priority, (pu-&gt;parkingtime/1000));
<a name="l00429"></a>00429 
<a name="l00430"></a>00430    <span class="keywordflow">if</span> (pu-&gt;parkingnum != -1)
<a name="l00431"></a>00431       snprintf(pu-&gt;parkingexten, <span class="keyword">sizeof</span>(pu-&gt;parkingexten), <span class="stringliteral">"%d"</span>, x);
<a name="l00432"></a>00432    <a class="code" href="manager_8h.html#17a8c809d5b2d04cbb8969a209134c2b">manager_event</a>(<a class="code" href="manager_8h.html#c81a36aac6503176bd649993386b23e4">EVENT_FLAG_CALL</a>, <span class="stringliteral">"ParkedCall"</span>,
<a name="l00433"></a>00433       <span class="stringliteral">"Exten: %s\r\n"</span>
<a name="l00434"></a>00434       <span class="stringliteral">"Channel: %s\r\n"</span>
<a name="l00435"></a>00435       <span class="stringliteral">"From: %s\r\n"</span>
<a name="l00436"></a>00436       <span class="stringliteral">"Timeout: %ld\r\n"</span>
<a name="l00437"></a>00437       <span class="stringliteral">"CallerIDNum: %s\r\n"</span>
<a name="l00438"></a>00438       <span class="stringliteral">"CallerIDName: %s\r\n"</span>,
<a name="l00439"></a>00439       pu-&gt;parkingexten, pu-&gt;chan-&gt;name, peer ? peer-&gt;name : <span class="stringliteral">""</span>,
<a name="l00440"></a>00440       (<span class="keywordtype">long</span>)pu-&gt;start.tv_sec + (<span class="keywordtype">long</span>)(pu-&gt;parkingtime/1000) - (<span class="keywordtype">long</span>)time(NULL),
<a name="l00441"></a>00441       <a class="code" href="strings_8h.html#a5b939153ec133be2de0e3647df143f4">S_OR</a>(pu-&gt;chan-&gt;cid.cid_num, <span class="stringliteral">"&lt;unknown&gt;"</span>),
<a name="l00442"></a>00442       <a class="code" href="strings_8h.html#a5b939153ec133be2de0e3647df143f4">S_OR</a>(pu-&gt;chan-&gt;cid.cid_name, <span class="stringliteral">"&lt;unknown&gt;"</span>)
<a name="l00443"></a>00443       );
<a name="l00444"></a>00444 
<a name="l00445"></a>00445    <span class="keywordflow">if</span> (peer &amp;&amp; <a class="code" href="res__features_8c.html#e8f11b21e02217176b0804f5bc589941">adsipark</a> &amp;&amp; <a class="code" href="adsi_8h.html#70400be4898ab6fbd733b93751dcc539">ast_adsi_available</a>(peer)) {
<a name="l00446"></a>00446       <a class="code" href="res__features_8c.html#da019e20f76270834e30c1b497b8cc13">adsi_announce_park</a>(peer, pu-&gt;parkingexten);  <span class="comment">/* Only supports parking numbers */</span>
<a name="l00447"></a>00447       <a class="code" href="adsi_8h.html#2f8323d710716d7bb9c902fa47b29558">ast_adsi_unload_session</a>(peer);
<a name="l00448"></a>00448    }
<a name="l00449"></a>00449 
<a name="l00450"></a>00450    con = <a class="code" href="pbx_8c.html#f8c5b4e7d06b7aff72707b5d7d7c94e1">ast_context_find</a>(<a class="code" href="res__features_8c.html#743e866266a3e8e07813ea74b9400fc9">parking_con</a>);
<a name="l00451"></a>00451    <span class="keywordflow">if</span> (!con) 
<a name="l00452"></a>00452       con = <a class="code" href="pbx_8c.html#9b7261abb02956903bb17c5bf8af265a">ast_context_create</a>(NULL, <a class="code" href="res__features_8c.html#743e866266a3e8e07813ea74b9400fc9">parking_con</a>, <a class="code" href="pbx__ael_8c.html#5940569cd1d60781f856f93235b072ee">registrar</a>);
<a name="l00453"></a>00453    <span class="keywordflow">if</span> (!con)   <span class="comment">/* Still no context? Bad */</span>
<a name="l00454"></a>00454       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#4490aa3d29644e716440fada68f54032">LOG_ERROR</a>, <span class="stringliteral">"Parking context '%s' does not exist and unable to create\n"</span>, <a class="code" href="res__features_8c.html#743e866266a3e8e07813ea74b9400fc9">parking_con</a>);
<a name="l00455"></a>00455    <span class="keywordflow">else</span> {      <span class="comment">/* Add extension to context */</span>
<a name="l00456"></a>00456       <span class="keywordflow">if</span> (!<a class="code" href="pbx_8c.html#0985a9a977ba8aa4f370da3a495437ae">ast_add_extension2</a>(con, 1, pu-&gt;parkingexten, 1, NULL, NULL, <a class="code" href="res__features_8c.html#6799a0be08d3bdfe0b2b5f19d7546798">parkedcall</a>, <a class="code" href="astmm_8h.html#17881997a89ddffd239268f0476567d0">strdup</a>(pu-&gt;parkingexten), <a class="code" href="utils_8h.html#801d8022c2922d0d4f73ba9e72c93865">ast_free</a>, <a class="code" href="pbx__ael_8c.html#5940569cd1d60781f856f93235b072ee">registrar</a>))
<a name="l00457"></a>00457          <a class="code" href="res__features_8c.html#1b66c04241a96d9698bbe2f70e913f9a">notify_metermaids</a>(pu-&gt;parkingexten, <a class="code" href="res__features_8c.html#743e866266a3e8e07813ea74b9400fc9">parking_con</a>);
<a name="l00458"></a>00458    }
<a name="l00459"></a>00459    <span class="comment">/* Tell the peer channel the number of the parking space */</span>
<a name="l00460"></a>00460    <span class="keywordflow">if</span> (peer &amp;&amp; pu-&gt;parkingnum != -1) <span class="comment">/* Only say number if it's a number */</span>
<a name="l00461"></a>00461       <a class="code" href="channel_8c.html#e02ce58f997ad8095efa170689df89cf">ast_say_digits</a>(peer, pu-&gt;parkingnum, <span class="stringliteral">""</span>, peer-&gt;language);
<a name="l00462"></a>00462    <span class="keywordflow">if</span> (pu-&gt;notquiteyet) {
<a name="l00463"></a>00463       <span class="comment">/* Wake up parking thread if we're really done */</span>
<a name="l00464"></a>00464       <a class="code" href="channel_8c.html#f1b18b170d0068311ca47c2e0d0ede5c">ast_indicate_data</a>(pu-&gt;chan, <a class="code" href="frame_8h.html#2d127e187c7a98c4396c337f2d76f389dcaa1b03a8c60073c53c1b662418697f">AST_CONTROL_HOLD</a>, 
<a name="l00465"></a>00465          <a class="code" href="strings_8h.html#a5b939153ec133be2de0e3647df143f4">S_OR</a>(<a class="code" href="res__features_8c.html#5cd266893eca16634e9bd66eeb7a1c3a">parkmohclass</a>, NULL),
<a name="l00466"></a>00466          !<a class="code" href="strings_8h.html#8ea6cd7603b8f588209bc49c9c29e968">ast_strlen_zero</a>(<a class="code" href="res__features_8c.html#5cd266893eca16634e9bd66eeb7a1c3a">parkmohclass</a>) ? strlen(<a class="code" href="res__features_8c.html#5cd266893eca16634e9bd66eeb7a1c3a">parkmohclass</a>) + 1 : 0);
<a name="l00467"></a>00467       pu-&gt;notquiteyet = 0;
<a name="l00468"></a>00468       pthread_kill(<a class="code" href="res__features_8c.html#a1b4c23e2029d94fb9090c489fdb6bcf">parking_thread</a>, SIGURG);
<a name="l00469"></a>00469    }
<a name="l00470"></a>00470    <span class="keywordflow">return</span> 0;
<a name="l00471"></a>00471 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="592f5491321993926462dffa87ba0bab"></a><!-- doxytag: member="features.h::ast_parking_ext" ref="592f5491321993926462dffa87ba0bab" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char* ast_parking_ext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Determine system parking extension Returns the call parking extension for drivers that provide special call parking help. 
<p>

<p>
Definition at line <a class="el" href="res__features_8c-source.html#l00164">164</a> of file <a class="el" href="res__features_8c-source.html">res_features.c</a>.
<p>
References <a class="el" href="res__features_8c-source.html#l00089">parking_ext</a>.
<p>
Referenced by <a class="el" href="res__features_8c-source.html#l00673">builtin_blindtransfer()</a>, <a class="el" href="chan__iax2_8c-source.html#l06220">dp_lookup()</a>, <a class="el" href="res__features_8c-source.html#l02453">load_config()</a>, <a class="el" href="chan__mgcp_8c-source.html#l02638">mgcp_ss()</a>, and <a class="el" href="chan__zap_8c-source.html#l05744">ss_thread()</a>.<div class="fragment"><pre class="fragment"><a name="l00165"></a>00165 {
<a name="l00166"></a>00166    <span class="keywordflow">return</span> <a class="code" href="res__features_8c.html#c54a405a0a0f539f9bca43450d6e2541">parking_ext</a>;
<a name="l00167"></a>00167 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a8e9ef5e6ec2534444a59331177bed20"></a><!-- doxytag: member="features.h::ast_pickup_call" ref="a8e9ef5e6ec2534444a59331177bed20" args="(struct ast_channel *chan)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_pickup_call           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>chan</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Pickup a call. 
<p>

<p>
Definition at line <a class="el" href="res__features_8c-source.html#l02403">2403</a> of file <a class="el" href="res__features_8c-source.html">res_features.c</a>.
<p>
References <a class="el" href="channel_8h-source.html#l00435">ast_channel::_state</a>, <a class="el" href="channel_8c-source.html#l01724">ast_answer()</a>, <a class="el" href="channel_8c-source.html#l03270">ast_channel_masquerade()</a>, <a class="el" href="lock_8h.html#a2fac4e1b143bef3b1ac807e0ab48f9f">ast_channel_unlock</a>, <a class="el" href="channel_8c-source.html#l00989">ast_channel_walk_locked()</a>, <a class="el" href="frame_8h.html#2d127e187c7a98c4396c337f2d76f389edaaffc26d24394cd2557ddb1db10f64">AST_CONTROL_ANSWER</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="channel_8c-source.html#l00863">ast_queue_control()</a>, <a class="el" href="channel_8h.html#c04acac682ff0cff5eda96378318b87a0789c8ad2fe8eda2081eb587a0bfbe42">AST_STATE_RING</a>, <a class="el" href="channel_8h.html#c04acac682ff0cff5eda96378318b87a85da5b3ea10583d638bc7ce8fe638ec2">AST_STATE_RINGING</a>, <a class="el" href="channel_8h-source.html#l00469">ast_channel::callgroup</a>, <a class="el" href="logger_8h-source.html#l00094">LOG_DEBUG</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="asterisk_8c-source.html#l00164">option_debug</a>, <a class="el" href="channel_8h-source.html#l00449">ast_channel::pbx</a>, and <a class="el" href="channel_8h-source.html#l00470">ast_channel::pickupgroup</a>.
<p>
Referenced by <a class="el" href="chan__sip_8c-source.html#l14098">handle_request_invite()</a>, <a class="el" href="chan__mgcp_8c-source.html#l02638">mgcp_ss()</a>, and <a class="el" href="chan__zap_8c-source.html#l05744">ss_thread()</a>.<div class="fragment"><pre class="fragment"><a name="l02404"></a>02404 {
<a name="l02405"></a>02405    <span class="keyword">struct </span><a class="code" href="structast__channel.html">ast_channel</a> *cur = NULL;
<a name="l02406"></a>02406    <span class="keywordtype">int</span> res = -1;
<a name="l02407"></a>02407 
<a name="l02408"></a>02408    <span class="keywordflow">while</span> ((cur = <a class="code" href="channel_8c.html#8ada12445e0d71c8bcd465f6838bf4e5">ast_channel_walk_locked</a>(cur)) != NULL) {
<a name="l02409"></a>02409       <span class="keywordflow">if</span> (!cur-&gt;<a class="code" href="structast__channel.html#569f7a090087f9e7071a247a24ea0809">pbx</a> &amp;&amp; 
<a name="l02410"></a>02410          (cur != chan) &amp;&amp;
<a name="l02411"></a>02411          (chan-&gt;<a class="code" href="structast__channel.html#6a5ae60e87b5caa521ea5c2b36de96cc">pickupgroup</a> &amp; cur-&gt;<a class="code" href="structast__channel.html#d435ec54d713513ab1d94049cbc33629">callgroup</a>) &amp;&amp;
<a name="l02412"></a>02412          ((cur-&gt;<a class="code" href="structast__channel.html#fb303761f789500fe4c0c9938c1c0245">_state</a> == <a class="code" href="channel_8h.html#c04acac682ff0cff5eda96378318b87a85da5b3ea10583d638bc7ce8fe638ec2">AST_STATE_RINGING</a>) ||
<a name="l02413"></a>02413           (cur-&gt;<a class="code" href="structast__channel.html#fb303761f789500fe4c0c9938c1c0245">_state</a> == <a class="code" href="channel_8h.html#c04acac682ff0cff5eda96378318b87a0789c8ad2fe8eda2081eb587a0bfbe42">AST_STATE_RING</a>))) {
<a name="l02414"></a>02414             <span class="keywordflow">break</span>;
<a name="l02415"></a>02415       }
<a name="l02416"></a>02416       <a class="code" href="lock_8h.html#a2fac4e1b143bef3b1ac807e0ab48f9f">ast_channel_unlock</a>(cur);
<a name="l02417"></a>02417    }
<a name="l02418"></a>02418    <span class="keywordflow">if</span> (cur) {
<a name="l02419"></a>02419       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a>)
<a name="l02420"></a>02420          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"Call pickup on chan '%s' by '%s'\n"</span>,cur-&gt;name, chan-&gt;name);
<a name="l02421"></a>02421       res = <a class="code" href="channel_8c.html#9e089c979b071a1df466a09497fdfa31">ast_answer</a>(chan);
<a name="l02422"></a>02422       <span class="keywordflow">if</span> (res)
<a name="l02423"></a>02423          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Unable to answer '%s'\n"</span>, chan-&gt;name);
<a name="l02424"></a>02424       res = <a class="code" href="channel_8c.html#9c10dd50747025f5100adeb1da23c2e1">ast_queue_control</a>(chan, <a class="code" href="frame_8h.html#2d127e187c7a98c4396c337f2d76f389edaaffc26d24394cd2557ddb1db10f64">AST_CONTROL_ANSWER</a>);
<a name="l02425"></a>02425       <span class="keywordflow">if</span> (res)
<a name="l02426"></a>02426          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Unable to queue answer on '%s'\n"</span>, chan-&gt;name);
<a name="l02427"></a>02427       res = <a class="code" href="channel_8c.html#8e30c09190bd2388188cd8bab35ba595">ast_channel_masquerade</a>(cur, chan);
<a name="l02428"></a>02428       <span class="keywordflow">if</span> (res)
<a name="l02429"></a>02429          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Unable to masquerade '%s' into '%s'\n"</span>, chan-&gt;name, cur-&gt;name);     <span class="comment">/* Done */</span>
<a name="l02430"></a>02430       <a class="code" href="lock_8h.html#a2fac4e1b143bef3b1ac807e0ab48f9f">ast_channel_unlock</a>(cur);
<a name="l02431"></a>02431    } <span class="keywordflow">else</span>   {
<a name="l02432"></a>02432       <span class="keywordflow">if</span> (option_debug)
<a name="l02433"></a>02433          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"No call pickup possible...\n"</span>);
<a name="l02434"></a>02434    }
<a name="l02435"></a>02435    <span class="keywordflow">return</span> res;
<a name="l02436"></a>02436 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="907f86dbd402c7f215ba3047f8c54a94"></a><!-- doxytag: member="features.h::ast_pickup_ext" ref="907f86dbd402c7f215ba3047f8c54a94" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char* ast_pickup_ext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Determine system call pickup extension. 
<p>

<p>
Definition at line <a class="el" href="res__features_8c-source.html#l00169">169</a> of file <a class="el" href="res__features_8c-source.html">res_features.c</a>.
<p>
References <a class="el" href="res__features_8c-source.html#l00090">pickup_ext</a>.
<p>
Referenced by <a class="el" href="chan__sip_8c-source.html#l09207">get_destination()</a>, <a class="el" href="chan__sip_8c-source.html#l14098">handle_request_invite()</a>, <a class="el" href="res__features_8c-source.html#l02102">handle_showfeatures()</a>, <a class="el" href="chan__mgcp_8c-source.html#l02638">mgcp_ss()</a>, and <a class="el" href="chan__zap_8c-source.html#l05744">ss_thread()</a>.<div class="fragment"><pre class="fragment"><a name="l00170"></a>00170 {
<a name="l00171"></a>00171    <span class="keywordflow">return</span> <a class="code" href="res__features_8c.html#12945224a84508b6d29891d86c8f0f7c">pickup_ext</a>;
<a name="l00172"></a>00172 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="eda7b3ca1113877d673e72fdfe2b1649"></a><!-- doxytag: member="features.h::ast_rdlock_call_features" ref="eda7b3ca1113877d673e72fdfe2b1649" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_rdlock_call_features           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="res__features_8c-source.html#l01076">1076</a> of file <a class="el" href="res__features_8c-source.html">res_features.c</a>.
<p>
References <a class="el" href="lock_8h-source.html#l00642">ast_rwlock_rdlock()</a>.
<p>
Referenced by <a class="el" href="chan__sip_8c-source.html#l11655">handle_request_info()</a>.<div class="fragment"><pre class="fragment"><a name="l01077"></a>01077 {
<a name="l01078"></a>01078    <a class="code" href="lock_8h.html#f4b8158bcd471d4f28b380768e3ee073">ast_rwlock_rdlock</a>(&amp;features_lock);
<a name="l01079"></a>01079 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="f3669c57747d1ce65a0c6589e03386c0"></a><!-- doxytag: member="features.h::ast_register_feature" ref="f3669c57747d1ce65a0c6589e03386c0" args="(struct ast_call_feature *feature)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_register_feature           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__call__feature.html">ast_call_feature</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>feature</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
register new feature into feature_set 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>feature</em>&nbsp;</td><td>an <a class="el" href="structast__call__feature.html">ast_call_feature</a> object which contains a keysequence and a callback function which is called when this keysequence is pressed during a call. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="res__features_8c-source.html#l01025">1025</a> of file <a class="el" href="res__features_8c-source.html">res_features.c</a>.
<p>
References <a class="el" href="linkedlists_8h-source.html#l00650">AST_LIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="logger_8c-source.html#l00989">ast_verbose()</a>, <a class="el" href="logger_8h-source.html#l00106">LOG_NOTICE</a>, <a class="el" href="asterisk_8c-source.html#l00163">option_verbose</a>, <a class="el" href="features_8h-source.html#l00038">ast_call_feature::sname</a>, and <a class="el" href="logger_8h-source.html#l00044">VERBOSE_PREFIX_2</a>.
<p>
Referenced by <a class="el" href="res__features_8c-source.html#l02453">load_config()</a>.<div class="fragment"><pre class="fragment"><a name="l01026"></a>01026 {
<a name="l01027"></a>01027    <span class="keywordflow">if</span> (!feature) {
<a name="l01028"></a>01028       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#bbf95aad74d847cd4bcb129604f798cd">LOG_NOTICE</a>,<span class="stringliteral">"You didn't pass a feature!\n"</span>);
<a name="l01029"></a>01029          <span class="keywordflow">return</span>;
<a name="l01030"></a>01030    }
<a name="l01031"></a>01031   
<a name="l01032"></a>01032    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;feature_list);
<a name="l01033"></a>01033    <a class="code" href="linkedlists_8h.html#5df56040a8838bdc841ef8eb179b7609">AST_LIST_INSERT_HEAD</a>(&amp;feature_list,feature,feature_entry);
<a name="l01034"></a>01034    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;feature_list);
<a name="l01035"></a>01035 
<a name="l01036"></a>01036    <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ge36cdd7167e060bff70d00fbd82809eb">option_verbose</a> &gt;= 2) 
<a name="l01037"></a>01037       <a class="code" href="logger_8c.html#6a1ef0a194bcc79fccfb662192954477">ast_verbose</a>(<a class="code" href="logger_8h.html#6e3640436a97291b451a8d264b5ab15d">VERBOSE_PREFIX_2</a> <span class="stringliteral">"Registered Feature '%s'\n"</span>,feature-&gt;<a class="code" href="structast__call__feature.html#d16edd3fe2bbc564136da7d1e79586df">sname</a>);
<a name="l01038"></a>01038 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="4dd763461ee81e87a7924033c30123bb"></a><!-- doxytag: member="features.h::ast_unlock_call_features" ref="4dd763461ee81e87a7924033c30123bb" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_unlock_call_features           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="res__features_8c-source.html#l01081">1081</a> of file <a class="el" href="res__features_8c-source.html">res_features.c</a>.
<p>
References <a class="el" href="lock_8h-source.html#l00637">ast_rwlock_unlock()</a>.
<p>
Referenced by <a class="el" href="chan__sip_8c-source.html#l11655">handle_request_info()</a>.<div class="fragment"><pre class="fragment"><a name="l01082"></a>01082 {
<a name="l01083"></a>01083    <a class="code" href="lock_8h.html#97ed909ef0a0582cf3870dd0629852c8">ast_rwlock_unlock</a>(&amp;features_lock);
<a name="l01084"></a>01084 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="3a56dc06bcdf3fe4cba843356ef33b50"></a><!-- doxytag: member="features.h::ast_unregister_feature" ref="3a56dc06bcdf3fe4cba843356ef33b50" args="(struct ast_call_feature *feature)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_unregister_feature           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__call__feature.html">ast_call_feature</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>feature</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
unregister feature from feature_set 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>feature</em>&nbsp;</td><td>the <a class="el" href="structast__call__feature.html">ast_call_feature</a> object which was registered before </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="res__features_8c-source.html#l01041">1041</a> of file <a class="el" href="res__features_8c-source.html">res_features.c</a>.
<p>
References <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00731">AST_LIST_REMOVE</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, and <a class="el" href="astmm_8h-source.html#l00069">free</a>.<div class="fragment"><pre class="fragment"><a name="l01042"></a>01042 {
<a name="l01043"></a>01043    <span class="keywordflow">if</span> (!feature)
<a name="l01044"></a>01044       <span class="keywordflow">return</span>;
<a name="l01045"></a>01045 
<a name="l01046"></a>01046    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;feature_list);
<a name="l01047"></a>01047    <a class="code" href="linkedlists_8h.html#d4a4c53d3b264b4e1c5e3fdd84cd8b5a">AST_LIST_REMOVE</a>(&amp;feature_list,feature,feature_entry);
<a name="l01048"></a>01048    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;feature_list);
<a name="l01049"></a>01049    <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(feature);
<a name="l01050"></a>01050 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu May 24 22:27:28 2007 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.5 </small></address>
</body>
</html>
