<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (24 May 2007)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Thu May 24 22:27:26 2007</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Finclude_2F.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Finclude_2Fasterisk_2F.html">asterisk</a></div>
<h1>dlfcn-compat.h File Reference</h1>
<p>
<a href="dlfcn-compat_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdl__info.html">dl_info</a></td></tr>

<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn-compat_8h.html#e3405fce965daa65a1561ec53eafb46b">dl_restrict</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn-compat_8h.html#12a180c322ab561ff75b996c242fa84a">RTLD_DEFAULT</a>&nbsp;&nbsp;&nbsp;((void *) -2)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn-compat_8h.html#d565d5d83850e65f4dc43e403df7a3db">RTLD_GLOBAL</a>&nbsp;&nbsp;&nbsp;0x8</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn-compat_8h.html#8884c6632ee6d253203a2d6deb4b7354">RTLD_LAZY</a>&nbsp;&nbsp;&nbsp;0x1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn-compat_8h.html#27db501f820a954df91ecdcd00aec958">RTLD_LOCAL</a>&nbsp;&nbsp;&nbsp;0x4</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn-compat_8h.html#b5f76bc27279e5ac633f9109f8fa9de2">RTLD_NEXT</a>&nbsp;&nbsp;&nbsp;((void *) -1)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn-compat_8h.html#0cc0978e1ca3437f8a24fab84ea5f45a">RTLD_NODELETE</a>&nbsp;&nbsp;&nbsp;0x80</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn-compat_8h.html#cb78ca118dbf7ce21081e05f1a0e1406">RTLD_NOLOAD</a>&nbsp;&nbsp;&nbsp;0x10</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn-compat_8h.html#cebd9c7b300fbb075a0eb012c43879e8">RTLD_NOW</a>&nbsp;&nbsp;&nbsp;0x2</td></tr>

<tr><td colspan="2"><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef <a class="el" href="structdl__info.html">dl_info</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn-compat_8h.html#99de982ae02e1d4adff300cfac048ca7">Dl_info</a></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn-compat_8h.html#9bffcec6f8892ecd0f36771c58761c8f">dladdr</a> (const void *dl_restrict, <a class="el" href="structdl__info.html">Dl_info</a> *dl_restrict)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn-compat_8h.html#45a2f0c60f9c16390e6878ecc49d436d">dlclose</a> (void *handle)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn-compat_8h.html#f4f18e7a664d25663c1a235c1fc7fade">dlerror</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn-compat_8h.html#d4ea5e7e662612dc0e5a7ad0ff1e33b0">dlopen</a> (const char *path, int mode)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="dlfcn-compat_8h.html#def04fd1fe7f4abea4e0f3df9745048d">dlsym</a> (void *dl_restrict handle, const char *dl_restrict symbol)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="e3405fce965daa65a1561ec53eafb46b"></a><!-- doxytag: member="dlfcn-compat.h::dl_restrict" ref="e3405fce965daa65a1561ec53eafb46b" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define dl_restrict          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn-compat_8h-source.html#l00052">52</a> of file <a class="el" href="dlfcn-compat_8h-source.html">dlfcn-compat.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="12a180c322ab561ff75b996c242fa84a"></a><!-- doxytag: member="dlfcn-compat.h::RTLD_DEFAULT" ref="12a180c322ab561ff75b996c242fa84a" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define RTLD_DEFAULT&nbsp;&nbsp;&nbsp;((void *) -2)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn-compat_8h-source.html#l00082">82</a> of file <a class="el" href="dlfcn-compat_8h-source.html">dlfcn-compat.h</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00560">dlsymIntern()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="d565d5d83850e65f4dc43e403df7a3db"></a><!-- doxytag: member="dlfcn-compat.h::RTLD_GLOBAL" ref="d565d5d83850e65f4dc43e403df7a3db" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define RTLD_GLOBAL&nbsp;&nbsp;&nbsp;0x8          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn-compat_8h-source.html#l00074">74</a> of file <a class="el" href="dlfcn-compat_8h-source.html">dlfcn-compat.h</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00685">loadModule()</a>, and <a class="el" href="dlfcn_8c-source.html#l00451">reference()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="8884c6632ee6d253203a2d6deb4b7354"></a><!-- doxytag: member="dlfcn-compat.h::RTLD_LAZY" ref="8884c6632ee6d253203a2d6deb4b7354" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define RTLD_LAZY&nbsp;&nbsp;&nbsp;0x1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn-compat_8h-source.html#l00071">71</a> of file <a class="el" href="dlfcn-compat_8h-source.html">dlfcn-compat.h</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00897">dlopen()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="27db501f820a954df91ecdcd00aec958"></a><!-- doxytag: member="dlfcn-compat.h::RTLD_LOCAL" ref="27db501f820a954df91ecdcd00aec958" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define RTLD_LOCAL&nbsp;&nbsp;&nbsp;0x4          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn-compat_8h-source.html#l00073">73</a> of file <a class="el" href="dlfcn-compat_8h-source.html">dlfcn-compat.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="b5f76bc27279e5ac633f9109f8fa9de2"></a><!-- doxytag: member="dlfcn-compat.h::RTLD_NEXT" ref="b5f76bc27279e5ac633f9109f8fa9de2" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define RTLD_NEXT&nbsp;&nbsp;&nbsp;((void *) -1)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn-compat_8h-source.html#l00081">81</a> of file <a class="el" href="dlfcn-compat_8h-source.html">dlfcn-compat.h</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00560">dlsymIntern()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="0cc0978e1ca3437f8a24fab84ea5f45a"></a><!-- doxytag: member="dlfcn-compat.h::RTLD_NODELETE" ref="0cc0978e1ca3437f8a24fab84ea5f45a" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define RTLD_NODELETE&nbsp;&nbsp;&nbsp;0x80          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn-compat_8h-source.html#l00076">76</a> of file <a class="el" href="dlfcn-compat_8h-source.html">dlfcn-compat.h</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l01041">dlclose()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="cb78ca118dbf7ce21081e05f1a0e1406"></a><!-- doxytag: member="dlfcn-compat.h::RTLD_NOLOAD" ref="cb78ca118dbf7ce21081e05f1a0e1406" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define RTLD_NOLOAD&nbsp;&nbsp;&nbsp;0x10          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn-compat_8h-source.html#l00075">75</a> of file <a class="el" href="dlfcn-compat_8h-source.html">dlfcn-compat.h</a>.
<p>
Referenced by <a class="el" href="dlfcn_8c-source.html#l00897">dlopen()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="cebd9c7b300fbb075a0eb012c43879e8"></a><!-- doxytag: member="dlfcn-compat.h::RTLD_NOW" ref="cebd9c7b300fbb075a0eb012c43879e8" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define RTLD_NOW&nbsp;&nbsp;&nbsp;0x2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn-compat_8h-source.html#l00072">72</a> of file <a class="el" href="dlfcn-compat_8h-source.html">dlfcn-compat.h</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="99de982ae02e1d4adff300cfac048ca7"></a><!-- doxytag: member="dlfcn-compat.h::Dl_info" ref="99de982ae02e1d4adff300cfac048ca7" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">typedef struct <a class="el" href="structdl__info.html">dl_info</a>  <a class="el" href="structdl__info.html">Dl_info</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="9bffcec6f8892ecd0f36771c58761c8f"></a><!-- doxytag: member="dlfcn-compat.h::dladdr" ref="9bffcec6f8892ecd0f36771c58761c8f" args="(const void *dl_restrict, Dl_info *dl_restrict)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int dladdr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const void *&nbsp;</td>
          <td class="mdname" nowrap> <em>dl_restrict</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap><a class="el" href="structdl__info.html">Dl_info</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>dl_restrict</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="45a2f0c60f9c16390e6878ecc49d436d"></a><!-- doxytag: member="dlfcn-compat.h::dlclose" ref="45a2f0c60f9c16390e6878ecc49d436d" args="(void *handle)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int dlclose           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>handle</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l01041">1041</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="app__rpt_8c-source.html#l00288">debug</a>, <a class="el" href="dlfcn_8c-source.html#l00560">dlsymIntern()</a>, <a class="el" href="dlfcn_8c-source.html#l00862">dolock()</a>, <a class="el" href="dlfcn_8c-source.html#l00885">dounlock()</a>, <a class="el" href="dlfcn_8c-source.html#l00196">error()</a>, <a class="el" href="dlfcn_8c-source.html#l00228">get_lib_name()</a>, <a class="el" href="dlfcn_8c-source.html#l00251">get_mach_header_from_NSModule()</a>, <a class="el" href="dlfcn_8c-source.html#l00398">isFlagSet()</a>, <a class="el" href="dlfcn_8c-source.html#l00383">isValidStatus()</a>, <a class="el" href="dlfcn_8c-source.html#l00124">dlstatus::lib</a>, <a class="el" href="dlfcn_8c-source.html#l00099">MAGIC_DYLIB_MOD</a>, <a class="el" href="dlfcn_8c-source.html#l00126">dlstatus::mode</a>, <a class="el" href="dlfcn_8c-source.html#l00123">dlstatus::module</a>, <a class="el" href="callerid_8c-source.html#l01043">name</a>, <a class="el" href="dlfcn_8c-source.html#l00125">dlstatus::refs</a>, <a class="el" href="dlfcn_8c-source.html#l00846">resetdlerror()</a>, <a class="el" href="dlfcn-compat_8h-source.html#l00076">RTLD_NODELETE</a>, and <a class="el" href="dlfcn_8c-source.html#l00211">warning()</a>.<div class="fragment"><pre class="fragment"><a name="l01042"></a>01042 {
<a name="l01043"></a>01043    <span class="keyword">struct </span><a class="code" href="structdlstatus.html">dlstatus</a> *dls = handle;
<a name="l01044"></a>01044    <a class="code" href="dlfcn_8c.html#3173031af7d4b847c50f22264d505a2a">dolock</a>();
<a name="l01045"></a>01045    <a class="code" href="dlfcn_8c.html#f79dfe72a8a68fc21a7a43fdebe8771e">resetdlerror</a>();
<a name="l01046"></a>01046    <span class="keywordflow">if</span> (!<a class="code" href="dlfcn_8c.html#94cc9569b7b9d1547f14f2ce0e5512cd">isValidStatus</a>(dls))
<a name="l01047"></a>01047    {
<a name="l01048"></a>01048       <span class="keywordflow">goto</span> dlcloseerror;
<a name="l01049"></a>01049    }
<a name="l01050"></a>01050    <span class="keywordflow">if</span> (dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a> == <a class="code" href="dlfcn_8c.html#7a6b0bdbbd9df80fd3f1044b33625543">MAGIC_DYLIB_MOD</a>)
<a name="l01051"></a>01051    {
<a name="l01052"></a>01052       <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>;
<a name="l01053"></a>01053       <span class="keywordflow">if</span> (!dls-&gt;<a class="code" href="structdlstatus.html#e8acc63b1e238f3255c900eed37254b8">lib</a>)
<a name="l01054"></a>01054       {
<a name="l01055"></a>01055          name = <span class="stringliteral">"global context"</span>;
<a name="l01056"></a>01056       }
<a name="l01057"></a>01057       <span class="keywordflow">else</span>
<a name="l01058"></a>01058       {
<a name="l01059"></a>01059          name = <a class="code" href="dlfcn_8c.html#0b7d7a9f21dd25d6dc50d712552f343a">get_lib_name</a>(dls-&gt;<a class="code" href="structdlstatus.html#e8acc63b1e238f3255c900eed37254b8">lib</a>);
<a name="l01060"></a>01060       }
<a name="l01061"></a>01061       <a class="code" href="dlfcn_8c.html#a0054ad56afd71085b56813f21a1544c">warning</a>(<span class="stringliteral">"trying to close a .dylib!"</span>);
<a name="l01062"></a>01062       <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"Not closing \"%s\" - dynamic libraries cannot be closed"</span>, name);
<a name="l01063"></a>01063       <span class="keywordflow">goto</span> dlcloseerror;
<a name="l01064"></a>01064    }
<a name="l01065"></a>01065    <span class="keywordflow">if</span> (!dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a>)
<a name="l01066"></a>01066    {
<a name="l01067"></a>01067       <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"module already closed"</span>);
<a name="l01068"></a>01068       <span class="keywordflow">goto</span> dlcloseerror;
<a name="l01069"></a>01069    }
<a name="l01070"></a>01070    
<a name="l01071"></a>01071    <span class="keywordflow">if</span> (dls-&gt;<a class="code" href="structdlstatus.html#5740713f144552f73502d802bc23dd35">refs</a> == 1)
<a name="l01072"></a>01072    {
<a name="l01073"></a>01073       <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> options = 0;
<a name="l01074"></a>01074       void (*fini) (void);
<a name="l01075"></a>01075       <span class="keywordflow">if</span> ((fini = <a class="code" href="dlfcn_8c.html#fbd7fb3690c8eff254f2690e831547b0">dlsymIntern</a>(dls, <span class="stringliteral">"__fini"</span>, 0)))
<a name="l01076"></a>01076       {
<a name="l01077"></a>01077          <a class="code" href="app__rpt_8c.html#ad42f6697b035b7580e4fef93be20b4d">debug</a>(<span class="stringliteral">"calling _fini()"</span>);
<a name="l01078"></a>01078          fini();
<a name="l01079"></a>01079       }
<a name="l01080"></a>01080 <span class="preprocessor">#ifdef __ppc__</span>
<a name="l01081"></a>01081 <span class="preprocessor"></span>      options |= NSUNLINKMODULE_OPTION_RESET_LAZY_REFERENCES;
<a name="l01082"></a>01082 <span class="preprocessor">#endif</span>
<a name="l01083"></a>01083 <span class="preprocessor"></span><span class="preprocessor">#if 1</span>
<a name="l01084"></a>01084 <span class="preprocessor"></span><span class="comment">/*  Currently, if a module contains c++ static destructors and it is unloaded, we</span>
<a name="l01085"></a>01085 <span class="comment"> *  get a segfault in atexit(), due to compiler and dynamic loader differences of</span>
<a name="l01086"></a>01086 <span class="comment"> *  opinion, this works around that.</span>
<a name="l01087"></a>01087 <span class="comment"> *  I really need a way to figure out from code if this is still necessary.</span>
<a name="l01088"></a>01088 <span class="comment"> */</span>
<a name="l01089"></a>01089       <span class="keywordflow">if</span> ((<span class="keyword">const</span> <span class="keyword">struct</span> section *)NULL !=
<a name="l01090"></a>01090          getsectbynamefromheader(<a class="code" href="dlfcn_8c.html#980566f5f6d3ca4e4f01c5d3cced8327">get_mach_header_from_NSModule</a>(dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a>),
<a name="l01091"></a>01091                            <span class="stringliteral">"__DATA"</span>, <span class="stringliteral">"__mod_term_func"</span>))
<a name="l01092"></a>01092       {
<a name="l01093"></a>01093          options |= NSUNLINKMODULE_OPTION_KEEP_MEMORY_MAPPED;
<a name="l01094"></a>01094       }
<a name="l01095"></a>01095 <span class="preprocessor">#endif</span>
<a name="l01096"></a>01096 <span class="preprocessor"></span><span class="preprocessor">#ifdef RTLD_NODELETE</span>
<a name="l01097"></a>01097 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="dlfcn_8c.html#de1ac04ff9536258d5099cd4ed3f0b84">isFlagSet</a>(dls-&gt;<a class="code" href="structdlstatus.html#15d61712450a686a7f365adf4fef581f">mode</a>, <a class="code" href="dlfcn-compat_8h.html#0cc0978e1ca3437f8a24fab84ea5f45a">RTLD_NODELETE</a>))
<a name="l01098"></a>01098          options |= NSUNLINKMODULE_OPTION_KEEP_MEMORY_MAPPED;
<a name="l01099"></a>01099 <span class="preprocessor">#endif</span>
<a name="l01100"></a>01100 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (!NSUnLinkModule(dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a>, options))
<a name="l01101"></a>01101       {
<a name="l01102"></a>01102          <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"unable to unlink module"</span>);
<a name="l01103"></a>01103          <span class="keywordflow">goto</span> dlcloseerror;
<a name="l01104"></a>01104       }
<a name="l01105"></a>01105       dls-&gt;<a class="code" href="structdlstatus.html#5740713f144552f73502d802bc23dd35">refs</a>--;
<a name="l01106"></a>01106       dls-&gt;<a class="code" href="structdlstatus.html#22884db148f0ffb0d830ba431102b0b5">module</a> = 0;
<a name="l01107"></a>01107       <span class="comment">/* Note: the dlstatus struct dls is neither removed from the list</span>
<a name="l01108"></a>01108 <span class="comment">       * nor is the memory it occupies freed. This shouldn't pose a </span>
<a name="l01109"></a>01109 <span class="comment">       * problem in mostly all cases, though.</span>
<a name="l01110"></a>01110 <span class="comment">       */</span>
<a name="l01111"></a>01111    }
<a name="l01112"></a>01112    <a class="code" href="dlfcn_8c.html#1db4dbf9ea9f28b2fb35656635a0bebe">dounlock</a>();
<a name="l01113"></a>01113    <span class="keywordflow">return</span> 0;
<a name="l01114"></a>01114   dlcloseerror:
<a name="l01115"></a>01115    <a class="code" href="dlfcn_8c.html#1db4dbf9ea9f28b2fb35656635a0bebe">dounlock</a>();
<a name="l01116"></a>01116    <span class="keywordflow">return</span> 1;
<a name="l01117"></a>01117 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="f4f18e7a664d25663c1a235c1fc7fade"></a><!-- doxytag: member="dlfcn-compat.h::dlerror" ref="f4f18e7a664d25663c1a235c1fc7fade" args="(void)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">const char* dlerror           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l01119">1119</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="dlfcn_8c-source.html#l00113">dlthread::errset</a>, and <a class="el" href="dlfcn_8c-source.html#l00114">dlthread::errstr</a>.<div class="fragment"><pre class="fragment"><a name="l01120"></a>01120 {
<a name="l01121"></a>01121    <span class="keyword">struct </span><a class="code" href="structdlthread.html">dlthread</a>  *tss;
<a name="l01122"></a>01122    <span class="keywordtype">char</span> * err_str;
<a name="l01123"></a>01123    tss = pthread_getspecific(<a class="code" href="dlfcn_8c.html#446c9e2cac70c4a3977923451eea13da">dlerror_key</a>);
<a name="l01124"></a>01124    err_str = tss-&gt;<a class="code" href="structdlthread.html#ac8ef2b34ca04ea40d46ffb53ef323f8">errstr</a>;
<a name="l01125"></a>01125    tss = pthread_getspecific(<a class="code" href="dlfcn_8c.html#446c9e2cac70c4a3977923451eea13da">dlerror_key</a>);
<a name="l01126"></a>01126    <span class="keywordflow">if</span> (tss-&gt;<a class="code" href="structdlthread.html#1d0e9ad7d1908eaf205e819f3255f92c">errset</a> == 0)
<a name="l01127"></a>01127       <span class="keywordflow">return</span> 0;
<a name="l01128"></a>01128    tss-&gt;<a class="code" href="structdlthread.html#1d0e9ad7d1908eaf205e819f3255f92c">errset</a> = 0;  
<a name="l01129"></a>01129    <span class="keywordflow">return</span> (err_str );
<a name="l01130"></a>01130 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="d4ea5e7e662612dc0e5a7ad0ff1e33b0"></a><!-- doxytag: member="dlfcn-compat.h::dlopen" ref="d4ea5e7e662612dc0e5a7ad0ff1e33b0" args="(const char *path, int mode)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void* dlopen           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>path</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00897">897</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="dlfcn_8c-source.html#l00801">dlcompat_init_func()</a>, <a class="el" href="dlfcn_8c-source.html#l00862">dolock()</a>, <a class="el" href="dlfcn_8c-source.html#l00885">dounlock()</a>, <a class="el" href="dlfcn_8c-source.html#l00196">error()</a>, <a class="el" href="dlfcn_8c-source.html#l00359">findFile()</a>, <a class="el" href="dlfcn_8c-source.html#l00398">isFlagSet()</a>, <a class="el" href="dlfcn_8c-source.html#l00685">loadModule()</a>, <a class="el" href="dlfcn_8c-source.html#l00403">lookupStatus()</a>, <a class="el" href="dlfcn_8c-source.html#l00451">reference()</a>, <a class="el" href="dlfcn_8c-source.html#l00125">dlstatus::refs</a>, <a class="el" href="dlfcn_8c-source.html#l00846">resetdlerror()</a>, <a class="el" href="dlfcn-compat_8h-source.html#l00071">RTLD_LAZY</a>, <a class="el" href="dlfcn-compat_8h-source.html#l00075">RTLD_NOLOAD</a>, and <a class="el" href="loader_8c-source.html#l00065">RTLD_NOW</a>.<div class="fragment"><pre class="fragment"><a name="l00898"></a>00898 {
<a name="l00899"></a>00899    <span class="keyword">const</span> <span class="keyword">struct </span>stat *sbuf;
<a name="l00900"></a>00900    <span class="keyword">struct </span><a class="code" href="structdlstatus.html">dlstatus</a> *dls;
<a name="l00901"></a>00901    <span class="keyword">const</span> <span class="keywordtype">char</span> *fullPath;
<a name="l00902"></a>00902    <a class="code" href="dlfcn_8c.html#83f7d76f85298415785439b62103645f">dlcompat_init_func</a>();      <span class="comment">/* Just in case */</span>
<a name="l00903"></a>00903    <a class="code" href="dlfcn_8c.html#3173031af7d4b847c50f22264d505a2a">dolock</a>();
<a name="l00904"></a>00904    <a class="code" href="dlfcn_8c.html#f79dfe72a8a68fc21a7a43fdebe8771e">resetdlerror</a>();
<a name="l00905"></a>00905    <span class="keywordflow">if</span> (!path)
<a name="l00906"></a>00906    {
<a name="l00907"></a>00907       dls = &amp;<a class="code" href="dlfcn_8c.html#86560ade58b777fa6f8f47ff729fee69">mainStatus</a>;
<a name="l00908"></a>00908       <span class="keywordflow">goto</span> dlopenok;
<a name="l00909"></a>00909    }
<a name="l00910"></a>00910    <span class="keywordflow">if</span> (!(sbuf = <a class="code" href="dlfcn_8c.html#5ce6066f9cbcf99b3cc6d47bc288daa8">findFile</a>(path, &amp;fullPath)))
<a name="l00911"></a>00911    {
<a name="l00912"></a>00912       <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"file \"%s\" not found"</span>, path);
<a name="l00913"></a>00913       <span class="keywordflow">goto</span> dlopenerror;
<a name="l00914"></a>00914    }
<a name="l00915"></a>00915    <span class="comment">/* Now checks that it hasn't been closed already */</span>
<a name="l00916"></a>00916    <span class="keywordflow">if</span> ((dls = <a class="code" href="dlfcn_8c.html#302bcae6e1b779aec6b07c4891b9283f">lookupStatus</a>(sbuf)) &amp;&amp; (dls-&gt;<a class="code" href="structdlstatus.html#5740713f144552f73502d802bc23dd35">refs</a> &gt; 0))
<a name="l00917"></a>00917    {
<a name="l00918"></a>00918       <span class="comment">/* debug("status found"); */</span>
<a name="l00919"></a>00919       dls = <a class="code" href="dlfcn_8c.html#f9549c9322f3ac5e9f28e0bb7552f8a1">reference</a>(dls, <a class="code" href="structdlstatus.html#15d61712450a686a7f365adf4fef581f">mode</a>);
<a name="l00920"></a>00920       <span class="keywordflow">goto</span> dlopenok;
<a name="l00921"></a>00921    }
<a name="l00922"></a>00922 <span class="preprocessor">#ifdef   RTLD_NOLOAD</span>
<a name="l00923"></a>00923 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (<a class="code" href="dlfcn_8c.html#de1ac04ff9536258d5099cd4ed3f0b84">isFlagSet</a>(<a class="code" href="structdlstatus.html#15d61712450a686a7f365adf4fef581f">mode</a>, <a class="code" href="dlfcn-compat_8h.html#cb78ca118dbf7ce21081e05f1a0e1406">RTLD_NOLOAD</a>))
<a name="l00924"></a>00924    {
<a name="l00925"></a>00925       <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"no existing handle and RTLD_NOLOAD specified"</span>);
<a name="l00926"></a>00926       <span class="keywordflow">goto</span> dlopenerror;
<a name="l00927"></a>00927    }
<a name="l00928"></a>00928 <span class="preprocessor">#endif</span>
<a name="l00929"></a>00929 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (<a class="code" href="dlfcn_8c.html#de1ac04ff9536258d5099cd4ed3f0b84">isFlagSet</a>(<a class="code" href="structdlstatus.html#15d61712450a686a7f365adf4fef581f">mode</a>, <a class="code" href="dlfcn-compat_8h.html#8884c6632ee6d253203a2d6deb4b7354">RTLD_LAZY</a>) &amp;&amp; <a class="code" href="dlfcn_8c.html#de1ac04ff9536258d5099cd4ed3f0b84">isFlagSet</a>(<a class="code" href="structdlstatus.html#15d61712450a686a7f365adf4fef581f">mode</a>, <a class="code" href="loader_8c.html#cebd9c7b300fbb075a0eb012c43879e8">RTLD_NOW</a>))
<a name="l00930"></a>00930    {
<a name="l00931"></a>00931       <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"how can I load something both RTLD_LAZY and RTLD_NOW?"</span>);
<a name="l00932"></a>00932       <span class="keywordflow">goto</span> dlopenerror;
<a name="l00933"></a>00933    }
<a name="l00934"></a>00934    dls = <a class="code" href="dlfcn_8c.html#3ccd00c1b00c0a0c2098a526ed71fe32">loadModule</a>(fullPath, sbuf, <a class="code" href="structdlstatus.html#15d61712450a686a7f365adf4fef581f">mode</a>);
<a name="l00935"></a>00935    
<a name="l00936"></a>00936   dlopenok:
<a name="l00937"></a>00937    <a class="code" href="dlfcn_8c.html#1db4dbf9ea9f28b2fb35656635a0bebe">dounlock</a>();
<a name="l00938"></a>00938    <span class="keywordflow">return</span> (<span class="keywordtype">void</span> *)dls;
<a name="l00939"></a>00939   dlopenerror:
<a name="l00940"></a>00940    <a class="code" href="dlfcn_8c.html#1db4dbf9ea9f28b2fb35656635a0bebe">dounlock</a>();
<a name="l00941"></a>00941    <span class="keywordflow">return</span> NULL;
<a name="l00942"></a>00942 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="def04fd1fe7f4abea4e0f3df9745048d"></a><!-- doxytag: member="dlfcn-compat.h::dlsym" ref="def04fd1fe7f4abea4e0f3df9745048d" args="(void *dl_restrict handle, const char *dl_restrict symbol)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void* dlsym           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void *dl_restrict&nbsp;</td>
          <td class="mdname" nowrap> <em>handle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *dl_restrict&nbsp;</td>
          <td class="mdname" nowrap> <em>symbol</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="dlfcn_8c-source.html#l00945">945</a> of file <a class="el" href="dlfcn_8c-source.html">dlfcn.c</a>.
<p>
References <a class="el" href="dlfcn_8c-source.html#l00560">dlsymIntern()</a>, <a class="el" href="dlfcn_8c-source.html#l00862">dolock()</a>, <a class="el" href="dlfcn_8c-source.html#l00885">dounlock()</a>, <a class="el" href="dlfcn_8c-source.html#l00196">error()</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, and <a class="el" href="astmm_8h-source.html#l00066">malloc</a>.<div class="fragment"><pre class="fragment"><a name="l00946"></a>00946 {
<a name="l00947"></a>00947    <span class="keywordtype">int</span> sym_len = strlen(symbol);
<a name="l00948"></a>00948    <span class="keywordtype">void</span> *value = NULL;
<a name="l00949"></a>00949    <span class="keywordtype">char</span> *malloc_sym = NULL;
<a name="l00950"></a>00950    <a class="code" href="dlfcn_8c.html#3173031af7d4b847c50f22264d505a2a">dolock</a>();
<a name="l00951"></a>00951    malloc_sym = <a class="code" href="astmm_8h.html#df74d22342f0da6246131193b1993a41">malloc</a>(sym_len + 2);
<a name="l00952"></a>00952    <span class="keywordflow">if</span> (malloc_sym)
<a name="l00953"></a>00953    {
<a name="l00954"></a>00954       sprintf(malloc_sym, <span class="stringliteral">"_%s"</span>, symbol);
<a name="l00955"></a>00955       value = <a class="code" href="dlfcn_8c.html#fbd7fb3690c8eff254f2690e831547b0">dlsymIntern</a>(handle, malloc_sym, 1);
<a name="l00956"></a>00956       <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(malloc_sym);
<a name="l00957"></a>00957    }
<a name="l00958"></a>00958    <span class="keywordflow">else</span>
<a name="l00959"></a>00959    {
<a name="l00960"></a>00960       <a class="code" href="dlfcn_8c.html#9989047f9754c69a45ea752cb417ca79">error</a>(<span class="stringliteral">"Unable to allocate memory"</span>);
<a name="l00961"></a>00961       <span class="keywordflow">goto</span> dlsymerror;
<a name="l00962"></a>00962    }
<a name="l00963"></a>00963    <a class="code" href="dlfcn_8c.html#1db4dbf9ea9f28b2fb35656635a0bebe">dounlock</a>();
<a name="l00964"></a>00964    <span class="keywordflow">return</span> value;
<a name="l00965"></a>00965   dlsymerror:
<a name="l00966"></a>00966    <a class="code" href="dlfcn_8c.html#1db4dbf9ea9f28b2fb35656635a0bebe">dounlock</a>();
<a name="l00967"></a>00967    <span class="keywordflow">return</span> NULL;
<a name="l00968"></a>00968 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu May 24 22:27:26 2007 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.5 </small></address>
</body>
</html>
