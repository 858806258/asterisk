<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (24 May 2007)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Thu May 24 22:27:47 2007</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Finclude_2F.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Finclude_2Fasterisk_2F.html">asterisk</a></div>
<h1>smdi.h File Reference</h1>SMDI support for Asterisk. <a href="#_details">More...</a>
<p>
<code>#include &lt;termios.h&gt;</code><br>
<code>#include &lt;<a class="el" href="time_8h-source.html">time.h</a>&gt;</code><br>
<code>#include &quot;<a class="el" href="config_8h-source.html">asterisk/config.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="module_8h-source.html">asterisk/module.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="astobj_8h-source.html">asterisk/astobj.h</a>&quot;</code><br>

<p>
<a href="smdi_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">SMDI interface structure.  <a href="structast__smdi__interface.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__smdi__md__message.html">ast_smdi_md_message</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">An SMDI message desk message.  <a href="structast__smdi__md__message.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__smdi__md__queue.html">ast_smdi_md_queue</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">SMDI message desk message queue.  <a href="structast__smdi__md__queue.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__smdi__mwi__message.html">ast_smdi_mwi_message</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">An SMDI message waiting indicator message.  <a href="structast__smdi__mwi__message.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__smdi__mwi__queue.html">ast_smdi_mwi_queue</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">SMDI message waiting indicator message queue.  <a href="structast__smdi__mwi__queue.html#_details">More...</a><br></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="smdi_8h.html#28a032b8e8d2c9be4fbeab412eb688af">SMDI_MAX_FILENAME_LEN</a>&nbsp;&nbsp;&nbsp;256</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="smdi_8h.html#401526b3ddf0fc503e47592b40770e1c">SMDI_MAX_STATION_NUM_LEN</a>&nbsp;&nbsp;&nbsp;10</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="smdi_8h.html#c471b138dcfc07750ec182399512c27d">SMDI_MESG_DESK_NUM_LEN</a>&nbsp;&nbsp;&nbsp;3</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="smdi_8h.html#a0b8b8d8fa9564c3aba837919eb83177">SMDI_MESG_DESK_TERM_LEN</a>&nbsp;&nbsp;&nbsp;4</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="smdi_8h.html#36f11a46ab62fb9d49abe23a0b219bf8">SMDI_MWI_FAIL_CAUSE_LEN</a>&nbsp;&nbsp;&nbsp;3</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="smdi_8h.html#9029aa568593edace124d7030046d4f2">ast_smdi_interface_destroy</a> (struct <a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a> *iface)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a> destructor.  <a href="#9029aa568593edace124d7030046d4f2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="smdi_8h.html#249d1773e8df65ccbc595e29342d17b6">ast_smdi_interface_find</a> (const char *iface_name)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find an SMDI interface with the specified name.  <a href="#249d1773e8df65ccbc595e29342d17b6"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="smdi_8h.html#a8435ff382225957ab4f884f143f478e">ast_smdi_md_message_destroy</a> (struct <a class="el" href="structast__smdi__md__message.html">ast_smdi_md_message</a> *<a class="el" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><a class="el" href="structast__smdi__md__message.html">ast_smdi_md_message</a> destructor.  <a href="#a8435ff382225957ab4f884f143f478e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__smdi__md__message.html">ast_smdi_md_message</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="smdi_8h.html#9dbb30234417d021937cb896ac0a0171">ast_smdi_md_message_pop</a> (struct <a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a> *iface)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the next SMDI message from the queue.  <a href="#9dbb30234417d021937cb896ac0a0171"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="smdi_8h.html#7799acace876dddc57f90bacf516bad0">ast_smdi_md_message_putback</a> (struct <a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a> *iface, struct <a class="el" href="structast__smdi__md__message.html">ast_smdi_md_message</a> *<a class="el" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Put an SMDI message back in the front of the queue.  <a href="#7799acace876dddc57f90bacf516bad0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__smdi__md__message.html">ast_smdi_md_message</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="smdi_8h.html#9babba9c2649950fdda3af91387e6f09">ast_smdi_md_message_wait</a> (struct <a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a> *iface, int timeout)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the next SMDI message from the queue.  <a href="#9babba9c2649950fdda3af91387e6f09"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="smdi_8h.html#26f240e1343fa898db0a1b6fb49c28ea">ast_smdi_mwi_message_destroy</a> (struct <a class="el" href="structast__smdi__mwi__message.html">ast_smdi_mwi_message</a> *<a class="el" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><a class="el" href="structast__smdi__mwi__message.html">ast_smdi_mwi_message</a> destructor.  <a href="#26f240e1343fa898db0a1b6fb49c28ea"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__smdi__mwi__message.html">ast_smdi_mwi_message</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="smdi_8h.html#9529aee88d9b3c388a3b902a34f255b2">ast_smdi_mwi_message_pop</a> (struct <a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a> *iface)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the next SMDI message from the queue.  <a href="#9529aee88d9b3c388a3b902a34f255b2"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="smdi_8h.html#2f8cc87ba46b9cf20020c836b34656f7">ast_smdi_mwi_message_putback</a> (struct <a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a> *iface, struct <a class="el" href="structast__smdi__mwi__message.html">ast_smdi_mwi_message</a> *<a class="el" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Put an SMDI message back in the front of the queue.  <a href="#2f8cc87ba46b9cf20020c836b34656f7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structast__smdi__mwi__message.html">ast_smdi_mwi_message</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="smdi_8h.html#2cb785c8551401a05b5af729121464bf">ast_smdi_mwi_message_wait</a> (struct <a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a> *iface, int timeout)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the next SMDI message from the queue.  <a href="#2cb785c8551401a05b5af729121464bf"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="smdi_8h.html#6018412a2ff79bc26234e3eb4986eb2e">ast_smdi_mwi_set</a> (struct <a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a> *iface, const char *<a class="el" href="chan__skinny_8c.html#be2fc5fd64209e633c78549d39c04fb2">mailbox</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set the MWI indicator for a mailbox.  <a href="#6018412a2ff79bc26234e3eb4986eb2e"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="smdi_8h.html#be4f7404e1d8acc32800d2f7ed9ba08c">ast_smdi_mwi_unset</a> (struct <a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a> *iface, const char *<a class="el" href="chan__skinny_8c.html#be2fc5fd64209e633c78549d39c04fb2">mailbox</a>)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unset the MWI indicator for a mailbox.  <a href="#be4f7404e1d8acc32800d2f7ed9ba08c"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
SMDI support for Asterisk. 
<p>
<dl compact><dt><b>Author:</b></dt><dd>Matthew A. Nicholson &lt;<a href="mailto:mnicholson@digium.com">mnicholson@digium.com</a>&gt; </dd></dl>

<p>
Definition in file <a class="el" href="smdi_8h-source.html">smdi.h</a>.<hr><h2>Define Documentation</h2>
<a class="anchor" name="28a032b8e8d2c9be4fbeab412eb688af"></a><!-- doxytag: member="smdi.h::SMDI_MAX_FILENAME_LEN" ref="28a032b8e8d2c9be4fbeab412eb688af" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define SMDI_MAX_FILENAME_LEN&nbsp;&nbsp;&nbsp;256          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="smdi_8h-source.html#l00043">43</a> of file <a class="el" href="smdi_8h-source.html">smdi.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="401526b3ddf0fc503e47592b40770e1c"></a><!-- doxytag: member="smdi.h::SMDI_MAX_STATION_NUM_LEN" ref="401526b3ddf0fc503e47592b40770e1c" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define SMDI_MAX_STATION_NUM_LEN&nbsp;&nbsp;&nbsp;10          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="smdi_8h-source.html#l00042">42</a> of file <a class="el" href="smdi_8h-source.html">smdi.h</a>.
<p>
Referenced by <a class="el" href="res__smdi_8c-source.html#l00335">smdi_read()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="c471b138dcfc07750ec182399512c27d"></a><!-- doxytag: member="smdi.h::SMDI_MESG_DESK_NUM_LEN" ref="c471b138dcfc07750ec182399512c27d" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define SMDI_MESG_DESK_NUM_LEN&nbsp;&nbsp;&nbsp;3          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="smdi_8h-source.html#l00039">39</a> of file <a class="el" href="smdi_8h-source.html">smdi.h</a>.
<p>
Referenced by <a class="el" href="res__smdi_8c-source.html#l00335">smdi_read()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0b8b8d8fa9564c3aba837919eb83177"></a><!-- doxytag: member="smdi.h::SMDI_MESG_DESK_TERM_LEN" ref="a0b8b8d8fa9564c3aba837919eb83177" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define SMDI_MESG_DESK_TERM_LEN&nbsp;&nbsp;&nbsp;4          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="smdi_8h-source.html#l00040">40</a> of file <a class="el" href="smdi_8h-source.html">smdi.h</a>.
<p>
Referenced by <a class="el" href="res__smdi_8c-source.html#l00335">smdi_read()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="36f11a46ab62fb9d49abe23a0b219bf8"></a><!-- doxytag: member="smdi.h::SMDI_MWI_FAIL_CAUSE_LEN" ref="36f11a46ab62fb9d49abe23a0b219bf8" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">#define SMDI_MWI_FAIL_CAUSE_LEN&nbsp;&nbsp;&nbsp;3          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="smdi_8h-source.html#l00041">41</a> of file <a class="el" href="smdi_8h-source.html">smdi.h</a>.
<p>
Referenced by <a class="el" href="res__smdi_8c-source.html#l00335">smdi_read()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="9029aa568593edace124d7030046d4f2"></a><!-- doxytag: member="smdi.h::ast_smdi_interface_destroy" ref="9029aa568593edace124d7030046d4f2" args="(struct ast_smdi_interface *iface)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_smdi_interface_destroy           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>iface</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a> destructor. 
<p>

<p>
Definition at line <a class="el" href="res__smdi_8c-source.html#l00489">489</a> of file <a class="el" href="res__smdi_8c-source.html">res_smdi.c</a>.
<p>
References <a class="el" href="loader_8c-source.html#l00947">ast_module_unref()</a>, <a class="el" href="lock_8h-source.html#l00074">AST_PTHREADT_NULL</a>, <a class="el" href="lock_8h-source.html#l00075">AST_PTHREADT_STOP</a>, <a class="el" href="res__smdi_8c-source.html#l00477">ast_smdi_md_message_destroy()</a>, <a class="el" href="res__smdi_8c-source.html#l00483">ast_smdi_mwi_message_destroy()</a>, <a class="el" href="astobj_8h-source.html#l00766">ASTOBJ_CONTAINER_DESTROY</a>, <a class="el" href="astobj_8h-source.html#l00454">ASTOBJ_CONTAINER_DESTROYALL</a>, <a class="el" href="smdi_8h-source.html#l00097">ast_smdi_interface::file</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="smdi_8h-source.html#l00095">ast_smdi_interface::md_q</a>, <a class="el" href="smdi_8h-source.html#l00096">ast_smdi_interface::mwi_q</a>, and <a class="el" href="smdi_8h-source.html#l00099">ast_smdi_interface::thread</a>.
<p>
Referenced by <a class="el" href="chan__zap_8c-source.html#l02407">destroy_zt_pvt()</a>, <a class="el" href="res__smdi_8c-source.html#l00520">smdi_load()</a>, <a class="el" href="res__smdi_8c-source.html#l00335">smdi_read()</a>, and <a class="el" href="res__smdi_8c-source.html#l00731">unload_module()</a>.<div class="fragment"><pre class="fragment"><a name="l00490"></a>00490 {
<a name="l00491"></a>00491    <span class="keywordflow">if</span> (iface-&gt;<a class="code" href="structast__smdi__interface.html#dc127f5d2483352fd20eaddb38feb6d2">thread</a> != <a class="code" href="lock_8h.html#84e4b34008de83ea9d1fa44057758022">AST_PTHREADT_NULL</a> &amp;&amp; iface-&gt;<a class="code" href="structast__smdi__interface.html#dc127f5d2483352fd20eaddb38feb6d2">thread</a> != <a class="code" href="lock_8h.html#8dcec06d78545e75eee3aa4723faeb1e">AST_PTHREADT_STOP</a>) {
<a name="l00492"></a>00492       pthread_cancel(iface-&gt;<a class="code" href="structast__smdi__interface.html#dc127f5d2483352fd20eaddb38feb6d2">thread</a>);
<a name="l00493"></a>00493       pthread_join(iface-&gt;<a class="code" href="structast__smdi__interface.html#dc127f5d2483352fd20eaddb38feb6d2">thread</a>, NULL);
<a name="l00494"></a>00494    }
<a name="l00495"></a>00495    
<a name="l00496"></a>00496    iface-&gt;<a class="code" href="structast__smdi__interface.html#dc127f5d2483352fd20eaddb38feb6d2">thread</a> = <a class="code" href="lock_8h.html#8dcec06d78545e75eee3aa4723faeb1e">AST_PTHREADT_STOP</a>;
<a name="l00497"></a>00497    
<a name="l00498"></a>00498    <span class="keywordflow">if</span>(iface-&gt;<a class="code" href="structast__smdi__interface.html#8c7dd922ad47494fc02c388e12c00eac">file</a>) 
<a name="l00499"></a>00499       fclose(iface-&gt;<a class="code" href="structast__smdi__interface.html#8c7dd922ad47494fc02c388e12c00eac">file</a>);
<a name="l00500"></a>00500    
<a name="l00501"></a>00501    <a class="code" href="astobj_8h.html#d501a6c1936784f0e38c7460cd0450de">ASTOBJ_CONTAINER_DESTROYALL</a>(&amp;iface-&gt;<a class="code" href="structast__smdi__interface.html#3f8c89d4dde4d73a610bf9598eb7f0d3">md_q</a>, <a class="code" href="smdi_8h.html#a8435ff382225957ab4f884f143f478e">ast_smdi_md_message_destroy</a>);
<a name="l00502"></a>00502    <a class="code" href="astobj_8h.html#d501a6c1936784f0e38c7460cd0450de">ASTOBJ_CONTAINER_DESTROYALL</a>(&amp;iface-&gt;<a class="code" href="structast__smdi__interface.html#d7ac20fcf9593dfebaf7eed2b2533375">mwi_q</a>, <a class="code" href="smdi_8h.html#26f240e1343fa898db0a1b6fb49c28ea">ast_smdi_mwi_message_destroy</a>);
<a name="l00503"></a>00503    <a class="code" href="astobj_8h.html#49009cb461a700fd0edeede01cf60a45">ASTOBJ_CONTAINER_DESTROY</a>(&amp;iface-&gt;<a class="code" href="structast__smdi__interface.html#3f8c89d4dde4d73a610bf9598eb7f0d3">md_q</a>);
<a name="l00504"></a>00504    <a class="code" href="astobj_8h.html#49009cb461a700fd0edeede01cf60a45">ASTOBJ_CONTAINER_DESTROY</a>(&amp;iface-&gt;<a class="code" href="structast__smdi__interface.html#d7ac20fcf9593dfebaf7eed2b2533375">mwi_q</a>);
<a name="l00505"></a>00505    <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(iface);
<a name="l00506"></a>00506 
<a name="l00507"></a>00507    <a class="code" href="loader_8c.html#593d1afacbd4c5bd89aac5a810e50f6e">ast_module_unref</a>(<a class="code" href="structast__module__info.html">ast_module_info</a>-&gt;self);
<a name="l00508"></a>00508 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="249d1773e8df65ccbc595e29342d17b6"></a><!-- doxytag: member="smdi.h::ast_smdi_interface_find" ref="249d1773e8df65ccbc595e29342d17b6" args="(const char *iface_name)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a>* ast_smdi_interface_find           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>iface_name</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Find an SMDI interface with the specified name. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>iface_name</em>&nbsp;</td><td>the name/port of the interface to search for.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>a pointer to the interface located or NULL if none was found. This actually returns an ASTOBJ reference and should be released using <a class="el" href="astobj_8h.html#5a9448be019b56fa37bce1be4bc2a48f">ASTOBJ_UNREF(iface, ast_smdi_interface_destroy)</a>. </dd></dl>

<p>
Definition at line <a class="el" href="res__smdi_8c-source.html#l00323">323</a> of file <a class="el" href="res__smdi_8c-source.html">res_smdi.c</a>.
<p>
References <a class="el" href="astobj_8h-source.html#l00402">ASTOBJ_CONTAINER_FIND</a>, and <a class="el" href="res__smdi_8c.html#008b8c6323578d5bdece62e26931cab8">smdi_ifaces</a>.
<p>
Referenced by <a class="el" href="app__voicemail_8c-source.html#l07508">load_config()</a>, and <a class="el" href="chan__zap_8c-source.html#l07493">mkintf()</a>.<div class="fragment"><pre class="fragment"><a name="l00324"></a>00324 {
<a name="l00325"></a>00325    <span class="keywordflow">return</span> (<a class="code" href="astobj_8h.html#bb4a582d1b01a686da4f5dacfab2cfba">ASTOBJ_CONTAINER_FIND</a>(&amp;<a class="code" href="res__smdi_8c.html#008b8c6323578d5bdece62e26931cab8">smdi_ifaces</a>, iface_name));
<a name="l00326"></a>00326 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a8435ff382225957ab4f884f143f478e"></a><!-- doxytag: member="smdi.h::ast_smdi_md_message_destroy" ref="a8435ff382225957ab4f884f143f478e" args="(struct ast_smdi_md_message *msg)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_smdi_md_message_destroy           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__smdi__md__message.html">ast_smdi_md_message</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<a class="el" href="structast__smdi__md__message.html">ast_smdi_md_message</a> destructor. 
<p>

<p>
Definition at line <a class="el" href="res__smdi_8c-source.html#l00477">477</a> of file <a class="el" href="res__smdi_8c-source.html">res_smdi.c</a>.
<p>
References <a class="el" href="astmm_8h-source.html#l00069">free</a>.
<p>
Referenced by <a class="el" href="res__smdi_8c-source.html#l00489">ast_smdi_interface_destroy()</a>, <a class="el" href="res__smdi_8c-source.html#l00189">ast_smdi_md_message_pop()</a>, <a class="el" href="res__smdi_8c-source.html#l00335">smdi_read()</a>, and <a class="el" href="chan__zap_8c-source.html#l05744">ss_thread()</a>.<div class="fragment"><pre class="fragment"><a name="l00478"></a>00478 {
<a name="l00479"></a>00479    <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(msg);
<a name="l00480"></a>00480 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="9dbb30234417d021937cb896ac0a0171"></a><!-- doxytag: member="smdi.h::ast_smdi_md_message_pop" ref="9dbb30234417d021937cb896ac0a0171" args="(struct ast_smdi_interface *iface)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__smdi__md__message.html">ast_smdi_md_message</a>* ast_smdi_md_message_pop           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>iface</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get the next SMDI message from the queue. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>iface</em>&nbsp;</td><td>a pointer to the interface to use.</td></tr>
  </table>
</dl>
This function pulls the first unexpired message from the SMDI message queue on the specified interface. It will purge all expired SMDI messages before returning.<p>
<dl compact><dt><b>Returns:</b></dt><dd>the next SMDI message, or NULL if there were no pending messages. </dd></dl>

<p>
Definition at line <a class="el" href="res__smdi_8c-source.html#l00189">189</a> of file <a class="el" href="res__smdi_8c-source.html">res_smdi.c</a>.
<p>
References <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="res__smdi_8c-source.html#l00477">ast_smdi_md_message_destroy()</a>, <a class="el" href="astobj_8h-source.html#l00631">ASTOBJ_CONTAINER_UNLINK_START</a>, <a class="el" href="astobj_8h-source.html#l00219">ASTOBJ_UNREF</a>, <a class="el" href="logger_8h-source.html#l00106">LOG_NOTICE</a>, <a class="el" href="smdi_8h-source.html#l00095">ast_smdi_interface::md_q</a>, <a class="el" href="smdi_8h-source.html#l00102">ast_smdi_interface::msg_expiry</a>, and <a class="el" href="smdi_8h-source.html#l00073">ast_smdi_md_message::timestamp</a>.
<p>
Referenced by <a class="el" href="res__smdi_8c-source.html#l00228">ast_smdi_md_message_wait()</a>.<div class="fragment"><pre class="fragment"><a name="l00190"></a>00190 {
<a name="l00191"></a>00191    <span class="keyword">struct </span><a class="code" href="structast__smdi__md__message.html">ast_smdi_md_message</a> *md_msg = <a class="code" href="astobj_8h.html#daa092f2410b7d53c3d4c71fb170dc2a">ASTOBJ_CONTAINER_UNLINK_START</a>(&amp;iface-&gt;<a class="code" href="structast__smdi__interface.html#3f8c89d4dde4d73a610bf9598eb7f0d3">md_q</a>);
<a name="l00192"></a>00192    <span class="keyword">struct </span>timeval now;
<a name="l00193"></a>00193    <span class="keywordtype">long</span> elapsed = 0;
<a name="l00194"></a>00194 
<a name="l00195"></a>00195    <span class="comment">/* purge old messages */</span>
<a name="l00196"></a>00196    now = ast_tvnow();
<a name="l00197"></a>00197    <span class="keywordflow">while</span> (md_msg) {
<a name="l00198"></a>00198       elapsed = ast_tvdiff_ms(now, md_msg-&gt;<a class="code" href="structast__smdi__md__message.html#d7e6d55ba379a13d08c25d15faf2a23b">timestamp</a>);
<a name="l00199"></a>00199 
<a name="l00200"></a>00200       <span class="keywordflow">if</span> (elapsed &gt; iface-&gt;<a class="code" href="structast__smdi__interface.html#1e5801b70e88261a93a6927ed7a250f2">msg_expiry</a>) {
<a name="l00201"></a>00201          <span class="comment">/* found an expired message */</span>
<a name="l00202"></a>00202          <a class="code" href="astobj_8h.html#5a9448be019b56fa37bce1be4bc2a48f">ASTOBJ_UNREF</a>(md_msg, <a class="code" href="smdi_8h.html#a8435ff382225957ab4f884f143f478e">ast_smdi_md_message_destroy</a>);
<a name="l00203"></a>00203          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#bbf95aad74d847cd4bcb129604f798cd">LOG_NOTICE</a>, <span class="stringliteral">"Purged expired message from %s SMDI MD message queue.  Message was %ld milliseconds too old.\n"</span>,
<a name="l00204"></a>00204             iface-&gt;name, elapsed - iface-&gt;<a class="code" href="structast__smdi__interface.html#1e5801b70e88261a93a6927ed7a250f2">msg_expiry</a>);
<a name="l00205"></a>00205          md_msg = <a class="code" href="astobj_8h.html#daa092f2410b7d53c3d4c71fb170dc2a">ASTOBJ_CONTAINER_UNLINK_START</a>(&amp;iface-&gt;<a class="code" href="structast__smdi__interface.html#3f8c89d4dde4d73a610bf9598eb7f0d3">md_q</a>);
<a name="l00206"></a>00206       }
<a name="l00207"></a>00207       <span class="keywordflow">else</span> {
<a name="l00208"></a>00208          <span class="comment">/* good message, return it */</span>
<a name="l00209"></a>00209          <span class="keywordflow">break</span>;
<a name="l00210"></a>00210       }
<a name="l00211"></a>00211    }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213    <span class="keywordflow">return</span> md_msg;
<a name="l00214"></a>00214 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="7799acace876dddc57f90bacf516bad0"></a><!-- doxytag: member="smdi.h::ast_smdi_md_message_putback" ref="7799acace876dddc57f90bacf516bad0" args="(struct ast_smdi_interface *iface, struct ast_smdi_md_message *msg)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_smdi_md_message_putback           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>iface</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct <a class="el" href="structast__smdi__md__message.html">ast_smdi_md_message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>md_msg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Put an SMDI message back in the front of the queue. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>iface</em>&nbsp;</td><td>a pointer to the interface to use. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>md_msg</em>&nbsp;</td><td>a pointer to the message to use.</td></tr>
  </table>
</dl>
This function puts a message back in the front of the specified queue. It should be used if a message was popped but is not going to be processed for some reason, and the message needs to be returned to the queue. 
<p>
Definition at line <a class="el" href="res__smdi_8c-source.html#l00160">160</a> of file <a class="el" href="res__smdi_8c-source.html">res_smdi.c</a>.
<p>
References <a class="el" href="astobj_8h-source.html#l00611">ASTOBJ_CONTAINER_LINK_START</a>, and <a class="el" href="smdi_8h-source.html#l00095">ast_smdi_interface::md_q</a>.<div class="fragment"><pre class="fragment"><a name="l00161"></a>00161 {
<a name="l00162"></a>00162    <a class="code" href="astobj_8h.html#a79ba50d4a7a6e2c7190c4ff0baa6335">ASTOBJ_CONTAINER_LINK_START</a>(&amp;iface-&gt;<a class="code" href="structast__smdi__interface.html#3f8c89d4dde4d73a610bf9598eb7f0d3">md_q</a>, md_msg);
<a name="l00163"></a>00163 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="9babba9c2649950fdda3af91387e6f09"></a><!-- doxytag: member="smdi.h::ast_smdi_md_message_wait" ref="9babba9c2649950fdda3af91387e6f09" args="(struct ast_smdi_interface *iface, int timeout)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__smdi__md__message.html">ast_smdi_md_message</a>* ast_smdi_md_message_wait           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>iface</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>timeout</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get the next SMDI message from the queue. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>iface</em>&nbsp;</td><td>a pointer to the interface to use. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>timeout</em>&nbsp;</td><td>the time to wait before returning in milliseconds.</td></tr>
  </table>
</dl>
This function pulls a message from the SMDI message queue on the specified interface. If no message is available this function will wait the specified amount of time before returning.<p>
<dl compact><dt><b>Returns:</b></dt><dd>the next SMDI message, or NULL if there were no pending messages and the timeout has expired. </dd></dl>

<p>
Definition at line <a class="el" href="res__smdi_8c-source.html#l00228">228</a> of file <a class="el" href="res__smdi_8c-source.html">res_smdi.c</a>.
<p>
References <a class="el" href="res__smdi_8c-source.html#l00189">ast_smdi_md_message_pop()</a>, and <a class="el" href="adsistub_8c-source.html#l00061">msg</a>.
<p>
Referenced by <a class="el" href="chan__zap_8c-source.html#l05744">ss_thread()</a>.<div class="fragment"><pre class="fragment"><a name="l00229"></a>00229 {
<a name="l00230"></a>00230    <span class="keyword">struct </span>timeval start;
<a name="l00231"></a>00231    <span class="keywordtype">long</span> diff = 0;
<a name="l00232"></a>00232    <span class="keyword">struct </span><a class="code" href="structast__smdi__md__message.html">ast_smdi_md_message</a> *<a class="code" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>;
<a name="l00233"></a>00233 
<a name="l00234"></a>00234    start = ast_tvnow();
<a name="l00235"></a>00235    <span class="keywordflow">while</span> (diff &lt; timeout) {
<a name="l00236"></a>00236 
<a name="l00237"></a>00237       <span class="keywordflow">if</span> ((msg = <a class="code" href="smdi_8h.html#9dbb30234417d021937cb896ac0a0171">ast_smdi_md_message_pop</a>(iface)))
<a name="l00238"></a>00238          <span class="keywordflow">return</span> msg;
<a name="l00239"></a>00239 
<a name="l00240"></a>00240       <span class="comment">/* check timeout */</span>
<a name="l00241"></a>00241       diff = ast_tvdiff_ms(ast_tvnow(), start);
<a name="l00242"></a>00242    }
<a name="l00243"></a>00243 
<a name="l00244"></a>00244    <span class="keywordflow">return</span> (<a class="code" href="smdi_8h.html#9dbb30234417d021937cb896ac0a0171">ast_smdi_md_message_pop</a>(iface));
<a name="l00245"></a>00245 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="26f240e1343fa898db0a1b6fb49c28ea"></a><!-- doxytag: member="smdi.h::ast_smdi_mwi_message_destroy" ref="26f240e1343fa898db0a1b6fb49c28ea" args="(struct ast_smdi_mwi_message *msg)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_smdi_mwi_message_destroy           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__smdi__mwi__message.html">ast_smdi_mwi_message</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>msg</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<a class="el" href="structast__smdi__mwi__message.html">ast_smdi_mwi_message</a> destructor. 
<p>

<p>
Definition at line <a class="el" href="res__smdi_8c-source.html#l00483">483</a> of file <a class="el" href="res__smdi_8c-source.html">res_smdi.c</a>.
<p>
References <a class="el" href="astmm_8h-source.html#l00069">free</a>.
<p>
Referenced by <a class="el" href="res__smdi_8c-source.html#l00489">ast_smdi_interface_destroy()</a>, <a class="el" href="res__smdi_8c-source.html#l00257">ast_smdi_mwi_message_pop()</a>, <a class="el" href="app__voicemail_8c-source.html#l02907">run_externnotify()</a>, and <a class="el" href="res__smdi_8c-source.html#l00335">smdi_read()</a>.<div class="fragment"><pre class="fragment"><a name="l00484"></a>00484 {
<a name="l00485"></a>00485    <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(msg);
<a name="l00486"></a>00486 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="9529aee88d9b3c388a3b902a34f255b2"></a><!-- doxytag: member="smdi.h::ast_smdi_mwi_message_pop" ref="9529aee88d9b3c388a3b902a34f255b2" args="(struct ast_smdi_interface *iface)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__smdi__mwi__message.html">ast_smdi_mwi_message</a>* ast_smdi_mwi_message_pop           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>iface</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get the next SMDI message from the queue. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>iface</em>&nbsp;</td><td>a pointer to the interface to use.</td></tr>
  </table>
</dl>
This function pulls the first unexpired message from the SMDI message queue on the specified interface. It will purge all expired SMDI messages before returning.<p>
<dl compact><dt><b>Returns:</b></dt><dd>the next SMDI message, or NULL if there were no pending messages. </dd></dl>

<p>
Definition at line <a class="el" href="res__smdi_8c-source.html#l00257">257</a> of file <a class="el" href="res__smdi_8c-source.html">res_smdi.c</a>.
<p>
References <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="res__smdi_8c-source.html#l00483">ast_smdi_mwi_message_destroy()</a>, <a class="el" href="astobj_8h-source.html#l00631">ASTOBJ_CONTAINER_UNLINK_START</a>, <a class="el" href="astobj_8h-source.html#l00219">ASTOBJ_UNREF</a>, <a class="el" href="logger_8h-source.html#l00106">LOG_NOTICE</a>, <a class="el" href="smdi_8h-source.html#l00102">ast_smdi_interface::msg_expiry</a>, <a class="el" href="smdi_8h-source.html#l00096">ast_smdi_interface::mwi_q</a>, and <a class="el" href="smdi_8h-source.html#l00056">ast_smdi_mwi_message::timestamp</a>.
<p>
Referenced by <a class="el" href="res__smdi_8c-source.html#l00296">ast_smdi_mwi_message_wait()</a>.<div class="fragment"><pre class="fragment"><a name="l00258"></a>00258 {
<a name="l00259"></a>00259    <span class="keyword">struct </span><a class="code" href="structast__smdi__mwi__message.html">ast_smdi_mwi_message</a> *mwi_msg = <a class="code" href="astobj_8h.html#daa092f2410b7d53c3d4c71fb170dc2a">ASTOBJ_CONTAINER_UNLINK_START</a>(&amp;iface-&gt;<a class="code" href="structast__smdi__interface.html#d7ac20fcf9593dfebaf7eed2b2533375">mwi_q</a>);
<a name="l00260"></a>00260    <span class="keyword">struct </span>timeval now;
<a name="l00261"></a>00261    <span class="keywordtype">long</span> elapsed = 0;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263    <span class="comment">/* purge old messages */</span>
<a name="l00264"></a>00264    now = ast_tvnow();
<a name="l00265"></a>00265    <span class="keywordflow">while</span> (mwi_msg)   {
<a name="l00266"></a>00266       elapsed = ast_tvdiff_ms(now, mwi_msg-&gt;<a class="code" href="structast__smdi__mwi__message.html#d7e6d55ba379a13d08c25d15faf2a23b">timestamp</a>);
<a name="l00267"></a>00267 
<a name="l00268"></a>00268       <span class="keywordflow">if</span> (elapsed &gt; iface-&gt;<a class="code" href="structast__smdi__interface.html#1e5801b70e88261a93a6927ed7a250f2">msg_expiry</a>) {
<a name="l00269"></a>00269          <span class="comment">/* found an expired message */</span>
<a name="l00270"></a>00270          <a class="code" href="astobj_8h.html#5a9448be019b56fa37bce1be4bc2a48f">ASTOBJ_UNREF</a>(mwi_msg, <a class="code" href="smdi_8h.html#26f240e1343fa898db0a1b6fb49c28ea">ast_smdi_mwi_message_destroy</a>);
<a name="l00271"></a>00271          <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#bbf95aad74d847cd4bcb129604f798cd">LOG_NOTICE</a>, <span class="stringliteral">"Purged expired message from %s SMDI MWI message queue.  Message was %ld milliseconds too old.\n"</span>,
<a name="l00272"></a>00272             iface-&gt;name, elapsed - iface-&gt;<a class="code" href="structast__smdi__interface.html#1e5801b70e88261a93a6927ed7a250f2">msg_expiry</a>);
<a name="l00273"></a>00273          mwi_msg = <a class="code" href="astobj_8h.html#daa092f2410b7d53c3d4c71fb170dc2a">ASTOBJ_CONTAINER_UNLINK_START</a>(&amp;iface-&gt;<a class="code" href="structast__smdi__interface.html#d7ac20fcf9593dfebaf7eed2b2533375">mwi_q</a>);
<a name="l00274"></a>00274       }
<a name="l00275"></a>00275       <span class="keywordflow">else</span> {
<a name="l00276"></a>00276          <span class="comment">/* good message, return it */</span>
<a name="l00277"></a>00277          <span class="keywordflow">break</span>;
<a name="l00278"></a>00278       }
<a name="l00279"></a>00279    }
<a name="l00280"></a>00280 
<a name="l00281"></a>00281    <span class="keywordflow">return</span> mwi_msg;
<a name="l00282"></a>00282 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="2f8cc87ba46b9cf20020c836b34656f7"></a><!-- doxytag: member="smdi.h::ast_smdi_mwi_message_putback" ref="2f8cc87ba46b9cf20020c836b34656f7" args="(struct ast_smdi_interface *iface, struct ast_smdi_mwi_message *msg)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_smdi_mwi_message_putback           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>iface</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>struct <a class="el" href="structast__smdi__mwi__message.html">ast_smdi_mwi_message</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>mwi_msg</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Put an SMDI message back in the front of the queue. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>iface</em>&nbsp;</td><td>a pointer to the interface to use. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mwi_msg</em>&nbsp;</td><td>a pointer to the message to use.</td></tr>
  </table>
</dl>
This function puts a message back in the front of the specified queue. It should be used if a message was popped but is not going to be processed for some reason, and the message needs to be returned to the queue. 
<p>
Definition at line <a class="el" href="res__smdi_8c-source.html#l00174">174</a> of file <a class="el" href="res__smdi_8c-source.html">res_smdi.c</a>.
<p>
References <a class="el" href="astobj_8h-source.html#l00611">ASTOBJ_CONTAINER_LINK_START</a>, and <a class="el" href="smdi_8h-source.html#l00096">ast_smdi_interface::mwi_q</a>.<div class="fragment"><pre class="fragment"><a name="l00175"></a>00175 {
<a name="l00176"></a>00176    <a class="code" href="astobj_8h.html#a79ba50d4a7a6e2c7190c4ff0baa6335">ASTOBJ_CONTAINER_LINK_START</a>(&amp;iface-&gt;<a class="code" href="structast__smdi__interface.html#d7ac20fcf9593dfebaf7eed2b2533375">mwi_q</a>, mwi_msg);
<a name="l00177"></a>00177 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="2cb785c8551401a05b5af729121464bf"></a><!-- doxytag: member="smdi.h::ast_smdi_mwi_message_wait" ref="2cb785c8551401a05b5af729121464bf" args="(struct ast_smdi_interface *iface, int timeout)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__smdi__mwi__message.html">ast_smdi_mwi_message</a>* ast_smdi_mwi_message_wait           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>iface</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>timeout</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get the next SMDI message from the queue. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>iface</em>&nbsp;</td><td>a pointer to the interface to use. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>timeout</em>&nbsp;</td><td>the time to wait before returning in milliseconds.</td></tr>
  </table>
</dl>
This function pulls a message from the SMDI message queue on the specified interface. If no message is available this function will wait the specified amount of time before returning.<p>
<dl compact><dt><b>Returns:</b></dt><dd>the next SMDI message, or NULL if there were no pending messages and the timeout has expired. </dd></dl>

<p>
Definition at line <a class="el" href="res__smdi_8c-source.html#l00296">296</a> of file <a class="el" href="res__smdi_8c-source.html">res_smdi.c</a>.
<p>
References <a class="el" href="res__smdi_8c-source.html#l00257">ast_smdi_mwi_message_pop()</a>, and <a class="el" href="adsistub_8c-source.html#l00061">msg</a>.
<p>
Referenced by <a class="el" href="app__voicemail_8c-source.html#l02907">run_externnotify()</a>.<div class="fragment"><pre class="fragment"><a name="l00297"></a>00297 {
<a name="l00298"></a>00298    <span class="keyword">struct </span>timeval start;
<a name="l00299"></a>00299    <span class="keywordtype">long</span> diff = 0;
<a name="l00300"></a>00300    <span class="keyword">struct </span><a class="code" href="structast__smdi__mwi__message.html">ast_smdi_mwi_message</a> *<a class="code" href="adsistub_8c.html#6e2baaf3b97dbeef01c0043275f9a0e7">msg</a>;
<a name="l00301"></a>00301 
<a name="l00302"></a>00302    start = ast_tvnow();
<a name="l00303"></a>00303    <span class="keywordflow">while</span> (diff &lt; timeout) {
<a name="l00304"></a>00304 
<a name="l00305"></a>00305       <span class="keywordflow">if</span> ((msg = <a class="code" href="smdi_8h.html#9529aee88d9b3c388a3b902a34f255b2">ast_smdi_mwi_message_pop</a>(iface)))
<a name="l00306"></a>00306          <span class="keywordflow">return</span> msg;
<a name="l00307"></a>00307 
<a name="l00308"></a>00308       <span class="comment">/* check timeout */</span>
<a name="l00309"></a>00309       diff = ast_tvdiff_ms(ast_tvnow(), start);
<a name="l00310"></a>00310    }
<a name="l00311"></a>00311 
<a name="l00312"></a>00312    <span class="keywordflow">return</span> (<a class="code" href="smdi_8h.html#9529aee88d9b3c388a3b902a34f255b2">ast_smdi_mwi_message_pop</a>(iface));
<a name="l00313"></a>00313 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="6018412a2ff79bc26234e3eb4986eb2e"></a><!-- doxytag: member="smdi.h::ast_smdi_mwi_set" ref="6018412a2ff79bc26234e3eb4986eb2e" args="(struct ast_smdi_interface *iface, const char *mailbox)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_smdi_mwi_set           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>iface</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>mailbox</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Set the MWI indicator for a mailbox. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>iface</em>&nbsp;</td><td>the interface to use. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mailbox</em>&nbsp;</td><td>the mailbox to use. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="res__smdi_8c-source.html#l00092">92</a> of file <a class="el" href="res__smdi_8c-source.html">res_smdi.c</a>.
<p>
References <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="manager_8h-source.html#l00166">file</a>, and <a class="el" href="logger_8h-source.html#l00118">LOG_ERROR</a>.
<p>
Referenced by <a class="el" href="app__voicemail_8c-source.html#l02907">run_externnotify()</a>.<div class="fragment"><pre class="fragment"><a name="l00093"></a>00093 {
<a name="l00094"></a>00094    FILE *<a class="code" href="manager_8h.html#8c7dd922ad47494fc02c388e12c00eac">file</a>;
<a name="l00095"></a>00095    <span class="keywordtype">int</span> i;
<a name="l00096"></a>00096    
<a name="l00097"></a>00097    file = fopen(iface-&gt;name, <span class="stringliteral">"w"</span>);
<a name="l00098"></a>00098    <span class="keywordflow">if</span>(!file) {
<a name="l00099"></a>00099       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#4490aa3d29644e716440fada68f54032">LOG_ERROR</a>, <span class="stringliteral">"Error opening SMDI interface %s (%s) for writing\n"</span>, iface-&gt;name, strerror(errno));
<a name="l00100"></a>00100       <span class="keywordflow">return</span> 1;
<a name="l00101"></a>00101    }  
<a name="l00102"></a>00102 
<a name="l00103"></a>00103    <a class="code" href="astobj_8h.html#f2673da846e4ebbd185b124fa113d321">ASTOBJ_WRLOCK</a>(iface);
<a name="l00104"></a>00104 
<a name="l00105"></a>00105    fprintf(file, <span class="stringliteral">"OP:MWI "</span>);
<a name="l00106"></a>00106 
<a name="l00107"></a>00107    <span class="keywordflow">for</span>(i = 0; i &lt; iface-&gt;<a class="code" href="structast__smdi__interface.html#9945c467d67fd7068c26fcedec175dd8">msdstrip</a>; i++)
<a name="l00108"></a>00108       fprintf(file, <span class="stringliteral">"0"</span>);
<a name="l00109"></a>00109 
<a name="l00110"></a>00110    fprintf(file, <span class="stringliteral">"%s!\x04"</span>, <a class="code" href="chan__mgcp_8c.html#be2fc5fd64209e633c78549d39c04fb2">mailbox</a>);
<a name="l00111"></a>00111    fclose(file);
<a name="l00112"></a>00112 
<a name="l00113"></a>00113    <a class="code" href="astobj_8h.html#09df6ddac721782b63dde9c9247b5285">ASTOBJ_UNLOCK</a>(iface);
<a name="l00114"></a>00114    <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a>)
<a name="l00115"></a>00115       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"Sent MWI set message for %s on %s\n"</span>, <a class="code" href="chan__mgcp_8c.html#be2fc5fd64209e633c78549d39c04fb2">mailbox</a>, iface-&gt;name);
<a name="l00116"></a>00116    <span class="keywordflow">return</span> 0;
<a name="l00117"></a>00117 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="be4f7404e1d8acc32800d2f7ed9ba08c"></a><!-- doxytag: member="smdi.h::ast_smdi_mwi_unset" ref="be4f7404e1d8acc32800d2f7ed9ba08c" args="(struct ast_smdi_interface *iface, const char *mailbox)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_smdi_mwi_unset           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structast__smdi__interface.html">ast_smdi_interface</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>iface</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>mailbox</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Unset the MWI indicator for a mailbox. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>iface</em>&nbsp;</td><td>the interface to use. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mailbox</em>&nbsp;</td><td>the mailbox to use. </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="res__smdi_8c-source.html#l00124">124</a> of file <a class="el" href="res__smdi_8c-source.html">res_smdi.c</a>.
<p>
References <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="manager_8h-source.html#l00166">file</a>, and <a class="el" href="logger_8h-source.html#l00118">LOG_ERROR</a>.
<p>
Referenced by <a class="el" href="app__voicemail_8c-source.html#l02907">run_externnotify()</a>.<div class="fragment"><pre class="fragment"><a name="l00125"></a>00125 {
<a name="l00126"></a>00126    FILE *<a class="code" href="manager_8h.html#8c7dd922ad47494fc02c388e12c00eac">file</a>;
<a name="l00127"></a>00127    <span class="keywordtype">int</span> i;
<a name="l00128"></a>00128    
<a name="l00129"></a>00129    file = fopen(iface-&gt;name, <span class="stringliteral">"w"</span>);
<a name="l00130"></a>00130    <span class="keywordflow">if</span>(!file) {
<a name="l00131"></a>00131       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#4490aa3d29644e716440fada68f54032">LOG_ERROR</a>, <span class="stringliteral">"Error opening SMDI interface %s (%s) for writing\n"</span>, iface-&gt;name, strerror(errno));
<a name="l00132"></a>00132       <span class="keywordflow">return</span> 1;
<a name="l00133"></a>00133    }  
<a name="l00134"></a>00134 
<a name="l00135"></a>00135    <a class="code" href="astobj_8h.html#f2673da846e4ebbd185b124fa113d321">ASTOBJ_WRLOCK</a>(iface);
<a name="l00136"></a>00136 
<a name="l00137"></a>00137    fprintf(file, <span class="stringliteral">"RMV:MWI "</span>);
<a name="l00138"></a>00138 
<a name="l00139"></a>00139    <span class="keywordflow">for</span>(i = 0; i &lt; iface-&gt;<a class="code" href="structast__smdi__interface.html#9945c467d67fd7068c26fcedec175dd8">msdstrip</a>; i++)
<a name="l00140"></a>00140       fprintf(file, <span class="stringliteral">"0"</span>);
<a name="l00141"></a>00141 
<a name="l00142"></a>00142    fprintf(file, <span class="stringliteral">"%s!\x04"</span>, <a class="code" href="chan__mgcp_8c.html#be2fc5fd64209e633c78549d39c04fb2">mailbox</a>);
<a name="l00143"></a>00143    fclose(file);
<a name="l00144"></a>00144 
<a name="l00145"></a>00145    <a class="code" href="astobj_8h.html#09df6ddac721782b63dde9c9247b5285">ASTOBJ_UNLOCK</a>(iface);
<a name="l00146"></a>00146    <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#g1cc76c5e6a626e61ced4609749a57a6e">option_debug</a>)
<a name="l00147"></a>00147       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#eded50d942c7c2d37d09ba8241ff017f">LOG_DEBUG</a>, <span class="stringliteral">"Sent MWI unset message for %s on %s\n"</span>, <a class="code" href="chan__mgcp_8c.html#be2fc5fd64209e633c78549d39c04fb2">mailbox</a>, iface-&gt;name);
<a name="l00148"></a>00148    <span class="keywordflow">return</span> 0;
<a name="l00149"></a>00149 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu May 24 22:27:47 2007 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.5 </small></address>
</body>
</html>
