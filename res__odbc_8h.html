<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (24 May 2007)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Thu May 24 22:27:44 2007</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>Globals</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Finclude_2F.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir__2Fusr_2Flocal_2Fsrc_2Fasterisk_2Esvn_2Fastum_2Finclude_2Fasterisk_2F.html">asterisk</a></div>
<h1>res_odbc.h File Reference</h1>ODBC resource manager. <a href="#_details">More...</a>
<p>
<code>#include &lt;sql.h&gt;</code><br>
<code>#include &lt;sqlext.h&gt;</code><br>
<code>#include &lt;sqltypes.h&gt;</code><br>

<p>
<a href="res__odbc_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structodbc__obj.html">odbc_obj</a></td></tr>

<tr><td colspan="2"><br><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8h.html#84c51aa1304300f5998525c675616e1d">odbc_status</a> { <a class="el" href="res__odbc_8h.html#84c51aa1304300f5998525c675616e1d52980cf07eb0cd6d8a1a6009ece2413d">ODBC_SUCCESS</a> = 0, 
<a class="el" href="res__odbc_8h.html#84c51aa1304300f5998525c675616e1d811154e1a371e8517989c329c5499980">ODBC_FAIL</a> = -1
 }</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">SQLHSTMT&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8h.html#bf1b89cadc264a6dc88d710c1adc3d8b">ast_odbc_prepare_and_execute</a> (struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj, SQLHSTMT(*prepare_cb)(struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj, void *data), void *data)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Prepares, executes, and returns the resulting statement handle.  <a href="#bf1b89cadc264a6dc88d710c1adc3d8b"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8h.html#4d7bd206977d04ca110b3850529a5a52">ast_odbc_release_obj</a> (struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Releases an ODBC object previously allocated by odbc_request_obj().  <a href="#4d7bd206977d04ca110b3850529a5a52"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="structodbc__obj.html">odbc_obj</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8h.html#ec1931837e30ff1bf6ec10ae7901328d">ast_odbc_request_obj</a> (const char *<a class="el" href="cdr__tds_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>, int check)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Retrieves a connected ODBC object.  <a href="#ec1931837e30ff1bf6ec10ae7901328d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8h.html#51a9d1dfb7cccabfde99c97efb0ca968">ast_odbc_sanity_check</a> (struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks an ODBC object to ensure it is still connected.  <a href="#51a9d1dfb7cccabfde99c97efb0ca968"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__odbc_8h.html#97debb2a25b7aa98164e8372dded0427">ast_odbc_smart_execute</a> (struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj, SQLHSTMT stmt)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Executes a prepared statement handle.  <a href="#97debb2a25b7aa98164e8372dded0427"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
ODBC resource manager. 
<p>

<p>
Definition in file <a class="el" href="res__odbc_8h-source.html">res_odbc.h</a>.<hr><h2>Enumeration Type Documentation</h2>
<a class="anchor" name="84c51aa1304300f5998525c675616e1d"></a><!-- doxytag: member="res_odbc.h::odbc_status" ref="84c51aa1304300f5998525c675616e1d" args="" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">enum <a class="el" href="res__odbc_8h.html#84c51aa1304300f5998525c675616e1d">odbc_status</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Enumerator: </b></dt><dd>
<table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" name="84c51aa1304300f5998525c675616e1d52980cf07eb0cd6d8a1a6009ece2413d"></a><!-- doxytag: member="ODBC_SUCCESS" ref="84c51aa1304300f5998525c675616e1d52980cf07eb0cd6d8a1a6009ece2413d" args="" -->ODBC_SUCCESS</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" name="84c51aa1304300f5998525c675616e1d811154e1a371e8517989c329c5499980"></a><!-- doxytag: member="ODBC_FAIL" ref="84c51aa1304300f5998525c675616e1d811154e1a371e8517989c329c5499980" args="" -->ODBC_FAIL</em>&nbsp;</td><td>
</td></tr>
</table>
</dl>

<p>
Definition at line <a class="el" href="res__odbc_8h-source.html#l00034">34</a> of file <a class="el" href="res__odbc_8h-source.html">res_odbc.h</a>.<div class="fragment"><pre class="fragment"><a name="l00034"></a>00034 { <a class="code" href="res__odbc_8h.html#84c51aa1304300f5998525c675616e1d52980cf07eb0cd6d8a1a6009ece2413d">ODBC_SUCCESS</a>=0, <a class="code" href="res__odbc_8h.html#84c51aa1304300f5998525c675616e1d811154e1a371e8517989c329c5499980">ODBC_FAIL</a>=-1} <a class="code" href="res__odbc_8h.html#84c51aa1304300f5998525c675616e1d">odbc_status</a>;
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="bf1b89cadc264a6dc88d710c1adc3d8b"></a><!-- doxytag: member="res_odbc.h::ast_odbc_prepare_and_execute" ref="bf1b89cadc264a6dc88d710c1adc3d8b" args="(struct odbc_obj *obj, SQLHSTMT(*prepare_cb)(struct odbc_obj *obj, void *data), void *data)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">SQLHSTMT ast_odbc_prepare_and_execute           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>SQLHSTMT(*)(struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj, void *data)&nbsp;</td>
          <td class="mdname" nowrap> <em>prepare_cb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>data</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Prepares, executes, and returns the resulting statement handle. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>obj</em>&nbsp;</td><td>The ODBC object </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>prepare_cb</em>&nbsp;</td><td>A function callback, which, when called, should return a statement handle prepared, with any necessary parameters or result columns bound. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>A parameter to be passed to the prepare_cb parameter function, indicating which statement handle is to be prepared. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Returns a statement handle or NULL on error. </dd></dl>

<p>
Definition at line <a class="el" href="res__odbc_8c-source.html#l00079">79</a> of file <a class="el" href="res__odbc_8c-source.html">res_odbc.c</a>.
<p>
References <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="res__odbc_8c-source.html#l00172">ast_odbc_sanity_check()</a>, and <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>.
<p>
Referenced by <a class="el" href="func__odbc_8c-source.html#l00199">acf_odbc_read()</a>, <a class="el" href="func__odbc_8c-source.html#l00099">acf_odbc_write()</a>, <a class="el" href="res__config__odbc_8c-source.html#l00483">config_odbc()</a>, and <a class="el" href="cdr__adaptive__odbc_8c-source.html#l00299">odbc_log()</a>.<div class="fragment"><pre class="fragment"><a name="l00080"></a>00080 {
<a name="l00081"></a>00081    <span class="keywordtype">int</span> res = 0, i, attempt;
<a name="l00082"></a>00082    SQLINTEGER nativeerror=0, numfields=0;
<a name="l00083"></a>00083    SQLSMALLINT diagbytes=0;
<a name="l00084"></a>00084    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structstate.html">state</a>[10], diagnostic[256];
<a name="l00085"></a>00085    SQLHSTMT stmt;
<a name="l00086"></a>00086 
<a name="l00087"></a>00087    <span class="keywordflow">for</span> (attempt = 0; attempt &lt; 2; attempt++) {
<a name="l00088"></a>00088       <span class="comment">/* This prepare callback may do more than just prepare -- it may also</span>
<a name="l00089"></a>00089 <span class="comment">       * bind parameters, bind results, etc.  The real key, here, is that</span>
<a name="l00090"></a>00090 <span class="comment">       * when we disconnect, all handles become invalid for most databases.</span>
<a name="l00091"></a>00091 <span class="comment">       * We must therefore redo everything when we establish a new</span>
<a name="l00092"></a>00092 <span class="comment">       * connection. */</span>
<a name="l00093"></a>00093       stmt = prepare_cb(obj, data);
<a name="l00094"></a>00094 
<a name="l00095"></a>00095       <span class="keywordflow">if</span> (stmt) {
<a name="l00096"></a>00096          res = SQLExecute(stmt);
<a name="l00097"></a>00097          <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO) &amp;&amp; (res != SQL_NO_DATA)) {
<a name="l00098"></a>00098             <span class="keywordflow">if</span> (res == SQL_ERROR) {
<a name="l00099"></a>00099                SQLGetDiagField(SQL_HANDLE_STMT, stmt, 1, SQL_DIAG_NUMBER, &amp;numfields, SQL_IS_INTEGER, &amp;diagbytes);
<a name="l00100"></a>00100                <span class="keywordflow">for</span> (i = 0; i &lt; numfields; i++) {
<a name="l00101"></a>00101                   SQLGetDiagRec(SQL_HANDLE_STMT, stmt, i + 1, state, &amp;nativeerror, diagnostic, <span class="keyword">sizeof</span>(diagnostic), &amp;diagbytes);
<a name="l00102"></a>00102                   <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"SQL Execute returned an error %d: %s: %s (%d)\n"</span>, res, state, diagnostic, diagbytes);
<a name="l00103"></a>00103                   <span class="keywordflow">if</span> (i &gt; 10) {
<a name="l00104"></a>00104                      <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Oh, that was good.  There are really %d diagnostics?\n"</span>, (<span class="keywordtype">int</span>)numfields);
<a name="l00105"></a>00105                      <span class="keywordflow">break</span>;
<a name="l00106"></a>00106                   }
<a name="l00107"></a>00107                }
<a name="l00108"></a>00108             }
<a name="l00109"></a>00109 
<a name="l00110"></a>00110             <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"SQL Execute error %d! Attempting a reconnect...\n"</span>, res);
<a name="l00111"></a>00111             SQLFreeHandle(SQL_HANDLE_STMT, stmt);
<a name="l00112"></a>00112             stmt = NULL;
<a name="l00113"></a>00113 
<a name="l00114"></a>00114             obj-&gt;<a class="code" href="structodbc__obj.html#46c48bec0d282018b9d167eef7711b2c">up</a> = 0;
<a name="l00115"></a>00115             <span class="comment">/*</span>
<a name="l00116"></a>00116 <span class="comment">             * While this isn't the best way to try to correct an error, this won't automatically</span>
<a name="l00117"></a>00117 <span class="comment">             * fail when the statement handle invalidates.</span>
<a name="l00118"></a>00118 <span class="comment">             */</span>
<a name="l00119"></a>00119             <a class="code" href="res__odbc_8h.html#51a9d1dfb7cccabfde99c97efb0ca968">ast_odbc_sanity_check</a>(obj);
<a name="l00120"></a>00120             <span class="keywordflow">continue</span>;
<a name="l00121"></a>00121          }
<a name="l00122"></a>00122          <span class="keywordflow">break</span>;
<a name="l00123"></a>00123       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (attempt == 0)
<a name="l00124"></a>00124          <a class="code" href="res__odbc_8h.html#51a9d1dfb7cccabfde99c97efb0ca968">ast_odbc_sanity_check</a>(obj);
<a name="l00125"></a>00125    }
<a name="l00126"></a>00126 
<a name="l00127"></a>00127    <span class="keywordflow">return</span> stmt;
<a name="l00128"></a>00128 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="4d7bd206977d04ca110b3850529a5a52"></a><!-- doxytag: member="res_odbc.h::ast_odbc_release_obj" ref="4d7bd206977d04ca110b3850529a5a52" args="(struct odbc_obj *obj)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ast_odbc_release_obj           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>obj</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Releases an ODBC object previously allocated by odbc_request_obj(). 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>obj</em>&nbsp;</td><td>The ODBC object </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="res__odbc_8c-source.html#l00377">377</a> of file <a class="el" href="res__odbc_8c-source.html">res_odbc.c</a>.
<p>
References <a class="el" href="res__odbc_8h-source.html#l00040">odbc_obj::used</a>.
<p>
Referenced by <a class="el" href="func__odbc_8c-source.html#l00199">acf_odbc_read()</a>, <a class="el" href="func__odbc_8c-source.html#l00099">acf_odbc_write()</a>, <a class="el" href="res__config__odbc_8c-source.html#l00483">config_odbc()</a>, <a class="el" href="cdr__adaptive__odbc_8c-source.html#l00083">load_config()</a>, <a class="el" href="cdr__adaptive__odbc_8c-source.html#l00299">odbc_log()</a>, <a class="el" href="res__odbc_8c-source.html#l00355">odbc_register_class()</a>, <a class="el" href="res__config__odbc_8c-source.html#l00204">realtime_multi_odbc()</a>, <a class="el" href="res__config__odbc_8c-source.html#l00056">realtime_odbc()</a>, and <a class="el" href="res__config__odbc_8c-source.html#l00361">update_odbc()</a>.<div class="fragment"><pre class="fragment"><a name="l00378"></a>00378 {
<a name="l00379"></a>00379    <span class="comment">/* For pooled connections, this frees the connection to be</span>
<a name="l00380"></a>00380 <span class="comment">    * reused.  For non-pooled connections, it does nothing. */</span>
<a name="l00381"></a>00381    obj-&gt;<a class="code" href="structodbc__obj.html#1aec9c5d0644e11fd9dd0f9fb36009fb">used</a> = 0;
<a name="l00382"></a>00382 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="ec1931837e30ff1bf6ec10ae7901328d"></a><!-- doxytag: member="res_odbc.h::ast_odbc_request_obj" ref="ec1931837e30ff1bf6ec10ae7901328d" args="(const char *name, int check)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">struct <a class="el" href="structodbc__obj.html">odbc_obj</a>* ast_odbc_request_obj           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">const char *&nbsp;</td>
          <td class="mdname" nowrap> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>check</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Retrieves a connected ODBC object. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>The name of the ODBC class for which a connection is needed. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>check</em>&nbsp;</td><td>Whether to ensure that a connection is valid before returning the handle. Usually unnecessary. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Returns an ODBC object or NULL if there is no connection available with the requested name.</dd></dl>
Connection classes may, in fact, contain multiple connection handles. If the connection is pooled, then each connection will be dedicated to the thread which requests it. Note that all connections should be released when the thread is done by calling odbc_release_obj(), below. 
<p>
Definition at line <a class="el" href="res__odbc_8c-source.html#l00384">384</a> of file <a class="el" href="res__odbc_8c-source.html">res_odbc.c</a>.
<p>
References <a class="el" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>, <a class="el" href="linkedlists_8h-source.html#l00650">AST_LIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h-source.html#l00670">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h-source.html#l00038">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h-source.html#l00453">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h-source.html#l00104">AST_LIST_UNLOCK</a>, <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="lock_8h-source.html#l00525">ast_mutex_destroy()</a>, <a class="el" href="lock_8h-source.html#l00508">ast_mutex_init()</a>, <a class="el" href="res__odbc_8c-source.html#l00172">ast_odbc_sanity_check()</a>, <a class="el" href="astmm_8h-source.html#l00069">free</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="res__odbc_8h.html#84c51aa1304300f5998525c675616e1d811154e1a371e8517989c329c5499980">ODBC_FAIL</a>, <a class="el" href="res__odbc_8c-source.html#l00473">odbc_obj_connect()</a>, and <a class="el" href="res__odbc_8h-source.html#l00040">odbc_obj::used</a>.
<p>
Referenced by <a class="el" href="func__odbc_8c-source.html#l00199">acf_odbc_read()</a>, <a class="el" href="func__odbc_8c-source.html#l00099">acf_odbc_write()</a>, <a class="el" href="res__config__odbc_8c-source.html#l00483">config_odbc()</a>, <a class="el" href="cdr__adaptive__odbc_8c-source.html#l00083">load_config()</a>, <a class="el" href="cdr__adaptive__odbc_8c-source.html#l00299">odbc_log()</a>, <a class="el" href="res__odbc_8c-source.html#l00355">odbc_register_class()</a>, <a class="el" href="res__config__odbc_8c-source.html#l00204">realtime_multi_odbc()</a>, <a class="el" href="res__config__odbc_8c-source.html#l00056">realtime_odbc()</a>, and <a class="el" href="res__config__odbc_8c-source.html#l00361">update_odbc()</a>.<div class="fragment"><pre class="fragment"><a name="l00385"></a>00385 {
<a name="l00386"></a>00386    <span class="keyword">struct </span><a class="code" href="structodbc__obj.html">odbc_obj</a> *obj = NULL;
<a name="l00387"></a>00387    <span class="keyword">struct </span><a class="code" href="structodbc__class.html">odbc_class</a> *<span class="keyword">class</span>;
<a name="l00388"></a>00388 
<a name="l00389"></a>00389    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;odbc_list);
<a name="l00390"></a>00390    <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;odbc_list, <span class="keyword">class</span>, list) {
<a name="l00391"></a>00391       <span class="keywordflow">if</span> (!strcmp(class-&gt;name, <a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>))
<a name="l00392"></a>00392          <span class="keywordflow">break</span>;
<a name="l00393"></a>00393    }
<a name="l00394"></a>00394    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;odbc_list);
<a name="l00395"></a>00395 
<a name="l00396"></a>00396    <span class="keywordflow">if</span> (!<span class="keyword">class</span>)
<a name="l00397"></a>00397       <span class="keywordflow">return</span> NULL;
<a name="l00398"></a>00398 
<a name="l00399"></a>00399    <a class="code" href="linkedlists_8h.html#44d46016bec4f7c50450973666ce638d">AST_LIST_LOCK</a>(&amp;class-&gt;odbc_obj);
<a name="l00400"></a>00400    <span class="keywordflow">if</span> (class-&gt;haspool) {
<a name="l00401"></a>00401       <span class="comment">/* Recycle connections before building another */</span>
<a name="l00402"></a>00402       <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;class-&gt;odbc_obj, obj, list) {
<a name="l00403"></a>00403          <span class="keywordflow">if</span> (! obj-&gt;<a class="code" href="structodbc__obj.html#1aec9c5d0644e11fd9dd0f9fb36009fb">used</a>) {
<a name="l00404"></a>00404             obj-&gt;<a class="code" href="structodbc__obj.html#1aec9c5d0644e11fd9dd0f9fb36009fb">used</a> = 1;
<a name="l00405"></a>00405             <span class="keywordflow">break</span>;
<a name="l00406"></a>00406          }
<a name="l00407"></a>00407       }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409       <span class="keywordflow">if</span> (!obj &amp;&amp; (class-&gt;count &lt; class-&gt;limit)) {
<a name="l00410"></a>00410          <span class="keyword">class</span>-&gt;count++;
<a name="l00411"></a>00411          obj = <a class="code" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*obj));
<a name="l00412"></a>00412          <span class="keywordflow">if</span> (!obj) {
<a name="l00413"></a>00413             <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;class-&gt;odbc_obj);
<a name="l00414"></a>00414             <span class="keywordflow">return</span> NULL;
<a name="l00415"></a>00415          }
<a name="l00416"></a>00416          <a class="code" href="lock_8h.html#33e99ac90b0ca47211841b5cab79ffc4">ast_mutex_init</a>(&amp;obj-&gt;<a class="code" href="structodbc__obj.html#dce7c4174ce9323904a934a486c41288">lock</a>);
<a name="l00417"></a>00417          obj-&gt;<a class="code" href="structodbc__obj.html#d0e45878043844ffc41aac437e86b602">parent</a> = <span class="keyword">class</span>;
<a name="l00418"></a>00418          <a class="code" href="res__odbc_8c.html#5339baa4ffe6373fc7d14e18a392c430">odbc_obj_connect</a>(obj);
<a name="l00419"></a>00419          <a class="code" href="linkedlists_8h.html#8de6ce8a3b9d59e7e7fddee6b62b32a7">AST_LIST_INSERT_TAIL</a>(&amp;class-&gt;odbc_obj, obj, list);
<a name="l00420"></a>00420       }
<a name="l00421"></a>00421    } <span class="keywordflow">else</span> {
<a name="l00422"></a>00422       <span class="comment">/* Non-pooled connection: multiple modules can use the same connection. */</span>
<a name="l00423"></a>00423       <a class="code" href="linkedlists_8h.html#e5bbda4b7ef1cd9462bb86ba25c5d7eb">AST_LIST_TRAVERSE</a>(&amp;class-&gt;odbc_obj, obj, list) {
<a name="l00424"></a>00424          <span class="comment">/* Non-pooled connection: if there is an entry, return it */</span>
<a name="l00425"></a>00425          <span class="keywordflow">break</span>;
<a name="l00426"></a>00426       }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428       <span class="keywordflow">if</span> (!obj) {
<a name="l00429"></a>00429          <span class="comment">/* No entry: build one */</span>
<a name="l00430"></a>00430          obj = <a class="code" href="utils_8h.html#27f1d0ddbd22dac569b18963c5cb7e19">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*obj));
<a name="l00431"></a>00431          <span class="keywordflow">if</span> (!obj) {
<a name="l00432"></a>00432             <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;class-&gt;odbc_obj);
<a name="l00433"></a>00433             <span class="keywordflow">return</span> NULL;
<a name="l00434"></a>00434          }
<a name="l00435"></a>00435          <a class="code" href="lock_8h.html#33e99ac90b0ca47211841b5cab79ffc4">ast_mutex_init</a>(&amp;obj-&gt;<a class="code" href="structodbc__obj.html#dce7c4174ce9323904a934a486c41288">lock</a>);
<a name="l00436"></a>00436          obj-&gt;<a class="code" href="structodbc__obj.html#d0e45878043844ffc41aac437e86b602">parent</a> = <span class="keyword">class</span>;
<a name="l00437"></a>00437          <span class="keywordflow">if</span> (<a class="code" href="res__odbc_8c.html#5339baa4ffe6373fc7d14e18a392c430">odbc_obj_connect</a>(obj) == <a class="code" href="res__odbc_8h.html#84c51aa1304300f5998525c675616e1d811154e1a371e8517989c329c5499980">ODBC_FAIL</a>) {
<a name="l00438"></a>00438             <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Failed to connect to %s\n"</span>, <a class="code" href="callerid_8c.html#b068931cc450442b63f5b3d276ea4297">name</a>);
<a name="l00439"></a>00439             <a class="code" href="lock_8h.html#1b27af7774f46859ffe2b1340ee7c082">ast_mutex_destroy</a>(&amp;obj-&gt;<a class="code" href="structodbc__obj.html#dce7c4174ce9323904a934a486c41288">lock</a>);
<a name="l00440"></a>00440             <a class="code" href="astmm_8h.html#eb051e552619427a26721b1a925a56e8">free</a>(obj);
<a name="l00441"></a>00441             obj = NULL;
<a name="l00442"></a>00442          } <span class="keywordflow">else</span> {
<a name="l00443"></a>00443             <a class="code" href="linkedlists_8h.html#5df56040a8838bdc841ef8eb179b7609">AST_LIST_INSERT_HEAD</a>(&amp;class-&gt;odbc_obj, obj, list);
<a name="l00444"></a>00444          }
<a name="l00445"></a>00445       }
<a name="l00446"></a>00446    }
<a name="l00447"></a>00447    <a class="code" href="linkedlists_8h.html#1829cc3d91ee394b65b7379f68ab3dad">AST_LIST_UNLOCK</a>(&amp;class-&gt;odbc_obj);
<a name="l00448"></a>00448 
<a name="l00449"></a>00449    <span class="keywordflow">if</span> (obj &amp;&amp; check) {
<a name="l00450"></a>00450       <a class="code" href="res__odbc_8h.html#51a9d1dfb7cccabfde99c97efb0ca968">ast_odbc_sanity_check</a>(obj);
<a name="l00451"></a>00451    }
<a name="l00452"></a>00452    <span class="keywordflow">return</span> obj;
<a name="l00453"></a>00453 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="51a9d1dfb7cccabfde99c97efb0ca968"></a><!-- doxytag: member="res_odbc.h::ast_odbc_sanity_check" ref="51a9d1dfb7cccabfde99c97efb0ca968" args="(struct odbc_obj *obj)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_odbc_sanity_check           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>obj</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Checks an ODBC object to ensure it is still connected. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>obj</em>&nbsp;</td><td>The ODBC object </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Returns 0 if connected, -1 otherwise. </dd></dl>

<p>
Definition at line <a class="el" href="res__odbc_8c-source.html#l00172">172</a> of file <a class="el" href="res__odbc_8c-source.html">res_odbc.c</a>.
<p>
References <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="res__odbc_8h-source.html#l00038">odbc_obj::con</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="res__odbc_8c-source.html#l00473">odbc_obj_connect()</a>, <a class="el" href="res__odbc_8c-source.html#l00455">odbc_obj_disconnect()</a>, <a class="el" href="res__odbc_8h-source.html#l00039">odbc_obj::parent</a>, and <a class="el" href="res__odbc_8h-source.html#l00041">odbc_obj::up</a>.
<p>
Referenced by <a class="el" href="res__odbc_8c-source.html#l00079">ast_odbc_prepare_and_execute()</a>, <a class="el" href="res__odbc_8c-source.html#l00384">ast_odbc_request_obj()</a>, and <a class="el" href="res__odbc_8c-source.html#l00312">odbc_show_command()</a>.<div class="fragment"><pre class="fragment"><a name="l00173"></a>00173 {
<a name="l00174"></a>00174    <span class="keywordtype">char</span> *test_sql = <span class="stringliteral">"select 1"</span>;
<a name="l00175"></a>00175    SQLHSTMT stmt;
<a name="l00176"></a>00176    <span class="keywordtype">int</span> res = 0;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178    <span class="keywordflow">if</span> (obj-&gt;<a class="code" href="structodbc__obj.html#d0e45878043844ffc41aac437e86b602">parent</a>-&gt;sanitysql)
<a name="l00179"></a>00179       test_sql = obj-&gt;<a class="code" href="structodbc__obj.html#d0e45878043844ffc41aac437e86b602">parent</a>-&gt;sanitysql;
<a name="l00180"></a>00180 
<a name="l00181"></a>00181    <span class="keywordflow">if</span> (obj-&gt;<a class="code" href="structodbc__obj.html#46c48bec0d282018b9d167eef7711b2c">up</a>) {
<a name="l00182"></a>00182       res = SQLAllocHandle(SQL_HANDLE_STMT, obj-&gt;<a class="code" href="structodbc__obj.html#7ed201fa20d25d22b291dc85ae9e5ced">con</a>, &amp;stmt);
<a name="l00183"></a>00183       <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00184"></a>00184          obj-&gt;<a class="code" href="structodbc__obj.html#46c48bec0d282018b9d167eef7711b2c">up</a> = 0;
<a name="l00185"></a>00185       } <span class="keywordflow">else</span> {
<a name="l00186"></a>00186          res = SQLPrepare(stmt, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)test_sql, SQL_NTS);
<a name="l00187"></a>00187          <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00188"></a>00188             obj-&gt;<a class="code" href="structodbc__obj.html#46c48bec0d282018b9d167eef7711b2c">up</a> = 0;
<a name="l00189"></a>00189          } <span class="keywordflow">else</span> {
<a name="l00190"></a>00190             res = SQLExecute(stmt);
<a name="l00191"></a>00191             <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00192"></a>00192                obj-&gt;<a class="code" href="structodbc__obj.html#46c48bec0d282018b9d167eef7711b2c">up</a> = 0;
<a name="l00193"></a>00193             }
<a name="l00194"></a>00194          }
<a name="l00195"></a>00195       }
<a name="l00196"></a>00196       SQLFreeHandle (SQL_HANDLE_STMT, stmt);
<a name="l00197"></a>00197    }
<a name="l00198"></a>00198 
<a name="l00199"></a>00199    <span class="keywordflow">if</span> (!obj-&gt;<a class="code" href="structodbc__obj.html#46c48bec0d282018b9d167eef7711b2c">up</a>) { <span class="comment">/* Try to reconnect! */</span>
<a name="l00200"></a>00200       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Connection is down attempting to reconnect...\n"</span>);
<a name="l00201"></a>00201       <a class="code" href="res__odbc_8c.html#440f2e0d3912c5fdebc9b8d36b8c21ff">odbc_obj_disconnect</a>(obj);
<a name="l00202"></a>00202       <a class="code" href="res__odbc_8c.html#5339baa4ffe6373fc7d14e18a392c430">odbc_obj_connect</a>(obj);
<a name="l00203"></a>00203    }
<a name="l00204"></a>00204    <span class="keywordflow">return</span> obj-&gt;<a class="code" href="structodbc__obj.html#46c48bec0d282018b9d167eef7711b2c">up</a>;
<a name="l00205"></a>00205 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="97debb2a25b7aa98164e8372dded0427"></a><!-- doxytag: member="res_odbc.h::ast_odbc_smart_execute" ref="97debb2a25b7aa98164e8372dded0427" args="(struct odbc_obj *obj, SQLHSTMT stmt)" --><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int ast_odbc_smart_execute           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td class="md"></td>
          <td class="md" nowrap>SQLHSTMT&nbsp;</td>
          <td class="mdname" nowrap> <em>stmt</em></td>
        </tr>
        <tr>
          <td class="md"></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Executes a prepared statement handle. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>obj</em>&nbsp;</td><td>The non-NULL result of odbc_request_obj() </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>stmt</em>&nbsp;</td><td>The prepared statement handle </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Returns 0 on success or -1 on failure</dd></dl>
This function was originally designed simply to execute a prepared statement handle and to retry if the initial execution failed. Unfortunately, it did this by disconnecting and reconnecting the database handle which on most databases causes the statement handle to become invalid. Therefore, this method has been deprecated in favor of odbc_prepare_and_execute() which allows the statement to be prepared multiple times, if necessary, in case of a loss of connection.<p>
This function really only ever worked with MySQL, where the statement handle is not prepared on the server. If you are not using MySQL, you should avoid it. 
<p>
Definition at line <a class="el" href="res__odbc_8c-source.html#l00130">130</a> of file <a class="el" href="res__odbc_8c-source.html">res_odbc.c</a>.
<p>
References <a class="el" href="logger_8c-source.html#l00866">ast_log()</a>, <a class="el" href="lock_8h-source.html#l00530">ast_mutex_lock()</a>, <a class="el" href="lock_8h-source.html#l00520">ast_mutex_unlock()</a>, <a class="el" href="res__odbc_8h-source.html#l00037">odbc_obj::lock</a>, <a class="el" href="logger_8h-source.html#l00112">LOG_WARNING</a>, <a class="el" href="res__odbc_8c-source.html#l00473">odbc_obj_connect()</a>, <a class="el" href="res__odbc_8c-source.html#l00455">odbc_obj_disconnect()</a>, and <a class="el" href="res__odbc_8h-source.html#l00041">odbc_obj::up</a>.
<p>
Referenced by <a class="el" href="res__config__odbc_8c-source.html#l00204">realtime_multi_odbc()</a>, <a class="el" href="res__config__odbc_8c-source.html#l00056">realtime_odbc()</a>, and <a class="el" href="res__config__odbc_8c-source.html#l00361">update_odbc()</a>.<div class="fragment"><pre class="fragment"><a name="l00131"></a>00131 {
<a name="l00132"></a>00132    <span class="keywordtype">int</span> res = 0, i;
<a name="l00133"></a>00133    SQLINTEGER nativeerror=0, numfields=0;
<a name="l00134"></a>00134    SQLSMALLINT diagbytes=0;
<a name="l00135"></a>00135    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structstate.html">state</a>[10], diagnostic[256];
<a name="l00136"></a>00136 
<a name="l00137"></a>00137    res = SQLExecute(stmt);
<a name="l00138"></a>00138    <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO) &amp;&amp; (res != SQL_NO_DATA)) {
<a name="l00139"></a>00139       <span class="keywordflow">if</span> (res == SQL_ERROR) {
<a name="l00140"></a>00140          SQLGetDiagField(SQL_HANDLE_STMT, stmt, 1, SQL_DIAG_NUMBER, &amp;numfields, SQL_IS_INTEGER, &amp;diagbytes);
<a name="l00141"></a>00141          <span class="keywordflow">for</span> (i = 0; i &lt; numfields; i++) {
<a name="l00142"></a>00142             SQLGetDiagRec(SQL_HANDLE_STMT, stmt, i + 1, state, &amp;nativeerror, diagnostic, <span class="keyword">sizeof</span>(diagnostic), &amp;diagbytes);
<a name="l00143"></a>00143             <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"SQL Execute returned an error %d: %s: %s (%d)\n"</span>, res, state, diagnostic, diagbytes);
<a name="l00144"></a>00144             <span class="keywordflow">if</span> (i &gt; 10) {
<a name="l00145"></a>00145                <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"Oh, that was good.  There are really %d diagnostics?\n"</span>, (<span class="keywordtype">int</span>)numfields);
<a name="l00146"></a>00146                <span class="keywordflow">break</span>;
<a name="l00147"></a>00147             }
<a name="l00148"></a>00148          }
<a name="l00149"></a>00149       }
<a name="l00150"></a>00150 <span class="preprocessor">#if 0</span>
<a name="l00151"></a>00151 <span class="preprocessor"></span>      <span class="comment">/* This is a really bad method of trying to correct a dead connection.  It</span>
<a name="l00152"></a>00152 <span class="comment">       * only ever really worked with MySQL.  It will not work with any other</span>
<a name="l00153"></a>00153 <span class="comment">       * database, since most databases prepare their statements on the server,</span>
<a name="l00154"></a>00154 <span class="comment">       * and if you disconnect, you invalidate the statement handle.  Hence, if</span>
<a name="l00155"></a>00155 <span class="comment">       * you disconnect, you're going to fail anyway, whether you try to execute</span>
<a name="l00156"></a>00156 <span class="comment">       * a second time or not.</span>
<a name="l00157"></a>00157 <span class="comment">       */</span>
<a name="l00158"></a>00158       <a class="code" href="logger_8c.html#46fbacc19de763bbca2547c1a9c6a5fa">ast_log</a>(<a class="code" href="logger_8h.html#d0cb3df3102ca9270c5785af9a8c137f">LOG_WARNING</a>, <span class="stringliteral">"SQL Execute error %d! Attempting a reconnect...\n"</span>, res);
<a name="l00159"></a>00159       <a class="code" href="lock_8h.html#b3c5e3093b325167f88db93c8b4b2421">ast_mutex_lock</a>(&amp;obj-&gt;<a class="code" href="structodbc__obj.html#dce7c4174ce9323904a934a486c41288">lock</a>);
<a name="l00160"></a>00160       obj-&gt;<a class="code" href="structodbc__obj.html#46c48bec0d282018b9d167eef7711b2c">up</a> = 0;
<a name="l00161"></a>00161       <a class="code" href="lock_8h.html#1d33e3caf152f0901c5ebdb69c2d4d26">ast_mutex_unlock</a>(&amp;obj-&gt;<a class="code" href="structodbc__obj.html#dce7c4174ce9323904a934a486c41288">lock</a>);
<a name="l00162"></a>00162       <a class="code" href="res__odbc_8c.html#440f2e0d3912c5fdebc9b8d36b8c21ff">odbc_obj_disconnect</a>(obj);
<a name="l00163"></a>00163       <a class="code" href="res__odbc_8c.html#5339baa4ffe6373fc7d14e18a392c430">odbc_obj_connect</a>(obj);
<a name="l00164"></a>00164       res = SQLExecute(stmt);
<a name="l00165"></a>00165 <span class="preprocessor">#endif</span>
<a name="l00166"></a>00166 <span class="preprocessor"></span>   }
<a name="l00167"></a>00167    
<a name="l00168"></a>00168    <span class="keywordflow">return</span> res;
<a name="l00169"></a>00169 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu May 24 22:27:44 2007 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.5 </small></address>
</body>
</html>
