<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (24 May 2007)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Thu May 24 22:27:55 2007</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.4.5 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul></div>
<h1><a class="anchor" name="CLI_command_api">CLI command API</a></h1>CLI commands are described by a struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> that contains all the components for their implementation.<p>
In the "old-style" format, the record must contain:<ul>
<li>a NULL-terminated array of words constituting the command, e.g. { "set", "debug", "on", NULL },</li><li>a summary string (short) and a usage string (longer);</li><li>a handler which implements the command itself, invoked with a file descriptor and argc/argv as typed by the user</li><li>a 'generator' function which, given a partial string, can generate legal completions for it. An example is</li></ul>
<p>
int old_setdebug(int fd, int argc, char *argv[]); char *dbg_complete(const char *line, const char *word, int pos, int n);<p>
{ { "set", "debug", "on", NULL }, do_setdebug, "Enable debugging", set_debug_usage, dbg_complete },<p>
In the "new-style" format, all the above functionalities are implemented by a single function, and the arguments tell which output is required. The prototype is the following:<p>
char *new_setdebug(const struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a);<p>
... this is how we create the entry to register NEW_CLI(new_setdebug, "short description") ...<p>
To help the transition, we make the pointer to the struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> available to old-style handlers via argv[-1].<p>
An example of new-style handler is the following<p>
<div class="fragment"><pre class="fragment"><span class="keyword">static</span> <span class="keywordtype">char</span> *test_new_cli(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="structast__cli__args.html">ast_cli_args</a> *a)
{
   <span class="keyword">static</span> <span class="keywordtype">char</span> *choices = { <span class="stringliteral">"one"</span>, <span class="stringliteral">"two"</span>, <span class="stringliteral">"three"</span>, NULL };

        <span class="keywordflow">switch</span> (cmd) {
        <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#cb9e7baa34e2b33943d2bfcc34bf340d835e08f776c41da0075f516f0353eb56">CLI_INIT</a>:
      e-&gt;<a class="code" href="structast__cli__entry.html#1dccadfed7bcbb036c56a4afb97e906f">command</a> = <span class="stringliteral">"do this well"</span>;
                e-&gt;<a class="code" href="structast__cli__entry.html#9366282e11c151558bdfaab4a264aa1b">usage</a> =
         <span class="stringliteral">"Usage: do this well &lt;arg&gt;\n"</span>
         <span class="stringliteral">"  typically multiline with body indented\n"</span>;
      <span class="keywordflow">return</span> NULL;

        <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#cb9e7baa34e2b33943d2bfcc34bf340d2f4c807e7bc4e767d91adc6ee3e8869e">CLI_GENERATE</a>:
                <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#5e0bdcbddccca4d66d74ba8c1cee1a68">pos</a> &gt; e-&gt;<a class="code" href="structast__cli__entry.html#a956af09162870af6ce4ebe0f12ccaf8">args</a>)
                        <span class="keywordflow">return</span> NULL;
         <span class="keywordflow">return</span> <a class="code" href="cli_8c.html#ff4b12b0f87714d5e22fdc54065104ac">ast_cli_complete</a>(a-&gt;<a class="code" href="structast__cli__args.html#c47d187067c6cf953245f128b5fde62a">word</a>, choices, a-&gt;<a class="code" href="structast__cli__args.html#7b8b965ad4bca0e41ab51de7b31363a1">n</a>);

        <span class="keywordflow">default</span>:        
                <span class="comment">// we are guaranteed to be called with argc &gt;= e-&gt;args;</span>
                <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#212be369d46788be295dbb6516442fee">argc</a> &gt; e-&gt;<a class="code" href="structast__cli__entry.html#a956af09162870af6ce4ebe0f12ccaf8">args</a> + 1) <span class="comment">// we accept one extra argument</span>
                        <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#8409e2cc535711ab81e051428521a8c6">CLI_SHOWUSAGE</a>;
                <a class="code" href="cli_8c.html#b610d6e1fd70e1b164d66a2ee22207dc">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#36eba1e1e343279857ea7f69a597324e">fd</a>, <span class="stringliteral">"done this well for %s\n"</span>, e-&gt;<a class="code" href="structast__cli__entry.html#a956af09162870af6ce4ebe0f12ccaf8">args</a>[argc-1]);
                <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#1feba2188d0c8b5f3bffccacea035b67">CLI_SUCCESS</a>;
        }
}
</pre></div> <hr size="1"><address style="align: right;"><small>Generated on Thu May 24 22:27:55 2007 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.5 </small></address>
</body>
</html>
